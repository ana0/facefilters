(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const{setupWebcam:setupWebcam}=require("./src/setUpWebcam.js");let{paintFace:paintFace}=require("./src/paint"),shaders=require("./src/pack.shaders.js");const multiRegl=require("./src/multi.js");let knownGoodShader=shaders.fragment;const div1=document.getElementById("target1"),regl1=multiRegl()(div1),div2=document.getElementById("target2"),regl2=multiRegl()(div2),lastFrame=regl2.texture(),targetAspect=1;let faceDetectionTexture1,faceDetectionTexture2,paintElement=document.getElementById("paint"),hasFace=!1,faceCenter=[.5,.5];function convertCoordinate([e,t],r,a){x=e/r,y=t/a,x=1-x,y=1-y,x=2*x-1,y=2*y-1;let o=r/a,i=x/(1/o),n=y;return 1<o&&(i=x,n=y/(o/1)),[i,n]}var image=document.getElementById("glacier");(image=new Image).src="./src/glacier.jpg",setupWebcam({regl1:regl1,regl2:regl2,done:(e,t,{videoWidth:r,videoHeight:a,getKeyPoints:o})=>{faceDetectionTexture1=regl1.texture(paintElement),faceDetectionTexture2=regl2.texture(paintElement);const i=regl2.texture(image),n=regl1.texture(image);let c=regl1({uniforms:{camTex:e,previousTex:lastFrame,maskTex:faceDetectionTexture1,glacierTex:n,videoResolution:[r,a],time:({time:e})=>e%1e4,hasFace:()=>hasFace,resolution:({viewportWidth:e,viewportHeight:t})=>[500,500],targetAspect:()=>1,scaledVideoResolution:({viewportWidth:e,viewportHeight:t})=>1,faceCenter:()=>convertCoordinate(faceCenter,r,a),leftEye:()=>convertCoordinate(window.leftEye,r,a),rightEye:()=>convertCoordinate(window.rightEye,r,a)},frag:()=>shaders.fragment,vert:()=>shaders.vertex,attributes:{position:[[-1,4],[-1,-1],[4,-1]]},count:3}),s=regl2({uniforms:{camTex:t,previousTex:lastFrame,maskTex:faceDetectionTexture2,glacierTex:i,videoResolution:[r,a],time:({time:e})=>e%1e4,hasFace:()=>hasFace,resolution:({viewportWidth:e,viewportHeight:t})=>[500,500],targetAspect:()=>1,scaledVideoResolution:({viewportWidth:e,viewportHeight:t})=>1,faceCenter:()=>convertCoordinate(faceCenter,r,a),leftEye:()=>convertCoordinate(window.leftEye,r,a),rightEye:()=>convertCoordinate(window.rightEye,r,a)},frag:()=>shaders.fragment,vert:()=>shaders.vertex,attributes:{position:[[-1,4],[-1,-1],[4,-1]]},count:3});regl1.frame(function(e){let t=o();t&&(hasFace=!0,faceCenter=t.noseTip[0],ctx=paintFace(t),faceDetectionTexture1.subimage(ctx));try{c()}catch(e){return console.log(e),void(shaders.fragment=knownGoodShader)}knownGoodShader=shaders.fragment,lastFrame({copy:!0})}),regl2.frame(function(e){let t=o();t&&(hasFace=!0,faceCenter=t.noseTip[0],ctx=paintFace(t),faceDetectionTexture2.subimage(ctx));try{s()}catch(e){return console.log(e),void(shaders.fragment=knownGoodShader)}knownGoodShader=shaders.fragment,lastFrame({copy:!0})})}});

},{"./src/multi.js":42,"./src/pack.shaders.js":43,"./src/paint":44,"./src/setUpWebcam.js":45}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tf=require("@tensorflow/tfjs-core");exports.disposeBox=(t=>{t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose()}),exports.createBox=(t=>({startEndTensor:t,startPoint:tf.slice(t,[0,0],[-1,2]),endPoint:tf.slice(t,[0,2],[-1,2])})),exports.scaleBox=((t,e)=>{const s=tf.mul(t.startPoint,e),o=tf.mul(t.endPoint,e),r=tf.concat2d([s,o],1);return exports.createBox(r)});

},{"@tensorflow/tfjs-core":13}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tf=require("@tensorflow/tfjs-core"),box_1=require("./box"),ANCHORS_CONFIG={strides:[8,16],anchors:[2,6]},NUM_LANDMARKS=6;function generateAnchors(t,e,s){const o=[];for(let i=0;i<s.strides.length;i++){const n=s.strides[i],a=Math.floor((e+n-1)/n),r=Math.floor((t+n-1)/n),c=s.anchors[i];for(let t=0;t<a;t++){const e=n*(t+.5);for(let t=0;t<r;t++){const s=n*(t+.5);for(let t=0;t<c;t++)o.push([s,e])}}}return o}function decodeBounds(t,e,s){const o=tf.slice(t,[0,1],[-1,2]),i=tf.add(o,e),n=tf.slice(t,[0,3],[-1,2]),a=tf.div(n,s),r=tf.div(i,s),c=tf.div(a,2),l=tf.sub(r,c),f=tf.add(r,c),d=tf.mul(l,s),h=tf.mul(f,s);return tf.concat2d([d,h],1)}function getInputTensorDimensions(t){return t instanceof tf.Tensor?[t.shape[0],t.shape[1]]:[t.height,t.width]}function flipFaceHorizontal(t,e){let s,o,i;if(t.topLeft instanceof tf.Tensor&&t.bottomRight instanceof tf.Tensor){const[n,a]=tf.tidy(()=>[tf.concat([tf.sub(e-1,t.topLeft.slice(0,1)),t.topLeft.slice(1,1)]),tf.concat([tf.sub(e-1,t.bottomRight.slice(0,1)),t.bottomRight.slice(1,1)])]);s=n,o=a,null!=t.landmarks&&(i=tf.tidy(()=>{const s=tf.sub(tf.tensor1d([e-1,0]),t.landmarks),o=tf.tensor1d([1,-1]);return tf.mul(s,o)}))}else{const[n,a]=t.topLeft,[r,c]=t.bottomRight;s=[e-1-n,a],o=[e-1-r,c],null!=t.landmarks&&(i=t.landmarks.map(t=>[e-1-t[0],t[1]]))}const n={topLeft:s,bottomRight:o};return null!=i&&(n.landmarks=i),null!=t.probability&&(n.probability=t.probability instanceof tf.Tensor?t.probability.clone():t.probability),n}function scaleBoxFromPrediction(t,e){return tf.tidy(()=>{let s;return s=t.hasOwnProperty("box")?t.box:t,box_1.scaleBox(s,e).startEndTensor.squeeze()})}class BlazeFaceModel{constructor(t,e,s,o,i,n){this.blazeFaceModel=t,this.width=e,this.height=s,this.maxFaces=o,this.anchorsData=generateAnchors(e,s,ANCHORS_CONFIG),this.anchors=tf.tensor2d(this.anchorsData),this.inputSizeData=[e,s],this.inputSize=tf.tensor1d([e,s]),this.iouThreshold=i,this.scoreThreshold=n}async getBoundingBoxes(t,e,s=!0){const[o,i,n]=tf.tidy(()=>{const e=t.resizeBilinear([this.width,this.height]),s=tf.mul(tf.sub(e.div(255),.5),2),o=this.blazeFaceModel.predict(s).squeeze(),i=decodeBounds(o,this.anchors,this.inputSize),n=tf.slice(o,[0,0],[-1,1]);return[o,i,tf.sigmoid(n).squeeze()]}),a=console.warn;console.warn=(()=>{});const r=tf.image.nonMaxSuppression(i,n,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=a;const c=await r.array();r.dispose();let l=c.map(t=>tf.slice(i,[t,0],[1,-1]));e||(l=await Promise.all(l.map(async t=>{const e=await t.array();return t.dispose(),e})));const f=t.shape[1],d=t.shape[2];let h;h=e?tf.div([d,f],this.inputSize):[d/this.inputSizeData[0],f/this.inputSizeData[1]];const p=[];for(let t=0;t<l.length;t++){const i=l[t],a=tf.tidy(()=>{const a=i instanceof tf.Tensor?box_1.createBox(i):box_1.createBox(tf.tensor2d(i));if(!s)return a;const r=c[t];let l;return l=e?this.anchors.slice([r,0],[1,2]):this.anchorsData[r],{box:a,landmarks:tf.slice(o,[r,NUM_LANDMARKS-1],[1,-1]).squeeze().reshape([NUM_LANDMARKS,-1]),probability:tf.slice(n,[r],[1]),anchor:l}});p.push(a)}return i.dispose(),n.dispose(),o.dispose(),{boxes:p,scaleFactor:h}}async estimateFaces(t,e=!1,s=!1,o=!0){const[,i]=getInputTensorDimensions(t),n=tf.tidy(()=>(t instanceof tf.Tensor||(t=tf.browser.fromPixels(t)),t.toFloat().expandDims(0))),{boxes:a,scaleFactor:r}=await this.getBoundingBoxes(n,e,o);return n.dispose(),e?a.map(t=>{const e=scaleBoxFromPrediction(t,r);let n={topLeft:e.slice([0],[2]),bottomRight:e.slice([2],[2])};if(o){const{landmarks:e,probability:s,anchor:o}=t,i=e.add(o).mul(r);n.landmarks=i,n.probability=s}return s&&(n=flipFaceHorizontal(n,i)),n}):Promise.all(a.map(async t=>{const e=scaleBoxFromPrediction(t,r);let n;if(o){const[s,o,i]=await Promise.all([t.landmarks,e,t.probability].map(async t=>t.array())),a=t.anchor,[c,l]=r,f=s.map(t=>[(t[0]+a[0])*c,(t[1]+a[1])*l]);n={topLeft:o.slice(0,2),bottomRight:o.slice(2),landmarks:f,probability:i},box_1.disposeBox(t.box),t.landmarks.dispose(),t.probability.dispose()}else{const t=await e.array();n={topLeft:t.slice(0,2),bottomRight:t.slice(2)}}return e.dispose(),s&&(n=flipFaceHorizontal(n,i)),n}))}}exports.BlazeFaceModel=BlazeFaceModel;

},{"./box":2,"@tensorflow/tfjs-core":13}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tfconv=require("@tensorflow/tfjs-converter"),face_1=require("./face"),BLAZEFACE_MODEL_URL="https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1";async function load({maxFaces:e=10,inputWidth:o=128,inputHeight:a=128,iouThreshold:t=.3,scoreThreshold:r=.75}={}){const c=await tfconv.loadGraphModel(BLAZEFACE_MODEL_URL,{fromTFHub:!0});return new face_1.BlazeFaceModel(c,o,a,e,t,r)}exports.load=load;var face_2=require("./face");exports.BlazeFaceModel=face_2.BlazeFaceModel;

},{"./face":3,"@tensorflow/tfjs-converter":12}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function scaleBoxCoordinates(t,e){return{startPoint:[t.startPoint[0]*e[0],t.startPoint[1]*e[1]],endPoint:[t.endPoint[0]*e[0],t.endPoint[1]*e[1]]}}function getBoxSize(t){return[Math.abs(t.endPoint[0]-t.startPoint[0]),Math.abs(t.endPoint[1]-t.startPoint[1])]}function getBoxCenter(t){return[t.startPoint[0]+(t.endPoint[0]-t.startPoint[0])/2,t.startPoint[1]+(t.endPoint[1]-t.startPoint[1])/2]}function cutBoxFromImageAndResize(t,e,o){var n=e.shape[1],r=e.shape[2],i=[[t.startPoint[1]/n,t.startPoint[0]/r,t.endPoint[1]/n,t.endPoint[0]/r]];return tf.image.cropAndResize(e,i,[0],o)}function enlargeBox(t,e){void 0===e&&(e=1.5);var o=getBoxCenter(t),n=getBoxSize(t),r=[e*n[0]/2,e*n[1]/2];return{startPoint:[o[0]-r[0],o[1]-r[1]],endPoint:[o[0]+r[0],o[1]+r[1]],landmarks:t.landmarks}}exports.scaleBoxCoordinates=scaleBoxCoordinates,exports.getBoxSize=getBoxSize,exports.getBoxCenter=getBoxCenter,exports.cutBoxFromImageAndResize=cutBoxFromImageAndResize,exports.enlargeBox=enlargeBox;

},{"@tensorflow/tfjs-core":13}],6:[function(require,module,exports){
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var blazeface=require("@tensorflow-models/blazeface"),tfconv=require("@tensorflow/tfjs-converter"),tf=require("@tensorflow/tfjs-core"),keypoints_1=require("./keypoints"),pipeline_1=require("./pipeline"),uv_coords_1=require("./uv_coords"),FACEMESH_GRAPHMODEL_PATH="https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",MESH_MODEL_INPUT_WIDTH=192,MESH_MODEL_INPUT_HEIGHT=192;function load(e){var t=void 0===e?{}:e,n=t.maxContinuousChecks,o=void 0===n?5:n,i=t.detectionConfidence,r=void 0===i?.9:i,s=t.maxFaces,a=void 0===s?10:s,c=t.iouThreshold,u=void 0===c?.3:c,f=t.scoreThreshold,l=void 0===f?.75:f;return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:return[4,Promise.all([loadDetectorModel(a,u,l),loadMeshModel()])];case 1:return e=i.sent(),t=e[0],n=e[1],[2,new FaceMesh(t,n,o,r,a)]}})})}function loadDetectorModel(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){return[2,blazeface.load({maxFaces:e,iouThreshold:t,scoreThreshold:n})]})})}function loadMeshModel(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,tfconv.loadGraphModel(FACEMESH_GRAPHMODEL_PATH,{fromTFHub:!0})]})})}function getInputTensorDimensions(e){return e instanceof tf.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}function flipFaceHorizontal(e,t){if(e.mesh instanceof tf.Tensor){var n=tf.tidy(function(){var n=tf.tensor1d([t-1,0,0]),o=tf.tensor1d([1,-1,1]);return tf.tidy(function(){return[tf.concat([tf.sub(t-1,e.boundingBox.topLeft.slice(0,1)),e.boundingBox.topLeft.slice(1,1)]),tf.concat([tf.sub(t-1,e.boundingBox.bottomRight.slice(0,1)),e.boundingBox.bottomRight.slice(1,1)]),tf.sub(n,e.mesh).mul(o),tf.sub(n,e.scaledMesh).mul(o)]})}),o=n[0],i=n[1],r=n[2],s=n[3];return Object.assign({},e,{boundingBox:{topLeft:o,bottomRight:i},mesh:r,scaledMesh:s})}return Object.assign({},e,{boundingBox:{topLeft:[t-1-e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]],bottomRight:[t-1-e.boundingBox.bottomRight[0],e.boundingBox.bottomRight[1]]},mesh:e.mesh.map(function(e){var n=e.slice(0);return n[0]=t-1-e[0],n}),scaledMesh:e.scaledMesh.map(function(e){var n=e.slice(0);return n[0]=t-1-e[0],n})})}exports.load=load;var FaceMesh=function(){function e(e,t,n,o,i){this.pipeline=new pipeline_1.Pipeline(e,t,MESH_MODEL_INPUT_WIDTH,MESH_MODEL_INPUT_HEIGHT,n,i),this.detectionConfidence=o}return e.getAnnotations=function(){return keypoints_1.MESH_ANNOTATIONS},e.getUVCoords=function(){return uv_coords_1.UV_COORDS},e.prototype.estimateFaces=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var o,i,r,s,a,c=this;return __generator(this,function(u){switch(u.label){case 0:return o=getInputTensorDimensions(e),i=o[1],r=tf.tidy(function(){return e instanceof tf.Tensor||(e=tf.browser.fromPixels(e)),e.toFloat().expandDims(0)}),"webgl"!==tf.getBackend()?[3,2]:(a=tf.env().get("WEBGL_PACK_DEPTHWISECONV"),tf.env().set("WEBGL_PACK_DEPTHWISECONV",!0),[4,this.pipeline.predict(r)]);case 1:return s=u.sent(),tf.env().set("WEBGL_PACK_DEPTHWISECONV",a),[3,4];case 2:return[4,this.pipeline.predict(r)];case 3:s=u.sent(),u.label=4;case 4:return r.dispose(),null!=s&&s.length>0?[2,Promise.all(s.map(function(e,o){return __awaiter(c,void 0,void 0,function(){var r,s,a,c,u,f,l,d,h,p,_,b,v,g,m=this;return __generator(this,function(M){switch(M.label){case 0:return r=e.coords,s=e.scaledCoords,a=e.box,c=e.flag,u=[c],t||(u=u.concat([r,s])),[4,Promise.all(u.map(function(e){return __awaiter(m,void 0,void 0,function(){return __generator(this,function(t){return[2,e.array()]})})}))];case 1:if(f=M.sent(),l=f[0],c.dispose(),l<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(o),t)return d={faceInViewConfidence:l,mesh:r,scaledMesh:s,boundingBox:{topLeft:tf.tensor1d(a.startPoint),bottomRight:tf.tensor1d(a.endPoint)}},n?[2,flipFaceHorizontal(d,i)]:[2,d];for(g in h=f.slice(1),p=h[0],_=h[1],s.dispose(),r.dispose(),b={faceInViewConfidence:l,boundingBox:{topLeft:a.startPoint,bottomRight:a.endPoint},mesh:p,scaledMesh:_},n&&(b=flipFaceHorizontal(b,i)),v={},keypoints_1.MESH_ANNOTATIONS)v[g]=keypoints_1.MESH_ANNOTATIONS[g].map(function(e){return b.scaledMesh[e]});return b.annotations=v,[2,b]}})})}))]:[2,[]]}})})},e}();exports.FaceMesh=FaceMesh;

},{"./keypoints":7,"./pipeline":8,"./uv_coords":10,"@tensorflow-models/blazeface":4,"@tensorflow/tfjs-converter":12,"@tensorflow/tfjs-core":13}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MESH_ANNOTATIONS={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};

},{}],8:[function(require,module,exports){
"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),box_1=require("./box"),util_1=require("./util"),UPDATE_REGION_OF_INTEREST_IOU_THRESHOLD=.25,LANDMARKS_COUNT=468,MESH_MODEL_KEYPOINTS_LINE_OF_SYMMETRY_INDICES=[1,168],BLAZEFACE_KEYPOINTS_LINE_OF_SYMMETRY_INDICES=[3,2],Pipeline=function(){function t(t,e,n,r,o,i){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=t,this.meshDetector=e,this.meshWidth=n,this.meshHeight=r,this.maxContinuousChecks=o,this.maxFaces=i}return t.prototype.transformRawCoords=function(t,e,n,r){var o=this,i=box_1.getBoxSize({startPoint:e.startPoint,endPoint:e.endPoint}),s=[i[0]/this.meshWidth,i[1]/this.meshHeight],a=t.map(function(t){return[s[0]*(t[0]-o.meshWidth/2),s[1]*(t[1]-o.meshHeight/2),t[2]]}),u=util_1.buildRotationMatrix(n,[0,0]),c=a.map(function(t){return util_1.rotatePoint(t,u).concat([t[2]])}),h=util_1.invertTransformMatrix(r),l=box_1.getBoxCenter({startPoint:e.startPoint,endPoint:e.endPoint}).concat([1]),_=[util_1.dot(l,h[0]),util_1.dot(l,h[1])];return c.map(function(t){return[t[0]+_[0],t[1]+_[1],t[2]]})},t.prototype.predict=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,o,i=this;return __generator(this,function(s){switch(s.label){case 0:return this.shouldUpdateRegionsOfInterest()?(!1,!0,[4,this.boundingBoxDetector.getBoundingBoxes(t,!1,!0)]):[3,2];case 1:return e=s.sent(),n=e.boxes,r=e.scaleFactor,0===n.length?(this.regionsOfInterest=[],[2,null]):(o=n.map(function(t){var e={startPoint:t.box.startPoint.squeeze().arraySync(),endPoint:t.box.endPoint.squeeze().arraySync()},n=box_1.scaleBoxCoordinates(e,r),o=box_1.enlargeBox(n);return __assign({},o,{landmarks:t.landmarks.arraySync()})}),n.forEach(function(t){null!=t&&null!=t.startPoint&&(t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose())}),this.updateRegionsOfInterest(o),this.runsWithoutFaceDetector=0,[3,3]);case 2:this.runsWithoutFaceDetector++,s.label=3;case 3:return[2,tf.tidy(function(){return i.regionsOfInterest.map(function(e,n){var r;if(e.landmarks.length===LANDMARKS_COUNT){var o=MESH_MODEL_KEYPOINTS_LINE_OF_SYMMETRY_INDICES[0],s=MESH_MODEL_KEYPOINTS_LINE_OF_SYMMETRY_INDICES[1];r=util_1.computeRotation(e.landmarks[o],e.landmarks[s])}else{o=BLAZEFACE_KEYPOINTS_LINE_OF_SYMMETRY_INDICES[0],s=BLAZEFACE_KEYPOINTS_LINE_OF_SYMMETRY_INDICES[1];r=util_1.computeRotation(e.landmarks[o],e.landmarks[s])}var a=box_1.getBoxCenter({startPoint:e.startPoint,endPoint:e.endPoint}),u=[a[0]/t.shape[2],a[1]/t.shape[1]],c=tf.image.rotateWithOffset(t,r,0,u),h=util_1.buildRotationMatrix(-r,a),l={startPoint:e.startPoint,endPoint:e.endPoint},_=box_1.cutBoxFromImageAndResize(l,c,[i.meshHeight,i.meshWidth]).div(255),f=i.meshDetector.predict(_),d=f[1],p=f[2],g=tf.reshape(p,[-1,3]),m=g.arraySync(),E=i.transformRawCoords(m,e,r,h),I=tf.tensor2d(E),P=i.calculateLandmarksBoundingBox(E);return i.regionsOfInterest[n]=__assign({},P,{landmarks:I.arraySync()}),{coords:g,scaledCoords:I,box:P,flag:d.squeeze()}})})]}})})},t.prototype.updateRegionsOfInterest=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.regionsOfInterest[e],o=0;if(r&&r.startPoint){var i=n.startPoint,s=i[0],a=i[1],u=n.endPoint,c=u[0],h=u[1],l=r.startPoint,_=l[0],f=l[1],d=r.endPoint,p=d[0],g=d[1],m=Math.max(s,_),E=Math.max(a,f),I=(Math.min(c,p)-m)*(Math.min(h,g)-E);o=I/((c-s)*(h-a)+(p-_)*(g-a)-I)}o<UPDATE_REGION_OF_INTEREST_IOU_THRESHOLD&&(this.regionsOfInterest[e]=n)}this.regionsOfInterest=this.regionsOfInterest.slice(0,t.length)},t.prototype.clearRegionOfInterest=function(t){null!=this.regionsOfInterest[t]&&(this.regionsOfInterest=this.regionsOfInterest.slice(0,t).concat(this.regionsOfInterest.slice(t+1)))},t.prototype.shouldUpdateRegionsOfInterest=function(){var t=this.regionsOfInterest.length,e=0===t;return 1===this.maxFaces||e?e:t!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks},t.prototype.calculateLandmarksBoundingBox=function(t){var e=t.map(function(t){return t[0]}),n=t.map(function(t){return t[1]}),r={startPoint:[Math.min.apply(Math,e),Math.min.apply(Math,n)],endPoint:[Math.max.apply(Math,e),Math.max.apply(Math,n)]};return box_1.enlargeBox({startPoint:r.startPoint,endPoint:r.endPoint})},t}();exports.Pipeline=Pipeline;

},{"./box":5,"./util":9,"@tensorflow/tfjs-core":13}],9:[function(require,module,exports){
"use strict";function normalizeRadians(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function computeRotation(t,r){return normalizeRadians(Math.PI/2-Math.atan2(-(r[1]-t[1]),r[0]-t[0]))}function radToDegrees(t){return 180*t/Math.PI}function buildTranslationMatrix(t,r){return[[1,0,t],[0,1,r],[0,0,1]]}function dot(t,r){for(var o=0,n=0;n<t.length;n++)o+=t[n]*r[n];return o}function getColumnFrom2DArr(t,r){for(var o=[],n=0;n<t.length;n++)o.push(t[n][r]);return o}function multiplyTransformMatrices(t,r){for(var o=[],n=t.length,a=0;a<n;a++){o.push([]);for(var e=0;e<n;e++)o[a].push(dot(t[a],getColumnFrom2DArr(r,e)))}return o}function buildRotationMatrix(t,r){var o=Math.cos(t),n=Math.sin(t),a=[[o,-n,0],[n,o,0],[0,0,1]],e=multiplyTransformMatrices(buildTranslationMatrix(r[0],r[1]),a);return multiplyTransformMatrices(e,buildTranslationMatrix(-r[0],-r[1]))}function invertTransformMatrix(t){var r=[[t[0][0],t[1][0]],[t[0][1],t[1][1]]],o=[t[0][2],t[1][2]],n=[-dot(r[0],o),-dot(r[1],o)];return[r[0].concat(n[0]),r[1].concat(n[1]),[0,0,1]]}function rotatePoint(t,r){return[dot(t,r[0]),dot(t,r[1])]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.normalizeRadians=normalizeRadians,exports.computeRotation=computeRotation,exports.radToDegrees=radToDegrees,exports.dot=dot,exports.getColumnFrom2DArr=getColumnFrom2DArr,exports.buildRotationMatrix=buildRotationMatrix,exports.invertTransformMatrix=invertTransformMatrix,exports.rotatePoint=rotatePoint;

},{}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UV_COORDS=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]];

},{}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),seedrandom=require("seedrandom"),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};function __extends(e,t){function a(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}function __awaiter(e,t,a,r){return new(a||(a=Promise))(function(n,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,s)}l((r=r.apply(e,t||[])).next())})}function __generator(e,t){var a,r,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function assertNotComplex(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&tf.util.assert("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors in the CPU backend."})})}var nonMaxSuppressionV3Impl=tf.kernel_impls.nonMaxSuppressionV3Impl,split=tf.kernel_impls.split,tile=tf.kernel_impls.tile,topkImpl=tf.kernel_impls.topkImpl,whereImpl=tf.kernel_impls.whereImpl;function mapActivation(e,t,a,r){if("linear"===a)return e.linear(t);if("relu"===a)return e.relu(t);if("elu"===a)return tf.elu(t);if("relu6"===a)return e.relu6(t);if("prelu"===a)return e.prelu(t,r);throw new Error("Activation "+a+" has not been implemented for the CPU backend.")}var MathBackendCPU=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new tf.DataStorage(t,tf.engine()),t}return __extends(t,e),t.prototype.write=function(e,t,a){this.firstUse&&(this.firstUse=!1,tf.env().get("IS_NODE")&&tf.backend_util.warn("\n============================\nHi there ðŸ‘‹. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:a,refCount:1}),r},t.prototype.makeTensorInfo=function(e,t,a){return{dataId:this.write(a,e,t),shape:e,dtype:t}},t.prototype.incRef=function(e){this.data.get(e).refCount++},t.prototype.decRef=function(e){this.data.has(e)&&this.data.get(e).refCount--},t.prototype.move=function(e,t,a,r){this.data.set(e,{values:t,dtype:r,refCount:1})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),a=t.dtype,r=t.complexTensorInfos;if("complex64"===a){var n=this.readSync(r.real.dataId),o=this.readSync(r.imag.dataId);return tf.backend_util.mergeRealAndImagArrays(n,o)}return this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),a=t;if("string"===e.dtype)try{a=t.map(function(e){return tf.util.decodeString(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return tf.buffer(e.shape,e.dtype,a)},t.prototype.makeOutput=function(e,t,a){var r=this.write(e,t,a);return tf.engine().makeTensorFromDataId(r,t,a,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensorInfos;null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}},t.prototype.disposeIntermediateTensorInfo=function(e){var t=e.dataId;if(this.data.has(t)){var a=this.data.get(t);a.refCount--,a.refCount<1&&this.disposeData(t)}},t.prototype.time=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(a){return t=tf.util.now(),e(),[2,{kernelMs:tf.util.now()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.stridedSlice=function(e,t,a,r){assertNotComplex(e,"stridedSlice");var n=tf.slice_util.computeOutShape(t,a,r);if(n.some(function(e){return 0===e}))return tf.tensor([],n);for(var o=tf.buffer(n,e.dtype),i=this.bufferSync(e),s=0;s<o.size;s++){for(var l=o.indexToLoc(s),f=new Array(l.length),u=0;u<f.length;u++)f[u]=l[u]*r[u]+t[u];o.set.apply(o,[i.get.apply(i,f)].concat(l))}return o.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),a=tf.buffer([e.size,e.size],e.dtype),r=a.values,n=0;n<t.length;n++)r[n*e.size+n]=t[n];return a.toTensor()},t.prototype.unstack=function(e,t){for(var a=e.shape[t],r=new Array(e.rank-1),n=0,o=0;o<e.rank;o++)o!==t&&(r[n++]=e.shape[o]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var l=new Array(a);for(o=0;o<l.length;o++)i[t]=o,l[o]=tf.slice(e,i,s).reshape(r);return l},t.prototype.reverse=function(e,t){assertNotComplex(e,"reverse");for(var a=tf.buffer(e.shape,e.dtype),r=this.bufferSync(e),n=function(n){var o=a.indexToLoc(n),i=o.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),a.set.apply(a,[r.get.apply(r,i)].concat(o))},o=0;o<a.size;o++)n(o);return a.toTensor()},t.prototype.neg=function(e){return assertNotComplex(e,"neg"),tf.mul(tf.scalar(-1),e)},t.prototype.addN=function(e){var t=this;assertNotComplex(e,"addN");for(var a=e.map(function(e){return t.readSync(e.dataId)}),r=tf.buffer(e[0].shape,e[0].dtype),n=r.values,o=0;o<e.length;o++)for(var i=a[o],s=0;s<n.length;s++)n[s]+=i[s];return r.toTensor()},t.prototype.softmax=function(e,t){var a=tf.util.parseAxisParam([t],e.shape),r=tf.max(e,a),n=tf.backend_util.expandShapeToKeepDim(r.shape,a),o=tf.sub(e,r.reshape(n)),i=tf.exp(o),s=this.sum(i,a).reshape(n);return tf.div(i,s)},t.prototype.pow=function(e,t){return assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,a,r){assertNotComplex([e,t],"matMul");for(var n=a?e.shape[1]:e.shape[2],o=a?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],l=this.readSync(e.dataId),f=this.readSync(t.dataId),u=a?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],p=u[0],d=u[1],c=u[2],h=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=h[0],v=h[1],g=h[2],I=o*i,y=tf.buffer([s,o,i],e.dtype),k=y.values,b=this.blockSize,x=0;x<s;x++)for(var S=0;S<o;S+=b)for(var F=0;F<i;F+=b)for(var N=0;N<n;N+=b)for(var C=Math.min(S+b,o),T=Math.min(F+b,i),M=Math.min(N+b,n),A=S;A<C;A++)for(var D=F;D<T;D++){for(var _=0,K=N;K<M;K++)_+=l[x*p+A*d+K*c]*f[K*m+D*v+x*g];k[x*I+(A*i+D)]+=_}return y.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,a=e.b,r=e.transposeA,n=e.transposeB,o=e.bias,i=e.activation,s=e.preluActivationWeights,l=this.batchMatMul(t,a,r,n);return o&&(l=tf.add(l,o)),i&&(l=mapActivation(this,l,i,s)),l},t.prototype.floorDiv=function(e,t){assertNotComplex([e,t],"floorDiv");return this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){assertNotComplex(e,"sum"),tf.backend_util.assertAxesAreInnerMostDims("sum",t,e.rank);for(var a=tf.backend_util.computeOutAndReduceShapes(e.shape,t),r=a[0],n=a[1],o=tf.upcastType(e.dtype,"int32"),i=tf.zeros(r,o),s=tf.util.sizeFromShape(n),l=this.readSync(i.dataId),f=this.readSync(e.dataId),u=0;u<l.length;++u){for(var p=u*s,d=0,c=0;c<s;++c)d+=f[p+c];l[u]=d}return i},t.prototype.prod=function(e,t){assertNotComplex(e,"sum");for(var a=tf.backend_util.computeOutAndReduceShapes(e.shape,t),r=a[0],n=a[1],o=tf.upcastType(e.dtype,"int32"),i=tf.zeros(r,o),s=tf.util.sizeFromShape(n),l=this.readSync(i.dataId),f=this.readSync(e.dataId),u=0;u<l.length;++u){for(var p=u*s,d=1,c=0;c<s;++c)d*=f[p+c];l[u]=d}return i},t.prototype.unsortedSegmentSum=function(e,t,a){assertNotComplex(e,"unsortedSegmentSum");for(var r=[],n=e.rank-t.rank,o=0;o<n;++o)t=t.expandDims(o+1);for(o=0;o<a;++o){var i=tf.scalar(o,"int32"),s=tf.equal(i,t).asType("float32").mul(e).sum(0);r.push(s)}return tf.stack(r)},t.prototype.argMin=function(e,t){assertNotComplex(e,"argMin");var a=[t];tf.backend_util.assertAxesAreInnerMostDims("argMin",a,e.rank);for(var r=tf.backend_util.computeOutAndReduceShapes(e.shape,a),n=r[0],o=r[1],i=tf.zeros(n,"int32"),s=tf.util.sizeFromShape(o),l=this.readSync(i.dataId),f=this.readSync(e.dataId),u=0;u<l.length;++u){for(var p=u*s,d=f[p],c=0,h=0;h<s;++h){var m=f[p+h];m<d&&(d=m,c=h)}l[u]=c}return i},t.prototype.argMax=function(e,t){assertNotComplex(e,"argMax");var a=[t];tf.backend_util.assertAxesAreInnerMostDims("argMax",a,e.rank);for(var r=tf.backend_util.computeOutAndReduceShapes(e.shape,a),n=r[0],o=r[1],i=tf.zeros(n,"int32"),s=tf.util.sizeFromShape(o),l=this.readSync(i.dataId),f=this.readSync(e.dataId),u=0;u<l.length;++u){for(var p=u*s,d=f[p],c=0,h=0;h<s;++h){var m=f[p+h];m>d&&(d=m,c=h)}l[u]=c}return i},t.prototype.cumsum=function(e,t,a,r){if(assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var n=tf.upcastType(e.dtype,"int32"),o=tf.zeros(e.shape,n),i=this.readSync(o.dataId),s=this.readSync(e.dataId),l=e.shape[e.rank-1],f=r?function(e,t){return e+l-t-1}:function(e,t){return e+t},u=0;u<s.length;u+=l)for(var p=0;p<l;p++){var d=f(u,p);if(0===p)i[d]=a?0:s[d];else{var c=f(u,p-1);i[d]=a?s[c]+i[c]:s[d]+i[c]}}return o},t.prototype.equal=function(e,t){return assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalAnd=function(e,t){return assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,a){assertNotComplex([e,t,a],"select");for(var r=this.readSync(e.dataId),n=this.readSync(t.dataId),o=this.readSync(a.dataId),i=tf.zeros(t.shape,tf.upcastType(t.dtype,a.dtype)),s=this.readSync(i.dataId),l=0,f=0===e.rank||e.rank>1||1===t.rank?1:tf.util.sizeFromShape(t.shape.slice(1)),u=0;u<r.length;u++)for(var p=0;p<f;p++)1===r[u]?s[l++]=n[u]:s[l++]=o[u];return i},t.prototype.where=function(e){assertNotComplex([e],"where");var t=this.readSync(e.dataId);return whereImpl(e.shape,t)},t.prototype.topk=function(e,t,a){assertNotComplex(e,"topk");var r=this.readSync(e.dataId);return topkImpl(r,e.shape,e.dtype,t,a)},t.prototype.min=function(e,t){assertNotComplex(e,"min"),tf.backend_util.assertAxesAreInnerMostDims("min",t,e.rank);for(var a=tf.backend_util.computeOutAndReduceShapes(e.shape,t),r=a[0],n=a[1],o=tf.zeros(r,e.dtype),i=tf.util.sizeFromShape(n),s=this.readSync(o.dataId),l=this.readSync(e.dataId),f=0;f<s.length;++f){for(var u=f*i,p=l[u],d=0;d<i;++d){var c=l[u+d];c<p&&(p=c)}s[f]=p}return o},t.prototype.minimum=function(e,t){return assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var a=e%t;return e<0&&t<0||e>=0&&t>=0?a:(a+t)%t})},t.prototype.maximum=function(e,t){return assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){assertNotComplex(e,"all"),tf.backend_util.assertAxesAreInnerMostDims("all",t,e.rank);for(var a=tf.backend_util.computeOutAndReduceShapes(e.shape,t),r=a[0],n=a[1],o=tf.zeros(r,e.dtype),i=tf.util.sizeFromShape(n),s=this.readSync(o.dataId),l=this.readSync(e.dataId),f=0;f<s.length;++f){for(var u=f*i,p=l[u],d=0;d<i;++d){var c=l[u+d];p=p&&c}s[f]=p}return o},t.prototype.any=function(e,t){assertNotComplex(e,"any"),tf.backend_util.assertAxesAreInnerMostDims("any",t,e.rank);for(var a=tf.backend_util.computeOutAndReduceShapes(e.shape,t),r=a[0],n=a[1],o=tf.zeros(r,e.dtype),i=tf.util.sizeFromShape(n),s=this.readSync(o.dataId),l=this.readSync(e.dataId),f=0;f<s.length;++f){for(var u=f*i,p=l[u],d=0;d<i;++d){var c=l[u+d];p=p||c}s[f]=p}return o},t.prototype.squaredDifference=function(e,t){return assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var a=e-t;return a*a})},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){assertNotComplex(e,"relu");for(var t=tf.zeros(e.shape,e.dtype),a=this.readSync(t.dataId),r=this.readSync(e.dataId),n=0;n<r.length;++n)a[n]=Math.max(0,r[n]);return t},t.prototype.relu6=function(e){assertNotComplex(e,"relu");for(var t=tf.zeros(e.shape,e.dtype),a=this.readSync(t.dataId),r=this.readSync(e.dataId),n=0;n<r.length;++n)a[n]=Math.min(Math.max(0,r[n]),6);return t},t.prototype.prelu=function(e,t){return assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.eluDer=function(e,t){assertNotComplex([e,t],"eluDer");for(var a=new Float32Array(t.size),r=this.readSync(t.dataId),n=this.readSync(e.dataId),o=0;o<r.length;++o){var i=r[o];a[o]=i>=1?n[o]:n[o]*(i+1)}return this.makeOutput(a,t.shape,"float32")},t.prototype.atan2=function(e,t){return assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.fusedConv2d=function(e){var t=e.input,a=e.filter,r=e.convInfo,n=e.bias,o=e.activation,i=e.preluActivationWeights,s=this.conv2d(t,a,r);return n&&(s=tf.add(s,n)),o&&(s=mapActivation(this,s,o,i)),s},t.prototype.conv2d=function(e,t,a){assertNotComplex([e,t],"conv2d");for(var r=a.filterHeight,n=a.filterWidth,o=a.dilationHeight,i=a.dilationWidth,s=a.padInfo.left,l=a.padInfo.top,f="channelsLast"===a.dataFormat,u=tf.buffer(a.outShape,e.dtype),p=e.strides[0],d=f?e.strides[1]:e.strides[2],c=f?e.strides[2]:1,h=f?1:e.strides[1],m=u.strides[0],v=f?u.strides[1]:u.strides[2],g=f?u.strides[2]:1,I=f?1:u.strides[1],y=this.readSync(e.dataId),k=this.readSync(t.dataId),b=u.values,x=0;x<a.batchSize;++x)for(var S=x*p,F=x*m,N=0;N<a.outHeight;++N)for(var C=F+N*v,T=N*a.strideHeight-l,M=0;M<r;M++){var A=T+M*o;if(!(A<0||A>=a.inHeight))for(var D=M*t.strides[0],_=S+A*d,K=0;K<a.outWidth;++K)for(var W=C+K*g,z=K*a.strideWidth-s,w=0;w<n;w++){var H=z+w*i;if(!(H<0||H>=a.inWidth))for(var B=_+H*c,E=D+w*t.strides[1],P=0;P<a.inChannels;++P){for(var q=y[B+P*h],O=0;O<a.outChannels;++O)b[W+O*I]+=q*k[E+O];E+=a.outChannels}}}return u.toTensor()},t.prototype.conv3d=function(e,t,a){for(var r=a.filterDepth,n=a.filterHeight,o=a.filterWidth,i=a.dilationDepth,s=a.dilationHeight,l=a.dilationWidth,f=a.padInfo.front,u=a.padInfo.left,p=a.padInfo.top,d=tf.buffer(a.outShape,e.dtype),c=this.readSync(e.dataId),h=this.readSync(t.dataId),m=d.values,v=0;v<a.batchSize;++v)for(var g=v*e.strides[0],I=v*d.strides[0],y=0;y<a.outDepth;++y)for(var k=I+y*d.strides[1],b=y*a.strideDepth-f,x=0;x<r;x++){var S=b+x*i;if(!(S<0||S>=a.inDepth))for(var F=x*t.strides[0],N=g+S*e.strides[1],C=0;C<a.outHeight;++C)for(var T=k+C*d.strides[2],M=C*a.strideHeight-p,A=0;A<n;A++){var D=M+A*s;if(!(D<0||D>=a.inHeight))for(var _=F+A*t.strides[1],K=N+D*e.strides[2],W=0;W<a.outWidth;++W)for(var z=T+W*a.outChannels,w=W*a.strideWidth-u,H=0;H<o;H++){var B=w+H*l;if(!(B<0||B>=a.inWidth))for(var E=_+H*t.strides[2],P=K+B*a.inChannels,q=E,O=0;O<a.inChannels;++O){for(var R=c[P+O],V=0;V<a.outChannels;++V)m[z+V]+=R*h[q+V];q+=a.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,a){assertNotComplex([e,t],"conv2dDerInput");for(var r=tf.buffer(a.inShape,"float32"),n=r.values,o=this.readSync(e.dataId),i=this.readSync(t.dataId),s=t.strides,l=s[0],f=s[1],u=s[2],p=a.batchSize,d=a.filterHeight,c=a.filterWidth,h=a.inChannels,m=a.inHeight,v=a.inWidth,g=a.outChannels,I=a.outHeight,y=a.outWidth,k=a.strideHeight,b=a.strideWidth,x=a.dataFormat,S=d-1-a.padInfo.top,F=c-1-a.padInfo.left,N="channelsLast"===x,C=r.strides[0],T=N?r.strides[1]:r.strides[2],M=N?r.strides[2]:1,A=N?1:r.strides[1],D=e.strides[0],_=N?e.strides[1]:e.strides[2],K=N?e.strides[2]:1,W=N?1:e.strides[1],z=0;z<p;++z)for(var w=0;w<h;++w)for(var H=0;H<m;++H)for(var B=H-S,E=Math.max(0,Math.ceil(B/k)),P=Math.min(I,(d+B)/k),q=0;q<v;++q){for(var O=q-F,R=Math.max(0,Math.ceil(O/b)),V=Math.min(y,(c+O)/b),L=0,U=E;U<P;++U)for(var G=U*k-B,j=R;j<V;++j)for(var Y=D*z+_*U+K*j,Z=l*(d-1-G)+f*(c-1-(j*b-O))+u*w,J=0;J<g;++J){L+=o[Y+W*J]*i[Z+J]}n[C*z+T*H+M*q+A*w]=L}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,a){for(var r=tf.buffer(a.inShape,"float32"),n=r.values,o=r.strides,i=o[0],s=o[1],l=o[2],f=o[3],u=this.readSync(e.dataId),p=e.strides,d=p[0],c=p[1],h=p[2],m=p[3],v=this.readSync(t.dataId),g=t.strides,I=g[0],y=g[1],k=g[2],b=g[3],x=a.batchSize,S=a.filterDepth,F=a.filterHeight,N=a.filterWidth,C=a.inChannels,T=a.inDepth,M=a.inHeight,A=a.inWidth,D=a.outChannels,_=a.outDepth,K=a.outHeight,W=a.outWidth,z=a.strideDepth,w=a.strideHeight,H=a.strideWidth,B=S-1-a.padInfo.front,E=F-1-a.padInfo.top,P=N-1-a.padInfo.left,q=0;q<x;++q)for(var O=0;O<C;++O)for(var R=0;R<T;++R)for(var V=R-B,L=Math.max(0,Math.ceil(V/z)),U=Math.min(_,(S+V)/z),G=0;G<M;++G)for(var j=G-E,Y=Math.max(0,Math.ceil(j/w)),Z=Math.min(K,(F+j)/w),J=0;J<A;++J){for(var Q=J-P,X=Math.max(0,Math.ceil(Q/H)),$=Math.min(W,(N+Q)/H),ee=0,te=L;te<U;++te)for(var ae=te*z-V,re=Y;re<Z;++re)for(var ne=re*w-j,oe=X;oe<$;++oe)for(var ie=d*q+c*te+h*re+m*oe,se=I*(S-1-ae)+y*(F-1-ne)+k*(N-1-(oe*H-Q))+b*O,le=0;le<D;++le){ee+=u[ie+le]*v[se+le]}n[i*q+s*R+l*G+f*J+O]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,a){assertNotComplex([e,t],"conv2dDerFilter");for(var r=a.strideHeight,n=a.strideWidth,o=a.filterHeight,i=a.filterWidth,s="channelsLast"===a.dataFormat,l=tf.buffer(a.filterShape,"float32"),f=a.padInfo.left,u=a.padInfo.top,p=this.bufferSync(e),d=this.bufferSync(t),c=0;c<o;++c)for(var h=Math.max(0,Math.ceil((u-c)/r)),m=Math.min(a.outHeight,(a.inHeight+u-c)/r),v=0;v<i;++v)for(var g=Math.max(0,Math.ceil((f-v)/n)),I=Math.min(a.outWidth,(a.inWidth+f-v)/n),y=0;y<a.inChannels;++y)for(var k=0;k<a.outChannels;++k){for(var b=0,x=0;x<a.batchSize;++x)for(var S=h;S<m;++S)for(var F=c+S*r-u,N=g;N<I;++N){var C=v+N*n-f;b+=s?p.get(x,F,C,y)*d.get(x,S,N,k):p.get(x,y,F,C)*d.get(x,k,S,N)}l.set(b,c,v,y,k)}return l.toTensor()},t.prototype.conv3dDerFilter=function(e,t,a){for(var r=a.strideDepth,n=a.strideHeight,o=a.strideWidth,i=a.filterDepth,s=a.filterHeight,l=a.filterWidth,f=tf.buffer(a.filterShape,"float32"),u=f.values,p=f.strides,d=p[0],c=p[1],h=p[2],m=p[3],v=this.readSync(t.dataId),g=t.strides,I=g[0],y=g[1],k=g[2],b=g[3],x=this.readSync(e.dataId),S=e.strides,F=S[0],N=S[1],C=S[2],T=S[3],M=a.padInfo.front,A=a.padInfo.left,D=a.padInfo.top,_=0;_<i;++_)for(var K=Math.max(0,Math.ceil((M-_)/r)),W=Math.min(a.outDepth,(a.inDepth+M-_)/r),z=_*d,w=0;w<s;++w)for(var H=Math.max(0,Math.ceil((D-w)/n)),B=Math.min(a.outHeight,(a.inHeight+D-w)/n),E=w*c+z,P=0;P<l;++P)for(var q=Math.max(0,Math.ceil((A-P)/o)),O=Math.min(a.outWidth,(a.inWidth+A-P)/o),R=P*h+E,V=0;V<a.inChannels;++V)for(var L=V*m+R,U=0;U<a.outChannels;++U){for(var G=0,j=0;j<a.batchSize;++j)for(var Y=j*F,Z=j*I,J=K;J<W;++J)for(var Q=(_+J*r-M)*N+Y,X=J*y+Z,$=H;$<B;++$)for(var ee=(w+$*n-D)*C+Q,te=$*k+X,ae=q;ae<O;++ae){var re=ae*b+te;G+=x[(P+ae*o-A)*T+ee+V]*v[re+U]}u[L+U]=G}return f.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,a=e.filter,r=e.convInfo,n=e.bias,o=e.activation,i=e.preluActivationWeights,s=this.depthwiseConv2D(t,a,r);return n&&(s=tf.add(s,n)),o&&(s=mapActivation(this,s,o,i)),s},t.prototype.depthwiseConv2D=function(e,t,a){assertNotComplex([e,t],"depthwiseConv2D");for(var r=a.filterHeight,n=a.filterWidth,o=a.dilationHeight,i=a.dilationWidth,s=a.padInfo.left,l=a.padInfo.top,f=a.outChannels/a.inChannels,u=tf.buffer(a.outShape,e.dtype),p=this.readSync(e.dataId),d=this.readSync(t.dataId),c=u.values,h=0;h<a.batchSize;++h)for(var m=h*e.strides[0],v=h*u.strides[0],g=0;g<a.outHeight;++g)for(var I=v+g*u.strides[1],y=g*a.strideHeight-s,k=0;k<r;++k){var b=y+k*o;if(!(b<0||b>=a.inHeight))for(var x=k*t.strides[0],S=m+b*e.strides[1],F=0;F<a.outWidth;++F)for(var N=I+F*u.strides[2],C=F*a.strideWidth-l,T=0;T<n;++T){var M=C+T*i;if(!(M<0||M>=a.inWidth))for(var A=x+T*t.strides[1],D=S+M*a.inChannels,_=N,K=A,W=0;W<a.inChannels;++W){for(var z=p[D+W],w=0;w<f;++w)c[_+w]+=z*d[K+w];_+=f,K+=f}}}return u.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,a){assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var r=tf.buffer(a.inShape,"float32"),n=r.values,o=r.strides,i=o[0],s=o[1],l=o[2],f=this.readSync(e.dataId),u=e.strides,p=u[0],d=u[1],c=u[2],h=this.readSync(t.dataId),m=t.strides,v=m[0],g=m[1],I=m[2],y=a.batchSize,k=a.filterHeight,b=a.filterWidth,x=a.inChannels,S=a.inHeight,F=a.inWidth,N=a.outChannels,C=a.outHeight,T=a.outWidth,M=a.strideHeight,A=a.strideWidth,D=k-1-a.padInfo.top,_=b-1-a.padInfo.left,K=N/x,W=0;W<y;++W)for(var z=0;z<x;++z)for(var w=0;w<S;++w)for(var H=w-D,B=Math.max(0,Math.ceil(H/M)),E=Math.min(C,(k+H)/M),P=0;P<F;++P){for(var q=P-_,O=Math.max(0,Math.ceil(q/A)),R=Math.min(T,(b+q)/A),V=0,L=B;L<E;++L)for(var U=L*M-H,G=O;G<R;++G)for(var j=p*W+d*L+c*G,Y=v*(k-1-U)+g*(b-1-(G*A-q))+I*z,Z=0;Z<K;++Z){V+=f[j+(z*K+Z)]*h[Y+Z]}n[i*W+s*w+l*P+z]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,a){assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var r=a.strideHeight,n=a.strideWidth,o=a.filterHeight,i=a.filterWidth,s=tf.buffer(a.filterShape,"float32"),l=a.padInfo.left,f=a.padInfo.top,u=a.outChannels/a.inChannels,p=this.bufferSync(e),d=this.bufferSync(t),c=0;c<o;++c)for(var h=Math.max(0,Math.ceil((f-c)/r)),m=Math.min(a.outHeight,(a.inHeight+f-c)/r),v=0;v<i;++v)for(var g=Math.max(0,Math.ceil((l-v)/n)),I=Math.min(a.outWidth,(a.inWidth+l-v)/n),y=0;y<a.outChannels;++y){for(var k=Math.trunc(y/u),b=y%u,x=0,S=0;S<a.batchSize;++S)for(var F=h;F<m;++F)for(var N=c+F*r-f,C=g;C<I;++C){var T=v+C*n-l;x+=p.get(S,N,T,k)*d.get(S,F,C,y)}s.set(x,c,v,k,b)}return s.toTensor()},t.prototype.tile=function(e,t){return assertNotComplex(e,"tile"),tile(this.bufferSync(e),t)},t.prototype.gather=function(e,t,a){assertNotComplex([e,t],"gather");var r=e.shape.slice(),n=this.readSync(t.dataId);r[a]=n.length;for(var o=tf.buffer(r,e.dtype),i=this.bufferSync(e),s=0;s<o.size;++s){var l=o.indexToLoc(s),f=l.slice();f[a]=n[l[a]];var u=i.locToIndex(f);o.values[s]=i.values[u]}return o.toTensor()},t.prototype.batchToSpaceND=function(e,t,a){assertNotComplex([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),n=tf.backend_util.getReshaped(e.shape,t,r),o=tf.backend_util.getPermuted(n.length,t.length),i=tf.backend_util.getReshapedPermuted(e.shape,t,r),s=tf.backend_util.getSliceBeginCoords(a,t.length),l=tf.backend_util.getSliceSize(i,a,t.length);return tf.transpose(e.reshape(n),o).reshape(i).slice(s,l)},t.prototype.pool3d=function(e,t,a){assertNotComplex(e,"pool3d");for(var r=t.strideDepth,n=t.strideHeight,o=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,l=t.dilationWidth,f=t.effectiveFilterDepth,u=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=t.padInfo.front,c=t.padInfo.top,h=t.padInfo.left,m="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=tf.buffer(t.outShape,e.dtype),I=g.values,y=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],k=t.outShape[2]*t.outShape[3]*t.outShape[4],b=t.outShape[3]*t.outShape[4],x=t.outShape[4],S=0;S<t.batchSize;++S)for(var F=S*y,N=S*e.strides[0],C=0;C<t.inChannels;++C)for(var T=0;T<t.outDepth;++T){for(var M=T*r-d,A=M;A<0;)A+=i;for(var D=Math.min(t.inDepth,f+M),_=F+T*k,K=0;K<t.outHeight;++K){for(var W=K*n-c,z=W;z<0;)z+=s;for(var w=Math.min(t.inHeight,u+W),H=_+K*b,B=0;B<t.outWidth;++B){for(var E=B*o-h,P=E;P<0;)P+=l;for(var q=Math.min(t.inWidth,p+E),O=H+B*x,R=m,V=0,L=0,U=A;U<D;U+=i){for(var G=N+U*e.strides[1],j=z;j<w;j+=s){for(var Y=G+j*e.strides[2],Z=P;Z<q;Z+=l){var J=v[Y+Z*e.strides[3]+C];if("max"===a&&J>R?R=J:"avg"===a&&(V+=J,L++),isNaN(R))break}if(isNaN(R))break}if(isNaN(R))break}I[O+C]="avg"===a?V/L:R}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return assertNotComplex(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,a){assertNotComplex([e,t],"avgPool3dBackprop");for(var r=a.strideDepth,n=a.strideHeight,o=a.strideWidth,i=a.filterDepth,s=a.filterHeight,l=a.filterWidth,f=a.dilationDepth,u=a.dilationHeight,p=a.dilationWidth,d=a.effectiveFilterDepth,c=a.effectiveFilterHeight,h=a.effectiveFilterWidth,m=d-1-a.padInfo.front,v=h-1-a.padInfo.left,g=c-1-a.padInfo.top,I=tf.buffer(t.shape,"float32"),y=1/(i*s*l),k=this.bufferSync(e),b=0;b<a.batchSize;++b)for(var x=0;x<a.inChannels;++x)for(var S=0;S<a.inDepth;++S)for(var F=0;F<a.inHeight;++F)for(var N=0;N<a.inWidth;++N){for(var C=S-m,T=F-g,M=N-v,A=0,D=0;D<d;D+=f){var _=(C+D)/r;if(!(_<0||_>=a.outDepth||Math.floor(_)!==_))for(var K=0;K<c;K+=u){var W=(T+K)/n;if(!(W<0||W>=a.outHeight||Math.floor(W)!==W))for(var z=0;z<h;z+=p){var w=(M+z)/o;if(!(w<0||w>=a.outWidth||Math.floor(w)!==w))A+=k.get(b,_,W,w,x)}}}I.set(A*y,b,S,F,N,x)}return I.toTensor()},t.prototype.maxPool3d=function(e,t){return assertNotComplex(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var a=tf.buffer(t.outShape,"int32"),r=t.strideDepth,n=t.strideHeight,o=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,l=t.dilationWidth,f=t.effectiveFilterDepth,u=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=t.padInfo.front,c=t.padInfo.top,h=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var I=0;I<t.outDepth;++I){for(var y=I*r-d,k=y;k<0;)k+=i;for(var b=Math.min(t.inDepth,f+y),x=0;x<t.outHeight;++x){for(var S=x*n-c,F=S;F<0;)F+=s;for(var N=Math.min(t.inHeight,u+S),C=0;C<t.outWidth;++C){for(var T=C*o-h,M=T;M<0;)M+=l;for(var A=Math.min(t.inWidth,p+T),D=Number.NEGATIVE_INFINITY,_=-1,K=k;K<b;K+=i)for(var W=K-y,z=F;z<N;z+=s)for(var w=z-S,H=M;H<A;H+=l){var B=H-T,E=m.get(v,K,z,H,g);E>=D&&(D=E,_=W*u*p+w*u+B)}a.set(_,v,I,x,C,g)}}}return a.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,a,r){assertNotComplex([t,a],"maxPool3dBackprop");for(var n=this.maxPool3dPositions(t,r),o=r.strideDepth,i=r.strideHeight,s=r.strideWidth,l=r.dilationDepth,f=r.dilationHeight,u=r.dilationWidth,p=r.effectiveFilterDepth,d=r.effectiveFilterHeight,c=r.effectiveFilterWidth,h=p-1-r.padInfo.front,m=c-1-r.padInfo.left,v=d-1-r.padInfo.top,g=tf.buffer(t.shape,"float32"),I=this.bufferSync(n),y=this.bufferSync(e),k=0;k<r.batchSize;++k)for(var b=0;b<r.inChannels;++b)for(var x=0;x<r.inDepth;++x)for(var S=0;S<r.inHeight;++S)for(var F=0;F<r.inWidth;++F){for(var N=x-h,C=S-v,T=F-m,M=0,A=0;A<p;A+=l){var D=(N+A)/o;if(!(D<0||D>=r.outDepth||Math.floor(D)!==D))for(var _=0;_<d;_+=f){var K=(C+_)/i;if(!(K<0||K>=r.outHeight||Math.floor(K)!==K))for(var W=0;W<c;W+=u){var z=(T+W)/s;if(!(z<0||z>=r.outWidth||Math.floor(z)!==z)){var w=p*d*c-1-I.get(k,D,K,z,b)===A*d*c+_*c+W?1:0;if(0!==w)M+=y.get(k,D,K,z,b)*w}}}}g.set(M,k,x,S,F,b)}return g.toTensor()},t.prototype.resizeBilinear=function(e,t,a,r){assertNotComplex(e,"resizeBilinear");for(var n=e.shape,o=n[0],i=n[1],s=n[2],l=n[3],f=this.readSync(e.dataId),u=new Float32Array(tf.util.sizeFromShape([o,t,a,l])),p=[r&&t>1?i-1:i,r&&a>1?s-1:s],d=[r&&t>1?t-1:t,r&&a>1?a-1:a],c=0,h=p[0]/d[0],m=p[1]/d[1],v=0;v<o;v++)for(var g=0;g<t;g++)for(var I=h*g,y=Math.floor(I),k=I-y,b=Math.min(i-1,Math.ceil(I)),x=v*e.strides[0]+y*e.strides[1],S=v*e.strides[0]+b*e.strides[1],F=0;F<a;F++)for(var N=m*F,C=Math.floor(N),T=N-C,M=Math.min(s-1,Math.ceil(N)),A=x+C*e.strides[2],D=S+C*e.strides[2],_=x+M*e.strides[2],K=S+M*e.strides[2],W=0;W<l;W++){var z=f[A+W],w=f[D+W],H=z+(f[_+W]-z)*T,B=H+(w+(f[K+W]-w)*T-H)*k;u[c++]=B}return tf.tensor(u,[o,t,a,l])},t.prototype.resizeBilinearBackprop=function(e,t,a){assertNotComplex([e,t],"resizeBilinearBackprop");for(var r=t.shape,n=r[0],o=r[1],i=r[2],s=r[3],l=e.shape,f=l[1],u=l[2],p=new Float32Array(n*o*i*s),d=[a&&f>1?o-1:o,a&&u>1?i-1:i],c=[a&&f>1?f-1:f,a&&u>1?u-1:u],h=d[0]/c[0],m=d[1]/c[1],v=this.readSync(e.dataId),g=0,I=0;I<n;I++)for(var y=I*t.strides[0],k=0;k<f;k++)for(var b=k*h,x=Math.floor(b),S=Math.min(Math.ceil(b),o-1),F=y+x*t.strides[1],N=y+S*t.strides[1],C=b-x,T=1-C,M=0;M<u;M++)for(var A=M*m,D=Math.floor(A),_=Math.min(Math.ceil(A),i-1),K=A-D,W=1-K,z=F+D*t.strides[2],w=F+_*t.strides[2],H=N+D*t.strides[2],B=N+_*t.strides[2],E=T*W,P=T*K,q=C*W,O=C*K,R=0;R<s;R++){var V=v[g++];p[z+R]+=V*E,p[w+R]+=V*P,p[H+R]+=V*q,p[B+R]+=V*O}return tf.tensor4d(p,[n,i,o,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,a,r){assertNotComplex(e,"resizeNearestNeighbor");for(var n=e.shape,o=n[0],i=n[1],s=n[2],l=n[3],f=this.readSync(e.dataId),u=new Float32Array(o*t*a*l),p=[r&&t>1?i-1:i,r&&a>1?s-1:s],d=[r&&t>1?t-1:t,r&&a>1?a-1:a],c=p[0]/d[0],h=p[1]/d[1],m=0,v=0;v<o;v++)for(var g=v*e.strides[0],I=0;I<t;I++)for(var y=c*I,k=g+Math.min(i-1,r?Math.round(y):Math.floor(y))*e.strides[1],b=0;b<a;b++)for(var x=h*b,S=k+Math.min(s-1,r?Math.round(x):Math.floor(x))*e.strides[2],F=0;F<l;F++){var N=f[S+F];u[m++]=N}return tf.tensor(u,[o,t,a,l],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,a){assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,n=r[0],o=r[1],i=r[2],s=r[3],l=e.shape,f=l[1],u=l[2],p=new Float32Array(n*o*i*s),d=this.readSync(e.dataId),c=[a&&f>1?o-1:o,a&&u>1?i-1:i],h=[a&&f>1?f-1:f,a&&u>1?u-1:u],m=c[0]/h[0],v=c[1]/h[1],g=1/m,I=1/v,y=2*Math.ceil(g)+2,k=2*Math.ceil(I)+2,b=0;b<n;b++)for(var x=b*t.strides[0],S=0;S<o;S++)for(var F=x+S*t.strides[1],N=Math.floor(S*g),C=Math.floor(N-y/2),T=0;T<i;T++)for(var M=F+T*t.strides[2],A=Math.floor(T*I),D=Math.floor(A-k/2),_=0;_<s;_++){for(var K=0,W=0;W<y;W++){var z=W+C;if(!(z<0||z>=f)){var w=x+z*e.strides[1],H=z*m;if(S===Math.min(o-1,a?Math.round(H):Math.floor(H)))for(var B=0;B<k;B++){var E=B+D;if(!(E<0||E>=u)){var P=w+E*e.strides[2],q=E*v;T===Math.min(i-1,a?Math.round(q):Math.floor(q))&&(K+=d[P+_])}}}}p[M+_]=K}return tf.tensor4d(p,t.shape,t.dtype)},t.prototype.localResponseNormalization4D=function(e,t,a,r,n){assertNotComplex(e,"localResponseNormalization4D");var o=e.shape[3],i=o-1,s=this.readSync(e.dataId),l=e.size,f=new Float32Array(l);function u(e){for(var a=e%o,r=e-a+Math.max(0,a-t),n=e-a+Math.min(a+t,i),l=0;r<=n;r++){var f=s[r];l+=f*f}return l}for(var p=0;p<l;p++){var d=u(p),c=s[p]*Math.pow(a+r*d,-n);f[p]=c}return tf.tensor4d(f,e.shape)},t.prototype.LRNGrad=function(e,t,a,r,n,o,i){assertNotComplex(e,"LRNGrad");for(var s=e.shape[3],l=this.readSync(e.dataId),f=this.readSync(t.dataId),u=this.readSync(a.dataId),p=new Float32Array(e.size),d=e.size,c=0;c<d;c++){for(var h=c%s,m=c-h+Math.max(0,h-r),v=c-h+Math.min(s,h+r+1),g=0,I=m;I<v;I++)g+=Math.pow(f[I],2);g=o*g+n;for(I=m;I<v;I++){var y=-2*o*i*f[I]*u[c]/g;c===I&&(y+=Math.pow(g,-i)),y*=l[c],p[I]+=y}}return tf.tensor4d(p,e.shape)},t.prototype.multinomial=function(e,t,a,r){assertNotComplex(e,"multinomial");for(var n=t?e:tf.softmax(e),o=n.shape[0],i=n.shape[1],s=tf.zeros([o,a],"int32"),l=this.readSync(s.dataId),f=this.readSync(n.dataId),u=0;u<o;++u){var p=u*i,d=new Float32Array(i-1);d[0]=f[p];for(var c=1;c<d.length;++c)d[c]=d[c-1]+f[p+c];for(var h=seedrandom.alea(r.toString()),m=u*a,v=0;v<a;++v){var g=h();l[m+v]=d.length;for(var I=0;I<d.length;I++)if(g<d[I]){l[m+v]=I;break}}}return s},t.prototype.oneHot=function(e,t,a,r){assertNotComplex(e,"oneHot");var n=new Float32Array(e.size*t);n.fill(r);for(var o=this.readSync(e.dataId),i=0;i<e.size;++i)o[i]>=0&&o[i]<t&&(n[i*t+o[i]]=a);return tf.tensor2d(n,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,a,r,n){assertNotComplex(e,"nonMaxSuppression");var o=this.readSync(e.dataId),i=this.readSync(t.dataId);return nonMaxSuppressionV3Impl(o,i,a,r,n)},t.prototype.depthToSpace=function(e,t,a){tf.util.assert("NHWC"===a,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a}),tf.util.assert(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],n=e.shape[1],o=e.shape[2],i=e.shape[3],s=n*t,l=o*t,f=i/(t*t),u=this.readSync(e.dataId),p=new Float32Array(r*s*l*f),d=0,c=0;c<r;++c)for(var h=0;h<s;++h)for(var m=Math.floor(h/t),v=h%t,g=0;g<l;++g)for(var I=Math.floor(g/t),y=(v*t+g%t)*f,k=0;k<f;++k){var b=k+y+i*(I+o*(m+n*c));p[d++]=u[b]}return tf.tensor4d(p,[r,s,l,f])},t.prototype.broadcastedBinaryOp=function(e,t,a,r){var n=tf.backend_util.assertAndGetBroadcastShape(e.shape,t.shape),o=tf.buffer(n,a),i=this.readSync(e.dataId),s=this.readSync(t.dataId),l=tf.backend_util.getBroadcastDims(e.shape,n),f=tf.backend_util.getBroadcastDims(t.shape,n),u=o.values;if(l.length+f.length===0)for(var p=0;p<u.length;++p)u[p]=r(i[p%i.length],s[p%s.length]);else{var d=this.bufferSync(e),c=this.bufferSync(t),h=function(a){var n=o.indexToLoc(a),p=n.slice(-e.rank);l.forEach(function(e){return p[e]=0});var h=d.locToIndex(p),m=n.slice(-t.rank);f.forEach(function(e){return m[e]=0});var v=c.locToIndex(m);u[a]=r(i[h],s[v])};for(p=0;p<u.length;++p)h(p)}return o.toTensor()},t.prototype.split=function(e,t,a){return split(e,t,a)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return e.prototype.epsilon.call(this)},t.prototype.cropAndResize=function(e,t,a,r,n,o){for(var i=e.shape,s=i[0],l=i[1],f=i[2],u=i[3],p=t.shape[0],d=r[0],c=r[1],h=tf.buffer([p,d,c,u],"float32"),m=this.readSync(t.dataId),v=this.readSync(a.dataId),g=this.readSync(e.dataId),I=e.strides,y=h.strides,k=0;k<p;k++){var b=4*k,x=m[b],S=m[b+1],F=m[b+2],N=m[b+3],C=v[k];if(!(C>=s))for(var T=d>1?(F-x)*(l-1)/(d-1):0,M=c>1?(N-S)*(f-1)/(c-1):0,A=0;A<d;A++){var D=d>1?x*(l-1)+A*T:.5*(x+F)*(l-1);if(D<0||D>l-1)for(var _=0;_<c;_++)for(var K=0;K<u;K++){var W=K+_*y[2]+A*y[1]+k*y[0];h.values[W]=o}else if("bilinear"===n){var z=Math.floor(D),w=Math.ceil(D),H=D-z;for(_=0;_<c;_++){if((U=c>1?S*(f-1)+_*M:.5*(S+N)*(f-1))<0||U>f-1)for(K=0;K<u;K++){W=K+_*y[2]+A*y[1]+k*y[0];h.values[W]=o}else{var B=Math.floor(U),E=Math.ceil(U),P=U-B;for(K=0;K<u;K++){var q=g[W=K+B*I[2]+z*I[1]+C*I[0]],O=g[W=K+E*I[2]+z*I[1]+C*I[0]],R=g[W=K+B*I[2]+w*I[1]+C*I[0]],V=q+(O-q)*P,L=R+(g[W=K+E*I[2]+w*I[1]+C*I[0]]-R)*P;W=K+_*y[2]+A*y[1]+k*y[0],h.values[W]=V+(L-V)*H}}}}else for(_=0;_<c;++_){var U;if((U=c>1?S*(f-1)+_*M:.5*(S+N)*(f-1))<0||U>f-1)for(K=0;K<u;K++){W=K+_*y[2]+A*y[1]+k*y[0];h.values[W]=o}else{var G=Math.round(U),j=Math.round(D);for(K=0;K<u;K++){var Y=K+G*I[2]+j*I[1]+C*I[0],Z=K+_*y[2]+A*y[1]+k*y[0];h.values[Z]=g[Y]}}}}}return h.toTensor()},t.prototype.sparseToDense=function(e,t,a,r){var n=tf.backend_util.calculateShapes(t,e,a),o=n.sliceRank,i=n.numUpdates,s=n.sliceSize,l=n.strides,f=n.outputSize;return this.scatter(e,t,a,f,s,i,o,l,r,!1)},t.prototype.gatherND=function(e,t){var a=t.shape,r=a[a.length-1],n=tf.backend_util.prepareAndValidate(e,t),o=n[0],i=n[1],s=n[2],l=n[3];if(0===i)return tf.tensor([],o,e.dtype);for(var f=new tf.TensorBuffer([i,s],e.dtype),u=this.readSync(t.dataId),p=this.readSync(e.dataId),d=0;d<i;d++){for(var c=[],h=0,m=0;m<r;m++){var v=u[d*r+m];h+=v*l[m],c.push(v)}if(h<0||h>=e.size/s)throw new Error("Invalid indices: "+c+" does not index into "+e.shape);for(var g=0;g<s;g++)f.values[d*s+g]=p[h*s+g]}return f.toTensor().reshape(o)},t.prototype.scatterND=function(e,t,a){var r=tf.backend_util.calculateShapes(t,e,a),n=r.sliceRank,o=r.numUpdates,i=r.sliceSize,s=r.strides,l=r.outputSize,f=tf.scalar(0);return this.scatter(e,t,a,l,i,o,n,s,f,!0)},t.prototype.fill=function(e,t,a){a=a||tf.util.inferDtype(t);var r=tf.util.getArrayFromDType(a,tf.util.sizeFromShape(e));return r.fill(t),tf.engine().makeTensor(r,e,a,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=tf.util.getArrayFromDType(e.dtype,tf.util.sizeFromShape(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,a){return tf.backend_util.linspaceImpl(e,t,a)},t.prototype.scatter=function(e,t,a,r,n,o,i,s,l,f){var u=[r/n,n],p=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return tf.tensor([],a,t.dtype);var c=new tf.TensorBuffer(u,t.dtype);c.values.fill(this.readSync(l.dataId)[0]);for(var h=0;h<o;h++){for(var m=[],v=0,g=0;g<i;g++){var I=p[h*i+g];m.push(I),v+=I*s[g]}if(v<0||v>=r/n)throw new Error("Invalid indices: "+m+" does not index into "+a);for(var y=0;y<n;y++)f?c.values[v*n+y]+=d[h*n+y]:c.values[v*n+y]=0===t.rank?d[0]:d[h*n+y]}return c.toTensor().reshape(a)},t}(tf.KernelBackend);function simpleAbsImpl(e){for(var t=new Float32Array(e.length),a=0;a<e.length;++a)t[a]=Math.abs(e[a]);return t}var absKernelFunc=function(e){var t=e.inputs.x,a=e.backend,r=new Float32Array(tf.util.sizeFromShape(t.shape));if("complex64"!==t.dtype)r=simpleAbsImpl(a.data.get(t.dataId).values);else for(var n=a.data.get(t.dataId),o=n.complexTensorInfos.real,i=n.complexTensorInfos.imag,s=a.data.get(o.dataId).values,l=a.data.get(i.dataId).values,f=0;f<s.length;f++){var u=s[f],p=l[f];r[f]=Math.hypot(u,p)}return a.makeOutput(r,t.shape,"float32")},absConfig={kernelName:tf.Abs,backendName:"cpu",kernelFunc:absKernelFunc};function createSimpleBinaryKernelImpl(e){return function(t,a,r,n,o){var i=tf.backend_util.assertAndGetBroadcastShape(t,a),s=i.length,l=tf.util.computeStrides(i),f=tf.util.sizeFromShape(i),u=tf.util.getTypedArrayFromDType(o,f),p=t.length,d=a.length,c=tf.util.computeStrides(t),h=tf.util.computeStrides(a),m=tf.backend_util.getBroadcastDims(t,i),v=tf.backend_util.getBroadcastDims(a,i);if(m.length+v.length===0)for(var g=0;g<u.length;++g)u[g]=e(r[g%r.length],n[g%n.length]);else{var I=function(t){var a=tf.util.indexToLoc(t,s,l),o=a.slice(-p);m.forEach(function(e){return o[e]=0});var i=tf.util.locToIndex(o,p,c),f=a.slice(-d);v.forEach(function(e){return f[e]=0});var g=tf.util.locToIndex(f,d,h);u[t]=e(r[i],n[g])};for(g=0;g<u.length;++g)I(g)}return[u,i]}}function complex(e){var t=e.inputs,a=e.backend,r=t.real,n=t.imag,o=a.data.get(r.dataId).values,i=a.data.get(n.dataId).values,s=a.makeTensorInfo(r.shape,"complex64");return a.data.get(s.dataId).complexTensorInfos={real:a.makeTensorInfo(r.shape,"float32",o),imag:a.makeTensorInfo(n.shape,"float32",i)},s}var complexConfig={kernelName:tf.Complex,backendName:"cpu",kernelFunc:complex};function identity(e){var t=e.inputs,a=e.backend,r=t.x;return a.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var identityConfig={kernelName:tf.Identity,backendName:"cpu",kernelFunc:identity};function real(e){var t=e.inputs,a=e.backend,r=t.input,n=a.data.get(r.dataId).complexTensorInfos.real,o=a.data.get(n.dataId).values;return a.makeTensorInfo(n.shape,n.dtype,o)}var realConfig={kernelName:tf.Real,backendName:"cpu",kernelFunc:real};function cast(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x,o=r.dtype;if("complex64"===o){if("complex64"===n.dtype)return identity({inputs:{x:n},backend:a});var i=tf.zeros(n.shape),s=cast({inputs:{x:n},backend:a,attrs:{dtype:"float32"}}),l=complex({inputs:{real:s,imag:i},backend:a});return i.dispose(),a.disposeIntermediateTensorInfo(s),l}if("complex64"===n.dtype){var f=real({inputs:{input:n},backend:a}),l=cast({inputs:{x:f},backend:a,attrs:{dtype:o}});return a.disposeIntermediateTensorInfo(f),l}if(!tf.util.hasEncodingLoss(n.dtype,o))return{dataId:(l=identity({inputs:{x:n},backend:a})).dataId,shape:l.shape,dtype:o};if("int32"===o){var u=a.data.get(n.dataId).values,p=Int32Array.from(u);return a.makeTensorInfo(n.shape,"int32",p)}if("bool"===o){var d=a.data.get(n.dataId).values,c=tf.util.toTypedArray([0],n.dtype),h=createSimpleBinaryKernelImpl(function(e,t){return e!==t?1:0})(n.shape,[],d,c,"bool"),m=h[0],v=h[1];return a.makeTensorInfo(v,"bool",m)}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+o)}var castConfig={kernelName:tf.Cast,backendName:"cpu",kernelFunc:cast};function binaryKernelFunc(e,t,a,r){return null==a?function(a){var n=a.inputs,o=a.backend,i=n,s=i.a,l=i.b,f=o;assertNotComplex([s,l],e);var u=f.data.get(s.dataId).values,p=f.data.get(l.dataId).values,d=r||s.dtype,c=t(s.shape,l.shape,u,p,d),h=c[0],m=c[1];return f.makeTensorInfo(m,d,h)}:function(e){var n=e.inputs,o=e.backend,i=n,s=i.a,l=i.b,f=o;if("complex64"===s.dtype||"complex64"===l.dtype){var u=cast({inputs:{x:s},backend:f,attrs:{dtype:"complex64"}}),p=f.data.get(u.dataId),d=p.complexTensorInfos.real,c=p.complexTensorInfos.imag,h=f.data.get(d.dataId).values,m=f.data.get(c.dataId).values,v=cast({inputs:{x:l},backend:f,attrs:{dtype:"complex64"}}),g=f.data.get(v.dataId),I=g.complexTensorInfos.real,y=g.complexTensorInfos.imag,k=f.data.get(I.dataId).values,b=f.data.get(y.dataId).values,x=a(s.shape,l.shape,h,m,k,b),S=x[0],F=x[1],N=x[2],C=f.makeTensorInfo(N,"float32",S),T=f.makeTensorInfo(N,"float32",F),M=complex({inputs:{real:C,imag:T},backend:f});return f.disposeIntermediateTensorInfo(u),f.disposeIntermediateTensorInfo(v),f.disposeIntermediateTensorInfo(C),f.disposeIntermediateTensorInfo(T),M}var A=f.data.get(s.dataId).values,D=f.data.get(l.dataId).values,_=r||s.dtype,K=t(s.shape,l.shape,A,D,_),W=K[0];N=K[1];return f.makeTensorInfo(N,_,W)}}function createComplexBinaryKernelImpl(e){return function(t,a,r,n,o,i){var s=tf.backend_util.assertAndGetBroadcastShape(t,a),l=tf.util.sizeFromShape(s),f=s.length,u=tf.util.computeStrides(s),p=tf.util.getTypedArrayFromDType("float32",l),d=tf.util.getTypedArrayFromDType("float32",l),c=tf.backend_util.getBroadcastDims(t,s),h=tf.backend_util.getBroadcastDims(a,s),m=tf.backend_util.mergeRealAndImagArrays(r,n),v=tf.backend_util.mergeRealAndImagArrays(o,i),g=t.length,I=tf.util.computeStrides(t),y=a.length,k=tf.util.computeStrides(a);if(c.length+h.length===0)for(var b=0;b<p.length;b++){var x=b%m.length,S=b%v.length,F=e(m[2*x],m[2*x+1],v[2*S],v[2*S+1]);p[b]=F.real,d[b]=F.imag}else{var N=function(t){var a=tf.util.indexToLoc(t,f,u),r=a.slice(-g);c.forEach(function(e){return r[e]=0});var n=tf.util.locToIndex(r,g,I),o=a.slice(-y);h.forEach(function(e){return o[e]=0});var i=tf.util.locToIndex(o,y,k),s=e(m[2*n],m[2*n+1],v[2*i],v[2*i+1]);p[t]=s.real,d[t]=s.imag};for(b=0;b<p.length;b++)N(b)}return[p,d,s]}}var addImpl=createSimpleBinaryKernelImpl(function(e,t){return e+t}),addComplexImpl=createComplexBinaryKernelImpl(function(e,t,a,r){return{real:e+a,imag:t+r}}),add=binaryKernelFunc(tf.Add,addImpl,addComplexImpl),addConfig={kernelName:tf.Add,backendName:"cpu",kernelFunc:add};function createSimpleUnaryImpl(e){return function(t,a,r){for(var n=tf.util.getTypedArrayFromDType(a,t.length),o=0;o<t.length;++o)n[o]=e(t[o],r);return n}}function unaryKernelFunc(e,t,a){return function(r){var n=r.inputs,o=r.attrs,i=r.backend,s=n.x;if(assertNotComplex(s,e),"string"===s.dtype||"string"===a)throw new Error("unaryKernelFunc does not support string input/output");for(var l=i,f=l.data.get(s.dataId).values,u=tf.util.sizeFromShape(s.shape),p=a||s.dtype,d=tf.util.getArrayFromDType(p,u),c=0;c<u;++c)d[c]=t(f[c],o);return l.makeTensorInfo(s.shape,p,d)}}function unaryKernelFuncFromImpl(e,t,a){return function(r){var n=r.inputs,o=r.attrs,i=r.backend,s=n.x;if(assertNotComplex(s,e),"string"===s.dtype||"string"===a)throw new Error("unaryKernelFunc does not support string input/output");var l=i,f=l.data.get(s.dataId).values,u=a||s.dtype,p=t(f,u,o);return l.makeTensorInfo(s.shape,u,p)}}var ceilImpl=createSimpleUnaryImpl(function(e){return Math.ceil(e)}),ceilKernelFunc=unaryKernelFuncFromImpl(tf.Ceil,ceilImpl),ceilConfig={kernelName:tf.Ceil,backendName:"cpu",kernelFunc:ceilKernelFunc},expImpl=createSimpleUnaryImpl(function(e){return Math.exp(e)}),expKernelFunc=unaryKernelFuncFromImpl(tf.Exp,expImpl),expConfig={kernelName:tf.Exp,backendName:"cpu",kernelFunc:expKernelFunc},expm1Impl=createSimpleUnaryImpl(function(e){return Math.expm1(e)}),expm1KernelFunc=unaryKernelFuncFromImpl(tf.Expm1,expm1Impl),expm1Config={kernelName:tf.Expm1,backendName:"cpu",kernelFunc:expm1KernelFunc},floorImpl=createSimpleUnaryImpl(function(e){return Math.floor(e)}),floorKernelFunc=unaryKernelFuncFromImpl(tf.Floor,floorImpl),floorConfig={kernelName:tf.Floor,backendName:"cpu",kernelFunc:floorKernelFunc},logImpl=createSimpleUnaryImpl(function(e){return Math.log(e)}),logKernelFunc=unaryKernelFuncFromImpl(tf.Log,logImpl),logConfig={kernelName:tf.Log,backendName:"cpu",kernelFunc:logKernelFunc};function maxImpl(e,t,a,r){for(var n=tf.util.getTypedArrayFromDType(r,tf.util.sizeFromShape(a)),o=0;o<n.length;++o){for(var i=o*t,s=e[i],l=0;l<t;++l){var f=e[i+l];f>s&&(s=f)}n[o]=s}return n}var multiplyImpl=createSimpleBinaryKernelImpl(function(e,t){return e*t}),multiplyComplexImpl=createComplexBinaryKernelImpl(function(e,t,a,r){return{real:e*a-t*r,imag:e*r+t*a}}),multiply=binaryKernelFunc(tf.Multiply,multiplyImpl,multiplyComplexImpl),multiplyConfig={kernelName:tf.Multiply,backendName:"cpu",kernelFunc:multiply},rsqrtImpl=createSimpleUnaryImpl(function(e){return 1/Math.sqrt(e)}),rsqrtKernelFunc=unaryKernelFuncFromImpl(tf.Rsqrt,rsqrtImpl),rsqrtConfig={kernelName:tf.Rsqrt,backendName:"cpu",kernelFunc:rsqrtKernelFunc};function sliceImpl(e,t,a,r,n){var o=tf.slice_util.isSliceContinous(r,t,a),i=tf.util.sizeFromShape(a),s=tf.util.computeStrides(r);if(o){var l=tf.slice_util.computeFlatOffset(t,s);return e.subarray(l,l+i)}for(var f=tf.util.getTypedArrayFromDType(n,i),u=0;u<i;++u){var p=a.length,d=tf.util.computeStrides(a),c=tf.util.indexToLoc(u,p,d).map(function(e,a){return e+t[a]}),h=tf.util.locToIndex(c,r.length,s);f[u]=e[h]}return f}function slice(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x,o=r.begin,i=r.size;assertNotComplex(n,"slice");var s=tf.slice_util.parseSliceParams(n,o,i),l=s[0],f=s[1];tf.slice_util.assertParamsValid(n,l,f);var u=sliceImpl(a.data.get(n.dataId).values,l,f,n.shape,n.dtype);return a.makeTensorInfo(f,n.dtype,u)}var sliceConfig={kernelName:tf.Slice,backendName:"cpu",kernelFunc:slice},subImpl=createSimpleBinaryKernelImpl(function(e,t){return e-t}),subComplexImpl=createComplexBinaryKernelImpl(function(e,t,a,r){return{real:e-a,imag:t-r}}),sub=binaryKernelFunc(tf.Sub,subImpl,subComplexImpl),subConfig={kernelName:tf.Sub,backendName:"cpu",kernelFunc:sub};function transposeImpl(e,t,a,r,n){for(var o=t.length,i=tf.util.sizeFromShape(t),s=tf.util.computeStrides(t),l=tf.util.computeStrides(n),f=tf.util.getTypedArrayFromDType(a,tf.util.sizeFromShape(n)),u=0;u<i;++u){for(var p=tf.util.indexToLoc(u,o,s),d=new Array(p.length),c=0;c<d.length;c++)d[c]=p[r[c]];f[tf.util.locToIndex(d,o,l)]=e[u]}return f}function uniqueImpl(e,t,a,r){for(var n=tf.util.parseAxisParam(t,a)[0],o=[1,a[0],1],i=0;i<n;i++)o[0]*=a[i];o[1]=a[n];for(i=n+1;i<a.length;i++)o[2]*=a[i];var s={},l=new Int32Array(a[n]),f=new tf.TensorBuffer(o,r,e),u=[],p=1===o[0]&&1===o[2];for(i=0;i<a[n];i++){var d=void 0;if(p)d=e[i].toString();else{for(var c=[],h=0;h<o[0];h++)for(var m=0;m<o[2];m++)c.push(f.get(h,i,m));d=c.join(",")}if(void 0!==s[d])l[i]=s[d];else{var v=Object.keys(s).length;s[d]=v,l[i]=v,u.push(i)}}var g=o.slice();g[1]=Object.keys(s).length;var I=new tf.TensorBuffer(g,r);u.forEach(function(e,t){for(var a=0;a<o[0];a++)for(var r=0;r<o[2];r++)I.set(f.get(a,e,r),a,t,r)});var y=a.slice();return y[n]=g[1],{outputValues:I.values,outputShape:y,indices:l}}var shared={__proto__:null,simpleAbsImpl:simpleAbsImpl,addImpl:addImpl,ceilImpl:ceilImpl,expImpl:expImpl,expm1Impl:expm1Impl,floorImpl:floorImpl,logImpl:logImpl,maxImpl:maxImpl,multiplyImpl:multiplyImpl,rsqrtImpl:rsqrtImpl,sliceImpl:sliceImpl,subImpl:subImpl,transposeImpl:transposeImpl,uniqueImpl:uniqueImpl},version="2.6.0";tf.registerBackend("cpu",function(){return new MathBackendCPU},1);var acosKernelFunc=unaryKernelFunc(tf.Acos,function(e){return Math.acos(e)}),acosConfig={kernelName:tf.Acos,backendName:"cpu",kernelFunc:acosKernelFunc},acoshKernelFunc=unaryKernelFunc(tf.Acosh,function(e){return Math.acosh(e)}),acoshConfig={kernelName:tf.Acosh,backendName:"cpu",kernelFunc:acoshKernelFunc},asinKernelFunc=unaryKernelFunc(tf.Asin,function(e){return Math.asin(e)}),asinConfig={kernelName:tf.Asin,backendName:"cpu",kernelFunc:asinKernelFunc},asinhKernelFunc=unaryKernelFunc(tf.Asinh,function(e){return Math.asinh(e)}),asinhConfig={kernelName:tf.Asinh,backendName:"cpu",kernelFunc:asinhKernelFunc},atanKernelFunc=unaryKernelFunc(tf.Atan,function(e){return Math.atan(e)}),atanConfig={kernelName:tf.Atan,backendName:"cpu",kernelFunc:atanKernelFunc},atanhKernelFunc=unaryKernelFunc(tf.Atanh,function(e){return Math.atanh(e)}),atanhConfig={kernelName:tf.Atanh,backendName:"cpu",kernelFunc:atanhKernelFunc};function pool(e,t,a,r,n,o){for(var i=n.strideHeight,s=n.strideWidth,l=n.dilationHeight,f=n.dilationWidth,u=n.effectiveFilterHeight,p=n.effectiveFilterWidth,d=n.padInfo.top,c=n.padInfo.left,h="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=tf.buffer(n.outShape,a),v=m.values,g=n.outShape[1]*n.outShape[2]*n.outShape[3],I=n.outShape[2]*n.outShape[3],y=n.outShape[3],k=0;k<n.batchSize;++k)for(var b=k*g,x=k*r[0],S=0;S<n.inChannels;++S)for(var F=0;F<n.outHeight;++F)for(var N=F*i-d,C=Math.max(0,N),T=Math.min(n.inHeight,u+N),M=b+F*I,A=0;A<n.outWidth;++A){for(var D=A*s-c,_=Math.max(0,D),K=Math.min(n.inWidth,p+D),W=h,z=0,w=0,H=C;H<T;H+=l){for(var B=x+H*r[1],E=_;E<K;E+=f){var P=e[B+E*r[2]+S];"max"===o&&P>W?W=P:"avg"===o&&(z+=P,w++)}if(isNaN(W))break}v[M+A*y+S]="avg"===o?z/w:W}return m}function maxPoolPositions(e,t,a,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);for(var i=tf.buffer(r.outShape,"int32"),s=r.strideHeight,l=r.strideWidth,f=r.dilationHeight,u=r.dilationWidth,p=r.effectiveFilterHeight,d=r.effectiveFilterWidth,c=r.padInfo.top,h=r.padInfo.left,m=tf.buffer(t,a,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var I=0;I<r.outHeight;++I){for(var y=I*s-c,k=y;k<0;)k+=f;for(var b=Math.min(r.inHeight,p+y),x=0;x<r.outWidth;++x){for(var S=x*l-h,F=S;F<0;)F+=u;for(var N=Math.min(r.inWidth,d+S),C=Number.NEGATIVE_INFINITY,T=-1,M=k;M<b;M+=f)for(var A=M-y,D=F;D<N;D+=u){var _=D-S,K=m.get(v,M,D,g);K>C&&(C=K,T=n?o?((v*r.inHeight+M)*r.inWidth+D)*r.inChannels+g:(M*r.inWidth+D)*r.inChannels+g:A*d+_)}i.set(T,v,I,x,g)}}return i}function avgPool(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x;assertNotComplex(n,"avgPool");var o=r.filterSize,i=r.strides,s=r.pad,l=r.dimRoundingMode;tf.util.assert(tf.backend_util.eitherStridesOrDilationsAreOne(i,1),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+i+" and dilations '1'"});var f,u=tf.backend_util.computePool2DInfo(n.shape,o,i,1,s,l);if(1===u.filterWidth&&1===u.filterHeight&&tf.util.arraysEqual(u.inShape,u.outShape))f=identity({inputs:{x:n},backend:a});else{var p=a.data.get(n.dataId).values,d=tf.util.computeStrides(n.shape),c=pool(p,n.shape,n.dtype,d,u,"avg");f=a.makeTensorInfo(u.outShape,n.dtype,c.values)}return f}var avgPoolConfig={kernelName:tf.AvgPool,backendName:"cpu",kernelFunc:avgPool};function avgPoolBackprop(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.dy,o=t.input,i=o;assertNotComplex([n,o],"avgPoolBackprop");for(var s=r.filterSize,l=r.strides,f=r.pad,u=tf.backend_util.computePool2DInfo(i.shape,s,l,1,f),p=u.strideHeight,d=u.strideWidth,c=u.filterHeight,h=u.filterWidth,m=u.dilationHeight,v=u.dilationWidth,g=u.effectiveFilterHeight,I=u.effectiveFilterWidth,y=I-1-u.padInfo.left,k=g-1-u.padInfo.top,b=tf.buffer(i.shape,"float32"),x=1/(c*h),S=a.data.get(n.dataId).values,F=tf.buffer(n.shape,"float32",S),N=0;N<u.batchSize;++N)for(var C=0;C<u.inChannels;++C)for(var T=0;T<u.inHeight;++T)for(var M=0;M<u.inWidth;++M){for(var A=T-k,D=M-y,_=0,K=0;K<g;K+=m){var W=(A+K)/p;if(!(W<0||W>=u.outHeight||Math.floor(W)!==W))for(var z=0;z<I;z+=v){var w=(D+z)/d;if(!(w<0||w>=u.outWidth||Math.floor(w)!==w))_+=F.get(N,W,w,C)}}b.set(_*x,N,T,M,C)}return a.makeTensorInfo(b.shape,b.dtype,b.values)}var avgPoolBackpropConfig={kernelName:tf.AvgPoolBackprop,backendName:"cpu",kernelFunc:avgPoolBackprop};function batchNormKernelFunc(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x,o=t.scale,i=t.offset,s=t.mean,l=t.variance;tf.util.assert(s.shape.length===l.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),tf.util.assert(null==i||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),tf.util.assert(null==o||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),assertNotComplex([n,s,l,o,i],"batchNorm");var f=r.varianceEpsilon;null==f&&(f=.001);for(var u=a.data.get(n.dataId).values,p=a.data.get(s.dataId).values,d=a.data.get(l.dataId).values,c=o?a.data.get(o.dataId).values:new Float32Array([1]),h=i?a.data.get(i.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),v=h.length,g=c.length,I=d.length,y=p.length,k=0,b=0,x=0,S=0,F=0;F<u.length;++F)m[F]=h[k++]+(u[F]-p[b++])*c[x++]/Math.sqrt(d[S++]+f),k>=v&&(k=0),b>=y&&(b=0),x>=g&&(x=0),S>=I&&(S=0);return a.makeTensorInfo(n.shape,n.dtype,m)}var batchNormConfig={kernelName:tf.FusedBatchNorm,backendName:"cpu",kernelFunc:batchNormKernelFunc},clipKernelFunc=unaryKernelFunc(tf.ClipByValue,function(e,t){var a=t;return e>a.clipValueMax?a.clipValueMax:e<a.clipValueMin?a.clipValueMin:e}),clipConfig={kernelName:tf.ClipByValue,backendName:"cpu",kernelFunc:clipKernelFunc};function imag(e){var t=e.inputs,a=e.backend,r=t.input,n=a.data.get(r.dataId).complexTensorInfos.imag,o=a.data.get(n.dataId).values;return a.makeTensorInfo(n.shape,n.dtype,o)}var imagConfig={kernelName:tf.Imag,backendName:"cpu",kernelFunc:imag};function reshape(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x,o=r.shape,i=tf.util.sizeFromShape(n.shape),s=tf.util.inferFromImplicitShape(o,i),l=tf.util.sizeFromShape(s);tf.util.assert(i===l,function(){return"The new shape ("+s+") has "+l+" elements and the old shape ("+n.shape+") has "+i+" elements. The new shape and old shape must have the same number of elements."}),a.incRef(n.dataId);var f=a.data.get(n.dataId);if(null!=f.complexTensorInfos){var u=f.complexTensorInfos.real,p=f.complexTensorInfos.imag;u.shape=s,p.shape=s}return{dataId:n.dataId,shape:s,dtype:n.dtype}}var reshapeConfig={kernelName:tf.Reshape,backendName:"cpu",kernelFunc:reshape};function concat(e){var t=e.inputs,a=e.backend,r=e.attrs.axis,n=tf.util.parseAxisParam(r,t[0].shape)[0],o=tf.backend_util.computeOutShape(t.map(function(e){return e.shape}),n);if(0===tf.util.sizeFromShape(o))return a.makeTensorInfo(o,t[0].dtype,[]);var i=t.filter(function(e){return tf.util.sizeFromShape(e.shape)>0});if(1===i.length)return i[0];var s=i.map(function(e){return e.shape});if(tf.backend_util.assertParamsConsistent(s,n),"complex64"===i[0].dtype){var l=i.map(function(e){return real({inputs:{input:e},backend:a})}),f=i.map(function(e){return imag({inputs:{input:e},backend:a})}),u=concat({inputs:l,backend:a,attrs:{axis:r}}),p=concat({inputs:f,backend:a,attrs:{axis:r}}),d=complex({inputs:{real:u,imag:p},backend:a});return l.forEach(function(e){return a.disposeIntermediateTensorInfo(e)}),f.forEach(function(e){return a.disposeIntermediateTensorInfo(e)}),a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(p),d}var c=i.map(function(e){var t=tf.util.sizeFromShape(e.shape.slice(n));return reshape({inputs:{x:e},backend:a,attrs:{shape:[-1,t]}})});o=tf.backend_util.computeOutShape(c.map(function(e){return e.shape}),1);var h=tf.util.getTypedArrayFromDType(i[0].dtype,tf.util.sizeFromShape(o));if(1===c[0].shape[0]){var m=0;c.forEach(function(e){var t=a.data.get(e.dataId).values,r=tf.util.sizeFromShape(e.shape);h.set(t,m),m+=r})}else{var v=0;c.forEach(function(e){for(var t=a.data.get(e.dataId).values,r=0,n=0;n<e.shape[0];++n)for(var i=n*o[1]+v,s=0;s<e.shape[1];++s)h[i+s]=t[r++];v+=e.shape[1]})}var g=tf.backend_util.computeOutShape(i.map(function(e){return e.shape}),n),I=a.makeTensorInfo(g,t[0].dtype,h);return c.forEach(function(e){return a.disposeIntermediateTensorInfo(e)}),I}var concatConfig={kernelName:tf.Concat,backendName:"cpu",kernelFunc:concat},cosKernelFunc=unaryKernelFunc(tf.Cos,function(e){return Math.cos(e)}),cosConfig={kernelName:tf.Cos,backendName:"cpu",kernelFunc:cosKernelFunc},coshKernelFunc=unaryKernelFunc(tf.Cosh,function(e){return Math.cosh(e)}),coshConfig={kernelName:tf.Cosh,backendName:"cpu",kernelFunc:coshKernelFunc},dilation2dConfig={kernelName:tf.Dilation2D,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,a=e.backend,r=e.attrs,n=t,o=n.x,i=n.filter,s=r,l=s.strides,f=s.pad,u=s.dilations,p=a,d=p.data.get(o.dataId).values,c=o.shape.length,h=p.data.get(i.dataId).values,m=i.shape.length,v=tf.backend_util.computeDilation2DInfo(o.shape,i.shape,l,f,"NHWC",u),g=v.batchSize,I=v.inHeight,y=v.inWidth,k=v.inChannels,b=v.outHeight,x=v.outWidth,S=v.padInfo,F=v.strideHeight,N=v.strideWidth,C=v.filterHeight,T=v.filterWidth,M=v.dilationHeight,A=v.dilationWidth,D=v.outShape,_=tf.util.sizeFromShape(D),K=D.length,W=tf.util.getArrayFromDType(o.dtype,_),z=0;z<g;++z)for(var w=0;w<b;++w)for(var H=w*F-S.top,B=0;B<x;++B)for(var E=B*N-S.left,P=0;P<k;++P){for(var q=Number.MIN_SAFE_INTEGER,O=0;O<C;++O){var R=H+O*M;if(R>=0&&R<I)for(var V=0;V<T;++V){var L=E+V*A;if(L>=0&&L<y){var U=tf.util.locToIndex([z,R,L,P],c,tf.util.computeStrides(o.shape)),G=tf.util.locToIndex([O,V,P],m,tf.util.computeStrides(i.shape)),j=d[U]+h[G];j>q&&(q=j)}}}W[tf.util.locToIndex([z,w,B,P],K,tf.util.computeStrides(D))]=q}return{dataId:p.write(tf.util.toTypedArray(W,o.dtype),D,o.dtype),shape:D,dtype:o.dtype}}},dilation2dBackpropFilterConfig={kernelName:tf.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t,o=n.x,i=n.filter,s=n.dy,l=r,f=l.strides,u=l.pad,p=l.dilations,d=a,c=tf.util.toNestedArray(o.shape,d.data.get(o.dataId).values),h=tf.util.toNestedArray(i.shape,d.data.get(i.dataId).values),m=tf.backend_util.computeDilation2DInfo(o.shape,i.shape,f,u,"NHWC",p),v=m.batchSize,g=m.inHeight,I=m.inWidth,y=m.inChannels,k=m.outHeight,b=m.outWidth,x=m.padInfo,S=m.strideHeight,F=m.strideWidth,N=m.filterHeight,C=m.filterWidth,T=m.dilationHeight,M=m.dilationWidth,A=m.outShape;tf.util.assert(s.rank===A.length,function(){return"Error in "+tf.Dilation2DBackpropFilter+", dy must have the same rank as output "+A.length+", but got "+s.rank});for(var D=tf.util.toNestedArray(A,d.data.get(s.dataId).values),_=tf.util.makeZerosNestedTypedArray(i.shape,i.dtype),K=0;K<v;++K)for(var W=0;W<k;++W)for(var z=W*S-x.top,w=0;w<b;++w)for(var H=w*F-x.left,B=0;B<y;++B){for(var E=Number.MIN_SAFE_INTEGER,P=0,q=0,O=0;O<N;++O){var R=z+O*T;if(R>=0&&R<g)for(var V=0;V<C;++V){var L=H+V*M;if(L>=0&&L<I){var U=c[K][R][L][B]+h[O][V][B];U>E&&(E=U,P=O,q=V)}}}_[P][q][B]+=D[K][W][w][B]}return{dataId:d.write(tf.util.toTypedArray(_,o.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},dilation2dBackpropInputConfig={kernelName:tf.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t,o=n.x,i=n.filter,s=n.dy,l=r,f=l.strides,u=l.pad,p=l.dilations,d=a,c=tf.util.toNestedArray(o.shape,d.data.get(o.dataId).values),h=tf.util.toNestedArray(i.shape,d.data.get(i.dataId).values),m=tf.backend_util.computeDilation2DInfo(o.shape,i.shape,f,u,"NHWC",p),v=m.batchSize,g=m.inHeight,I=m.inWidth,y=m.inChannels,k=m.outHeight,b=m.outWidth,x=m.padInfo,S=m.strideHeight,F=m.strideWidth,N=m.filterHeight,C=m.filterWidth,T=m.dilationHeight,M=m.dilationWidth,A=m.outShape;tf.util.assert(s.rank===A.length,function(){return"Error in "+tf.Dilation2DBackpropInput+", dy must have the same rank as output "+A.length+", but got "+s.rank});for(var D=tf.util.toNestedArray(A,d.data.get(s.dataId).values),_=tf.util.makeZerosNestedTypedArray(o.shape,o.dtype),K=0;K<v;++K)for(var W=0;W<k;++W)for(var z=W*S-x.top,w=0;w<b;++w)for(var H=w*F-x.left,B=0;B<y;++B){for(var E=Number.MIN_SAFE_INTEGER,P=z<0?0:z,q=H<0?0:H,O=0;O<N;++O){var R=z+O*T;if(R>=0&&R<g)for(var V=0;V<C;++V){var L=H+V*M;if(L>=0&&L<I){var U=c[K][R][L][B]+h[O][V][B];U>E&&(E=U,P=R,q=L)}}}_[K][P][q][B]+=D[K][W][w][B]}return{dataId:d.write(tf.util.toTypedArray(_,o.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},divImpl=createSimpleBinaryKernelImpl(function(e,t){return e/t}),div=binaryKernelFunc(tf.Div,divImpl),divConfig={kernelName:tf.Div,backendName:"cpu",kernelFunc:div},eluKernelFunc=unaryKernelFunc(tf.Elu,function(e){return e>=0?e:Math.exp(e)-1}),eluConfig={kernelName:tf.Elu,backendName:"cpu",kernelFunc:eluKernelFunc},p=tf.backend_util.ERF_P,a1=tf.backend_util.ERF_A1,a2=tf.backend_util.ERF_A2,a3=tf.backend_util.ERF_A3,a4=tf.backend_util.ERF_A4,a5=tf.backend_util.ERF_A5,erfKernelFunc=unaryKernelFunc(tf.Erf,function(e){var t=Math.sign(e),a=Math.abs(e),r=1/(1+p*a);return t*(1-((((a5*r+a4)*r+a3)*r+a2)*r+a1)*r*Math.exp(-a*a))}),erfConfig={kernelName:tf.Erf,backendName:"cpu",kernelFunc:erfKernelFunc};function fftBatch(e,t,a){for(var r=e.shape,n=r[0],o=r[1],i=a.data.get(e.dataId),s=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,f=[n,o],u=tf.util.sizeFromShape(f),p=tf.util.getTypedArrayFromDType("float32",u),d=tf.util.getTypedArrayFromDType("float32",u),c=0;c<n;c++){for(var h=slice({inputs:{x:s},backend:a,attrs:{begin:[c,0],size:[1,o]}}),m=slice({inputs:{x:l},backend:a,attrs:{begin:[c,0],size:[1,o]}}),v=complex({inputs:{real:h,imag:m},backend:a}),g=fftImpl(v,t,a),I=g.real,y=g.imag,k=tf.backend_util.mergeRealAndImagArrays(I,y),b=0;b<o;b++){var x=tf.backend_util.getComplexWithIndex(k,b);p[c*o+b]=x.real,d[c*o+b]=x.imag}a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(m),a.disposeIntermediateTensorInfo(v)}var S=a.makeTensorInfo(f,"float32",p),F=a.makeTensorInfo(f,"float32",d),N=complex({inputs:{real:S,imag:F},backend:a});return a.disposeIntermediateTensorInfo(S),a.disposeIntermediateTensorInfo(F),N}function fftImpl(e,t,a){var r=tf.util.sizeFromShape(e.shape),n=a.data.get(e.dataId),o=a.data.get(n.complexTensorInfos.real.dataId).values,i=a.data.get(n.complexTensorInfos.imag.dataId).values;if(isExponentOf2(r)){var s=fftRadix2(o,i,r,t,a),l=[e.shape[0],e.shape[1]];if(t){var f=a.makeTensorInfo(l,"float32",s.real),u=a.makeTensorInfo(l,"float32",s.imag),p=a.makeTensorInfo([],"float32",tf.util.createScalarValue(r,"float32")),d=identity({inputs:{x:p},backend:a}),c=divConfig.kernelFunc({inputs:{a:f,b:p},backend:a}),h=divConfig.kernelFunc({inputs:{a:u,b:d},backend:a}),m=a.data.get(c.dataId).values,v=a.data.get(h.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(c),a.disposeIntermediateTensorInfo(h),{real:m,imag:v}}return s}var g=fourierTransformByMatmul(tf.backend_util.mergeRealAndImagArrays(o,i),r,t);return tf.backend_util.splitRealAndImagArrays(g)}function isExponentOf2(e){return 0==(e&e-1)}function fftRadix2(e,t,a,r,n){if(1===a)return{real:e,imag:t};var o=tf.backend_util.mergeRealAndImagArrays(e,t),i=a/2,s=tf.backend_util.complexWithEvenIndex(o),l=s.real,f=s.imag,u=[l.length],p=n.makeTensorInfo(u,"float32",l),d=n.makeTensorInfo(u,"float32",f),c=complex({inputs:{real:p,imag:d},backend:n}),h=tf.backend_util.complexWithOddIndex(o),m=h.real,v=h.imag,g=[m.length],I=n.makeTensorInfo(g,"float32",m),y=n.makeTensorInfo(g,"float32",v),k=complex({inputs:{real:I,imag:y},backend:n}),b=fftRadix2(l,f,i,r,n),x=b.real,S=b.imag,F=[x.length],N=n.makeTensorInfo(F,"float32",x),C=n.makeTensorInfo(F,"float32",S),T=complex({inputs:{real:N,imag:C},backend:n}),M=fftRadix2(m,v,i,r,n),A=M.real,D=M.imag,_=[A.length],K=n.makeTensorInfo(_,"float32",A),W=n.makeTensorInfo(_,"float32",D),z=complex({inputs:{real:K,imag:W},backend:n}),w=tf.backend_util.exponents(a,r),H=[w.real.length],B=n.makeTensorInfo(H,"float32",w.real),E=n.makeTensorInfo(H,"float32",w.imag),P=complex({inputs:{real:B,imag:E},backend:n}),q=multiply({inputs:{a:P,b:z},backend:n}),O=add({inputs:{a:T,b:q},backend:n}),R=sub({inputs:{a:T,b:q},backend:n}),V=real({inputs:{input:O},backend:n}),L=real({inputs:{input:R},backend:n}),U=imag({inputs:{input:O},backend:n}),G=imag({inputs:{input:R},backend:n}),j=concat({inputs:[V,L],backend:n,attrs:{axis:0}}),Y=concat({inputs:[U,G],backend:n,attrs:{axis:0}}),Z=n.data.get(j.dataId).values,J=n.data.get(Y.dataId).values;return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(K),n.disposeIntermediateTensorInfo(W),n.disposeIntermediateTensorInfo(z),n.disposeIntermediateTensorInfo(B),n.disposeIntermediateTensorInfo(E),n.disposeIntermediateTensorInfo(P),n.disposeIntermediateTensorInfo(q),n.disposeIntermediateTensorInfo(O),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(V),n.disposeIntermediateTensorInfo(U),n.disposeIntermediateTensorInfo(L),n.disposeIntermediateTensorInfo(G),n.disposeIntermediateTensorInfo(j),n.disposeIntermediateTensorInfo(Y),{real:Z,imag:J}}function fourierTransformByMatmul(e,t,a){for(var r=new Float32Array(2*t),n=0;n<t;n++){for(var o=0,i=0,s=0;s<t;s++){var l=tf.backend_util.exponent(n*s,t,a),f=tf.backend_util.getComplexWithIndex(e,s);o+=f.real*l.real-f.imag*l.imag,i+=f.real*l.imag+f.imag*l.real}a&&(o/=t,i/=t),tf.backend_util.assignToTypedArray(r,o,i,n)}return r}function fft(e){var t=e.inputs,a=e.backend,r=t.input,n=tf.util.sizeFromShape(r.shape),o=r.shape[r.shape.length-1],i=reshape({inputs:{x:r},backend:a,attrs:{shape:[n/o,o]}}),s=fftBatch(i,!1,a),l=reshape({inputs:{x:s},backend:a,attrs:{shape:r.shape}});return a.disposeIntermediateTensorInfo(i),a.disposeIntermediateTensorInfo(s),l}var fftConfig={kernelName:tf.FFT,backendName:"cpu",kernelFunc:fft},flipLeftRightConfig={kernelName:tf.FlipLeftRight,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,a=(e.attrs,e.backend),r=t.image,n=a,o=tf.util.getTypedArrayFromDType(r.dtype,tf.util.sizeFromShape(r.shape)),i=r.shape,s=i[0],l=i[1],f=i[2],u=i[3],p=n.data.get(r.dataId).values,d=0;d<s;d++)for(var c=d*f*l*u,h=0;h<l;h++)for(var m=h*(f*u),v=0;v<f;v++)for(var g=v*u,I=0;I<u;I++){var y=[s,h,v,I][2],k=Math.round(f-y),b=c+m+g+I,x=p[b];if(k>=0&&k<f)x=p[c+m+k*u+I];o[b]=x}return{dataId:n.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function ifft(e){var t=e.inputs,a=e.backend,r=t.input,n=tf.util.sizeFromShape(r.shape),o=r.shape[r.shape.length-1],i=reshape({inputs:{x:r},backend:a,attrs:{shape:[n/o,o]}}),s=fftBatch(i,!0,a),l=reshape({inputs:{x:s},backend:a,attrs:{shape:r.shape}});return a.disposeIntermediateTensorInfo(i),a.disposeIntermediateTensorInfo(s),l}var ifftConfig={kernelName:tf.IFFT,backendName:"cpu",kernelFunc:ifft},isFiniteKernelFunc=unaryKernelFunc(tf.IsFinite,function(e){return Number.isFinite(e)?1:0},"bool"),isFiniteConfig={kernelName:tf.IsFinite,backendName:"cpu",kernelFunc:isFiniteKernelFunc},isInfKernelFunc=unaryKernelFunc(tf.IsInf,function(e){return Math.abs(e)===1/0?1:0},"bool"),isInfConfig={kernelName:tf.IsInf,backendName:"cpu",kernelFunc:isInfKernelFunc},isNaNKernelFunc=unaryKernelFunc(tf.IsNan,function(e){return Number.isNaN(e)?1:0},"bool"),isNaNConfig={kernelName:tf.IsNan,backendName:"cpu",kernelFunc:isNaNKernelFunc},log1pKernelFunc=unaryKernelFunc(tf.Log1p,function(e){return Math.log1p(e)}),log1pConfig={kernelName:tf.Log1p,backendName:"cpu",kernelFunc:log1pKernelFunc},logicalNotKernelFunc=unaryKernelFunc(tf.LogicalNot,function(e){return e?0:1},"bool"),logicalNotConfig={kernelName:tf.LogicalNot,backendName:"cpu",kernelFunc:logicalNotKernelFunc},maxConfig={kernelName:tf.Max,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.attrs,r=e.backend,n=t.x,o=a,i=o.reductionIndices,s=o.keepDims,l=r,f=n.shape,u=f.length,p=tf.util.parseAxisParam(i,f),d=p,c=tf.backend_util.getAxesPermutation(d,u),h=l.data.get(n.dataId).values;if(null!=c){for(var m=new Array(u),v=0;v<m.length;v++)m[v]=f[c[v]];h=transposeImpl(h,f,n.dtype,c,m),d=tf.backend_util.getInnerMostAxes(d.length,u),f=m}assertNotComplex(n,"max"),tf.backend_util.assertAxesAreInnerMostDims("max",d,u);var g=tf.backend_util.computeOutAndReduceShapes(f,d),I=g[0],y=g[1],k=maxImpl(h,tf.util.sizeFromShape(y),I,n.dtype),b=l.write(k,I,n.dtype),x=I;s&&(x=m=tf.backend_util.expandShapeToKeepDim(I,p));return{dataId:b,shape:x,dtype:n.dtype}}};function maxPool(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x;assertNotComplex(n,"maxPool");var o=r.filterSize,i=r.strides,s=r.pad,l=r.dimRoundingMode;tf.util.assert(tf.backend_util.eitherStridesOrDilationsAreOne(i,1),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+i+" and dilations '1'"});var f,u=tf.backend_util.computePool2DInfo(n.shape,o,i,1,s,l);if(1===u.filterWidth&&1===u.filterHeight&&tf.util.arraysEqual(u.inShape,u.outShape))f=identity({inputs:{x:n},backend:a});else{var p=a.data.get(n.dataId).values,d=tf.util.computeStrides(n.shape),c=pool(p,n.shape,n.dtype,d,u,"max");f=a.makeTensorInfo(u.outShape,n.dtype,c.values)}return f}var maxPoolConfig={kernelName:tf.MaxPool,backendName:"cpu",kernelFunc:maxPool};function maxPoolBackprop(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.dy,o=t.input,i=o;assertNotComplex([o,t.output],"maxPoolBackprop");for(var s=r.filterSize,l=r.strides,f=r.pad,u=r.dimRoundingMode,p=tf.backend_util.computePool2DInfo(i.shape,s,l,1,f,u),d=a.data.get(i.dataId).values,c=tf.buffer(p.outShape,i.dtype,maxPoolPositions(d,i.shape,i.dtype,p).values),h=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,I=p.effectiveFilterHeight,y=p.effectiveFilterWidth,k=y-1-p.padInfo.left,b=I-1-p.padInfo.top,x=tf.buffer(i.shape,"float32"),S=a.data.get(n.dataId).values,F=tf.buffer(n.shape,"float32",S),N=0;N<p.batchSize;++N)for(var C=0;C<p.inChannels;++C)for(var T=0;T<p.inHeight;++T)for(var M=0;M<p.inWidth;++M){for(var A=T-b,D=M-k,_=0,K=0;K<I;K+=v){var W=(A+K)/h;if(!(W<0||W>=p.outHeight||Math.floor(W)!==W))for(var z=0;z<y;z+=g){var w=(D+z)/m;if(!(w<0||w>=p.outWidth||Math.floor(w)!==w)){var H=I*y-1-c.get(N,W,w,C)===K*y+z?1:0;if(0!==H)_+=F.get(N,W,w,C)*H}}}x.set(_,N,T,M,C)}return a.makeTensorInfo(x.shape,x.dtype,x.values)}var maxPoolBackpropConfig={kernelName:tf.MaxPoolBackprop,backendName:"cpu",kernelFunc:maxPoolBackprop};function maxPoolWithArgmaxImpl(e,t,a,r,n){var o=pool(e,t,a,tf.util.computeStrides(t),n,"max"),i=maxPoolPositions(e,t,a,n,!0,r);return[o.values,i.values]}var maxPoolWithArgmaxConfig={kernelName:tf.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.attrs,r=e.backend,n=t.x,o=a,i=o.filterSize,s=o.strides,l=o.pad,f=o.includeBatchInIndex,u=r;assertNotComplex(n,"MaxPoolWithArgmax");var p=u.data.get(n.dataId).values,d=tf.backend_util.computePool2DInfo(n.shape,i,s,[1,1],l),c=maxPoolWithArgmaxImpl(p,n.shape,n.dtype,f,d),h=c[0],m=c[1],v=u.write(h,d.outShape,n.dtype),g=u.write(m,d.outShape,n.dtype);return[{dataId:v,shape:d.outShape,dtype:n.dtype},{dataId:g,shape:d.outShape,dtype:"int32"}]}},nonMaxSuppressionV4Impl=tf.kernel_impls.nonMaxSuppressionV4Impl,nonMaxSuppressionV4Config={kernelName:tf.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t,o=n.boxes,i=n.scores,s=r,l=s.maxOutputSize,f=s.iouThreshold,u=s.scoreThreshold,p=s.padToMaxOutputSize,d=a;assertNotComplex(o,"NonMaxSuppressionPadded");var c=d.data.get(o.dataId).values,h=d.data.get(i.dataId).values,m=nonMaxSuppressionV4Impl(c,h,l,f,u,p);return[m.selectedIndices,m.validOutputs]}},nonMaxSuppressionV5Impl=tf.kernel_impls.nonMaxSuppressionV5Impl,nonMaxSuppressionV5Config={kernelName:tf.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t,o=n.boxes,i=n.scores,s=r,l=s.maxOutputSize,f=s.iouThreshold,u=s.scoreThreshold,p=s.softNmsSigma,d=a;assertNotComplex(o,"NonMaxSuppressionWithScore");var c=d.data.get(o.dataId).values,h=d.data.get(i.dataId).values,m=nonMaxSuppressionV5Impl(c,h,l,f,u,p);return[m.selectedIndices,m.selectedScores]}},notEqualImpl=createSimpleBinaryKernelImpl(function(e,t){return e!==t?1:0}),notEqual=binaryKernelFunc(tf.NotEqual,notEqualImpl,null,"bool"),notEqualConfig={kernelName:tf.NotEqual,backendName:"cpu",kernelFunc:notEqual};function padV2(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x,o=r.paddings,i=r.constantValue;assertNotComplex(n,"pad");var s=o.map(function(e,t){return e[0]+n.shape[t]+e[1]}),l=o.map(function(e){return e[0]}),f=a.data.get(n.dataId).values,u=tf.util.sizeFromShape(n.shape),p=n.shape.length,d=tf.util.computeStrides(n.shape),c=tf.util.sizeFromShape(s),h=s.length,m=tf.util.computeStrides(s),v=tf.util.getTypedArrayFromDType(n.dtype,c);0!==i&&v.fill(i);for(var g=0;g<u;g++){var I=tf.util.indexToLoc(g,p,d).map(function(e,t){return e+l[t]});v[tf.util.locToIndex(I,h,m)]=f[g]}return{dataId:a.write(v,s,n.dtype),shape:s,dtype:n.dtype}}var padV2Config={kernelName:tf.PadV2,backendName:"cpu",kernelFunc:padV2},reciprocalKernelFunc=unaryKernelFunc(tf.Reciprocal,function(e){return 1/e}),reciprocalConfig={kernelName:tf.Reciprocal,backendName:"cpu",kernelFunc:reciprocalKernelFunc},rotateWithOffsetConfig={kernelName:tf.RotateWithOffset,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,a=e.attrs,r=e.backend,n=t.image,o=a,i=o.radians,s=o.fillValue,l=o.center,f=r,u=tf.util.getTypedArrayFromDType(n.dtype,tf.util.sizeFromShape(n.shape)),p=n.shape,d=p[0],c=p[1],h=p[2],m=p[3],v=tf.backend_util.getImageCenter(l,c,h),g=v[0],I=v[1],y=Math.sin(i),k=Math.cos(i),b=f.data.get(n.dataId).values,x=0;x<d;x++)for(var S=x*h*c*m,F=0;F<c;F++)for(var N=F*(h*m),C=0;C<h;C++)for(var T=C*m,M=0;M<m;M++){var A=[d,F,C,M],D=A[2],_=A[1],K=(D-g)*k-(_-I)*y,W=(D-g)*y+(_-I)*k;K=Math.round(K+g),W=Math.round(W+I);var z=s;if("number"!=typeof s&&(z=3===M?255:s[M]),K>=0&&K<h&&W>=0&&W<c)z=b[S+W*(h*m)+K*m+M];u[S+N+T+M]=z}return{dataId:f.write(u,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},roundKernelFunc=unaryKernelFunc(tf.Round,function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}),roundConfig={kernelName:tf.Round,backendName:"cpu",kernelFunc:roundKernelFunc},scaleAlpha=tf.backend_util.SELU_SCALEALPHA,scale=tf.backend_util.SELU_SCALE,seluKernelFunc=unaryKernelFunc(tf.Selu,function(e){return e>=0?scale*e:scaleAlpha*(Math.exp(e)-1)}),seluConfig={kernelName:tf.Selu,backendName:"cpu",kernelFunc:seluKernelFunc},sigmoidKernelFunc=unaryKernelFunc(tf.Sigmoid,function(e){return 1/(1+Math.exp(-e))}),sigmoidConfig={kernelName:tf.Sigmoid,backendName:"cpu",kernelFunc:sigmoidKernelFunc},signKernelFunc=unaryKernelFunc(tf.Sign,function(e){return e<0?-1:e>0?1:0}),signConfig={kernelName:tf.Sign,backendName:"cpu",kernelFunc:signKernelFunc},sinKernelFunc=unaryKernelFunc(tf.Sin,function(e){return Math.sin(e)}),sinConfig={kernelName:tf.Sin,backendName:"cpu",kernelFunc:sinKernelFunc},sinhKernelFunc=unaryKernelFunc(tf.Sinh,function(e){return Math.sinh(e)}),sinhConfig={kernelName:tf.Sinh,backendName:"cpu",kernelFunc:sinhKernelFunc},epsilon=1.1920928955078125e-7,threshold=Math.log(epsilon)+2,softplusKernelFunc=unaryKernelFunc(tf.Softplus,function(e){var t=e>-threshold,a=e<threshold,r=Math.exp(e);return a?r:t?e:Math.log(1+r)}),softplusConfig={kernelName:tf.Softplus,backendName:"cpu",kernelFunc:softplusKernelFunc};function transpose(e){var t=e.inputs,a=e.attrs,r=e.backend,n=t.x,o=a.perm;assertNotComplex(n,"transpose");for(var i=n.shape.length,s=new Array(i),l=0;l<s.length;l++)s[l]=n.shape[o[l]];var f=transposeImpl(r.data.get(n.dataId).values,n.shape,n.dtype,o,s);return{dataId:r.write(f,s,n.dtype),shape:s,dtype:n.dtype}}var transposeConfig={kernelName:tf.Transpose,backendName:"cpu",kernelFunc:transpose};function spaceToBatchND(e){var t=e.inputs,a=e.backend,r=e.attrs,n=t.x,o=r.blockShape,i=r.paddings;assertNotComplex([n],"spaceToBatchND");var s=tf.util.sizeFromShape(o),l=[[0,0]];l.push.apply(l,i);for(var f=1+o.length;f<n.shape.length;++f)l.push([0,0]);var u=padV2Config.kernelFunc({inputs:{x:n},backend:a,attrs:{paddings:l,constantValue:0}}),p=tf.backend_util.getReshaped(u.shape,o,s,!1),d=tf.backend_util.getPermuted(p.length,o.length,!1),c=tf.backend_util.getReshapedPermuted(u.shape,o,s,!1),h=reshape({inputs:{x:u},backend:a,attrs:{shape:p}}),m=transpose({inputs:{x:h},backend:a,attrs:{perm:d}}),v=reshape({inputs:{x:m},backend:a,attrs:{shape:c}});return a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(m),v}var spaceToBatchNDConfig={kernelName:tf.SpaceToBatchND,backendName:"cpu",kernelFunc:spaceToBatchND},sqrtKernelFunc=unaryKernelFunc(tf.Sqrt,function(e){return Math.sqrt(e)}),sqrtConfig={kernelName:tf.Sqrt,backendName:"cpu",kernelFunc:sqrtKernelFunc},squareConfig={kernelName:tf.Square,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,a=e.backend,r=t.x,n=a;assertNotComplex(r,"square");for(var o=n.data.get(r.dataId).values,i=new Float32Array(o.length),s=0;s<o.length;++s){var l=o[s];i[s]=l*l}return{dataId:n.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},squaredDifferenceImpl=createSimpleBinaryKernelImpl(function(e,t){var a=e-t;return a*a}),squaredDifference=binaryKernelFunc(tf.SquaredDifference,squaredDifferenceImpl),squaredDifferenceConfig={kernelName:tf.SquaredDifference,backendName:"cpu",kernelFunc:squaredDifference},stepKernelFunc=unaryKernelFunc(tf.Step,function(e,t){var a=t;return isNaN(e)?NaN:e>0?1:a.alpha}),stepConfig={kernelName:tf.Step,backendName:"cpu",kernelFunc:stepKernelFunc},tanKernelFunc=unaryKernelFunc(tf.Tan,function(e){return Math.tan(e)}),tanConfig={kernelName:tf.Tan,backendName:"cpu",kernelFunc:tanKernelFunc},tanhKernelFunc=unaryKernelFunc(tf.Tanh,function(e){return Math.tanh(e)}),tanhConfig={kernelName:tf.Tanh,backendName:"cpu",kernelFunc:tanhKernelFunc};function unique(e){var t=e.inputs,a=e.attrs,r=e.backend,n=a.axis,o=t.x;assertNotComplex(o,"unique");var i=uniqueImpl(r.data.get(o.dataId).values,n,o.shape,o.dtype),s=i.outputValues,l=i.outputShape,f=i.indices;return[r.makeTensorInfo(l,o.dtype,s),r.makeTensorInfo([f.length],"int32",f)]}for(var uniqueConfig={kernelName:tf.Unique,backendName:"cpu",kernelFunc:unique},kernelConfigs=[absConfig,acosConfig,acoshConfig,addConfig,asinConfig,asinhConfig,atanConfig,atanhConfig,avgPoolConfig,avgPoolBackpropConfig,batchNormConfig,castConfig,ceilConfig,clipConfig,complexConfig,concatConfig,cosConfig,coshConfig,dilation2dConfig,dilation2dBackpropInputConfig,dilation2dBackpropFilterConfig,divConfig,eluConfig,erfConfig,expConfig,expm1Config,fftConfig,flipLeftRightConfig,floorConfig,identityConfig,ifftConfig,imagConfig,isFiniteConfig,isInfConfig,isNaNConfig,logConfig,log1pConfig,logicalNotConfig,maxPoolConfig,maxPoolBackpropConfig,maxPoolWithArgmaxConfig,maxConfig,multiplyConfig,nonMaxSuppressionV4Config,nonMaxSuppressionV5Config,notEqualConfig,padV2Config,realConfig,reciprocalConfig,reshapeConfig,rotateWithOffsetConfig,roundConfig,rsqrtConfig,seluConfig,sigmoidConfig,signConfig,sinConfig,sinhConfig,sliceConfig,softplusConfig,spaceToBatchNDConfig,sqrtConfig,squareConfig,squaredDifferenceConfig,stepConfig,subConfig,tanConfig,tanhConfig,transposeConfig,uniqueConfig],_i=0,kernelConfigs_1=kernelConfigs;_i<kernelConfigs_1.length;_i++){var kernelConfig=kernelConfigs_1[_i];tf.registerKernel(kernelConfig)}exports.MathBackendCPU=MathBackendCPU,exports.shared=shared,exports.version_cpu=version;

},{"@tensorflow/tfjs-core":13,"seedrandom":28}],12:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DataType,SaverDef,tfOps=require("@tensorflow/tfjs-core"),__assign=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e};function __awaiter(e,t,a,r){return new(a||(a=Promise))(function(n,s){function o(e){try{i(r.next(e))}catch(e){s(e)}}function p(e){try{i(r.throw(e))}catch(e){s(e)}}function i(e){e.done?n(e.value):new a(function(t){t(e.value)}).then(o,p)}i((r=r.apply(e,t||[])).next())})}function __generator(e,t){var a,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:p(0),throw:p(1),return:p(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function p(s){return function(p){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(n=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[0,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{a=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,p])}}}!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(DataType||(DataType={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(SaverDef||(SaverDef={}));var CUSTOM_OPS={};function registerOp(e,t){var a={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};CUSTOM_OPS[e]=a}function getRegisteredOp(e){return CUSTOM_OPS[e]}function deregisterOp(e){delete CUSTOM_OPS[e]}function getParamValue(e,t,a,r){var n=t.inputParams[e];if(n&&void 0!==n.inputIndexStart){var s=n.inputIndexStart,o=0===n.inputIndexEnd?void 0:void 0===n.inputIndexEnd?s+1:n.inputIndexEnd;if("tensor"===n.type)return getTensor(t.inputNames[n.inputIndexStart],a,r);if("tensors"===n.type)return t.inputNames.slice(s,o).map(function(e){return getTensor(e,a,r)});var p=getTensor(t.inputNames.slice(s)[0],a,r),i=p.dataSync();return"number"===n.type?i[0]:tfOps.util.toNestedArray(p.shape,i)}var u=t.attrParams[e];return u&&u.value}function getTensor(e,t,a){var r=parseNodeName(e),n=r[0],s=r[1],o=a.currentContextIds.find(function(e){return!!t[getNodeNameWithContextId(n,e)]});return void 0!==o?t[getNodeNameWithContextId(n,o)][s]:void 0}function getTensorsForCurrentContenxt(e,t,a){return t[getNodeNameWithContextId(e,a.currentContextId)]}function getNodeNameAndIndex(e,t){var a=parseNodeName(e),r=a[0],n=a[1];return[getNodeNameWithContextId(r,t&&t.currentContextId),n]}function getNodeNameWithContextId(e,t){return t?e+"-"+t:e}function parseNodeName(e){var t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function getPadding(e,t,a){var r=getParamValue("pad",e,t,a);if("explicit"===r){r=getParamValue("explicitPaddings",e,t,a);for(var n=[[0,0],[0,0],[0,0],[0,0]],s=0;s<4;s++)n[s][0]=r[2*s],n[s][1]=r[2*s+1];return n}return r}function cloneTensor(e){return e.kept?e:tfOps.clone(e)}var json=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],arithmetic={__proto__:null,json:json},json$1=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],basicMath={__proto__:null,json:json$1},json$2=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],control={__proto__:null,json:json$2},json$3=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],convolution={__proto__:null,json:json$3},json$4=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],creation={__proto__:null,json:json$4},json$5=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],dynamic={__proto__:null,json:json$5},json$6=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],evaluation={__proto__:null,json:json$6},json$7=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],graph={__proto__:null,json:json$7},json$8=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],image={__proto__:null,json:json$8},json$9=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],logical={__proto__:null,json:json$9},json$a=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],matrices={__proto__:null,json:json$a},json$b=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],normalization={__proto__:null,json:json$b},json$c=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],reduction={__proto__:null,json:json$c},json$d=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],sliceJoin={__proto__:null,json:json$d},json$e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],spectral={__proto__:null,json:json$e},json$f=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}],transformation={__proto__:null,json:json$f},OperationMapper=function(){function e(){var e=[arithmetic,basicMath,control,convolution,creation,dynamic,evaluation,logical,image,graph,matrices,normalization,reduction,sliceJoin,spectral,transformation],t=[].concat.apply([],e.map(function(e){return e.json}));this.opMappers=t.reduce(function(e,t){return e[t.tfOpName]=t,e},{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.transformGraph=function(e,t){var a=this;void 0===t&&(t={});var r=e.node,n=[],s=[],o=[],p=r.reduce(function(e,t){return e[t.name]=a.mapNode(t),t.op.startsWith("Placeholder")?n.push(e[t.name]):"Const"===t.op?s.push(e[t.name]):null!=t.input&&0!==t.input.length||o.push(e[t.name]),e},{}),i=[],u=[],m={},l={};null!=t&&(m=this.mapSignatureEntries(t.inputs),l=this.mapSignatureEntries(t.outputs));var c=Object.keys(p);c.forEach(function(e){var t=p[e];t.inputNames.forEach(function(e){var a=getNodeNameAndIndex(e)[0];t.inputs.push(p[a]),p[a].children.push(t)})}),0===Object.keys(l).length?c.forEach(function(e){var t=p[e];0===t.children.length&&u.push(t)}):Object.keys(l).forEach(function(e){var t=getNodeNameAndIndex(e)[0],a=p[t];null!=a&&(a.signatureKey=l[e],u.push(a))}),Object.keys(m).length>0?Object.keys(m).forEach(function(e){var t=getNodeNameAndIndex(e)[0],a=p[t];a&&(a.signatureKey=m[e],i.push(a))}):i=n;var d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce(function(e,t){return e[t.signature.name]=a.mapFunction(t),e},{}));var y={nodes:p,inputs:i,outputs:u,weights:s,placeholders:n,signature:t,functions:d};return o.length>0&&(y.initNodes=o),y},e.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,a){return t[e[a].name]=a,t},{})},e.prototype.mapNode=function(e){var t=getRegisteredOp(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var a={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(e){return e.startsWith("^")?e.substr(1):e}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(a.inputParams=t.inputs.reduce(function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e},{})),null!=t.attrs&&(a.attrParams=t.attrs.reduce(function(t,a){var r=a.type,n=void 0;switch(a.type){case"string":void 0===(n=getStringParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getStringParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":void 0===(n=getStringArrayParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getStringArrayParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":void 0===(n=getNumberParam(e.attr,a.tfName,a.defaultValue||0))&&a.tfDeprecatedName&&(n=getNumberParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":void 0===(n=getNumericArrayParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getNumericArrayParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":void 0===(n=getBoolParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getBoolParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":void 0===(n=getBoolArrayParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getBoolArrayParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":void 0===(n=getTensorShapeParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getTensorShapeParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":void 0===(n=getTensorShapeArrayParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getTensorShapeArrayParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":void 0===(n=getDtypeParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getDtypeParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":void 0===(n=getDtypeArrayParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getDtypeArrayParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":void 0===(n=getFuncParam(e.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(n=getFuncParam(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+a.type+" for op: "+e.op)}return t[a.name]={value:n,type:r},t},{})),a},e.prototype.mapFunction=function(e){var t=this,a=e.nodeDef,r=[],n={};null!=a&&(n=a.reduce(function(e,a){return e[a.name]=t.mapNode(a),"Const"===a.op&&r.push(e[a.name]),e},{}));var s=[],o=[];e.signature.inputArg.forEach(function(e){var t=getNodeNameAndIndex(e.name)[0],a={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:parseDtypeParam(e.type),type:"dtype"}},children:[]};a.signatureKey=e.name,s.push(a),n[t]=a}),Object.keys(n).forEach(function(e){var t=n[e];t.inputNames.forEach(function(e){var a=getNodeNameAndIndex(e)[0];t.inputs.push(n[a]),n[a].children.push(t)})});var p=e.ret;e.signature.outputArg.forEach(function(e){var t=getNodeNameAndIndex(p[e.name]),a=t[0],r=t[1],s=n[a];null!=s&&(s.defaultOutput=r,o.push(s))});var i=this.mapArgsToSignature(e);return{nodes:n,inputs:s,outputs:o,weights:r,placeholders:[],signature:i}},e.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(e,a){return e[a.name]=t.mapArgToTensorInfo(a),e},{}),outputs:e.signature.outputArg.reduce(function(a,r){return a[r.name]=t.mapArgToTensorInfo(r,e.ret),a},{})}},e.prototype.mapArgToTensorInfo=function(e,t){var a=e.name;return null!=t&&(a=t[a]),{name:a,dtype:e.type}},e}();function decodeBase64(e){var t=tfOps.env().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function parseStringParam(e,t){var a=Array.isArray(e)?String.fromCharCode.apply(null,e):decodeBase64(e);return t?a:a.toLowerCase()}function getStringParam(e,t,a,r){void 0===r&&(r=!1);var n=e[t];return null!=n?parseStringParam(n.s,r):a}function getBoolParam(e,t,a){var r=e[t];return r?r.b:a}function getNumberParam(e,t,a){var r=e[t]||{},n=null!=r.i?r.i:null!=r.f?r.f:a;return"number"==typeof n?n:parseInt(n,10)}function parseDtypeParam(e){switch("string"==typeof e&&(e=DataType[e]),e){case DataType.DT_FLOAT:return"float32";case DataType.DT_INT32:case DataType.DT_INT64:case DataType.DT_INT8:case DataType.DT_UINT8:return"int32";case DataType.DT_BOOL:return"bool";case DataType.DT_DOUBLE:return"float32";case DataType.DT_STRING:return"string";default:return null}}function getFuncParam(e,t,a){var r=e[t];return r&&r.func?r.func.name:a}function getDtypeParam(e,t,a){var r=e[t];return r&&r.type?parseDtypeParam(r.type):a}function getDtypeArrayParam(e,t,a){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map(function(e){return parseDtypeParam(e)}):a}function parseTensorShapeParam(e){if(!e.unknownRank)return null!=e.dim?e.dim.map(function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)}):[]}function getTensorShapeParam(e,t,a){var r=e[t];return r&&r.shape?parseTensorShapeParam(r.shape):a}function getNumericArrayParam(e,t,a){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(function(e){return"number"==typeof e?e:parseInt(e,10)}):a}function getStringArrayParam(e,t,a,r){void 0===r&&(r=!1);var n=e[t];return n&&n.list&&n.list.s?n.list.s.map(function(e){return parseStringParam(e,r)}):a}function getTensorShapeArrayParam(e,t,a){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(function(e){return parseTensorShapeParam(e)}):a}function getBoolArrayParam(e,t,a){var r=e[t];return r&&r.list&&r.list.b?r.list.b:a}var NodeValueImpl=function(){function e(e,t,a){var r=this;this.node=e,this.tensorMap=t,this.context=a,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(e){return r.getInput(e)}),null!=e.rawAttrs&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(e,t){return e[t]=r.getAttr(t),e},{}))}return e.prototype.getInput=function(e){return getTensor(e,this.tensorMap,this.context)},e.prototype.getAttr=function(e,t){var a=this.node.rawAttrs[e];if(null!=a.tensor)return getTensor(e,this.tensorMap,this.context);if(null!=a.i||null!=a.f)return getNumberParam(this.node.rawAttrs,e,t);if(null!=a.s)return getStringParam(this.node.rawAttrs,e,t);if(null!=a.b)return getBoolParam(this.node.rawAttrs,e,t);if(null!=a.shape)return getTensorShapeParam(this.node.rawAttrs,e,t);if(null!=a.type)return getDtypeParam(this.node.rawAttrs,e,t);if(null!=a.list){if(null!=a.list.i||null!=a.list.f)return getNumericArrayParam(this.node.rawAttrs,e,t);if(null!=a.list.s)return getStringArrayParam(this.node.rawAttrs,e,t);if(null!=a.list.shape)return getTensorShapeArrayParam(this.node.rawAttrs,e,t);if(null!=a.list.b)return getBoolArrayParam(this.node.rawAttrs,e,t);if(null!=a.list.type)return getDtypeArrayParam(this.node.rawAttrs,e,t)}return t},e}(),executeOp=function(e,t,a){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[tfOps.add(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"AddN":return[tfOps.addN(getParamValue("tensors",e,t,a))];case"FloorMod":case"Mod":return[tfOps.mod(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Mul":return[tfOps.mul(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"RealDiv":case"Div":return[tfOps.div(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"DivNoNan":return[tfOps.divNoNan(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"FloorDiv":return[tfOps.floorDiv(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Sub":return[tfOps.sub(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Minimum":return[tfOps.minimum(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Maximum":return[tfOps.maximum(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Pow":return[tfOps.pow(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"SquaredDifference":return[tfOps.squaredDifference(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$1=function(e,t,a){switch(e.op){case"Abs":case"ComplexAbs":return[tfOps.abs(getParamValue("x",e,t,a))];case"Acos":return[tfOps.acos(getParamValue("x",e,t,a))];case"Acosh":return[tfOps.acosh(getParamValue("x",e,t,a))];case"Asin":return[tfOps.asin(getParamValue("x",e,t,a))];case"Asinh":return[tfOps.asinh(getParamValue("x",e,t,a))];case"Atan":return[tfOps.atan(getParamValue("x",e,t,a))];case"Atan2":return[tfOps.atan2(getParamValue("x",e,t,a),getParamValue("y",e,t,a))];case"Atanh":return[tfOps.atanh(getParamValue("x",e,t,a))];case"Ceil":return[tfOps.ceil(getParamValue("x",e,t,a))];case"Complex":return[tfOps.complex(getParamValue("real",e,t,a),getParamValue("imag",e,t,a))];case"Cos":return[tfOps.cos(getParamValue("x",e,t,a))];case"Cosh":return[tfOps.cosh(getParamValue("x",e,t,a))];case"Elu":return[tfOps.elu(getParamValue("x",e,t,a))];case"Erf":return[tfOps.erf(getParamValue("x",e,t,a))];case"Exp":return[tfOps.exp(getParamValue("x",e,t,a))];case"Expm1":return[tfOps.expm1(getParamValue("x",e,t,a))];case"Floor":return[tfOps.floor(getParamValue("x",e,t,a))];case"Log":return[tfOps.log(getParamValue("x",e,t,a))];case"Log1p":return[tfOps.log1p(getParamValue("x",e,t,a))];case"Imag":return[tfOps.imag(getParamValue("x",e,t,a))];case"Neg":return[tfOps.neg(getParamValue("x",e,t,a))];case"Reciprocal":return[tfOps.reciprocal(getParamValue("x",e,t,a))];case"Real":return[tfOps.real(getParamValue("x",e,t,a))];case"Relu":return[tfOps.relu(getParamValue("x",e,t,a))];case"Round":return[tfOps.round(getParamValue("x",e,t,a))];case"Selu":return[tfOps.selu(getParamValue("x",e,t,a))];case"Sigmoid":return[tfOps.sigmoid(getParamValue("x",e,t,a))];case"Sin":return[tfOps.sin(getParamValue("x",e,t,a))];case"Sign":return[tfOps.sign(getParamValue("x",e,t,a))];case"Sinh":return[tfOps.sinh(getParamValue("x",e,t,a))];case"Softplus":return[tfOps.softplus(getParamValue("x",e,t,a))];case"Sqrt":return[tfOps.sqrt(getParamValue("x",e,t,a))];case"Square":return[tfOps.square(getParamValue("x",e,t,a))];case"Tanh":return[tfOps.tanh(getParamValue("x",e,t,a))];case"Tan":return[tfOps.tan(getParamValue("x",e,t,a))];case"Relu6":case"ClipByValue":return[tfOps.clipByValue(getParamValue("x",e,t,a),getParamValue("clipValueMin",e,t,a),getParamValue("clipValueMax",e,t,a))];case"Rsqrt":return[tfOps.rsqrt(getTensor(e.inputNames[0],t,a))];case"Prod":return[tfOps.prod(getParamValue("x",e,t,a),getParamValue("axes",e,t,a))];case"LeakyRelu":return[tfOps.leakyRelu(getParamValue("x",e,t,a),getParamValue("alpha",e,t,a))];case"Prelu":return[tfOps.prelu(getParamValue("x",e,t,a),getParamValue("alpha",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}};function assertShapesMatchAllowUndefinedSize(e,t,a){void 0===a&&(a=""),tfOps.util.assert(shapesEqualAllowUndefinedSize(e,t),function(){return a+" Shapes "+e+" and "+t+" must match"})}function shapesEqualAllowUndefinedSize(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(-1!==e[a]&&-1!==t[a]&&e[a]!==t[a])return!1;return!0}var TensorArray=function(){function e(e,t,a,r,n,s,o){this.name=e,this.dtype=t,this.maxSize=a,this.elementShape=r,this.identicalElementShapes=n,this.dynamicSize=s,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=tfOps.scalar(0),tfOps.keep(this.idTensor)}return Object.defineProperty(e.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},e.prototype.size=function(){return this.tensors.length},e.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.size())throw new Error("Tried to read from index "+e+", but array size is: "+this.size());var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},e.prototype.readMany=function(e){var t=this;return e.map(function(e){return t.read(e)})},e.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var a=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),a.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(a.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");a.tensor=t,tfOps.keep(t),a.written=!0,this.tensors[e]=a},e.prototype.writeMany=function(e,t){var a=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+t.length+".");e.forEach(function(e,r){return a.write(e,t[r])})},e.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(e)e=e.slice(0,this.size());else{e=[];for(var a=0;a<this.size();a++)e.push(a)}if(0===e.length)return tfOps.tensor([],[0].concat(this.elementShape));var r=this.readMany(e);return assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),tfOps.stack(r,0)},e.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return tfOps.tensor([],[0].concat(this.elementShape));for(var t=[],a=0;a<this.size();a++)t.push(a);var r=this.readMany(t);return assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),tfOps.concat(r,0)},e.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var a=Math.max.apply(Math,e);if(!this.dynamicSize&&a>=this.maxSize)throw new Error("Max index must be < array size ("+a+"  vs. "+this.maxSize+")");this.writeMany(e,tfOps.unstack(t,0))},e.prototype.split=function(e,t){var a=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var r=0,n=e.map(function(e){return r+=e});if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var s=0===r?0:t.size/r,o=[];tfOps.tidy(function(){t=tfOps.reshape(t,[1,r,s]);for(var p=0;p<e.length;++p){var i=[0,0===p?0:n[p-1],0],u=[1,e[p],s];o[p]=tfOps.reshape(tfOps.slice(t,i,u),a.elementShape)}return o});for(var p=[],i=0;i<e.length;i++)p[i]=i;this.writeMany(p,o)},e}(),TensorList=function(){function e(e,t,a,r){void 0===r&&(r=-1),this.tensors=e,this.elementShape=t,this.elementDtype=a,null!=e&&e.forEach(function(e){if(a!==e.dtype)throw new Error("Invalid data types; op elements "+a+", but list elements "+e.dtype);assertShapesMatchAllowUndefinedSize(t,e.shape,"TensorList shape mismatch: "),tfOps.keep(e)}),this.idTensor=tfOps.scalar(0),this.maxNumElements=r,tfOps.keep(this.idTensor)}return Object.defineProperty(e.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!0,configurable:!0}),e.prototype.copy=function(){return new e(this.tensors.slice(),this.elementShape,this.elementDtype)},e.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){null!=e&&e.has(t.id)||t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},e.prototype.size=function(){return this.tensors.length},e.prototype.stack=function(e,t,a){var r=this;if(void 0===a&&(a=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);if(-1!==a&&this.tensors.length!==a)throw new Error("Operation expected a list with "+a+" elements but got a list with "+this.tensors.length+" elements.");return assertShapesMatchAllowUndefinedSize(e,this.elementShape,"TensorList shape mismatch: "),tfOps.tidy(function(){var t=r.tensors.map(function(t){return tfOps.reshape(t,e)});return tfOps.stack(t,0)})},e.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);if(0===this.size())throw new Error("Trying to pop from an empty list.");var a=this.tensors.pop();return assertShapesMatchAllowUndefinedSize(a.shape,e,"TensorList shape mismatch: "),tfOps.reshape(a,e)},e.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements "+e.dtype+", but list elements "+this.elementDtype);if(assertShapesMatchAllowUndefinedSize(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");tfOps.keep(e),this.tensors.push(e)},e.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size "+e+" is greater maxNumElement "+this.maxNumElements+".");this.tensors.length=e},e.prototype.getItem=function(e,t,a){if(a!==this.elementDtype)throw new Error("Invalid data types; op elements "+a+", but list elements "+this.elementDtype);if(e<0||e>this.tensors.length)throw new Error("Trying to access element "+e+" in a list with "+this.tensors.length+" elements.");if(null==this.tensors[e])throw new Error("element at index "+e+" is null.");return assertShapesMatchAllowUndefinedSize(this.tensors[e].shape,t,"TensorList shape mismatch: "),this.tensors[e]},e.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements "+t.dtype+", but list elements "+this.elementDtype);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element "+e+" in a list with max "+this.maxNumElements+" elements.");assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorList shape mismatch: "),tfOps.keep(t),this.tensors[e]=t},e.prototype.gather=function(e,t,a){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);return assertShapesMatchAllowUndefinedSize(this.elementShape,a,"TensorList shape mismatch: "),0===(e=e.slice(0,this.size())).length?tfOps.tensor([],[0].concat(this.elementShape)):tfOps.tidy(function(){var t=e.map(function(e){return tfOps.reshape(r.tensors[e],a)});return tfOps.stack(t,0)})},e.prototype.concat=function(e,t){var a=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is "+this.elementDtype+" but concat requested dtype "+e);return assertShapesMatchAllowUndefinedSize(this.elementShape,t,"TensorList shape mismatch: "),0===this.size()?tfOps.tensor([],[0].concat(this.elementShape)):tfOps.tidy(function(){var e=a.tensors.map(function(e){return tfOps.reshape(e,t)});return tfOps.concat(e,0)})},e}();function fromTensor(e,t,a){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+e.shape);if(e.dtype!==a)throw new Error("Invalid data types; op elements "+e.dtype+", but list elements "+a);assertShapesMatchAllowUndefinedSize(e.shape.slice(1),t,"TensorList shape mismatch: ");var n=tfOps.unstack(e);return new TensorList(n,t,r)}function reserve(e,t,a){return new TensorList([],e,t,a)}function scatter(e,t,a,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var n=Math.max.apply(Math,t);if(null!=r&&-1!==r&&n>=r)throw new Error("Max index must be < array size ("+n+"  vs. "+r+")");var s=new TensorList([],a,e.dtype,r),o=tfOps.unstack(e,0);return t.forEach(function(e,t){s.setItem(e,o[t])}),s}function split(e,t,a){var r=0,n=t.map(function(e){return r+=e});if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+r+", and tensor's shape is: "+e.shape);for(var s=0===r?0:e.size/r,o=tfOps.tidy(function(){var o=[];e=tfOps.reshape(e,[1,r,s]);for(var p=0;p<t.length;++p){var i=[0,0===p?0:n[p-1],0],u=[1,t[p],s];o[p]=tfOps.reshape(tfOps.slice(e,i,u),a)}return e.dispose(),o}),p=new TensorList([],a,e.dtype,t.length),i=0;i<o.length;i++)p.setItem(i,o[i]);return p}var _this=void 0,executeOp$2=function(e,t,a){return __awaiter(_this,void 0,void 0,function(){var r,n,s,o,p,i,u,m,l,c,d,y,f,h,g,N,x,O,P,V,b,T,v,_,S,w,A,D,E,I,M,k,C,z,F,L,j,R,B,$,U,q,W,G,H,Q,K,Y,X,Z,J,ee,te;return __generator(this,function(ae){switch(ae.label){case 0:switch(e.op){case"If":case"StatelessIf":return[3,1];case"While":case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35]}return[3,36];case 1:return r=getParamValue("thenBranch",e,t,a),n=getParamValue("elseBranch",e,t,a),s=getParamValue("cond",e,t,a),i=getParamValue("args",e,t,a),[4,s.data()];case 2:return(l=ae.sent())[0]?[2,a.functionMap[r].executeFunctionAsync(i,a.tensorArrayMap,a.tensorListMap)]:[2,a.functionMap[n].executeFunctionAsync(i,a.tensorArrayMap,a.tensorListMap)];case 3:return o=getParamValue("body",e,t,a),p=getParamValue("cond",e,t,a),i=getParamValue("args",e,t,a),[4,a.functionMap[p].executeFunctionAsync(i,a.tensorArrayMap,a.tensorListMap)];case 4:return u=ae.sent(),m=i.map(function(e){return e.id}),[4,u[0].data()];case 5:l=ae.sent(),u.forEach(function(e){e.kept||-1!==m.indexOf(e.id)||e.dispose()}),c=i,d=function(){var e,t,r;return __generator(this,function(n){switch(n.label){case 0:return e=c,[4,a.functionMap[o].executeFunctionAsync(c,a.tensorArrayMap,a.tensorListMap)];case 1:return c=n.sent(),t=c.map(function(e){return e.id}),e.forEach(function(e){e.kept||-1!==m.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}),[4,a.functionMap[p].executeFunctionAsync(c,a.tensorArrayMap,a.tensorListMap)];case 2:return[4,(r=n.sent())[0].data()];case 3:return l=n.sent(),r.forEach(function(e){e.kept||-1!==m.indexOf(e.id)||-1!==t.indexOf(e.id)||e.dispose()}),[2]}})},ae.label=6;case 6:return l[0]?[5,d()]:[3,8];case 7:return ae.sent(),[3,6];case 8:return[2,c];case 9:return[2,[cloneTensor(y=getParamValue("pred",e,t,a))]];case 10:return y=getParamValue("pred",e,t,a),(g=getParamValue("data",e,t,a)).kept||(g=cloneTensor(g)),[4,y.data()];case 11:return[2,ae.sent()[0]?[void 0,g]:[g,void 0]];case 12:return(f=e.inputNames.find(function(e){return void 0!==getTensor(e,t,a)}))?[2,[cloneTensor(g=getTensor(f,t,a))]]:[2,void 0];case 13:return h=getParamValue("frameName",e,t,a),g=getParamValue("tensor",e,t,a),a.enterFrame(h),[2,[cloneTensor(g)]];case 14:return g=getParamValue("tensor",e,t,a),a.exitFrame(),[2,[cloneTensor(g)]];case 15:return g=getParamValue("tensor",e,t,a),a.nextIteration(),[2,[cloneTensor(g)]];case 16:return N=getParamValue("size",e,t,a),x=getParamValue("dtype",e,t,a),J=getParamValue("elementShape",e,t,a),O=getParamValue("dynamicSize",e,t,a),P=getParamValue("clearAfterRead",e,t,a),V=getParamValue("identicalElementShapes",e,t,a),b=getParamValue("name",e,t,a),T=new TensorArray(b,x,N,J,V,O,P),a.addTensorArray(T),[2,[T.idTensor,tfOps.scalar(1)]];case 17:return v=getParamValue("tensorArrayId",e,t,a),L=getParamValue("index",e,t,a),K=getParamValue("tensor",e,t,a),(_=a.getTensorArray(v.id)).write(L,K),[2,[_.idTensor]];case 18:return S=getParamValue("tensorArrayId",e,t,a),j=getParamValue("index",e,t,a),[2,[a.getTensorArray(S.id).read(j)]];case 19:return $=getParamValue("tensorArrayId",e,t,a),U=getParamValue("indices",e,t,a),w=getParamValue("dtype",e,t,a),[2,[a.getTensorArray($.id).gather(U,w)]];case 20:return A=getParamValue("tensorArrayId",e,t,a),R=getParamValue("indices",e,t,a),B=getParamValue("tensor",e,t,a),(D=a.getTensorArray(A.id)).scatter(R,B),[2,[D.idTensor]];case 21:return H=getParamValue("tensorArrayId",e,t,a),E=a.getTensorArray(H.id),Q=getParamValue("dtype",e,t,a),[2,[E.concat(Q)]];case 22:return I=getParamValue("tensorArrayId",e,t,a),Z=getParamValue("tensor",e,t,a),ee=getParamValue("lengths",e,t,a),(M=a.getTensorArray(I.id)).split(ee,Z),[2,[M.idTensor]];case 23:return k=getParamValue("tensorArrayId",e,t,a),C=a.getTensorArray(k.id),[2,[tfOps.scalar(C.size(),"int32")]];case 24:return z=getParamValue("tensorArrayId",e,t,a),(F=a.getTensorArray(z.id)).clearAndClose(),[2,[F.idTensor]];case 25:return Y=getParamValue("tensorListId",e,t,a),L=getParamValue("index",e,t,a),K=getParamValue("tensor",e,t,a),(te=a.getTensorList(Y.id)).setItem(L,K),[2,[te.idTensor]];case 26:return Y=getParamValue("tensorListId",e,t,a),j=getParamValue("index",e,t,a),J=getParamValue("elementShape",e,t,a),X=getParamValue("elementDType",e,t,a),[2,[(te=a.getTensorList(Y.id)).getItem(j,J,X)]];case 27:return R=getParamValue("indices",e,t,a),B=getParamValue("tensor",e,t,a),J=getParamValue("elementShape",e,t,a),q=getParamValue("numElements",e,t,a),te=scatter(B,R,J,q),a.addTensorList(te),[2,[te.idTensor]];case 28:return J=getParamValue("elementShape",e,t,a),G=getParamValue("elementDType",e,t,a),q=getParamValue("numElements",e,t,a),te=reserve(J,G,q),a.addTensorList(te),[2,[te.idTensor]];case 29:return $=getParamValue("tensorListId",e,t,a),U=getParamValue("indices",e,t,a),J=getParamValue("elementShape",e,t,a),G=getParamValue("elementDType",e,t,a),[2,[(te=a.getTensorList($.id)).gather(U,G,J)]];case 30:return Y=getParamValue("tensorListId",e,t,a),J=getParamValue("elementShape",e,t,a),G=getParamValue("elementDType",e,t,a),q=getParamValue("numElements",e,t,a),[2,[(te=a.getTensorList(Y.id)).stack(J,G,q)]];case 31:return W=getParamValue("tensor",e,t,a),J=getParamValue("elementShape",e,t,a),G=getParamValue("elementDType",e,t,a),te=fromTensor(W,J,G),a.addTensorList(te),[2,[te.idTensor]];case 32:return H=getParamValue("tensorListId",e,t,a),te=a.getTensorList(H.id),Q=getParamValue("dtype",e,t,a),J=getParamValue("elementShape",e,t,a),[2,[te.concat(Q,J)]];case 33:return Y=getParamValue("tensorListId",e,t,a),K=getParamValue("tensor",e,t,a),(te=a.getTensorList(Y.id)).pushBack(K),[2,[te.idTensor]];case 34:return Y=getParamValue("tensorListId",e,t,a),J=getParamValue("elementShape",e,t,a),X=getParamValue("elementDType",e,t,a),[2,[(te=a.getTensorList(Y.id)).popBack(J,X)]];case 35:return Z=getParamValue("tensor",e,t,a),J=getParamValue("elementShape",e,t,a),ee=getParamValue("lengths",e,t,a),te=split(Z,ee,J),a.addTensorList(te),[2,[te.idTensor]];case 36:throw TypeError("Node type "+e.op+" is not implemented")}})})};function fusedConvAndDepthWiseParams(e,t,a){var r=getParamValue("fusedOps",e,t,a),n=r[0],s=r[1],o="biasadd"===n,p="prelu"===s,i="fusedbatchnorm"===n,u=getParamValue("numArgs",e,t,a);if(o){if(p&&2!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!p&&1!==u)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(i)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");var m=getParamValue("strides",e,t,a),l=getPadding(e,t,a),c=getParamValue("dataFormat",e,t,a).toUpperCase(),d=getParamValue("dilations",e,t,a),y=getParamValue("args",e,t,a);return{stride:m,pad:l,dataFormat:c,dilations:d,biasArg:y[0],preluArg:y[1],activationFunc:s}}var executeOp$3=function(e,t,a){switch(e.op){case"Conv1D":var r=getParamValue("stride",e,t,a),n=getParamValue("pad",e,t,a),s=getParamValue("dataFormat",e,t,a).toUpperCase(),o=getParamValue("dilation",e,t,a);return[tfOps.conv1d(getParamValue("x",e,t,a),getParamValue("filter",e,t,a),r,n,s,o)];case"Conv2D":r=getParamValue("strides",e,t,a),n=getPadding(e,t,a),s=getParamValue("dataFormat",e,t,a).toUpperCase();var p=getParamValue("dilations",e,t,a);return[tfOps.conv2d(getParamValue("x",e,t,a),getParamValue("filter",e,t,a),[r[1],r[2]],n,s,[p[1],p[2]])];case"_FusedConv2D":var i=fusedConvAndDepthWiseParams(e,t,a),u=(r=i.stride,n=i.pad,s=i.dataFormat,p=i.dilations,i.biasArg),m=i.preluArg,l=i.activationFunc;return[tfOps.fused.conv2d({x:getParamValue("x",e,t,a),filter:getParamValue("filter",e,t,a),strides:[r[1],r[2]],pad:n,dataFormat:s,dilations:[p[1],p[2]],bias:u,activation:l,preluActivationWeights:m})];case"FusedDepthwiseConv2dNative":var c=fusedConvAndDepthWiseParams(e,t,a);r=c.stride,n=c.pad,s=c.dataFormat,p=c.dilations,u=c.biasArg,m=c.preluArg,l=c.activationFunc;return[tfOps.fused.depthwiseConv2d({x:getParamValue("x",e,t,a),filter:getParamValue("filter",e,t,a),strides:[r[1],r[2]],pad:n,dataFormat:s,dilations:[p[1],p[2]],bias:u,activation:l,preluActivationWeights:m})];case"Conv2DBackpropInput":case"Conv2dTranspose":var d=getParamValue("outputShape",e,t,a);r=getParamValue("strides",e,t,a),n=getPadding(e,t,a);return[tfOps.conv2dTranspose(getParamValue("x",e,t,a),getParamValue("filter",e,t,a),d,[r[1],r[2]],n)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":r=getParamValue("strides",e,t,a),n=getPadding(e,t,a),p=getParamValue("dilations",e,t,a),s=getParamValue("dataFormat",e,t,a).toUpperCase();return[tfOps.depthwiseConv2d(getParamValue("input",e,t,a),getParamValue("filter",e,t,a),[r[1],r[2]],n,s,[p[1],p[2]])];case"Conv3D":r=getParamValue("strides",e,t,a),n=getParamValue("pad",e,t,a),s=getParamValue("dataFormat",e,t,a).toUpperCase(),p=getParamValue("dilations",e,t,a);return[tfOps.conv3d(getParamValue("x",e,t,a),getParamValue("filter",e,t,a),[r[1],r[2],r[3]],n,s,[p[1],p[2],p[3]])];case"AvgPool":r=getParamValue("strides",e,t,a),n=getParamValue("pad",e,t,a);var y=getParamValue("kernelSize",e,t,a);return[tfOps.avgPool(getParamValue("x",e,t,a),[y[1],y[2]],[r[1],r[2]],n)];case"MaxPool":r=getParamValue("strides",e,t,a),n=getParamValue("pad",e,t,a),y=getParamValue("kernelSize",e,t,a);return[tfOps.maxPool(getParamValue("x",e,t,a),[y[1],y[2]],[r[1],r[2]],n)];case"MaxPoolWithArgmax":r=getParamValue("strides",e,t,a),n=getParamValue("pad",e,t,a),y=getParamValue("kernelSize",e,t,a);var f=getParamValue("includeBatchInIndex",e,t,a),h=tfOps.maxPoolWithArgmax(getParamValue("x",e,t,a),[y[1],y[2]],[r[1],r[2]],n,f);return[h.result,h.indexes];case"AvgPool3D":r=getParamValue("strides",e,t,a),n=getParamValue("pad",e,t,a),y=getParamValue("kernelSize",e,t,a);return[tfOps.avgPool3d(getParamValue("x",e,t,a),[y[1],y[2],y[3]],[r[1],r[2],r[3]],n)];case"MaxPool3D":r=getParamValue("strides",e,t,a),n=getParamValue("pad",e,t,a),y=getParamValue("kernelSize",e,t,a);return[tfOps.maxPool3d(getParamValue("x",e,t,a),[y[1],y[2],y[3]],[r[1],r[2],r[3]],n)];case"Dilation2D":var g=getParamValue("strides",e,t,a),N=(n=getParamValue("pad",e,t,a),p=getParamValue("dilations",e,t,a),g[1]),x=g[2],O=p[1],P=p[2];return[tfOps.dilation2d(getParamValue("x",e,t,a),getParamValue("filter",e,t,a),[N,x],n,[O,P],"NHWC")];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$4=function(e,t,a){switch(e.op){case"Fill":var r=getParamValue("shape",e,t,a),n=getParamValue("dtype",e,t,a),s=getParamValue("value",e,t,a);return[tfOps.fill(r,s,n)];case"LinSpace":var o=getParamValue("start",e,t,a),p=getParamValue("stop",e,t,a),i=getParamValue("num",e,t,a);return[tfOps.linspace(o,p,i)];case"Multinomial":var u=getParamValue("logits",e,t,a),m=getParamValue("numSamples",e,t,a),l=getParamValue("seed",e,t,a);return[tfOps.multinomial(u,m,l)];case"OneHot":var c=getParamValue("indices",e,t,a),d=getParamValue("depth",e,t,a),y=getParamValue("onValue",e,t,a),f=getParamValue("offValue",e,t,a);return[tfOps.oneHot(c,d,y,f)];case"Ones":return[tfOps.ones(getParamValue("shape",e,t,a),getParamValue("dtype",e,t,a))];case"OnesLike":return[tfOps.onesLike(getParamValue("x",e,t,a))];case"RandomUniform":return[tfOps.randomUniform(getParamValue("shape",e,t,a),getParamValue("minval",e,t,a),getParamValue("maxval",e,t,a),getParamValue("dtype",e,t,a))];case"Range":o=getParamValue("start",e,t,a);var h=getParamValue("stop",e,t,a),g=getParamValue("step",e,t,a);return[tfOps.range(o,h,g,getParamValue("dtype",e,t,a))];case"TruncatedNormal":r=getParamValue("shape",e,t,a);var N=getParamValue("mean",e,t,a),x=getParamValue("stdDev",e,t,a);l=getParamValue("seed",e,t,a);return[tfOps.truncatedNormal(r,N,x,getParamValue("dtype",e,t,a),l)];case"Zeros":return[tfOps.zeros(getParamValue("shape",e,t,a),getParamValue("dtype",e,t,a))];case"ZerosLike":return[tfOps.zerosLike(getParamValue("x",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}},_this$1=void 0;function nmsParams(e,t,a){return{boxes:getParamValue("boxes",e,t,a),scores:getParamValue("scores",e,t,a),maxOutputSize:getParamValue("maxOutputSize",e,t,a),iouThreshold:getParamValue("iouThreshold",e,t,a),scoreThreshold:getParamValue("scoreThreshold",e,t,a),softNmsSigma:getParamValue("softNmsSigma",e,t,a)}}var executeOp$5=function(e,t,a){return __awaiter(_this$1,void 0,void 0,function(){var r,n,s,o,p,i,u,m,l,c,d,y;return __generator(this,function(f){switch(f.label){case 0:switch(e.op){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return r=nmsParams(e,t,a),i=r.boxes,u=r.scores,m=r.maxOutputSize,l=r.iouThreshold,c=r.scoreThreshold,n=r.softNmsSigma,[4,tfOps.image.nonMaxSuppressionWithScoreAsync(i,u,m,l,c,n)];case 2:return[2,[(y=f.sent()).selectedIndices,y.selectedScores]];case 3:return s=nmsParams(e,t,a),i=s.boxes,u=s.scores,m=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,o=getParamValue("padToMaxOutputSize",e,t,a),[4,tfOps.image.nonMaxSuppressionPaddedAsync(i,u,m,l,c,o)];case 4:return[2,[(y=f.sent()).selectedIndices,y.validOutputs]];case 5:return p=nmsParams(e,t,a),i=p.boxes,u=p.scores,m=p.maxOutputSize,l=p.iouThreshold,c=p.scoreThreshold,[4,tfOps.image.nonMaxSuppressionAsync(i,u,m,l,c)];case 6:return[2,[f.sent()]];case 7:return d=tfOps.cast(getParamValue("condition",e,t,a),"bool"),[4,tfOps.whereAsync(d)];case 8:return y=[f.sent()],d.dispose(),[2,y];case 9:return[2,tfOps.setdiff1dAsync(getParamValue("x",e,t,a),getParamValue("y",e,t,a))];case 10:throw TypeError("Node type "+e.op+" is not implemented")}})})},executeOp$6=function(e,t,a){switch(e.op){case"TopKV2":var r=getParamValue("x",e,t,a),n=getParamValue("k",e,t,a),s=getParamValue("sorted",e,t,a);return[(o=tfOps.topk(r,n,s)).values,o.indices];case"Unique":r=getParamValue("x",e,t,a);return[(o=tfOps.unique(r)).values,o.indices];case"UniqueV2":r=getParamValue("x",e,t,a);var o,p=getParamValue("axis",e,t,a);return[(o=tfOps.unique(r,p)).values,o.indices];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$7=function(e,t,a){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=getParamValue("default",e,t,a);return[getTensor(e.name,t,a)||r];case"Placeholder":return[getTensor(e.name,t,a)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[cloneTensor(getParamValue("x",e,t,a))];case"IdentityN":return getParamValue("x",e,t,a).map(function(e){return cloneTensor(e)});case"Snapshot":return[cloneTensor(getParamValue("x",e,t,a))];case"Shape":return[tfOps.tensor1d(getParamValue("x",e,t,a).shape,"int32")];case"ShapeN":return getParamValue("x",e,t,a).map(function(e){return tfOps.tensor1d(e.shape)});case"Size":return[tfOps.scalar(getParamValue("x",e,t,a).size,"int32")];case"Rank":return[tfOps.scalar(getParamValue("x",e,t,a).rank,"int32")];case"NoOp":return[tfOps.scalar(1)];case"Print":var n=getParamValue("x",e,t,a),s=getParamValue("data",e,t,a),o=getParamValue("message",e,t,a),p=getParamValue("summarize",e,t,a);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var i=0;i<s.length;i++)console.log(Array.prototype.slice.call(s[i].dataSync()).slice(0,p));return[n];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$8=function(e,t,a){switch(e.op){case"ResizeBilinear":var r=getParamValue("images",e,t,a),n=getParamValue("size",e,t,a),s=getParamValue("alignCorners",e,t,a);return[tfOps.image.resizeBilinear(r,[n[0],n[1]],s)];case"ResizeNearestNeighbor":r=getParamValue("images",e,t,a),n=getParamValue("size",e,t,a),s=getParamValue("alignCorners",e,t,a);return[tfOps.image.resizeNearestNeighbor(r,[n[0],n[1]],s)];case"CropAndResize":var o=getParamValue("image",e,t,a),p=getParamValue("boxes",e,t,a),i=getParamValue("boxInd",e,t,a),u=getParamValue("cropSize",e,t,a),m=getParamValue("method",e,t,a),l=getParamValue("extrapolationValue",e,t,a);return[tfOps.image.cropAndResize(o,p,i,u,m,l)];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$9=function(e,t,a){switch(e.op){case"Equal":return[tfOps.equal(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"NotEqual":return[tfOps.notEqual(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Greater":return[tfOps.greater(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"GreaterEqual":return[tfOps.greaterEqual(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Less":return[tfOps.less(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"LessEqual":return[tfOps.lessEqual(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"LogicalAnd":return[tfOps.logicalAnd(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"LogicalNot":return[tfOps.logicalNot(getParamValue("a",e,t,a))];case"LogicalOr":return[tfOps.logicalOr(getParamValue("a",e,t,a),getParamValue("b",e,t,a))];case"Select":case"SelectV2":return[tfOps.where(getParamValue("condition",e,t,a),getParamValue("a",e,t,a),getParamValue("b",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$a=function(e,t,a){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[tfOps.matMul(getParamValue("a",e,t,a),getParamValue("b",e,t,a),getParamValue("transposeA",e,t,a),getParamValue("transposeB",e,t,a))];case"Transpose":return[tfOps.transpose(getParamValue("x",e,t,a),getParamValue("perm",e,t,a))];case"_FusedMatMul":var r=getParamValue("fusedOps",e,t,a),n=r[0],s=r[1],o="biasadd"===n,p="prelu"===s,i=getParamValue("numArgs",e,t,a);if(o){if(p&&2!==i)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!p&&1!==i)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var u=getParamValue("args",e,t,a),m=u[0],l=u[1];return[tfOps.fused.matMul({a:getParamValue("a",e,t,a),b:getParamValue("b",e,t,a),transposeA:getParamValue("transposeA",e,t,a),transposeB:getParamValue("transposeB",e,t,a),bias:m,activation:s,preluActivationWeights:l})];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$b=function(e,t,a){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[tfOps.batchNorm(getParamValue("x",e,t,a),getParamValue("mean",e,t,a),getParamValue("variance",e,t,a),getParamValue("offset",e,t,a),getParamValue("scale",e,t,a),getParamValue("epsilon",e,t,a))];case"LRN":return[tfOps.localResponseNormalization(getParamValue("x",e,t,a),getParamValue("radius",e,t,a),getParamValue("bias",e,t,a),getParamValue("alpha",e,t,a),getParamValue("beta",e,t,a))];case"Softmax":return[tfOps.softmax(getParamValue("x",e,t,a))];case"LogSoftmax":return[tfOps.logSoftmax(getParamValue("x",e,t,a))];case"SparseToDense":return[tfOps.sparseToDense(getParamValue("sparseIndices",e,t,a),getParamValue("outputShape",e,t,a),getParamValue("sparseValues",e,t,a),getParamValue("defaultValue",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$c=function(e,t,a){switch(e.op){case"Max":var r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.max(getParamValue("x",e,t,a),r,n)];case"Mean":r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.mean(getParamValue("x",e,t,a),r,n)];case"Min":r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.min(getParamValue("x",e,t,a),r,n)];case"Sum":r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.sum(getParamValue("x",e,t,a),r,n)];case"All":r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.all(getParamValue("x",e,t,a),r,n)];case"Any":r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.any(getParamValue("x",e,t,a),r,n)];case"ArgMax":r=getParamValue("axis",e,t,a);return[tfOps.argMax(getParamValue("x",e,t,a),r)];case"ArgMin":r=getParamValue("axis",e,t,a);return[tfOps.argMin(getParamValue("x",e,t,a),r)];case"Prod":r=getParamValue("axis",e,t,a),n=getParamValue("keepDims",e,t,a);return[tfOps.prod(getParamValue("x",e,t,a),r,n)];case"Cumsum":r=getParamValue("axis",e,t,a);var s=getParamValue("exclusive",e,t,a),o=getParamValue("reverse",e,t,a);return[tfOps.cumsum(getParamValue("x",e,t,a),r,s,o)];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$d=function(e,t,a){switch(e.op){case"ConcatV2":case"Concat":var r=getParamValue("n",e,t,a),n=getParamValue("axis",e,t,a),s=getParamValue("tensors",e,t,a);return s=s.slice(0,r),[tfOps.concat(s,n)];case"GatherV2":case"Gather":n=getParamValue("axis",e,t,a);var o=getParamValue("x",e,t,a),p=getParamValue("indices",e,t,a);return[tfOps.gather(o,tfOps.cast(p,"int32"),n)];case"ReverseV2":case"Reverse":n=getParamValue("axis",e,t,a),o=getParamValue("x",e,t,a);return[tfOps.reverse(o,n)];case"Slice":var i=getParamValue("begin",e,t,a),u=getParamValue("size",e,t,a);return[tfOps.slice(getParamValue("x",e,t,a),i,u)];case"StridedSlice":i=getParamValue("begin",e,t,a);var m=getParamValue("end",e,t,a),l=getParamValue("strides",e,t,a),c=getParamValue("beginMask",e,t,a),d=getParamValue("endMask",e,t,a),y=getParamValue("ellipsisMask",e,t,a),f=getParamValue("newAxisMask",e,t,a),h=getParamValue("shrinkAxisMask",e,t,a),g=getParamValue("x",e,t,a);return[tfOps.stridedSlice(g,i,m,l,c,d,y,f,h)];case"Pack":return tfOps.tidy(function(){var r=getParamValue("axis",e,t,a),n=getParamValue("tensors",e,t,a),s=n[0].shape,o=tfOps.squeeze(n[0]).shape,p=n.map(function(e){var t=tfOps.util.arraysEqual(e.shape,s);if(!t&&!tfOps.util.arraysEqual(tfOps.squeeze(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:tfOps.reshape(e,s)});return[tfOps.stack(p,r)]});case"Unpack":n=getParamValue("axis",e,t,a),g=getParamValue("tensor",e,t,a);return tfOps.unstack(g,n);case"Tile":var N=getParamValue("reps",e,t,a);return[tfOps.tile(getParamValue("x",e,t,a),N)];case"Split":case"SplitV":n=getParamValue("axis",e,t,a);var x=getParamValue("numOrSizeSplits",e,t,a);g=getParamValue("x",e,t,a);return tfOps.split(g,x,n);case"ScatterNd":p=getParamValue("indices",e,t,a);var O=getParamValue("values",e,t,a),P=getParamValue("shape",e,t,a);return[tfOps.scatterND(p,O,P)];case"GatherNd":var V=getParamValue("x",e,t,a);p=getParamValue("indices",e,t,a);return[tfOps.gatherND(V,p)];case"SparseToDense":p=getParamValue("sparseIndices",e,t,a),P=getParamValue("outputShape",e,t,a);var b=getParamValue("sparseValues",e,t,a),T=getParamValue("defaultValue",e,t,a);return[tfOps.sparseToDense(p,b,P,b.dtype===T.dtype?T:tfOps.cast(T,b.dtype))];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$e=function(e,t,a){switch(e.op){case"FFT":return[tfOps.fft(getParamValue("x",e,t,a))];case"IFFT":return[tfOps.ifft(getParamValue("x",e,t,a))];case"RFFT":return[tfOps.rfft(getParamValue("x",e,t,a))];case"IRFFT":return[tfOps.irfft(getParamValue("x",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}},executeOp$f=function(e,t,a){switch(e.op){case"Cast":return[tfOps.cast(getParamValue("x",e,t,a),getParamValue("dtype",e,t,a))];case"ExpandDims":var r=getParamValue("axis",e,t,a);return[tfOps.expandDims(getParamValue("x",e,t,a),r)];case"Squeeze":r=getParamValue("axis",e,t,a);return[tfOps.squeeze(getParamValue("x",e,t,a),r)];case"Reshape":return[tfOps.reshape(getParamValue("x",e,t,a),getParamValue("shape",e,t,a))];case"PadV2":case"Pad":return[tfOps.pad(getParamValue("x",e,t,a),getParamValue("padding",e,t,a),getParamValue("constantValue",e,t,a))];case"SpaceToBatchND":var n=getParamValue("blockShape",e,t,a),s=getParamValue("paddings",e,t,a);return[tfOps.spaceToBatchND(getParamValue("x",e,t,a),n,s)];case"BatchToSpaceND":n=getParamValue("blockShape",e,t,a);var o=getParamValue("crops",e,t,a);return[tfOps.batchToSpaceND(getParamValue("x",e,t,a),n,o)];case"DepthToSpace":var p=getParamValue("blockSize",e,t,a),i=getParamValue("dataFormat",e,t,a).toUpperCase();return[tfOps.depthToSpace(getParamValue("x",e,t,a),p,i)];case"BroadcastTo":return[tfOps.broadcastTo(getParamValue("x",e,t,a),getParamValue("shape",e,t,a))];default:throw TypeError("Node type "+e.op+" is not implemented")}};function executeOp$g(e,t,a){var r=function(e,t,a){switch(e.category){case"arithmetic":return tfOps.tidy(function(){return executeOp(e,t,a)});case"basic_math":return tfOps.tidy(function(){return executeOp$1(e,t,a)});case"control":return executeOp$2(e,t,a);case"convolution":return tfOps.tidy(function(){return executeOp$3(e,t,a)});case"creation":return tfOps.tidy(function(){return executeOp$4(e,t,a)});case"dynamic":return executeOp$5(e,t,a);case"evaluation":return tfOps.tidy(function(){return executeOp$6(e,t,a)});case"image":return tfOps.tidy(function(){return executeOp$8(e,t,a)});case"graph":return tfOps.tidy(function(){return executeOp$7(e,t,a)});case"logical":return tfOps.tidy(function(){return executeOp$9(e,t,a)});case"matrices":return tfOps.tidy(function(){return executeOp$a(e,t,a)});case"normalization":return tfOps.tidy(function(){return executeOp$b(e,t,a)});case"reduction":return tfOps.tidy(function(){return executeOp$c(e,t,a)});case"slice_join":return tfOps.tidy(function(){return executeOp$d(e,t,a)});case"spectral":return tfOps.tidy(function(){return executeOp$e(e,t,a)});case"transformation":return tfOps.tidy(function(){return executeOp$f(e,t,a)});case"custom":var r=getRegisteredOp(e.op);if(r&&r.customExecutor)return r.customExecutor(new NodeValueImpl(e,t,a));throw TypeError("Custom op "+e.op+" is not registered.");default:throw TypeError("Unknown op '"+e.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,a);return r instanceof Promise?r.then(function(e){return[].concat(e)}):[].concat(r)}var ExecutionContext=function(){function e(e,t,a,r){void 0===e&&(e={}),void 0===t&&(t={}),void 0===a&&(a={}),void 0===r&&(r={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=a,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return e.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(e.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),e.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var a=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(a))}e.push(""),this._currentContextIds=e},e.prototype.contextIdforContexts=function(e){return e?e.map(function(e){return 0===e.id&&0===e.iterationId?"":e.frameName+"-"+e.iterationId}).join("/"):""},e.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},e.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},e.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},e.prototype.getWeight=function(e){return this.weightMap[e]},e.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},e.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},e.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},e.prototype.getTensorList=function(e){return this.tensorListMap[e]},e.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},e}();function getExecutionSubgraph(e,t,a,r){var n=new Set,s=[],o=null,p=null,i=new Set,u=Object.keys(e).map(function(e){return parseNodeName(e)[0]}),m=[];null!=r&&(m=r.map(function(e){return parseNodeName(e.name)[0]}));for(var l=t.slice();l.length>0;){var c=l.pop();(isControlFlow(c)||isDynamicShape(c))&&null==o&&(p=(o=c).children.map(function(e){return e.name}).filter(function(e){return n.has(e)})),n.add(c.name),null==a[c.name]&&(-1===u.indexOf(c.name)&&-1===m.indexOf(c.name)&&(0!==c.inputs.length?c.inputs.forEach(function(e){i.has(e.name)||(i.add(e.name),l.push(e))}):s.push(c.name)))}return{inputs:e,outputs:t,usedNodes:n,missingInputs:s,dynamicNode:o,syncInputs:p}}function getNodesInTopologicalOrder(e,t,a){var r=a.usedNodes,n=a.inputs,s=[],o=Object.keys(n).map(function(e){return parseNodeName(e)[0]}).map(function(t){return e.nodes[t]}),p=e.initNodes;o.forEach(function(e){r.has(e.name)&&s.push(e)}),e.weights.forEach(function(e){r.has(e.name)&&s.push(e)}),null!=p&&p.forEach(function(e){r.has(e.name)&&s.push(e)});for(var i=new Set,u=[];s.length>0;){var m=s.pop();i.add(m.name),t[m.name]||u.push(m),m.children.forEach(function(e){!i.has(e.name)&&r.has(e.name)&&e.inputs.every(function(e){return i.has(e.name)})&&s.push(e)})}return u}var CONTROL_FLOW_OPS=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],DYNAMIC_SHAPE_OPS=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function isControlFlow(e){return CONTROL_FLOW_OPS.indexOf(e.op)>=0}function isDynamicShape(e){return DYNAMIC_SHAPE_OPS.indexOf(e.op)>=0}var GraphExecutor=function(){function e(t,a){var r=this;this.graph=t,this.parent=a,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach(function(a){r._functionExecutorMap[a]=new e(t.functions[a],r)})}return Object.defineProperty(e.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(t){return e[t].map(function(e){return e.id})});this._weightIds=[].concat.apply([],t),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?t+":"+e.defaultOutput:t})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,a){return t[a]=e._functions[a].signature,t},{})},enumerable:!0,configurable:!0}),e.prototype.getCompilationKey=function(e,t){var a=e.map(function(e){return e.name}).sort(),r=t.map(function(e){return e.name}).sort();return a.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)},e.prototype.compile=function(e,t){var a=getExecutionSubgraph(e,t,this.weightMap,this._initNodes),r=a.missingInputs,n=a.dynamicNode,s=a.syncInputs;if(null!=n)throw new Error("This execution contains the node '"+n.name+"', which has the dynamic op '"+n.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+s+"]");if(r.length>0){var o=t.map(function(e){return e.name}),p=Object.keys(e);throw new Error("Cannot compute the outputs ["+o+"] from the provided inputs ["+p+"]. Missing the following inputs: ["+r+"]")}return getNodesInTopologicalOrder(this.graph,this.weightMap,a)},e.prototype.execute=function(e,t){var a=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var n=r.map(function(e){return a.graph.nodes[parseNodeName(e)[0]]}),s=t.map(function(e){return parseNodeName(e)[0]}),o=s.map(function(e){return a.graph.nodes[e]});0===o.length&&(o=this._outputs);var p=this.getCompilationKey(n,o),i=this.compiledMap.get(p);null==i&&(i=this.compile(e,o),this.compiledMap.set(p,i));var u={},m={};return tfOps.tidy(function(){var r=new ExecutionContext(a.weightMap,u,m,a.functionExecutorMap),n=__assign({},a.weightMap);Object.keys(e).forEach(function(t){var a=parseNodeName(t),r=a[0],s=[];s[a[1]]=e[t],n[r]=s});for(var o=a.getFrozenTensorIds(n),p={},l=0;l<i.length;l++){var c=i[l];if(!n[c.name]){var d=executeOp$g(c,n,r);if(d instanceof Promise)throw new Error("The execution of the op '"+c.op+"' returned a promise. Please use model.executeAsync() instead.");n[c.name]=d,a.checkTensorForDisposal(c.name,c,n,r,o,s,p)}}return null==a.parent&&r.dispose(o),t.map(function(e){return getTensor(e,n,r)})})},e.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(t){return e[t]}).map(function(e){return e.map(function(e){return e.id})}));return new Set(t)},e.prototype.checkTensorForDisposal=function(e,t,a,r,n,s,o){"control"!==t.category&&-1===s.indexOf(e)&&(a[e].forEach(function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)}),t.inputs.forEach(function(e){if("control"!==e.category){var t=getTensorsForCurrentContenxt(e.name,a,r);null!=t&&t.forEach(function(e){if(e&&!n.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}})}}))},e.prototype.executeAsync=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._executeAsync(e,t)]})})},e.prototype._executeAsync=function(e,t,a,r,n){return void 0===a&&(a=!1),void 0===r&&(r={}),void 0===n&&(n={}),__awaiter(this,void 0,void 0,function(){var s,o,p,i,u,m;return __generator(this,function(l){switch(l.label){case 0:return a||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t)),s=new ExecutionContext(this.weightMap,r,n,this.functionExecutorMap),[4,this.executeWithControlFlow(e,s,t,a)];case 1:return o=l.sent(),p=t.map(function(e){return getTensor(e,o,s)}),i=p.map(function(e){return e.id}),u=Object.keys(e).map(function(t){return e[t].id}),m=new Set(i.concat(u,this.weightIds)),Object.keys(o).forEach(function(e){o[e].forEach(function(e){!e||e.isDisposed||m.has(e.id)||e.dispose()})}),null==this.parent&&s.dispose(m),[2,p]}})})},e.prototype.executeFunctionAsync=function(e,t,a){return __awaiter(this,void 0,void 0,function(){var r,n=this;return __generator(this,function(s){return r=e.reduce(function(e,t,a){return e[n.inputs[a].name]=t,e},{}),[2,this._executeAsync(r,this.outputNodes,!0,t,a)]})})},e.prototype.executeWithControlFlow=function(e,t,a,r){return __awaiter(this,void 0,void 0,function(){var n,s,o,p,i,u,m,l,c,d,y,f,h,g,N,x,O,P=this;return __generator(this,function(V){switch(V.label){case 0:n=Object.keys(e),s=n.map(function(e){return P.graph.nodes[parseNodeName(e)[0]]}),o=a.map(function(e){return parseNodeName(e)[0]}),p=o.map(function(e){return P.graph.nodes[e]}),i=getExecutionSubgraph(e,p,this.weightMap),u=i.usedNodes,m=i.missingInputs,l=i.dynamicNode,c=i.syncInputs,d=s.concat(this.graph.weights).map(function(e){return{node:e,contexts:t.currentContext}}),y=__assign({},this.weightMap),Object.keys(e).forEach(function(t){var a=parseNodeName(t),r=a[0],n=[];n[a[1]]=e[t],y[r]=n}),f={},h=this.getFrozenTensorIds(y),g={},V.label=1;case 1:return d.length>0?(N=this.processStack(s,d,t,y,g,h,o,f,u),[4,Promise.all(N)]):[3,3];case 2:return V.sent(),[3,1];case 3:if(null!=l||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(x=p.filter(function(e){return!isControlFlow(e)&&!getTensor(e.name,y,t)}).map(function(e){return e.name})).length>0)throw O="",null!=l&&(O="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+c+"]"),new Error("Cannot compute the outputs ["+x+"] from the provided inputs ["+n+"]. Consider providing the following inputs: ["+m+"]. "+O);return[2,y]}})})},e.prototype.processStack=function(e,t,a,r,n,s,o,p,i){for(var u=this,m=[],l=function(){var l=t.pop();a.currentContext=l.contexts;var d="";if("Enter"===l.node.op&&getParamValue("isConstant",l.node,r,a)&&(d=getNodeNameAndIndex(l.node.name,a)[0]),-1===e.indexOf(l.node)){var y=executeOp$g(l.node,r,a);d||(d=getNodeNameAndIndex(l.node.name,a)[0]);var f=a.currentContext;y instanceof Promise?m.push(y.then(function(e){return r[d]=e,a.currentContext=f,u.checkTensorForDisposal(d,l.node,r,a,s,o,p),u.processChildNodes(l.node,t,a,r,n,i),e})):(r[d]=y,c.checkTensorForDisposal(d,l.node,r,a,s,o,p),c.processChildNodes(l.node,t,a,r,n,i))}else c.processChildNodes(l.node,t,a,r,n,i)},c=this;t.length>0;)l();return m},e.prototype.processChildNodes=function(e,t,a,r,n,s){e.children.forEach(function(e){var o=getNodeNameAndIndex(e.name,a)[0];!n[o]&&s.has(e.name)&&("Merge"===e.op?e.inputNames.some(function(e){return!!getTensor(e,r,a)})&&(n[o]=!0,t.push({contexts:a.currentContext,node:e})):e.inputNames.every(function(e){return!!getTensor(e,r,a)})&&(n[o]=!0,t.push({contexts:a.currentContext,node:e})))})},e.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(e){return e.dispose()})})},e.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(a){var r=e[a],n=parseNodeName(a)[0],s=t.graph.nodes[n];if(s.attrParams.shape&&s.attrParams.shape.value){var o=s.attrParams.shape.value,p=o.length===r.shape.length&&r.shape.every(function(e,t){return-1===o[t]||o[t]===e});tfOps.util.assert(p,function(){return"The shape of dict['"+s.name+"'] provided in model.execute(dict) must be ["+o+"], but was ["+r.shape+"]"})}s.attrParams.dtype&&s.attrParams.dtype.value&&tfOps.util.assert(r.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['"+s.name+"'] provided in model.execute(dict) must be "+s.attrParams.dtype.value+", but was "+r.dtype})})},e.prototype.mapInputs=function(e){var t={};for(var a in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[a])t[this._signature.inputs[a].name]=e[a];else t[a]=e[a]}return t},e.prototype.checkInputs=function(e){var t=this,a=Object.keys(e).filter(function(e){var a=parseNodeName(e)[0];return null==t.graph.nodes[a]});if(a.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+a+"] that are not part of graph")},e.prototype.mapOutputs=function(e){var t=this;return e.map(function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e},{})},e.prototype.checkOutputs=function(e){var t=this;e.forEach(function(e){var a=parseNodeName(e)[0];if(!t.graph.nodes[a])throw new Error("The output '"+e+"' is not found in the graph")})},e}(),TFHUB_SEARCH_PARAM="?tfjs-format=file",DEFAULT_MODEL_NAME="model.json",GraphModel=function(){function e(e,t){void 0===t&&(t={}),this.modelUrl=e,this.loadOptions=t,this.version="n/a",null==t&&(this.loadOptions={})}return Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=tfOps.io.browserHTTPRequest(e,this.loadOptions);else{var t=tfOps.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(tfOps.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return e=t.sent(),[2,this.loadSync(e)]}})})},e.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,a={};null!=this.artifacts.userDefinedMetadata&&(a=this.artifacts.userDefinedMetadata.signature),this.version=t.versions.producer+"."+t.versions.minConsumer;var r=tfOps.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new GraphExecutor(OperationMapper.Instance.transformGraph(t,a)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),null!=e.modelInitializer){var n=OperationMapper.Instance.transformGraph(e.modelInitializer);this.initializer=new GraphExecutor(n),this.initializer.weightMap=this.executor.weightMap,this.initializer.execute({},[])}return!0},e.prototype.save=function(e,t){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(a){if("string"==typeof e){if(0===(t=tfOps.io.getSaveHandlers(e)).length)throw new Error("Cannot find any save handlers for URL '"+e+"'");if(t.length>1)throw new Error("Found more than one ("+t.length+") save handlers for URL '"+e+"'");e=t[0]}if(null==e.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.normalizeInputs=function(e){if(!(e instanceof tfOps.Tensor||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+e.length+" input tensors.");return this.inputNodes.reduce(function(t,a,r){return t[a]=e[r],t},{})},e.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},e.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var a=this.executor.execute(e,t);return a.length>1?a:a[0]},e.prototype.executeAsync=function(e,t){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(r){switch(r.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return[2,(a=r.sent()).length>1?a:a[0]]}})})},e.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,a){return t[a]=[e[a]],t},{})},e.prototype.dispose=function(){this.executor.dispose(),this.initializer&&this.initializer.dispose()},e}();function loadGraphModel(e,t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(r){switch(r.label){case 0:if(null==e)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==t&&(t={}),t.fromTFHub&&null==e.load&&(e.endsWith("/")||(e+="/"),e=""+e+DEFAULT_MODEL_NAME+TFHUB_SEARCH_PARAM),[4,(a=new GraphModel(e,t)).load()];case 1:return r.sent(),[2,a]}})})}var version="2.6.0";exports.GraphModel=GraphModel,exports.deregisterOp=deregisterOp,exports.loadGraphModel=loadGraphModel,exports.registerOp=registerOp,exports.version_converter=version;

}).call(this)}).call(this,require("buffer").Buffer)
},{"@tensorflow/tfjs-core":13,"buffer":17}],13:[function(require,module,exports){
(function (process,global,Buffer,__argument0,__argument1,__argument2,__argument3,setImmediate){(function (){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function __awaiter(e,t,r,n){return new(r||(r=Promise))(function(o,a){function s(e){try{u(n.next(e))}catch(e){a(e)}}function i(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(s,i)}u((n=n.apply(e,t||[])).next())})}function __generator(e,t){var r,n,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}var EPSILON_FLOAT32=1e-7,EPSILON_FLOAT16=1e-4,DataStorage=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),KernelBackend=function(){function e(){}return e.prototype.time=function(e){return notYetImplemented("time")},e.prototype.read=function(e){return notYetImplemented("read")},e.prototype.readSync=function(e){return notYetImplemented("readSync")},e.prototype.numDataIds=function(){return notYetImplemented("numDataIds")},e.prototype.disposeData=function(e){return notYetImplemented("disposeData")},e.prototype.write=function(e,t,r){return notYetImplemented("write")},e.prototype.move=function(e,t,r,n){return notYetImplemented("move")},e.prototype.memory=function(){return notYetImplemented("memory")},e.prototype.floatPrecision=function(){return notYetImplemented("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?EPSILON_FLOAT32:EPSILON_FLOAT16},e.prototype.batchMatMul=function(e,t,r,n){return notYetImplemented("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights;return notYetImplemented("fusedBatchMatMul")},e.prototype.slice=function(e,t,r){return notYetImplemented("slice")},e.prototype.stridedSlice=function(e,t,r,n){return notYetImplemented("stridedSlice")},e.prototype.unstack=function(e,t){return notYetImplemented("unstack")},e.prototype.reverse=function(e,t){return notYetImplemented("reverse")},e.prototype.concat=function(e,t){return notYetImplemented("concat")},e.prototype.neg=function(e){return notYetImplemented("neg")},e.prototype.add=function(e,t){return notYetImplemented("add")},e.prototype.addN=function(e){return notYetImplemented("addN")},e.prototype.subtract=function(e,t){return notYetImplemented("subtract")},e.prototype.multiply=function(e,t){return notYetImplemented("multiply")},e.prototype.realDivide=function(e,t){return notYetImplemented("realDivide")},e.prototype.floorDiv=function(e,t){return notYetImplemented("floorDiv")},e.prototype.sum=function(e,t){return notYetImplemented("sum")},e.prototype.prod=function(e,t){return notYetImplemented("prod")},e.prototype.unsortedSegmentSum=function(e,t,r){return notYetImplemented("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return notYetImplemented("argMin")},e.prototype.argMax=function(e,t){return notYetImplemented("argMax")},e.prototype.equal=function(e,t){return notYetImplemented("equal")},e.prototype.notEqual=function(e,t){return notYetImplemented("notEqual")},e.prototype.less=function(e,t){return notYetImplemented("less")},e.prototype.lessEqual=function(e,t){return notYetImplemented("lessEqual")},e.prototype.greater=function(e,t){return notYetImplemented("greater")},e.prototype.greaterEqual=function(e,t){return notYetImplemented("greaterEqual")},e.prototype.logicalNot=function(e){return notYetImplemented("logicalNot")},e.prototype.logicalAnd=function(e,t){return notYetImplemented("logicalAnd")},e.prototype.logicalOr=function(e,t){return notYetImplemented("logicalOr")},e.prototype.where=function(e){return notYetImplemented("where")},e.prototype.select=function(e,t,r){return notYetImplemented("select")},e.prototype.topk=function(e,t,r){return notYetImplemented("topk")},e.prototype.min=function(e,t){return notYetImplemented("min")},e.prototype.minimum=function(e,t){return notYetImplemented("minimum")},e.prototype.mod=function(e,t){return notYetImplemented("mod")},e.prototype.max=function(e,t){return notYetImplemented("max")},e.prototype.maximum=function(e,t){return notYetImplemented("maximum")},e.prototype.all=function(e,t){return notYetImplemented("all")},e.prototype.any=function(e,t){return notYetImplemented("any")},e.prototype.squaredDifference=function(e,t){return notYetImplemented("squaredDifference")},e.prototype.ceil=function(e){return notYetImplemented("ceil")},e.prototype.floor=function(e){return notYetImplemented("floor")},e.prototype.round=function(e){return notYetImplemented("round")},e.prototype.sign=function(e){return notYetImplemented("sign")},e.prototype.isNaN=function(e){return notYetImplemented("isNaN")},e.prototype.isInf=function(e){return notYetImplemented("isInf")},e.prototype.isFinite=function(e){return notYetImplemented("isFinite")},e.prototype.pow=function(e,t){return notYetImplemented("pow")},e.prototype.exp=function(e){return notYetImplemented("exp")},e.prototype.expm1=function(e){return notYetImplemented("expm1")},e.prototype.softmax=function(e,t){return notYetImplemented("softmax")},e.prototype.log=function(e){return notYetImplemented("log")},e.prototype.log1p=function(e){return notYetImplemented("log1p")},e.prototype.sqrt=function(e){return notYetImplemented("sqrt")},e.prototype.rsqrt=function(e){return notYetImplemented("rsqrt")},e.prototype.square=function(e){return notYetImplemented("square")},e.prototype.reciprocal=function(e){return notYetImplemented("reciprocal")},e.prototype.relu=function(e){return notYetImplemented("relu")},e.prototype.relu6=function(e){return notYetImplemented("relu6")},e.prototype.prelu=function(e,t){return notYetImplemented("prelu")},e.prototype.elu=function(e){return notYetImplemented("elu")},e.prototype.eluDer=function(e,t){return notYetImplemented("eluDer")},e.prototype.selu=function(e){return notYetImplemented("selu")},e.prototype.int=function(e){return notYetImplemented("int")},e.prototype.clip=function(e,t,r){return notYetImplemented("clip")},e.prototype.abs=function(e){return notYetImplemented("abs")},e.prototype.complexAbs=function(e){return notYetImplemented("complexAbs")},e.prototype.sigmoid=function(e){return notYetImplemented("sigmoid")},e.prototype.softplus=function(e){return notYetImplemented("softplus")},e.prototype.sin=function(e){return notYetImplemented("sin")},e.prototype.cos=function(e){return notYetImplemented("cos")},e.prototype.tan=function(e){return notYetImplemented("tan")},e.prototype.asin=function(e){return notYetImplemented("asin")},e.prototype.acos=function(e){return notYetImplemented("acos")},e.prototype.atan=function(e){return notYetImplemented("atan")},e.prototype.atan2=function(e,t){return notYetImplemented("atan2")},e.prototype.sinh=function(e){return notYetImplemented("sinh")},e.prototype.cosh=function(e){return notYetImplemented("cosh")},e.prototype.tanh=function(e){return notYetImplemented("tanh")},e.prototype.asinh=function(e){return notYetImplemented("asinh")},e.prototype.acosh=function(e){return notYetImplemented("acosh")},e.prototype.atanh=function(e){return notYetImplemented("atanh")},e.prototype.erf=function(e){return notYetImplemented("erf")},e.prototype.step=function(e,t){return notYetImplemented("step")},e.prototype.fusedConv2d=function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return notYetImplemented("fusedConv2d")},e.prototype.conv2d=function(e,t,r){return notYetImplemented("conv2d")},e.prototype.conv2dDerInput=function(e,t,r){return notYetImplemented("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,r){return notYetImplemented("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return notYetImplemented("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,r){return notYetImplemented("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,r){return notYetImplemented("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,r){return notYetImplemented("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,r){return notYetImplemented("conv3d")},e.prototype.conv3dDerInput=function(e,t,r){return notYetImplemented("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,r){return notYetImplemented("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return notYetImplemented("maxPool")},e.prototype.maxPoolBackprop=function(e,t,r,n){return notYetImplemented("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return notYetImplemented("avgPool")},e.prototype.avgPoolBackprop=function(e,t,r){return notYetImplemented("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return notYetImplemented("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,r){return notYetImplemented("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return notYetImplemented("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,r,n){return notYetImplemented("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return notYetImplemented("reshape")},e.prototype.cast=function(e,t){return notYetImplemented("cast")},e.prototype.tile=function(e,t){return notYetImplemented("tile")},e.prototype.pad=function(e,t,r){return notYetImplemented("pad")},e.prototype.transpose=function(e,t){return notYetImplemented("transpose")},e.prototype.gather=function(e,t,r){return notYetImplemented("gather")},e.prototype.gatherND=function(e,t){return notYetImplemented("gatherND")},e.prototype.scatterND=function(e,t,r){return notYetImplemented("scatterND")},e.prototype.batchToSpaceND=function(e,t,r){return notYetImplemented("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,r){return notYetImplemented("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,r,n){return notYetImplemented("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,r){return notYetImplemented("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,r,n){return notYetImplemented("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,r){return notYetImplemented("resizeNearestNeighborBackprop")},e.prototype.batchNorm=function(e,t,r,n,o,a){return notYetImplemented("batchNorm")},e.prototype.localResponseNormalization4D=function(e,t,r,n,o){return notYetImplemented("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,r,n,o,a,s){return notYetImplemented("LRNGrad")},e.prototype.multinomial=function(e,t,r,n){return notYetImplemented("multinomial")},e.prototype.oneHot=function(e,t,r,n){return notYetImplemented("oneHot")},e.prototype.cumsum=function(e,t,r,n){return notYetImplemented("cumsum")},e.prototype.nonMaxSuppression=function(e,t,r,n,o){return notYetImplemented("nonMaxSuppression")},e.prototype.fft=function(e){return notYetImplemented("fft")},e.prototype.ifft=function(e){return notYetImplemented("ifft")},e.prototype.complex=function(e,t){return notYetImplemented("complex")},e.prototype.real=function(e){return notYetImplemented("real")},e.prototype.imag=function(e){return notYetImplemented("imag")},e.prototype.cropAndResize=function(e,t,r,n,o,a){return notYetImplemented("cropAndResize")},e.prototype.depthToSpace=function(e,t,r){return notYetImplemented("depthToSpace")},e.prototype.split=function(e,t,r){return notYetImplemented("split")},e.prototype.sparseToDense=function(e,t,r,n){return notYetImplemented("sparseToDense")},e.prototype.diag=function(e){return notYetImplemented("diag")},e.prototype.fill=function(e,t,r){return notYetImplemented("fill")},e.prototype.onesLike=function(e){return notYetImplemented("onesLike")},e.prototype.zerosLike=function(e){return notYetImplemented("zerosLike")},e.prototype.linspace=function(e,t,r){return notYetImplemented("linspace")},e.prototype.dispose=function(){return notYetImplemented("dispose")},e}();function notYetImplemented(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}var globalNameSpace,TENSORFLOWJS_FLAGS_PREFIX="tfjsflags",Environment=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},null!=this.urlFlags[e]){var n=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+n+"."),this.set(e,n)}},e.prototype.getAsync=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=n.sent(),[2,this.flags[e]]}})})},e.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(t instanceof Promise)throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=getQueryParams(this.global.location.search);if(TENSORFLOWJS_FLAGS_PREFIX in t)t[TENSORFLOWJS_FLAGS_PREFIX].split(",").forEach(function(t){var r=t.split(":"),n=r[0],o=r[1];e.urlFlags[n]=parseValue(n,o)})}},e}();function getQueryParams(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return decodeParam(t,r[0],r[1]),r.join("=")}),t}function decodeParam(e,t,r){e[decodeURIComponent(t)]=decodeURIComponent(r||"")}function parseValue(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}function env(){return exports.ENV}function setEnvironmentGlobal(e){exports.ENV=e}function getGlobalNamespace(){if(null==globalNameSpace){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}globalNameSpace=e}return globalNameSpace}function getGlobalMap(){var e=getGlobalNamespace();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}function getGlobal(e,t){var r=getGlobalMap();if(r.has(e))return r.get(e);var n=t();return r.set(e,n),r.get(e)}exports.ENV=null;var Abs="Abs",Acos="Acos",Acosh="Acosh",Add="Add",AddN="AddN",All="All",Any="Any",ArgMax="ArgMax",ArgMin="ArgMin",Asin="Asin",Asinh="Asinh",Atan="Atan",Atanh="Atanh",Atan2="Atan2",AvgPool="AvgPool",AvgPoolBackprop="AvgPoolBackprop",AvgPool3D="AvgPool3D",AvgPool3DBackprop="AvgPool3DBackprop",BatchMatMul="BatchMatMul",BatchToSpaceND="BatchToSpaceND",BroadcastTo="BroadcastTo",Cast="Cast",Ceil="Ceil",ClipByValue="ClipByValue",Complex="Complex",Concat="Concat",Conv2D="Conv2D",Conv2DBackpropFilter="Conv2DBackpropFilter",Conv2DBackpropInput="Conv2DBackpropInput",Conv3D="Conv3D",Conv3DBackpropFilterV2="Conv3DBackpropFilterV2",Conv3DBackpropInputV2="Conv3DBackpropInputV2",Cos="Cos",Cosh="Cosh",Cumsum="Cumsum",CropAndResize="CropAndResize",DepthToSpace="DepthToSpace",DepthwiseConv2dNative="DepthwiseConv2dNative",DepthwiseConv2dNativeBackpropFilter="DepthwiseConv2dNativeBackpropFilter",DepthwiseConv2dNativeBackpropInput="DepthwiseConv2dNativeBackpropInput",Diag="Diag",Dilation2D="Dilation2D",Dilation2DBackpropInput="Dilation2DBackpropInput",Dilation2DBackpropFilter="Dilation2DBackpropFilter",Div="Div",Elu="Elu",EluGrad="EluGrad",Erf="Erf",Equal="Equal",Exp="Exp",Expm1="Expm1",FFT="FFT",Fill="Fill",FlipLeftRight="FlipLeftRight",Floor="Floor",FloorDiv="FloorDiv",FusedBatchNorm="FusedBatchNorm",GatherV2="GatherV2",GatherNd="GatherNd",Greater="Greater",GreaterEqual="GreaterEqual",Identity="Identity",IFFT="IFFT",Imag="Imag",IsFinite="IsFinite",IsInf="IsInf",IsNan="IsNan",Less="Less",LessEqual="LessEqual",LinSpace="LinSpace",Log="Log",Log1p="Log1p",LogicalAnd="LogicalAnd",LogicalNot="LogicalNot",LogicalOr="LogicalOr",LogSoftmax="LogSoftmax",LRN="LRN",LRNBackprop="LRNBackprop",Max="Max",Maximum="Maximum",MaxPool="MaxPool",MaxPoolBackprop="MaxPoolBackprop",MaxPool3D="MaxPool3D",MaxPool3DBackprop="MaxPool3DBackprop",MaxPoolWithArgmax="MaxPoolWithArgmax",Mean="Mean",Min="Min",Minimum="Minimum",Mod="Mod",Multiply="Multiply",Negate="Negate",NotEqual="NotEqual",NonMaxSuppressionV3="NonMaxSuppressionV3",NonMaxSuppressionV4="NonMaxSuppressionV4",NonMaxSuppressionV5="NonMaxSuppressionV5",OnesLike="OnesLike",OneHot="OneHot",PadV2="PadV2",Pool="Pool",Pow="Pow",Prelu="Prelu",Prod="Prod",Range="Range",Real="Real",Reciprocal="Reciprocal",Relu="Relu",Reshape="Reshape",ResizeNearestNeighbor="ResizeNearestNeighbor",ResizeNearestNeighborGrad="ResizeNearestNeighborGrad",ResizeBilinear="ResizeBilinear",ResizeBilinearGrad="ResizeBilinearGrad",Relu6="Relu6",Reverse="Reverse",Round="Round",Rsqrt="Rsqrt",ScatterNd="ScatterNd",SelectV2="SelectV2",Selu="Selu",Slice="Slice",Sin="Sin",Sinh="Sinh",Sign="Sign",Sigmoid="Sigmoid",Softplus="Softplus",Sqrt="Sqrt",Sum="Sum",SpaceToBatchND="SpaceToBatchND",SplitV="SplitV",Softmax="Softmax",SquaredDifference="SquaredDifference",Square="Square",Sub="Sub",SparseToDense="SparseToDense",StridedSlice="StridedSlice",Tan="Tan",Tanh="Tanh",Tile="Tile",TopK="TopK",Transpose="Transpose",Unique="Unique",Unpack="Unpack",UnsortedSegmentSum="UnsortedSegmentSum",ZerosLike="ZerosLike",Step="Step",FromPixels="FromPixels",RotateWithOffset="RotateWithOffset",_FusedMatMul="_FusedMatMul",FusedConv2D="FusedConv2D",FusedDepthwiseConv2D="FusedDepthwiseConv2D",kernelRegistry=getGlobal("kernelRegistry",function(){return new Map}),gradRegistry=getGlobal("gradRegistry",function(){return new Map});function getKernel(e,t){var r=makeKey(e,t);return kernelRegistry.get(r)}function getGradient(e){return gradRegistry.get(e)}function getKernelsForBackend(e){for(var t=kernelRegistry.entries(),r=[];;){var n=t.next(),o=n.done,a=n.value;if(o)break;var s=a[0],i=a[1];s.split("_")[0]===e&&r.push(i)}return r}function registerKernel(e){var t=e.kernelName,r=e.backendName,n=makeKey(t,r);kernelRegistry.has(n)&&console.warn("The kernel '"+t+"' for backend '"+r+"' is already registered"),kernelRegistry.set(n,e)}function registerGradient(e){var t=e.kernelName;gradRegistry.has(t)&&env().getBool("DEBUG")&&console.warn("Overriding the gradient for '"+t+"'"),gradRegistry.set(t,e)}function unregisterKernel(e,t){var r=makeKey(e,t);if(!kernelRegistry.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is not registered");kernelRegistry.delete(r)}function unregisterGradient(e){if(!gradRegistry.has(e))throw new Error("The gradient '"+e+"' for backend is not registered");gradRegistry.delete(e)}function copyRegisteredKernels(e,t){getKernelsForBackend(e).forEach(function(e){registerKernel(Object.assign({},e,{backendName:t}))})}function makeKey(e,t){return t+"_"+e}function shuffle(e){for(var t=e.length,r=0,n=0;t>0;)n=Math.random()*t|0,r=e[--t],e[t]=e[n],e[n]=r}function clamp(e,t,r){return Math.max(e,Math.min(t,r))}function nearestLargerEven(e){return e%2==0?e:e+1}function sum(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function randUniform(e,t){var r=Math.random();return t*r+(1-r)*e}function distSquared(e,t){for(var r=0,n=0;n<e.length;n++){var o=Number(e[n])-Number(t[n]);r+=o*o}return r}function assert(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function assertShapesMatch(e,t,r){void 0===r&&(r=""),assert(arraysEqual(e,t),function(){return r+" Shapes "+e+" and "+t+" must match"})}function assertNonNull(e){assert(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function flatten(e,t,r){if(void 0===t&&(t=[]),void 0===r&&(r=!1),null==t&&(t=[]),Array.isArray(e)||isTypedArray(e)&&!r)for(var n=0;n<e.length;++n)flatten(e[n],t,r);else t.push(e);return t}function sizeFromShape(e){if(0===e.length)return 1;for(var t=e[0],r=1;r<e.length;r++)t*=e[r];return t}function isScalarShape(e){return 0===e.length}function arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function isInt(e){return e%1==0}function tanh(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function sizeToSquarishShape(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function createShuffledIndices(e){for(var t=new Uint32Array(e),r=0;r<e;++r)t[r]=r;return shuffle(t),t}function rightPad(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function repeatedTry(e,t,r){return void 0===t&&(t=function(e){return 0}),new Promise(function(n,o){var a=0,s=function(){if(e())n();else{var i=t(++a);null!=r&&a>=r?o():setTimeout(s,i)}};s()})}function inferFromImplicitShape(e,t){for(var r=1,n=-1,o=0;o<e.length;++o)if(e[o]>=0)r*=e[o];else if(-1===e[o]){if(-1!==n)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+o);n=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===n){if(t>0&&t!==r)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===r)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%r!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+r);var a=e.slice();return a[n]=t/r,a}function parseAxisParam(e,t){var r=t.length;return assert((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-r&&e<r}),function(){return"All values in axis param must be in range [-"+r+", "+r+") but got axis "+e}),assert(e.every(function(e){return isInt(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?r+e:e})}function squeezeShape(e,t){for(var r=[],n=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:parseAxisParam(t,e).sort(),s=0,i=0;i<e.length;++i){if(null!=a){if(a[s]===i&&1!==e[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+e[i]+"' is not 1");(null==a[s]||a[s]>i)&&1===e[i]&&(r.push(e[i]),n.push(i)),a[s]<=i&&s++}1!==e[i]&&(r.push(e[i]),n.push(i))}return{newShape:r,keptDims:n}}function getTypedArrayFromDType(e,t){var r=null;if(null==e||"float32"===e)r=new Float32Array(t);else if("int32"===e)r=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);r=new Uint8Array(t)}return r}function getArrayFromDType(e,t){var r=null;if(null==e||"float32"===e)r=new Float32Array(t);else if("int32"===e)r=new Int32Array(t);else if("bool"===e)r=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);r=new Array(t)}return r}function checkConversionForErrors(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+t+" being uploaded contains "+n+".")}}function isValidDtype(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function hasEncodingLoss(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function isTypedArray(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function bytesPerElement(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function bytesFromStringArray(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function isString(e){return"string"==typeof e||e instanceof String}function isBoolean(e){return"boolean"==typeof e}function isNumber(e){return"number"==typeof e}function inferDtype(e){return Array.isArray(e)?inferDtype(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":isNumber(e)?"float32":isString(e)?"string":isBoolean(e)?"bool":"float32"}function isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}function nearestDivisor(e,t){for(var r=t;r<e;++r)if(e%r==0)return r;return e}function computeStrides(e){var t=e.length;if(t<2)return[];var r=new Array(t-1);r[t-2]=e[t-1];for(var n=t-3;n>=0;--n)r[n]=r[n+1]*e[n+1];return r}function createScalarValue(e,t){return"string"===t?encodeString(e):toTypedArray([e],t)}function toTypedArray(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=flatten(e)),env().getBool("DEBUG")&&checkConversionForErrors(e,t),noConversionNeeded(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),n=0;n<r.length;++n)0!==Math.round(e[n])&&(r[n]=1);return r}throw new Error("Unknown data type "+t)}function createNestedArray(e,t,r){var n=new Array;if(1===t.length)for(var o=t[0],a=0;a<o;a++)n[a]=r[e+a];else{o=t[0];var s=t.slice(1),i=s.reduce(function(e,t){return e*t});for(a=0;a<o;a++)n[a]=createNestedArray(e+a*i,s,r)}return n}function toNestedArray(e,t){if(0===e.length)return t[0];var r=e.reduce(function(e,t){return e*t});if(0===r)return[];if(r!==t.length)throw new Error("["+e+"] does not match the input size "+t.length+".");return createNestedArray(0,e,t)}function noConversionNeeded(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}function makeOnesTypedArray(e,t){for(var r=makeZerosTypedArray(e,t),n=0;n<r.length;n++)r[n]=1;return r}function makeZerosTypedArray(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function makeZerosNestedTypedArray(e,t){var r=e.reduce(function(e,t){return e*t},1);if(null==t||"float32"===t)return toNestedArray(e,new Float32Array(r));if("int32"===t)return toNestedArray(e,new Int32Array(r));if("bool"===t)return toNestedArray(e,new Uint8Array(r));throw new Error("Unknown data type "+t)}function now(){return env().platform.now()}function assertNonNegativeIntegerDimensions(e){e.forEach(function(t){assert(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function fetch$1(e,t){return env().platform.fetch(e,t)}function encodeString(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",env().platform.encode(e,t)}function decodeString(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",env().platform.decode(e,t)}function locToIndex(e,t,r){if(0===t)return 0;if(1===t)return e[0];for(var n=e[e.length-1],o=0;o<e.length-1;++o)n+=r[o]*e[o];return n}function indexToLoc(e,t,r){if(0===t)return[];if(1===t)return[e];for(var n=new Array(t),o=0;o<n.length-1;++o)n[o]=Math.floor(e/r[o]),e-=n[o]*r[o];return n[n.length-1]=e,n}var util={__proto__:null,shuffle:shuffle,clamp:clamp,nearestLargerEven:nearestLargerEven,sum:sum,randUniform:randUniform,distSquared:distSquared,assert:assert,assertShapesMatch:assertShapesMatch,assertNonNull:assertNonNull,flatten:flatten,sizeFromShape:sizeFromShape,isScalarShape:isScalarShape,arraysEqual:arraysEqual,isInt:isInt,tanh:tanh,sizeToSquarishShape:sizeToSquarishShape,createShuffledIndices:createShuffledIndices,rightPad:rightPad,repeatedTry:repeatedTry,inferFromImplicitShape:inferFromImplicitShape,parseAxisParam:parseAxisParam,squeezeShape:squeezeShape,getTypedArrayFromDType:getTypedArrayFromDType,getArrayFromDType:getArrayFromDType,checkConversionForErrors:checkConversionForErrors,isValidDtype:isValidDtype,hasEncodingLoss:hasEncodingLoss,isTypedArray:isTypedArray,bytesPerElement:bytesPerElement,bytesFromStringArray:bytesFromStringArray,isString:isString,isBoolean:isBoolean,isNumber:isNumber,inferDtype:inferDtype,isFunction:isFunction,nearestDivisor:nearestDivisor,computeStrides:computeStrides,createScalarValue:createScalarValue,toTypedArray:toTypedArray,toNestedArray:toNestedArray,makeOnesTypedArray:makeOnesTypedArray,makeZerosTypedArray:makeZerosTypedArray,makeZerosNestedTypedArray:makeZerosNestedTypedArray,now:now,assertNonNegativeIntegerDimensions:assertNonNegativeIntegerDimensions,fetch:fetch$1,encodeString:encodeString,decodeString:decodeString,locToIndex:locToIndex,indexToLoc:indexToLoc},Profiler=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Logger)}return e.prototype.profileKernel=function(e,t,r){for(var n,o=this.backendTimer.time(function(){n=r()}),a=function(t){var r=n[t];r.data().then(function(t){checkComputationForErrors(t,r.dtype,e)})},s=0;s<n.length;s++)a(s);return{kernelName:e,outputs:n,inputs:t,timeMs:o.then(function(e){return e.kernelMs}),extraInfo:o.then(function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""})}},e.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,n=e.outputs,o=e.timeMs,a=e.inputs,s=e.extraInfo;n.forEach(function(e){Promise.all([e.data(),o,s]).then(function(n){t.logger.logKernelProfile(r,e,n[0],n[1],a,n[2])})})},e}();function checkComputationForErrors(e,t,r){if("float32"!==t)return!1;for(var n=0;n<e.length;n++){var o=e[n];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+r+"'"),!0}return!1}var Logger=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,r,n,o,a){var s="number"==typeof n?rightPad(n+"ms",9):n.error,i=rightPad(e,25),u=t.rank,c=t.size,p=rightPad(t.shape.toString(),14),l="";for(var d in o){var f=o[d];if(null!=f){var h=f.shape||t.shape,m=h.length;l+=d+": "+m+"D "+(m>0?h:"")+" "}}console.log("%c"+i+"\t%c"+s+"\t%c"+u+"D "+p+"\t%c"+c+"\t%c"+l+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function getFilteredNodesXToY(e,t,r){for(var n={},o={},a=0;a<t.length;a++)n[t[a].id]=!0;for(a=0;a<e.length;a++){var s=(h=e[a]).inputs;for(var i in s){for(var u=s[i],c=!1,p=0;p<t.length;p++)if(n[u.id]){h.outputs.forEach(function(e){return n[e.id]=!0}),c=!0,o[h.id]=!0;break}if(c)break}}var l={};l[r.id]=!0;var d={};for(a=e.length-1;a>=0;a--)for(s=(h=e[a]).inputs,p=0;p<h.outputs.length;p++)if(l[h.outputs[p].id]){for(var i in s)l[s[i].id]=!0,d[h.id]=!0;break}var f=[];for(a=0;a<e.length;a++){var h;if(o[(h=e[a]).id]&&d[h.id]){var m={};for(var i in h.inputs){var v=h.inputs[i];n[v.id]&&(m[i]=v)}var g=Object.assign({},h);g.inputs=m,g.outputs=h.outputs,f.push(g)}}return f}function backpropagateGradients(e,t,r,n){for(var o=function(o){var a=t[o],s=[];if(a.outputs.forEach(function(t){var r=e[t.id];null!=r?s.push(r):s.push(null)}),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+a.kernelName+".");var i=a.gradient(s),u=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var o=r(function(){return i[t]()});if("float32"!==o.dtype)throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+o.dtype+"'");var s=a.inputs[t];if(!arraysEqual(o.shape,s.shape))throw new Error("Error in gradient for op "+a.kernelName+". The gradient of input '"+t+"' has shape '"+o.shape+"', which does not match the shape of the input '"+s.shape+"'");if(null==e[s.id])e[s.id]=o;else{var u=e[s.id];e[s.id]=n(u,o),u.dispose()}};for(var c in a.inputs)u(c)},a=t.length-1;a>=0;a--)o(a)}var FORMAT_LIMIT_NUM_VALS=20,FORMAT_NUM_FIRST_LAST_VALS=3,FORMAT_NUM_SIG_DIGITS=7;function tensorToString(e,t,r,n){var o=computeStrides(t),a=computeMaxSizePerColumn(e,t,r,o),s=t.length,i=subTensorToString(e,t,r,o,a),u=["Tensor"];return n&&(u.push("  dtype: "+r),u.push("  rank: "+s),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(i.map(function(e){return"    "+e}).join("\n")),u.join("\n")}function computeMaxSizePerColumn(e,t,r,n){var o=sizeFromShape(t),a=n[n.length-1],s=new Array(a).fill(0),i=t.length,u="complex64"===r?createComplexTuples(e):e;if(i>1)for(var c=0;c<o/a;c++)for(var p=c*a,l=0;l<a;l++)s[l]=Math.max(s[l],valToString(u[p+l],0,r).length);return s}function valToString(e,t,r){return rightPad(Array.isArray(e)?parseFloat(e[0].toFixed(FORMAT_NUM_SIG_DIGITS))+" + "+parseFloat(e[1].toFixed(FORMAT_NUM_SIG_DIGITS))+"j":isString(e)?"'"+e+"'":"bool"===r?boolNumToString(e):parseFloat(e.toFixed(FORMAT_NUM_SIG_DIGITS)).toString(),t)}function boolNumToString(e){return 0===e?"false":"true"}function subTensorToString(e,t,r,n,o,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,i=t[0],u=t.length;if(0===u)return"complex64"===r?[valToString(createComplexTuples(e)[0],0,r)]:"bool"===r?[boolNumToString(e[0])]:[e[0].toString()];if(1===u){if(i>FORMAT_LIMIT_NUM_VALS){var c=FORMAT_NUM_FIRST_LAST_VALS*s,p=Array.from(e.slice(0,c)),l=Array.from(e.slice((i-FORMAT_NUM_FIRST_LAST_VALS)*s,i*s));return"complex64"===r&&(p=createComplexTuples(p),l=createComplexTuples(l)),["["+p.map(function(e,t){return valToString(e,o[t],r)}).join(", ")+", ..., "+l.map(function(e,t){return valToString(e,o[i-FORMAT_NUM_FIRST_LAST_VALS+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?createComplexTuples(e):Array.from(e)).map(function(e,t){return valToString(e,o[t],r)}).join(", ")+"]"]}var d=t.slice(1),f=n.slice(1),h=n[0]*s,m=[];if(i>FORMAT_LIMIT_NUM_VALS){for(var v=0;v<FORMAT_NUM_FIRST_LAST_VALS;v++){var g=(y=v*h)+h;m.push.apply(m,subTensorToString(e.slice(y,g),d,r,f,o,!1))}m.push("...");for(v=i-FORMAT_NUM_FIRST_LAST_VALS;v<i;v++){g=(y=v*h)+h;m.push.apply(m,subTensorToString(e.slice(y,g),d,r,f,o,v===i-1))}}else for(v=0;v<i;v++){var y;g=(y=v*h)+h;m.push.apply(m,subTensorToString(e.slice(y,g),d,r,f,o,v===i-1))}var x=2===u?",":"";m[0]="["+m[0]+x;for(v=1;v<m.length-1;v++)m[v]=" "+m[v]+x;var b=",\n";for(v=2;v<u;v++)b+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":b),m}function createComplexTuples(e){for(var t=[],r=0;r<e.length;r+=2)t.push([e[r],e[r+1]]);return t}var TensorBuffer=function(){function e(e,t,r){var n=this;if(this.dtype=t,this.shape=e.slice(),this.size=sizeFromShape(e),null!=r){var o=r.length;assert(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+n.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||getArrayFromDType(t,this.size),this.strides=computeStrides(e)}return e.prototype.set=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];0===r.length&&(r=[0]),assert(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var r=0,n=0,o=e;n<o.length;n++){var a=o[n];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var i=e[e.length-1],u=0;u<e.length-1;++u)i+=this.strides[u]*e[u];return this.values[i]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return trackerFn().makeTensor(this.values,this.shape,this.dtype)},e}(),trackerFn=null,opHandler=null;function setTensorTracker(e){trackerFn=e}function setOpHandler(e){opHandler=e}var Tensor=function(){function e(e,t,r,n){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=sizeFromShape(e),this.strides=computeStrides(e),this.dataId=r,this.id=n,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,opHandler.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return opHandler.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,toNestedArray(this.shape,e)]}})})},e.prototype.arraySync=function(){return toNestedArray(this.shape,this.dataSync())},e.prototype.data=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=trackerFn().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(e){return decodeString(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=trackerFn().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return decodeString(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,trackerFn().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(trackerFn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.print=function(e){return void 0===e&&(e=!1),opHandler.print(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),opHandler.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),tensorToString(this.dataSync(),this.shape,this.dtype,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),opHandler.cast(this,e)},e.prototype.variable=function(e,t,r){return void 0===e&&(e=!0),this.throwIfDisposed(),trackerFn().makeVariable(this,e,t,r)},e}();Object.defineProperty(Tensor,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var UpcastInt32AndMap,UpcastBoolAndMap,UpcastFloat32AndMap,UpcastComplex64AndMap,Variable=function(e){function t(t,r,n,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=r,a.name=n,a}return __extends(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!arraysEqual(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");trackerFn().disposeTensor(this),this.dataId=e.dataId,trackerFn().incRef(this,null)},t.prototype.dispose=function(){trackerFn().disposeVariable(this),this.isDisposedInternal=!0},t}(Tensor);Object.defineProperty(Variable,Symbol.hasInstance,{value:function(e){return e instanceof Tensor&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(exports.Rank||(exports.Rank={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(UpcastInt32AndMap||(UpcastInt32AndMap={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(UpcastBoolAndMap||(UpcastBoolAndMap={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(UpcastFloat32AndMap||(UpcastFloat32AndMap={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(UpcastComplex64AndMap||(UpcastComplex64AndMap={}));var upcastTypeMap={float32:UpcastFloat32AndMap,int32:UpcastInt32AndMap,bool:UpcastBoolAndMap,complex64:UpcastComplex64AndMap};function upcastType(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return upcastTypeMap[e][t]}function sumOutType(e){return upcastType(e,"int32")}function makeTypesMatch(e,t){if(e.dtype===t.dtype)return[e,t];var r=upcastType(e.dtype,t.dtype);return[e.cast(r),t.cast(r)]}function assertTypesMatch(e,t){assert(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function isTensorInList(e,t){return t.some(function(t){return t.id===e.id})}function getTensorsInContainer(e){var t=[];return walkTensorContainer(e,t,new Set),t}function walkTensorContainer(e,t,r){if(null!=e)if(e instanceof Tensor)t.push(e);else if(isIterable(e)){var n=e;for(var o in n){var a=n[o];r.has(a)||(r.add(a),walkTensorContainer(a,t,r))}}}function isIterable(e){return Array.isArray(e)||"object"==typeof e}var tensor_util={__proto__:null,makeTypesMatch:makeTypesMatch,assertTypesMatch:assertTypesMatch,isTensorInList:isTensorInList,getTensorsInContainer:getTensorsInContainer},EngineState=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Engine=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EngineState}return e.prototype.ready=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r;return __generator(this,function(n){switch(n.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,n.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return n.sent()?[4,this.setBackend(r)]:[3,4];case 3:return n.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,r){return void 0===r&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},e.prototype.setBackend=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return n=o.sent(),[3,3];case 2:n=r,o.label=3;case 3:if(!n)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Profiler(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;getKernelsForBackend(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;getKernelsForBackend(e).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(null==r)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var n=r.factory();if(!n||n instanceof KernelBackend||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};var o=++this.pendingBackendInitId,a=n.then(function(r){return!(o<t.pendingBackendInitId)&&(t.registry[e]=r,t.pendingBackendInit=null,!0)}).catch(function(r){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(r.stack||r.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],n=this.initializeBackend(r),o=n.success,a=n.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),n=r.backend,o=this.readSync(t);n.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var r,n=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return n.startScope(o)},function(){return n.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(e,t,r){e();try{var n=r();return t(),n}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(e){return{x:function(){var t={x:e},r={dtype:"float32"};return ENGINE.runKernelFunc(function(t){return t.cast(e,"float32")},t,null,Cast,r)}}},[],{}),t},e.prototype.runKernel=function(e,t,r,n,o){return this.runKernelFunc(null,t,null,e,r,n,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,r){var n=this.backend.numDataIds(),o=0;r.forEach(function(e){o+="complex64"===e.dtype?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=n-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,r,n,o,a,s){var i,u=this,c=[],p=this.isTapeOn();null==n&&(n=null!=this.state.activeScope?this.state.activeScope.name:"");var l,d=this.state.numBytes,f=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var h,m,v=getKernel(n,this.backendName);if(null!=v)l=function(){var e=u.backend.numDataIds();h=v.kernelFunc({inputs:t,attrs:o,backend:u.backend});var r=Array.isArray(h)?h:[h];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(n,e,r);var i=r.map(function(e){var t=e.dataId,r=e.shape,n=e.dtype;return u.makeTensorFromDataId(t,r,n)});if(p){var l=u.getTensorsForGradient(n,t,i);if(null==l){null==s&&(s=[]);var d=i.filter(function(e,t){return s[t]});l=(a||[]).slice().concat(d)}c=u.saveTensorsForBackwardMode(l)}return i};else{var g=function(e){p&&(c=e.map(function(e){return u.keep(u.clone(e))}))};l=function(){var t=u.backend.numDataIds();h=u.tidy(function(){return e(u.backend,g)});var r=Array.isArray(h)?h:[h];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(n,t,r),r}}return this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){u.ENV.getBool("DEBUG")||u.state.profiling?(m=u.profiler.profileKernel(n,t,function(){return l()}),u.ENV.getBool("DEBUG")&&u.profiler.logKernelProfile(m),i=m.outputs):i=l()}),p&&this.addTapeNode(n,t,i,r,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:n,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-f,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return null!=t[e]?t[e].shape:null}),outputShapes:i.map(function(e){return e.shape}),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(h)?i:i[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(e){return t.keep(t.clone(e))})},e.prototype.getTensorsForGradient=function(e,t,r){var n=getGradient(e);if(null!=n){var o=n.inputsToSave||[],a=n.outputsToSave||[],s=void 0;n.saveAllInputs?(assert(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(e){return t[e]})):s=o.map(function(e){return t[e]});var i=r.filter(function(e,t){return a[t]});return s.concat(i)}return null},e.prototype.makeTensor=function(e,t,r,n){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",n=n||this.backend;var o=e;"string"===r&&isString(e[0])&&(o=e.map(function(e){return encodeString(e)}));var a=n.write(o,t,r),s=new Tensor(t,r,a,this.nextTensorId());if(this.incRef(s,n),"string"===r){var i=this.state.tensorInfo.get(a),u=bytesFromStringArray(o);this.state.numBytes+=u-i.bytes,i.bytes=u}return s},e.prototype.makeTensorFromDataId=function(e,t,r,n){var o=new Tensor(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,n),o},e.prototype.makeVariable=function(e,t,r,n){void 0===t&&(t=!0),r=r||this.nextVariableId().toString(),null!=n&&n!==e.dtype&&(e=e.cast(n));var o=new Variable(e,t,r,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*bytesPerElement(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Variable||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o,a,s,i,u;return __generator(this,function(c){switch(c.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],n=this.state.activeProfile,[4,e()];case 1:n.result=c.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,o=0,a=this.state.activeProfile.kernels,c.label=2;case 2:return o<a.length?(s=a[o],i=s,[4,s.kernelTimeMs]):[3,6];case 3:return i.kernelTimeMs=c.sent(),u=s,[4,s.extraInfo];case 4:u.extraInfo=c.sent(),c.label=5;case 5:return o++,[3,2];case 6:return[2,this.state.activeProfile]}})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,r,n,o,a){var s=this,i={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},u=getGradient(e);null!=u&&(n=u.gradFunc),null!=n&&(i.gradient=function(e){return e=e.map(function(e,t){if(null==e){var n=r[t],o=makeZerosTypedArray(n.size,n.dtype);return s.makeTensor(o,n.shape,n.dtype)}return e}),n(e.length>1?e:e[0],o,a)}),this.state.activeTape.push(i)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,r=getTensorsInContainer(e),n=new Set(r.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||n.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(e){e.kept||e.scopeId!==s.id||t.track(e)})},e.prototype.gradients=function(e,t,r,n){var o=this;if(void 0===n&&(n=!1),assert(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});assert(a instanceof Tensor,function(){return"The result y returned by f() must be a tensor."});var s=getFilteredNodesXToY(this.state.activeTape,t,a);if(!n&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e={};e[a.id]=null==r?ones(a.shape):r,backpropagateGradients(e,s,function(e){return o.tidy(e)},add);var n=t.map(function(t){return e[t.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t=0,r=e.saved;t<r.length;t++){r[t].dispose()}}),o.state.activeTape=null),{value:a,grads:n}})},e.prototype.customGrad=function(e){var t=this;return assert(isFunction(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];assert(n.every(function(e){return e instanceof Tensor}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return n.forEach(function(e,t){a[t]=e}),t.runKernelFunc(function(t,o){return assert((r=e.apply(void 0,n.concat([o]))).value instanceof Tensor,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),assert(isFunction(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(e,t){var o=r.gradFunc(e,t),a=Array.isArray(o)?o:[o];assert(a.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),assert(a.every(function(e){return e instanceof Tensor}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var s={};return a.forEach(function(e,t){s[t]=function(){return e}}),s})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return t=now(),[4,this.backend.time(e)];case 1:return(r=n.sent()).wallMs=now()-t,[2,r]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EngineState,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}();function ones(e){var t=makeOnesTypedArray(sizeFromShape(e),"float32");return ENGINE.makeTensor(t,e,"float32")}function getOrMakeEngine(){var e=getGlobalNamespace();if(null==e._tfengine){var t=new Environment(e);e._tfengine=new Engine(t)}return setEnvironmentGlobal(e._tfengine.ENV),setTensorTracker(function(){return e._tfengine}),e._tfengine}var ENGINE=getOrMakeEngine();function add(e,t){var r={a:e,b:t};return ENGINE.runKernelFunc(function(r,n){var o=r.add(e,t);return n([e,t]),o},r,null,Add)}function _isNavigatorDefined(){return"undefined"!=typeof navigator&&null!=navigator}function isMobile(){if(_isNavigatorDefined()){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function isBrowser(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var device_util={__proto__:null,isMobile:isMobile,isBrowser:isBrowser},ENV=env();function inferShape(e,t){var r=e;if(isTypedArray(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var n=[];Array.isArray(r)||isTypedArray(r)&&"string"!==t;)n.push(r.length),r=r[0];return Array.isArray(e)&&env().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&deepAssertShapeConsistency(e,n,[]),n}function deepAssertShapeConsistency(e,t,r){if(r=r||[],Array.isArray(e)||isTypedArray(e)){assert(t.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),assert(e.length===t[0],function(){return"Element arr["+r.join("][")+"] should have "+t[0]+" elements, but has "+e.length+" elements"});for(var n=t.slice(1),o=0;o<e.length;++o)deepAssertShapeConsistency(e[o],n,r.concat(o))}else assert(0===t.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+t[0]+" elements"})}function assertDtype(e,t,r,n){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+r+"' passed to '"+n+"' must be "+e+" tensor, but got "+t+" tensor")}function convertToTensor(e,t,r,n){if(void 0===n&&(n="numeric"),e instanceof Tensor)return assertDtype(n,e.dtype,t,r),e;var o=inferDtype(e);if("string"!==o&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),assertDtype(n,o,t,r),null==e||!isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+r+"' must be a Tensor or TensorLike, but got '"+a+"'")}var s=inferShape(e,o);isTypedArray(e)||Array.isArray(e)||(e=[e]);var i="string"!==o?toTypedArray(e,o):flatten(e,[],!0);return ENGINE.makeTensor(i,s,o)}function convertToTensorArray(e,t,r,n){if(void 0===n&&(n="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+r+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,n){return convertToTensor(e,t+"["+n+"]",r)},n)}ENV.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ENV.registerFlag("IS_BROWSER",function(){return isBrowser()}),ENV.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),ENV.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),ENV.registerFlag("PROD",function(){return!1}),ENV.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ENV.getBool("DEBUG")}),ENV.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),ENV.registerFlag("IS_TEST",function(){return!1});var OP_SCOPE_SUFFIX="__op";function op(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var r=t[0],n=e[r];r.endsWith("_")&&(r=r.substring(0,r.length-1)),r+=OP_SCOPE_SUFFIX;var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];ENGINE.startScope(r);try{var o=n.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ENGINE.endScope(o),o}catch(e){throw ENGINE.endScope(null),e}};return Object.defineProperty(o,"name",{value:r,configurable:!0}),o}function complex_(e,t){var r=convertToTensor(e,"real","complex"),n=convertToTensor(t,"imag","complex");assertShapesMatch(r.shape,n.shape,"real and imag shapes, "+r.shape+" and "+n.shape+", must match in call to tf.complex().");var o={real:r,imag:n};return ENGINE.runKernelFunc(function(e){return e.complex(r,n)},o,null,Complex)}var complex=op({complex_:complex_});function makeTensor(e,t,r,n){if(null==n&&(n=inferDtype(e)),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){assertNonNegativeIntegerDimensions(t);var o=sizeFromShape(t),a=sizeFromShape(r);assert(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var s=0;s<r.length;++s){var i=r[s],u=s!==r.length-1||i!==sizeFromShape(t.slice(s));assert(r[s]===t[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "})}}return isTypedArray(e)||Array.isArray(e)||(e=[e]),t=t||r,e="string"!==n?toTypedArray(e,n):flatten(e,[],!0),ENGINE.makeTensor(e,t,n)}function tensor(e,t,r){return makeTensor(e,t,inferShape(e,r),r)}var DTYPE_VALUE_SIZE_MAP={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},NUM_BYTES_STRING_LENGTH=4;function encodeWeights(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,s,i=this;return __generator(this,function(u){switch(u.label){case 0:for(r=[],n=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var s=o[a],u=Array.isArray(e)?e[a].tensor:e[s];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype&&"complex64"!==u.dtype)throw new Error("Unsupported dtype in weight '"+s+"': "+u.dtype);var c={name:s,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var p=new Promise(function(e){return __awaiter(i,void 0,void 0,function(){var t,r,n,o,a,s,i;return __generator(this,function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(t=c.sent(),r=t.reduce(function(e,t){return e+t.length},0)+NUM_BYTES_STRING_LENGTH*t.length,n=new Uint8Array(r),o=0,a=0;a<t.length;a++)s=t[a],i=new Uint8Array(new Uint32Array([s.length]).buffer),n.set(i,o),o+=NUM_BYTES_STRING_LENGTH,n.set(s,o),o+=s.length;return e(n),[2]}})})});n.push(p)}else n.push(u.data());null!=t&&(c.group=t),r.push(c)},s=0;s<o.length;++s)a(s);return[4,Promise.all(n)];case 1:return[2,{data:concatenateTypedArrays(u.sent()),specs:r}]}})})}function decodeWeights(e,t){for(var r,n={},o=0,a=0,s=t;a<s.length;a++){var i=s[a],u=i.name,c=i.dtype,p=i.shape,l=sizeFromShape(p),d=void 0;if("quantization"in i){var f=i.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f&&"scale"in f))throw new Error("Weight "+i.name+" with quantization "+f.dtype+" doesn't have corresponding metadata min and scale.")}else{if("float16"!==f.dtype)throw new Error("Weight "+i.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==c)throw new Error("Weight "+i.name+" is quantized with "+f.dtype+" which only supports weights of type float32 not "+c+".")}var h=DTYPE_VALUE_SIZE_MAP[f.dtype],m=e.slice(o,o+l*h),v="uint8"===f.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];d[g]=y*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type "+f.dtype+" for weight type float32.");void 0===r&&(r=getFloat16Decoder()),d=r(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type "+f.dtype+" for weight type int32.");d=new Int32Array(v.length);for(g=0;g<v.length;g++){y=v[g];d[g]=Math.round(y*f.scale+f.min)}}o+=l*h}else if("string"===c){var x=sizeFromShape(i.shape);d=[];for(g=0;g<x;g++){var b=new Uint32Array(e.slice(o,o+NUM_BYTES_STRING_LENGTH))[0];o+=NUM_BYTES_STRING_LENGTH;var T=new Uint8Array(e.slice(o,o+b));d.push(T),o+=b}}else{var E=DTYPE_VALUE_SIZE_MAP[c];m=e.slice(o,o+l*E);if("float32"===c)d=new Float32Array(m);else if("int32"===c)d=new Int32Array(m);else if("bool"===c)d=new Uint8Array(m);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=new Float32Array(m);var S=new Float32Array(d.length/2),w=new Float32Array(d.length/2);for(g=0;g<S.length;g++)S[g]=d[2*g],w[g]=d[2*g+1];var k=tensor(S,p,"float32"),_=tensor(w,p,"float32");n[u]=complex(k,_)}o+=l*E}"complex64"!==c&&(n[u]=tensor(d,p,c))}return n}function concatenateTypedArrays(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,r=[];e.forEach(function(e){if(t+=e.byteLength,r.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var n=new Uint8Array(t),o=0;return r.forEach(function(e){n.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),n.buffer}var useNodeBuffer="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function stringByteLength(e){return useNodeBuffer?Buffer.byteLength(e):new Blob([e]).size}function arrayBufferToBase64String(e){if(useNodeBuffer)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),r="",n=0,o=t.length;n<o;n++)r+=String.fromCharCode(t[n]);return btoa(r)}function base64StringToArrayBuffer(e){if(useNodeBuffer){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var r=atob(e),n=new Uint8Array(r.length),o=0;o<r.length;++o)n.set([r.charCodeAt(o)],o);return n.buffer}function concatenateArrayBuffers(e){if(1===e.length)return e[0];var t=0;e.forEach(function(e){t+=e.byteLength});var r=new Uint8Array(t),n=0;return e.forEach(function(e){r.set(new Uint8Array(e),n),n+=e.byteLength}),r.buffer}function basename(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function getModelArtifactsInfoForJSON(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:stringByteLength(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:stringByteLength(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function computeFloat16MantisaTable(){var e=function(e){for(var t=e<<13,r=0;0==(8388608&t);)r-=8388608,t<<=1;return(t&=-8388609)|(r+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var r=1;r<1024;r++)t[r]=e(r);for(r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}function computeFloat16ExponentTable(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function computeFloat16OffsetTable(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function getFloat16Decoder(){var e=computeFloat16MantisaTable(),t=computeFloat16ExponentTable(),r=computeFloat16OffsetTable();return function(n){for(var o=new ArrayBuffer(4*n.length),a=new Uint32Array(o),s=0;s<n.length;s++){var i=n[s],u=e[r[i>>10]+(1023&i)]+t[i>>10];a[s]=u}return new Float32Array(o)}}var IORouterRegistry=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,r){return e.getHandlers(t,"load",r)},e.getHandlers=function(t,r,n){var o=[];return("load"===r?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var r=e(t,n);null!==r&&o.push(r)}),o},e}(),registerSaveRouter=function(e){return IORouterRegistry.registerSaveRouter(e)},registerLoadRouter=function(e){return IORouterRegistry.registerLoadRouter(e)},getSaveHandlers=function(e){return IORouterRegistry.getSaveHandlers(e)},getLoadHandlers=function(e,t){return IORouterRegistry.getLoadHandlers(e,t)},DATABASE_NAME="tensorflowjs",DATABASE_VERSION=1,MODEL_STORE_NAME="models_store",INFO_STORE_NAME="model_info_store";function getIndexedDBFactory(){if(!env().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function setUpDatabase(e){var t=e.result;t.createObjectStore(MODEL_STORE_NAME,{keyPath:"modelPath"}),t.createObjectStore(INFO_STORE_NAME,{keyPath:"modelPath"})}var BrowserIndexedDB=function(){function e(e){if(this.indexedDB=getIndexedDBFactory(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(e,n){var o=r.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);o.onupgradeneeded=function(){return setUpDatabase(o)},o.onsuccess=function(){var a=o.result;if(null==t){var s=a.transaction(MODEL_STORE_NAME,"readonly"),i=s.objectStore(MODEL_STORE_NAME).get(r.modelPath);i.onsuccess=function(){if(null==i.result)return a.close(),n(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));e(i.result.modelArtifacts)},i.onerror=function(e){return a.close(),n(i.error)},s.oncomplete=function(){return a.close()}}else{var u,c=getModelArtifactsInfoForJSON(t),p=a.transaction(INFO_STORE_NAME,"readwrite"),l=p.objectStore(INFO_STORE_NAME),d=l.put({modelPath:r.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var o=(u=a.transaction(MODEL_STORE_NAME,"readwrite")).objectStore(MODEL_STORE_NAME).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:c});o.onsuccess=function(){return e({modelArtifactsInfo:c})},o.onerror=function(e){var t=(l=p.objectStore(INFO_STORE_NAME)).delete(r.modelPath);t.onsuccess=function(){return a.close(),n(o.error)},t.onerror=function(e){return a.close(),n(o.error)}}},d.onerror=function(e){return a.close(),n(d.error)},p.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return n(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),indexedDBRouter=function(e){return env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserIndexedDB.URL_SCHEME)?browserIndexedDB(e.slice(BrowserIndexedDB.URL_SCHEME.length)):null};function browserIndexedDB(e){return new BrowserIndexedDB(e)}function maybeStripScheme(e){return e.startsWith(BrowserIndexedDB.URL_SCHEME)?e.slice(BrowserIndexedDB.URL_SCHEME.length):e}IORouterRegistry.registerSaveRouter(indexedDBRouter),IORouterRegistry.registerLoadRouter(indexedDBRouter);var BrowserIndexedDBManager=function(){function e(){this.indexedDB=getIndexedDBFactory()}return e.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){var n=e.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);n.onupgradeneeded=function(){return setUpDatabase(n)},n.onsuccess=function(){var e=n.result,o=e.transaction(INFO_STORE_NAME,"readonly"),a=o.objectStore(INFO_STORE_NAME).getAll();a.onsuccess=function(){for(var e={},r=0,n=a.result;r<n.length;r++){var o=n[r];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),r(a.error)},o.oncomplete=function(){return e.close()}},n.onerror=function(e){return r(n.error)}})]})})},e.prototype.removeModel=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(r){return e=maybeStripScheme(e),[2,new Promise(function(r,n){var o=t.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);o.onupgradeneeded=function(){return setUpDatabase(o)},o.onsuccess=function(){var t,a=o.result,s=a.transaction(INFO_STORE_NAME,"readwrite"),i=s.objectStore(INFO_STORE_NAME),u=i.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),n(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=i.delete(e),s=function(){var o=(t=a.transaction(MODEL_STORE_NAME,"readwrite")).objectStore(MODEL_STORE_NAME).delete(e);o.onsuccess=function(){return r(u.result.modelArtifactsInfo)},o.onerror=function(e){return n(u.error)}};o.onsuccess=s,o.onerror=function(e){return s(),a.close(),n(u.error)}},u.onerror=function(e){return a.close(),n(u.error)},s.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return n(o.error)}})]})})},e}(),PATH_SEPARATOR="/",PATH_PREFIX="tensorflowjs_models",INFO_SUFFIX="info",MODEL_TOPOLOGY_SUFFIX="model_topology",WEIGHT_SPECS_SUFFIX="weight_specs",WEIGHT_DATA_SUFFIX="weight_data",MODEL_METADATA_SUFFIX="model_metadata";function getModelKeys(e){return{info:[PATH_PREFIX,e,INFO_SUFFIX].join(PATH_SEPARATOR),topology:[PATH_PREFIX,e,MODEL_TOPOLOGY_SUFFIX].join(PATH_SEPARATOR),weightSpecs:[PATH_PREFIX,e,WEIGHT_SPECS_SUFFIX].join(PATH_SEPARATOR),weightData:[PATH_PREFIX,e,WEIGHT_DATA_SUFFIX].join(PATH_SEPARATOR),modelMetadata:[PATH_PREFIX,e,MODEL_METADATA_SUFFIX].join(PATH_SEPARATOR)}}function getModelPathFromKey(e){var t=e.split(PATH_SEPARATOR);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(PATH_SEPARATOR)}function maybeStripScheme$1(e){return e.startsWith(BrowserLocalStorage.URL_SCHEME)?e.slice(BrowserLocalStorage.URL_SCHEME.length):e}var BrowserLocalStorage=function(){function e(e){if(!env().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=getModelKeys(this.modelPath)}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),n=getModelArtifactsInfoForJSON(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(n)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,arrayBufferToBase64String(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:n}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+n.modelTopologyBytes+", weightSpecsBytes="+n.weightSpecsBytes+", weightDataBytes="+n.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,o,a,s;return __generator(this,function(i){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,null==(n=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=n,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=base64StringToArrayBuffer(s),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),localStorageRouter=function(e){return env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserLocalStorage.URL_SCHEME)?browserLocalStorage(e.slice(BrowserLocalStorage.URL_SCHEME.length)):null};function browserLocalStorage(e){return new BrowserLocalStorage(e)}IORouterRegistry.registerSaveRouter(localStorageRouter),IORouterRegistry.registerLoadRouter(localStorageRouter);var BrowserLocalStorageManager=function(){function e(){assert(env().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),assert("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,o,a;return __generator(this,function(s){for(e={},t=PATH_PREFIX+PATH_SEPARATOR,r=PATH_SEPARATOR+INFO_SUFFIX,n=0;n<this.LS.length;++n)(o=this.LS.key(n)).startsWith(t)&&o.endsWith(r)&&(a=getModelPathFromKey(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(n){if(e=maybeStripScheme$1(e),t=getModelKeys(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},e}(),URL_SCHEME_SUFFIX="://",ModelStoreManagerRegistry=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,r){assert(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(URL_SCHEME_SUFFIX)&&(t=t.slice(0,t.indexOf(URL_SCHEME_SUFFIX))),assert(t.length>0,function(){return"scheme must not be an empty string."});var n=e.getInstance();assert(null==n.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),n.managers[t]=r},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function parseURL(e){if(-1===e.indexOf(URL_SCHEME_SUFFIX))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ModelStoreManagerRegistry.getSchemes().join(","));return{scheme:e.split(URL_SCHEME_SUFFIX)[0],path:e.split(URL_SCHEME_SUFFIX)[1]}}function cloneModelInternal(e,t,r){return void 0===r&&(r=!1),__awaiter(this,void 0,void 0,function(){var n,o,a,s,i,u,c,p,l;return __generator(this,function(d){switch(d.label){case 0:return assert(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),assert((n=IORouterRegistry.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),assert(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+e+"."}),o=n[0],assert((a=IORouterRegistry.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),assert(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+t+"."}),s=a[0],i=parseURL(e).scheme,u=parseURL(e).path,c=i===parseURL(e).scheme,[4,o.load()];case 1:return p=d.sent(),r&&c?[4,ModelStoreManagerRegistry.getManager(i).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,s.save(p)];case 4:return l=d.sent(),!r||c?[3,6]:[4,ModelStoreManagerRegistry.getManager(i).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,l.modelArtifactsInfo]}})})}function listModels(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,o,a,s;return __generator(this,function(i){switch(i.label){case 0:e=ModelStoreManagerRegistry.getSchemes(),t={},r=0,n=e,i.label=1;case 1:return r<n.length?(o=n[r],[4,ModelStoreManagerRegistry.getManager(o).listModels()]):[3,4];case 2:for(s in a=i.sent())t[o+URL_SCHEME_SUFFIX+s]=a[s];i.label=3;case 3:return r++,[3,1];case 4:return[2,t]}})})}function removeModel(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){return t=parseURL(e),[2,ModelStoreManagerRegistry.getManager(t.scheme).removeModel(t.path)]})})}function copyModel(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return!1,[2,cloneModelInternal(e,t,!1)]})})}function moveModel(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return!0,[2,cloneModelInternal(e,t,!0)]})})}var PlatformBrowser=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();if(env().get("IS_BROWSER")){env().setPlatform("browser",new PlatformBrowser);try{ModelStoreManagerRegistry.registerManager(BrowserLocalStorage.URL_SCHEME,new BrowserLocalStorageManager)}catch(e){}try{ModelStoreManagerRegistry.registerManager(BrowserIndexedDB.URL_SCHEME,new BrowserIndexedDBManager)}catch(e){}}var systemFetch,getNodeFetch={importFetch:function(){return require("node-fetch")}},PlatformNode=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=env().global.fetch?env().global.fetch(e,t):(null==systemFetch&&(systemFetch=getNodeFetch.importFetch()),systemFetch(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();function buffer(e,t,r){return void 0===t&&(t="float32"),t=t||"float32",assertNonNegativeIntegerDimensions(e),new TensorBuffer(e,t,r)}function cast_(e,t){var r=convertToTensor(e,"x","cast");if(!isValidDtype(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==r.dtype||"string"!==t&&"string"===r.dtype)throw new Error("Only strings can be casted to strings");var n={x:r},o={dtype:t};return ENGINE.runKernelFunc(function(e){return e.cast(r,t)},n,null,Cast,o)}env().get("IS_NODE")&&env().setPlatform("node",new PlatformNode);var cast=op({cast_:cast_});function clone_(e){var t=convertToTensor(e,"x","clone",null),r={x:t};return ENGINE.runKernelFunc(function(){return ENGINE.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},r,null,Identity)}var clone=op({clone_:clone_});function print(e,t){void 0===t&&(t=!1),console.log(e.toString(t))}getOrMakeEngine();var opHandler$1={buffer:buffer,cast:cast,clone:clone,print:print};setOpHandler(opHandler$1);var DEFAULT_FILE_NAME_PREFIX="model",DEFAULT_JSON_EXTENSION_NAME=".json",DEFAULT_WEIGHT_DATA_EXTENSION_NAME=".weights.bin";function defer(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var BrowserDownloads=function(){function e(t){if(!env().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t=DEFAULT_FILE_NAME_PREFIX),this.modelTopologyFileName=t+DEFAULT_JSON_EXTENSION_NAME,this.weightDataFileName=t+DEFAULT_WEIGHT_DATA_EXTENSION_NAME}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o,a,s;return __generator(this,function(i){switch(i.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,defer(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return i.sent(),null==e.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,defer(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:i.sent(),i.label=4;case 4:return[2,{modelArtifactsInfo:getModelArtifactsInfoForJSON(e)}]}})})},e.URL_SCHEME="downloads://",e}(),BrowserFiles=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r=this;return __generator(this,function(n){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(n,o){var a=new FileReader;a.onload=function(a){var s=JSON.parse(a.target.result),i=s.modelTopology;if(null!=i){0===t.length&&n({modelTopology:i});var u=s.weightsManifest;if(null!=u){var c;try{c=r.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var p=[],l=[],d=[];u.forEach(function(e){e.paths.forEach(function(e){l.push(e),d.push(null)}),p.push.apply(p,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var r=t.target.result,o=l.indexOf(e);d[o]=r,-1===d.indexOf(null)&&n({modelTopology:i,weightSpecs:p,weightData:concatenateArrayBuffers(d),format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,userDefinedMetadata:s.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],n=t.map(function(e){return basename(e.name)}),o={},a=0,s=e;a<s.length;a++){s[a].paths.forEach(function(e){var a=basename(e);if(-1!==r.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(r.push(a),-1===n.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[n.indexOf(a)]})}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},e}(),browserDownloadsRouter=function(e){return env().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(BrowserDownloads.URL_SCHEME)?browserDownloads(e.slice(BrowserDownloads.URL_SCHEME.length)):null};function browserDownloads(e){return void 0===e&&(e="model"),new BrowserDownloads(e)}function browserFiles(e){return new BrowserFiles(e)}function monitorPromisesProgress(e,t,r,n){!function(e){assert(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){assert(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),assert(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),assert(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(r=null==r?0:r,n=null==n?1:n);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var s=r+ ++o/e.length*(n-r);return t(s),a}),a}))}function loadWeightsAsArrayBuffer(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,s,i,u,c,p;return __generator(this,function(l){switch(l.label){case 0:return null==t&&(t={}),r=null==t.fetchFunc?env().platform.fetch:t.fetchFunc,n=e.map(function(e){return r(e,t.requestInit,{isBinary:!0})}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(n)];case 1:return s=l.sent(),[3,4];case 2:return[4,monitorPromisesProgress(n,t.onProgress,o,a)];case 3:s=l.sent(),l.label=4;case 4:return i=s.map(function(e){return e.arrayBuffer()}),u=.5,c=1,null!=t.onProgress?[3,6]:[4,Promise.all(i)];case 5:return p=l.sent(),[3,8];case 6:return[4,monitorPromisesProgress(i,t.onProgress,u,c)];case 7:p=l.sent(),l.label=8;case 8:return[2,p]}})})}function loadWeights(e,t,r,n){return void 0===t&&(t=""),__awaiter(this,void 0,void 0,function(){return __generator(this,function(o){return[2,weightsLoaderFactory(function(e){return loadWeightsAsArrayBuffer(e,{requestInit:n})})(e,t,r)]})})}function weightsLoaderFactory(e){var t=this;return function(r,n,o){return void 0===n&&(n=""),__awaiter(t,void 0,void 0,function(){var t,a,s,i,u,c,p,l,d,f;return __generator(this,function(h){switch(h.label){case 0:if(t=r.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],i=[],r.forEach(function(e,r){var n=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=DTYPE_VALUE_SIZE_MAP[u]*sizeFromShape(e.shape),p=function(){t[r]=!0,null==a[r]&&(a[r]=[]),a[r].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=o?o.forEach(function(t,r){t===e.name&&(p(),s[r]=!0)}):p(),i.push(e.name),n+=c})}),!s.every(function(e){return e}))throw u=o.filter(function(e,t){return!s[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+i.join(", ")+".");return c=t.reduce(function(e,t,r){return t&&e.push(r),e},[]),p=[],c.forEach(function(e){r[e].paths.forEach(function(e){var t=n+(n.endsWith("/")?"":"/")+e;p.push(t)})}),[4,e(p)];case 1:return l=h.sent(),d={},f=0,c.forEach(function(e){for(var t=r[e].paths.length,n=0,o=0;o<t;o++)n+=l[f+o].byteLength;for(var s=new ArrayBuffer(n),i=new Uint8Array(s),u=0,c=0;c<t;c++){var p=new Uint8Array(l[f+c]);i.set(p,u),u+=p.byteLength}a[e].forEach(function(e){var t=decodeWeights(s.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var r in t)d[r]=t[r]}),f+=t}),[2,d]}})})}}IORouterRegistry.registerSaveRouter(browserDownloadsRouter);var OCTET_STREAM_MIME_TYPE="application/octet-stream",JSON_TYPE="application/json",HTTPRequest=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(assert("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=env().platform.fetch,assert(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&assert(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o;return __generator(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(n)],{type:JSON_TYPE}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:OCTET_STREAM_MIME_TYPE}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:getModelArtifactsInfoForJSON(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r,n,o,a,s,i,u,c,p,l,d,f;return __generator(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(n=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,i=t.format,u=t.userDefinedMetadata,null==n&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:l=h.sent(),c=l[0],p=l[1],h.label=7;case 7:return d={modelTopology:n,weightSpecs:c,weightData:p,userDefinedMetadata:u,generatedBy:a,convertedBy:s,format:i},(f=t.modelInitializer)&&(d.modelInitializer=f),[2,d]}})})},e.prototype.loadWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,n,o,a,s,i,u,c,p,l,d,f,h,m,v,g,y,x,b,T;return __generator(this,function(E){switch(E.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=parseUrl(t),n=r[0],o=r[1],a=this.weightPathPrefix||n,s=[],i=0,u=e;i<u.length;i++)c=u[i],s.push.apply(s,c.weights);for(p=[],l=[],d=0,f=e;d<f.length;d++)for(h=f[d],m=0,v=h.paths;m<v.length;m++)g=v[m],null!=this.weightUrlConverter?l.push(this.weightUrlConverter(g)):p.push(a+g+o);return this.weightUrlConverter?(x=(y=p.push).apply,b=[p],[4,Promise.all(l)]):[3,2];case 1:x.apply(y,b.concat([E.sent()])),E.label=2;case 2:return[4,loadWeightsAsArrayBuffer(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return T=E.sent(),[2,[s,concatenateArrayBuffers(T)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function parseUrl(e){var t=e.lastIndexOf("/"),r=e.lastIndexOf("?");return[e.substring(0,t)+"/",r>t?e.substring(r):""]}function isHTTPScheme(e){return null!=e.match(HTTPRequest.URL_SCHEME_REGEX)}var httpRouter=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every(function(e){return isHTTPScheme(e)}):isHTTPScheme(e))?http(e,t):null};function http(e,t){return new HTTPRequest(e,t)}function browserHTTPRequest(e,t){return http(e,t)}IORouterRegistry.registerSaveRouter(httpRouter),IORouterRegistry.registerLoadRouter(httpRouter);var PassthroughLoader=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.modelArtifacts]})})},e}(),PassthroughSaver=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.saveHandler(e)]})})},e}();function fromMemory(e,t,r,n){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new PassthroughLoader(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:e,weightSpecs:t,weightData:r,trainingConfig:n}))}function withSaveHandler(e){return new PassthroughSaver(e)}var io={__proto__:null,browserFiles:browserFiles,browserHTTPRequest:browserHTTPRequest,concatenateArrayBuffers:concatenateArrayBuffers,decodeWeights:decodeWeights,encodeWeights:encodeWeights,fromMemory:fromMemory,getLoadHandlers:getLoadHandlers,getModelArtifactsInfoForJSON:getModelArtifactsInfoForJSON,getSaveHandlers:getSaveHandlers,http:http,isHTTPScheme:isHTTPScheme,loadWeights:loadWeights,registerLoadRouter:registerLoadRouter,registerSaveRouter:registerSaveRouter,weightsLoaderFactory:weightsLoaderFactory,withSaveHandler:withSaveHandler,copyModel:copyModel,listModels:listModels,moveModel:moveModel,removeModel:removeModel};function reshape_(e,t){var r=convertToTensor(e,"x","reshape",null),n={x:r},o={shape:t};return ENGINE.runKernelFunc(function(e,n){return t=inferFromImplicitShape(t,r.size),assert(r.size===sizeFromShape(t),function(){return"new shape and old shape must have the same number of elements."}),n([r]),e.reshape(r,t)},n,null,Reshape,o)}var reshape=op({reshape_:reshape_});function matMul_(e,t,r,n){var o;void 0===r&&(r=!1),void 0===n&&(n=!1);var a=convertToTensor(e,"a","matMul"),s=convertToTensor(t,"b","matMul");o=makeTypesMatch(a,s),a=o[0],s=o[1],assert(a.rank>=2&&s.rank>=2&&a.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+s.rank+"."});var i=r?a.shape[a.rank-2]:a.shape[a.rank-1],u=n?s.shape[s.rank-1]:s.shape[s.rank-2],c=r?a.shape[a.rank-1]:a.shape[a.rank-2],p=n?s.shape[s.rank-2]:s.shape[s.rank-1],l=a.shape.slice(0,-2),d=s.shape.slice(0,-2),f=sizeFromShape(l),h=sizeFromShape(d);assert(arraysEqual(l,d),function(){return"Error in matMul: outer dimensions ("+l+") and ("+d+") of Tensors with shapes "+a.shape+" and "+s.shape+" must match."}),assert(i===u,function(){return"Error in matMul: inner shapes ("+i+") and ("+u+") of Tensors with shapes "+a.shape+" and "+s.shape+" and transposeA="+r+" and transposeB="+n+" must match."});var m=a.shape.slice(0,-2).concat([c,p]),v=reshape(a,r?[f,i,c]:[f,c,i]),g=reshape(s,n?[h,p,u]:[h,u,p]),y={a:v,b:g},x={transposeA:r,transposeB:n},b=ENGINE.runKernelFunc(function(e,t){return t([v,g]),e.batchMatMul(v,g,r,n)},y,null,BatchMatMul,x);return reshape(b,m)}var matMul=op({matMul_:matMul_});function oneHot_(e,t,r,n){if(void 0===r&&(r=1),void 0===n&&(n=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=convertToTensor(e,"indices","oneHot","int32"),a=o.shape.concat([t]),s={indices:o},i={depth:t,onValue:r,offValue:n};return ENGINE.runKernelFunc(function(e,s){return s([o]),reshape(e.oneHot(reshape(o,[o.size]),t,r,n),a)},s,null,OneHot,i)}var oneHot=op({oneHot_:oneHot_});function transpose_(e,t){var r=convertToTensor(e,"x","transpose");if(null==t&&(t=r.shape.map(function(e,t){return t}).reverse()),assert(r.rank===t.length,function(){return"Error in transpose: rank of input "+r.rank+" must match length of perm "+t+"."}),t.forEach(function(e){assert(e>=0&&e<r.rank,function(){return"All entries in 'perm' must be between 0 and "+(r.rank-1)+" but got "+t})}),r.rank<=1)return r.clone();var n={x:r},o={perm:t};return ENGINE.runKernelFunc(function(e){return e.transpose(r,t)},n,null,Transpose,o)}var transpose=op({transpose_:transpose_});function confusionMatrix_(e,t,r){var n=convertToTensor(e,"labels","confusionMatrix"),o=convertToTensor(t,"predictions","confusionMatrix");assert(null==r||r>0&&Number.isInteger(r),function(){return"If provided, numClasses must be a positive integer, but got "+r}),assert(1===n.rank,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),assert(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),assert(n.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),assert(r>0&&Number.isInteger(r),function(){return"numClasses is required to be a positive integer, but got "+r});var a=oneHot(cast(n,"int32"),r),s=oneHot(cast(o,"int32"),r),i=transpose(a);return cast(matMul(i,s),"int32")}var fromPixels2DContext,confusionMatrix=op({confusionMatrix_:confusionMatrix_}),math={__proto__:null,confusionMatrix:confusionMatrix};function tensor3d(e,t,r){if(assertNonNull(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var n=inferShape(e,r);if(3!==n.length&&1!==n.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===n.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t,n,r)}function fromPixels_(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=!1,n=!1,o=!1,a=!1,s=!1;if(e.data instanceof Uint8Array)r=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)n=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);s=!0}if(o){if(o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=getKernel(FromPixels,ENGINE.backendName)){var i={pixels:e},u={numChannels:t};return ENGINE.runKernel(FromPixels,i,u)}var c,p,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],d=l[0],f=l[1];if(s?c=e.getContext("2d").getImageData(0,0,d,f).data:n||r?c=e.data:(a||o)&&(null==fromPixels2DContext&&(fromPixels2DContext=document.createElement("canvas").getContext("2d")),fromPixels2DContext.canvas.width=d,fromPixels2DContext.canvas.height=f,fromPixels2DContext.drawImage(e,0,0,d,f),c=fromPixels2DContext.getImageData(0,0,d,f).data),4===t)p=new Int32Array(c);else{var h=d*f;p=new Int32Array(h*t);for(var m=0;m<h;m++)for(var v=0;v<t;++v)p[m*t+v]=c[4*m+v]}return tensor3d(p,[f,d,t],"int32")}function toPixels(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,s,i,u,c,p,l,d,f,h,m,v,g;return __generator(this,function(y){switch(y.label){case 0:if(r=convertToTensor(e,"img","toPixels"),e instanceof Tensor||(r=cast(n=r,"int32"),n.dispose()),2!==r.rank&&3!==r.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+r.rank+".");if(o=r.shape.slice(0,2),a=o[0],s=o[1],(i=2===r.rank?1:r.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);if("float32"!==r.dtype&&"int32"!==r.dtype)throw new Error("Unsupported type for toPixels: "+r.dtype+". Please use float32 or int32 tensors.");return[4,r.data()];case 1:for(u=y.sent(),c="float32"===r.dtype?255:1,p=new Uint8ClampedArray(s*a*4),l=0;l<a*s;++l){for(d=[0,0,0,255],f=0;f<i;f++){if(h=u[l*i+f],"float32"===r.dtype){if(h<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered "+h+".")}else if("int32"===r.dtype&&(h<0||h>255))throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered "+h+".");1===i?(d[0]=h*c,d[1]=h*c,d[2]=h*c):d[f]=h*c}p[(m=4*l)+0]=Math.round(d[0]),p[m+1]=Math.round(d[1]),p[m+2]=Math.round(d[2]),p[m+3]=Math.round(d[3])}return null!=t&&(t.width=s,t.height=a,v=t.getContext("2d"),g=new ImageData(p,s,a),v.putImageData(g,0,0)),r!==e&&r.dispose(),[2,p]}})})}var fromPixels=op({fromPixels_:fromPixels_}),browser={__proto__:null,toPixels:toPixels,fromPixels:fromPixels};function prepareAndValidate(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var r=t.shape,n=r[r.length-1],o=1,a=0;a<r.length-1;++a)o*=r[a];var s=e.shape,i=r.slice();i.pop();var u=1;for(a=n;a<e.rank;++a)u*=s[a],i.push(s[a]);var c=computeStrides(e.shape).map(function(e){return e/u}).concat([1]).slice(0,n);return[i,o,u,c]}var gather_nd_util={__proto__:null,prepareAndValidate:prepareAndValidate};function validateUpdateShape(e,t,r){var n=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+r.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+n+", and batchDim: "+o+".";if(r.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<n+(r.rank-o))throw new Error(a+" Output shape length < "+(n+(r.rank-o)));if(r.rank!==o+e.length-n)throw new Error(a+" update.rank != "+(o+e.length-n));for(var s=0;s<o;++s)if(r.shape[s]!==t.shape[s])throw new Error(a+" updates.shape["+s+"] ("+r.shape[s]+") != indices.shape["+s+"] ("+t.shape[s]+").");for(s=0;s<r.rank-o;++s)if(r.shape[s+o]!==e[s+n])throw new Error(a+" updates.shape["+(s+o)+"] ("+r.shape[s+o]+") != shape["+(s+o)+"] ("+e[s+o]+")")}function validateInput(e,t,r){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(r.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+r);if(0===r.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}validateUpdateShape(r,t,e)}function calculateShapes(e,t,r){for(var n=t.shape.length,o=n>1?t.shape[n-1]:1,a=r.length,s=1,i=o;i<a;++i)s*=r[i];var u=o<1?1:o;return{sliceRank:o,numUpdates:sizeFromShape(t.shape)/u,sliceSize:s,strides:computeStrides(r.slice(0,o)).concat([1]),outputSize:sizeFromShape(r)}}var scatter_nd_util={__proto__:null,validateUpdateShape:validateUpdateShape,validateInput:validateInput,calculateShapes:calculateShapes};function assertParamsValid(e,t,r){var n=e.shape.length;assert(n===t.length,function(){return"Error in slice"+n+"D: Length of begin "+t+" must match the rank of the array ("+n+")."}),assert(n===r.length,function(){return"Error in slice"+n+"D: Length of size "+r+" must match the rank of the array ("+n+")."});for(var o=function(o){assert(t[o]+r[o]<=e.shape[o],function(){return"Error in slice"+n+"D: begin["+o+"] + size["+o+"] ("+(t[o]+r[o])+") would overflow input.shape["+o+"] ("+e.shape[o]+")"})},a=0;a<n;++a)o(a)}function maskToAxes(e){for(var t=[],r=0;e>0;)1&e&&t.push(r),e/=2,r++;return t}function computeOutShape(e,t,r){for(var n=[],o=0;o<e.length;o++)n[o]=Math.ceil((t[o]-e[o])/r[o]);return n}function stridesWithElidedDims(e,t,r,n){for(var o=e.slice(),a=o.length;a<n.length;a++)o.push(1);for(a=0;a<r;a++)0===a?o[t]=1:(o.splice(t,0,1),o.pop());return o}function unnormalizeAxis(e,t,r){return r<=e?r:r-(t-1)}function getElidedAxes(e,t){for(var r=[],n=0;n<e;n++)r.push(t+n);return r}function getNormalizedAxes(e,t,r,n,o,a,s,i,u){var c=e.length,p=new Array(c),l=new Array(c),d=new Array(c);if(t.length&&r>0){var f=t[0],h=r+1;p=startIndicesWithElidedDims(s,f,h,n,e),l=stopIndicesWithElidedDims(i,f,h,o,e),d=stridesWithElidedDims(a,f,h,e)}else for(var m=0;m<c;m++)p[m]=startForAxis(s,n,a,e,m,u),l[m]=stopForAxis(i,o,a,e,m,u),d[m]=stridesForAxis(a,m,u);return{begin:p,end:l,strides:d}}function startIndicesWithElidedDims(e,t,r,n,o){for(var a=o.slice(),s=getElidedAxes(r,t),i=0;i<a.length;i++)if(s.indexOf(i)>-1)a[i]=0;else{var u=unnormalizeAxis(t,r,i),c=n[u];e&1<<u&&(c=0),a[i]=c}return a}function stopIndicesWithElidedDims(e,t,r,n,o){for(var a=o.slice(),s=getElidedAxes(r,t),i=0;i<a.length;i++)if(s.indexOf(i)>-1)a[i]=Number.MAX_SAFE_INTEGER;else{var u=unnormalizeAxis(t,r,i),c=n[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),a[i]=c}for(var p=0;p<a.length;p++){var l=o[p];a[p]<0&&(a[p]+=l),a[p]=clamp(0,a[p],o[p])}return a}function stridesForAxis(e,t,r){var n=e[t];return(r&1<<t||null==n)&&(n=1),n}function startForAxis(e,t,r,n,o,a){var s=t[o],i=r[o]||1;(e&1<<o||a&1<<o||null==s)&&(s=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=n[o];return s<0&&(s+=u),s=clamp(0,s,u-1)}function stopForAxis(e,t,r,n,o,a){var s=t[o],i=r[o]||1;(e&1<<o||a&1<<o||null==s)&&(s=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=n[o];return s<0&&(s+=u),s=i>0?clamp(0,s,u):clamp(-1,s,u-1)}function isSliceContinous(e,t,r){for(var n=r.length,o=0;o<r.length;o++)if(r[o]>1){n=o;break}for(o=n+1;o<r.length;o++)if(t[o]>0||r[o]!==e[o])return!1;return!0}function computeFlatOffset(e,t){for(var r=e.length>0?e[e.length-1]:1,n=0;n<e.length-1;n++)r+=e[n]*t[n];return r}function parseSliceParams(e,t,r){var n,o,a=e.shape.length;return(n="number"==typeof t?[t].concat(new Array(a-1).fill(0)):t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice()).forEach(function(e){assert(-1!==e,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==r?new Array(a).fill(-1):"number"==typeof r?[r].concat(new Array(a-1).fill(-1)):r.length<a?r.concat(new Array(a-r.length).fill(-1)):r).map(function(t,r){return t>=0?t:(assert(-1===t,function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+r+"."}),e.shape[r]-n[r])}),[n,o]}var slice_util={__proto__:null,assertParamsValid:assertParamsValid,maskToAxes:maskToAxes,computeOutShape:computeOutShape,stridesWithElidedDims:stridesWithElidedDims,getNormalizedAxes:getNormalizedAxes,startIndicesWithElidedDims:startIndicesWithElidedDims,stopIndicesWithElidedDims:stopIndicesWithElidedDims,stridesForAxis:stridesForAxis,startForAxis:startForAxis,stopForAxis:stopForAxis,isSliceContinous:isSliceContinous,computeFlatOffset:computeFlatOffset,parseSliceParams:parseSliceParams},Serializable=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),SerializationMap=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function registerClass(e){assert(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),assert("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),assert(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),SerializationMap.register(e)}var serialization={__proto__:null,Serializable:Serializable,SerializationMap:SerializationMap,registerClass:registerClass},TEST_EPSILON_FLOAT32=.001,TEST_EPSILON_FLOAT16=.1;function expectArraysClose(e,t,r){return null==r&&(r=testEpsilon()),expectArraysPredicate(e,t,function(e,t){return areClose(e,t,r)})}function testEpsilon(){return 32===ENGINE.backend.floatPrecision()?TEST_EPSILON_FLOAT32:TEST_EPSILON_FLOAT16}function expectArraysPredicate(e,t,r){var n=!0;if((isTypedArray(e)||isTypedArray(t))&&(n=!1),isTypedArray(e)&&isTypedArray(t)&&(n=!0),n){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var s=inferShape(e),i=inferShape(t);if(!arraysEqual(s,i))throw new Error("Arrays have different shapes. Actual: ["+s+"]. Expected: ["+i+"]")}var u=isTypedArray(e)?e:flatten(e),c=isTypedArray(t)?t:flatten(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var p=0;p<c.length;++p){var l=u[p],d=c[p];if(!r(l,d))throw new Error("Arrays differ: actual["+p+"] = "+l+", expected["+p+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function expectPromiseToFail(e,t){e().then(function(){return t.fail()},function(){return t()})}function expectArraysEqual(e,t){var r="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return isString(e)||isString(e[0])||isString(t)||isString(t[0])?expectArraysPredicate(e,r,function(e,t){return e==t}):expectArraysPredicate(e,t,function(e,t){return areClose(e,t,0)})}function expectNumbersClose(e,t,r){if(null==r&&(r=testEpsilon()),!areClose(e,t,r))throw new Error("Numbers differ: actual === "+e+", expected === "+t)}function areClose(e,t,r){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>r)}function expectValuesInRange(e,t,r){for(var n=0;n<e.length;n++)if(e[n]<t||e[n]>r)throw new Error("Value out of range:"+e[n]+" low: "+t+", high: "+r)}function expectArrayBuffersEqual(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}var test_util={__proto__:null,TEST_EPSILON_FLOAT16:TEST_EPSILON_FLOAT16,expectArraysClose:expectArraysClose,testEpsilon:testEpsilon,expectPromiseToFail:expectPromiseToFail,expectArraysEqual:expectArraysEqual,expectNumbersClose:expectNumbersClose,expectValuesInRange:expectValuesInRange,expectArrayBuffersEqual:expectArrayBuffersEqual},version="2.6.0";function enableProdMode(){env().set("PROD",!0)}function enableDebugMode(){env().set("DEBUG",!0)}function disableDeprecationWarnings(){env().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function deprecationWarn(e){env().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function disposeVariables(){ENGINE.disposeVariables()}function engine(){return ENGINE}function memory(){return ENGINE.memory()}function profile(e){return ENGINE.profile(e)}function tidy(e,t){return ENGINE.tidy(e,t)}function dispose(e){getTensorsInContainer(e).forEach(function(e){return e.dispose()})}function keep(e){return ENGINE.keep(e)}function time(e){return ENGINE.time(e)}function setBackend(e){return ENGINE.setBackend(e)}function ready(){return ENGINE.ready()}function getBackend(){return ENGINE.backendName}function removeBackend(e){ENGINE.removeBackend(e)}function findBackend(e){return ENGINE.findBackend(e)}function findBackendFactory(e){return ENGINE.findBackendFactory(e)}function registerBackend(e,t,r){return void 0===r&&(r=1),ENGINE.registerBackend(e,t,r)}function backend(){return ENGINE.backend}function setPlatform(e,t){env().setPlatform(e,t)}function add_(e,t){var r,n=convertToTensor(e,"a","add"),o=convertToTensor(t,"b","add");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.add(n,o);return t([n,o]),r},a,null,Add)}var add$1=op({add_:add_});function floorDiv_(e,t){var r,n=convertToTensor(e,"a","floorDiv"),o=convertToTensor(t,"b","floorDiv");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.floorDiv(n,o);return t([n,o]),r},a,null,FloorDiv)}var floorDiv=op({floorDiv_:floorDiv_});function div_(e,t){var r,n=convertToTensor(e,"a","div"),o=convertToTensor(t,"b","div");if(r=makeTypesMatch(n,o),n=r[0],o=r[1],"int32"===n.dtype&&"int32"===o.dtype)return floorDiv(n,o);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.realDivide(n,o);return t([n,o]),r},a,null,Div,{})}var div=op({div_:div_});function mul_(e,t){var r,n=convertToTensor(e,"a","mul"),o=convertToTensor(t,"b","mul");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.multiply(n,o);return t([n,o]),r},a,null,Multiply)}var mul=op({mul_:mul_});function abs_(e){var t=convertToTensor(e,"x","abs"),r={x:t};return ENGINE.runKernelFunc(function(e,r){return r([t]),"complex64"===t.dtype?e.complexAbs(t):e.abs(t)},r,null,Abs)}var abs=op({abs_:abs_});function acos_(e){var t=convertToTensor(e,"x","acos"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.acos(t);return r([t]),n},r,null,Acos)}var acos=op({acos_:acos_});function acosh_(e){var t=convertToTensor(e,"x","acosh"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.acosh(t);return r([t]),n},r,null,Acosh)}var acosh=op({acosh_:acosh_});function addN_(e){assert(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),assert(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return convertToTensor(e,"tensors"+t,"addN")}),r=t[0];t.forEach(function(e){if(e.dtype!==r.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!arraysEqual(e.shape,r.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=t;return ENGINE.runKernelFunc(function(e,r){var n=e.addN(t);return r(t),n},n,null,AddN)}var addN=op({addN_:addN_});function axesAreInnerMostDims(e,t){for(var r=0;r<e.length;++r)if(e[e.length-r-1]!==t-1-r)return!1;return!0}function combineLocations(e,t,r){for(var n=e.length+t.length,o=[],a=0,s=0,i=0;i<n;i++)-1===r.indexOf(i)?o.push(e[a++]):o.push(t[s++]);return o}function computeOutAndReduceShapes(e,t){for(var r=[],n=e.length,o=0;o<n;o++)-1===t.indexOf(o)&&r.push(e[o]);return[r,t.map(function(t){return e[t]})]}function expandShapeToKeepDim(e,t){return combineLocations(e,t.map(function(e){return 1}),t)}function assertAxesAreInnerMostDims(e,t,r){assert(axesAreInnerMostDims(t,r),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+r+" input."})}function getAxesPermutation(e,t){if(axesAreInnerMostDims(e,t))return null;for(var r=[],n=0;n<t;++n)-1===e.indexOf(n)&&r.push(n);return e.forEach(function(e){return r.push(e)}),r}function getUndoAxesPermutation(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function getInnerMostAxes(e,t){for(var r=[],n=t-e;n<t;++n)r.push(n);return r}function all_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","all","bool"),o={x:n},a={axis:t,keepDims:r};return ENGINE.runKernelFunc(function(e){var o=parseAxisParam(t,n.shape),a=o,s=getAxesPermutation(a,n.rank);null!=s&&(n=transpose(n,s),a=getInnerMostAxes(a.length,n.rank));var i=e.all(n,a);if(r){var u=expandShapeToKeepDim(i.shape,o);return reshape(i,u)}return i},o,null,All,a)}var all=op({all_:all_});function any_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","any","bool"),o={x:n},a={axis:t,keepDims:r};return ENGINE.runKernelFunc(function(e){var o=parseAxisParam(t,n.shape),a=o,s=getAxesPermutation(a,n.rank);null!=s&&(n=transpose(n,s),a=getInnerMostAxes(a.length,n.rank));var i=e.any(n,a);if(r){var u=expandShapeToKeepDim(i.shape,o);return reshape(i,u)}return i},o,null,Any,a)}var any=op({any_:any_});function argMax_(e,t){void 0===t&&(t=0);var r=convertToTensor(e,"x","argMax"),n={x:r},o={axis:t};return ENGINE.runKernelFunc(function(e,n){n([r]);var o=parseAxisParam(t,r.shape),a=getAxesPermutation(o,r.rank);return null!=a&&(r=transpose(r,a),o=getInnerMostAxes(o.length,r.rank)),e.argMax(r,o[0])},n,null,ArgMax,o)}var argMax=op({argMax_:argMax_});function argMin_(e,t){void 0===t&&(t=0);var r=convertToTensor(e,"x","argMin"),n={x:r},o={axis:t};return ENGINE.runKernelFunc(function(e,n){n([r]),null==t&&(t=0);var o=parseAxisParam(t,r.shape),a=getAxesPermutation(o,r.rank);return null!=a&&(r=transpose(r,a),o=getInnerMostAxes(o.length,r.rank)),e.argMin(r,o[0])},n,null,ArgMin,o)}var argMin=op({argMin_:argMin_});function asin_(e){var t=convertToTensor(e,"x","asin"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.asin(t);return r([t]),n},r,null,Asin)}var asin=op({asin_:asin_});function asinh_(e){var t=convertToTensor(e,"x","asinh"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.asinh(t);return r([t]),n},r,null,Asinh)}var asinh=op({asinh_:asinh_});function atan_(e){var t=convertToTensor(e,"x","atan"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.atan(t);return r([t]),n},r,null,Atan)}var atan=op({atan_:atan_});function atan2_(e,t){var r,n=convertToTensor(e,"a","atan2"),o=convertToTensor(t,"b","atan2");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.atan2(n,o);return t([n,o]),r},a,null,Atan2)}var atan2=op({atan2_:atan2_});function atanh_(e){var t=convertToTensor(e,"x","atanh"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.atanh(t);return r([t]),n},r,null,Atanh)}var atanh=op({atanh_:atanh_});function computeDilation2DInfo(e,t,r,n,o,a){void 0===o&&(o="NHWC");var s=e[3];return computeConv2DInfo(e,t.concat([s]),r,a,n,null,null,convertConv2DDataFormat(o))}function computePool2DInfo(e,t,r,n,o,a,s){void 0===s&&(s="channelsLast");var i,u=parseTupleParam(t),c=u[0],p=u[1];if("channelsLast"===s)i=[c,p,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);i=[c,p,e[1],e[1]]}return computeConv2DInfo(e,i,r,n,o,a,!1,s)}function computePool3DInfo(e,t,r,n,o,a,s){void 0===s&&(s="NDHWC");var i,u,c=parse3TupleParam(t),p=c[0],l=c[1],d=c[2];if("NDHWC"===s)u="channelsLast",i=[p,l,d,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat "+s);u="channelsFirst",i=[p,l,d,e[1],e[1]]}return computeConv3DInfo(e,i,r,n,o,!1,u,a)}function computeConv2DInfo(e,t,r,n,o,a,s,i){void 0===s&&(s=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1],c=u[0],p=u[1],l=u[2],d=u[3];if("channelsLast"===i)c=e[0],p=e[1],l=e[2],d=e[3];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);c=e[0],d=e[1],p=e[2],l=e[3]}var f,h=t[0],m=t[1],v=t[3],g=parseTupleParam(r),y=g[0],x=g[1],b=parseTupleParam(n),T=b[0],E=b[1],S=getEffectiveFilterSize(h,T),w=getEffectiveFilterSize(m,E),k=getPadAndOutInfo(o,p,l,y,x,S,w,a,i),_=k.padInfo,N=k.outHeight,I=k.outWidth,A=s?v*d:v;return"channelsFirst"===i?f=[c,A,N,I]:"channelsLast"===i&&(f=[c,N,I,A]),{batchSize:c,dataFormat:i,inHeight:p,inWidth:l,inChannels:d,outHeight:N,outWidth:I,outChannels:A,padInfo:_,strideHeight:y,strideWidth:x,filterHeight:h,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:w,dilationHeight:T,dilationWidth:E,inShape:e,outShape:f,filterShape:t}}function computeConv3DInfo(e,t,r,n,o,a,s,i){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],p=u[1],l=u[2],d=u[3],f=u[4];if("channelsLast"===s)c=e[0],p=e[1],l=e[2],d=e[3],f=e[4];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],f=e[1],p=e[2],l=e[3],d=e[4]}var h,m=t[0],v=t[1],g=t[2],y=t[4],x=parse3TupleParam(r),b=x[0],T=x[1],E=x[2],S=parse3TupleParam(n),w=S[0],k=S[1],_=S[2],N=getEffectiveFilterSize(m,w),I=getEffectiveFilterSize(v,k),A=getEffectiveFilterSize(g,_),D=get3DPadAndOutInfo(o,p,l,d,b,T,E,N,I,A,i),M=D.padInfo,F=D.outDepth,C=D.outHeight,G=D.outWidth,R=a?y*f:y;return"channelsFirst"===s?h=[c,R,F,C,G]:"channelsLast"===s&&(h=[c,F,C,G,R]),{batchSize:c,dataFormat:s,inDepth:p,inHeight:l,inWidth:d,inChannels:f,outDepth:F,outHeight:C,outWidth:G,outChannels:R,padInfo:M,strideDepth:b,strideHeight:T,strideWidth:E,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:N,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationDepth:w,dilationHeight:k,dilationWidth:_,inShape:e,outShape:h,filterShape:t}}function computeOutputShape2D(e,t,r,n,o){null==n&&(n=computeDefaultPad(e,t,r));var a=e[0],s=e[1],i=conditionalRound((a-t+2*n)/r+1,o);assert(isInt(i),function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"});var u=conditionalRound((s-t+2*n)/r+1,o);return assert(isInt(u),function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"}),[i,u]}function computeOutputShape4D(e,t,r,n,o,a){null==o&&(o=computeDefaultPad(e,t,n));var s=e[0],i=e[1],u=e[2],c=conditionalRound((s-t+2*o)/n+1,a);assert(isInt(c),function(){return"The output # of depths ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var p=conditionalRound((i-t+2*o)/n+1,a);assert(isInt(p),function(){return"The output # of rows ("+p+") must be an integer. Change the stride and/or zero pad parameters"});var l=conditionalRound((u-t+2*o)/n+1,a);return assert(isInt(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[c,p,l,r]}function computeDefaultPad(e,t,r,n){void 0===n&&(n=1);var o=getEffectiveFilterSize(t,n);return Math.floor((e[0]*(r-1)-r+o)/2)}function parseTupleParam(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function parse3TupleParam(e){return"number"==typeof e?[e,e,e]:e}function getEffectiveFilterSize(e,t){return t<=1?e:e+(e-1)*(t-1)}function getPadAndOutInfo(e,t,r,n,o,a,s,i,u){var c,p,l;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=computeOutputShape2D([t,r],a,n,e,i);p=d[0],l=d[1]}else if("same"===e){p=Math.ceil(t/n),l=Math.ceil(r/o);var f=Math.max(0,(p-1)*n+a-t),h=Math.max(0,(l-1)*o+s-r),m=Math.floor(f/2);c={top:m,bottom:v=f-m,left:g=Math.floor(h/2),right:y=h-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},p=Math.ceil((t-a+1)/n),l=Math.ceil((r-s+1)/o);else{if("object"!=typeof e)throw Error("Unknown padding parameter: "+e);var v,g,y,x="channelsLast"===u?e[1][0]:e[2][0];c={top:x,bottom:v="channelsLast"===u?e[1][1]:e[2][1],left:g="channelsLast"===u?e[2][0]:e[3][0],right:y="channelsLast"===u?e[2][1]:e[3][1],type:0===x&&0===v&&0===g&&0===y?"VALID":"EXPLICIT"},p=conditionalRound((t-a+x+v)/n+1,i),l=conditionalRound((r-s+g+y)/o+1,i)}return{padInfo:c,outHeight:p,outWidth:l}}function get3DPadAndOutInfo(e,t,r,n,o,a,s,i,u,c,p){var l,d,f,h;if("number"==typeof e){l={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=computeOutputShape4D([t,r,n,1],i,1,o,e,p);d=m[0],f=m[1],h=m[2]}else if("same"===e){var v=((d=Math.ceil(t/o))-1)*o+i-t,g=((f=Math.ceil(r/a))-1)*a+u-r,y=((h=Math.ceil(n/s))-1)*s+c-n,x=Math.floor(v/2),b=v-x,T=Math.floor(g/2),E=g-T,S=Math.floor(y/2);l={top:T,bottom:E,left:S,right:y-S,front:x,back:b,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);l={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-i+1)/o),f=Math.ceil((r-u+1)/a),h=Math.ceil((n-c+1)/s)}return{padInfo:l,outDepth:d,outHeight:f,outWidth:h}}function conditionalRound(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function tupleValuesAreOne(e){var t=parseTupleParam(e),r=t[0],n=t[1],o=t[2];return 1===r&&1===n&&1===o}function eitherStridesOrDilationsAreOne(e,t){return tupleValuesAreOne(e)||tupleValuesAreOne(t)}function convertConv2DDataFormat(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function avgPool_(e,t,r,n,o){var a=convertToTensor(e,"x","avgPool","float32");assert(eitherStridesOrDilationsAreOne(r,1),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+r+" and dilations '1'"});var s=a,i=!1;3===a.rank&&(i=!0,s=reshape(a,[1,a.shape[0],a.shape[1],a.shape[2]])),assert(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=o&&assert(isInt(n),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var u={x:s},c={filterSize:t,strides:r,pad:n,dimRoundingMode:o},p=ENGINE.runKernelFunc(function(e,a){var i=computePool2DInfo(s.shape,t,r,1,n,o);return a([s]),1===i.filterWidth&&1===i.filterHeight&&arraysEqual(i.inShape,i.outShape)?s.clone():e.avgPool(s,i)},u,null,AvgPool,c);return p=cast(p,a.dtype),i?reshape(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var avgPool=op({avgPool_:avgPool_});function avgPool3d_(e,t,r,n,o,a,s){void 0===a&&(a="NDHWC"),null==s?s=[1,1,1]:deprecationWarn("dilations is deprecated, this field will be gone in v3.0.0.");var i=convertToTensor(e,"x","avgPool3d","float32"),u=i,c=!1;4===i.rank&&(c=!0,u=reshape(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),assert(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),assert("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),assert(eitherStridesOrDilationsAreOne(r,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"}),null!=o&&assert(isInt(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var p={x:u},l={filterSize:t,strides:r,pad:n,dimRoundingMode:o,dataFormat:a,dilations:s},d=ENGINE.runKernelFunc(function(e,i){null==s&&(s=[1,1,1]);var c=computePool3DInfo(u.shape,t,r,s,n,o,a);return i([u]),e.avgPool3d(u,c)},p,null,AvgPool3D,l);return d=cast(d,u.dtype),c?reshape(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var avgPool3d=op({avgPool3d_:avgPool3d_});function assertParamsConsistent(e,t){var r=e[0].length;e.forEach(function(e,t){assert(e.length===r,function(){return"Error in concat"+r+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+r+")"})}),assert(t>=0&&t<r,function(){return"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+"."});var n=e[0];e.forEach(function(e,o){for(var a=0;a<r;a++)assert(a===t||e[a]===n[a],function(){return"Error in concat"+r+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+o+"."})})}function computeOutShape$1(e,t){for(var r=e[0].slice(),n=1;n<e.length;n++)r[t]+=e[n][t];return r}function concat_(e,t){void 0===t&&(t=0),assert(e.length>=1,function(){return"Pass at least one tensor to concat"});var r=convertToTensorArray(e,"tensors","concat");"complex64"===r[0].dtype&&r.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")});var n=r,o={axis:t};return ENGINE.runKernelFunc(function(e,n){var o=parseAxisParam(t,r[0].shape)[0],a=computeOutShape$1(r.map(function(e){return e.shape}),o);if(0===sizeFromShape(a))return tensor([],a);if(1===(r=r.filter(function(e){return e.size>0})).length)return r[0];assertParamsConsistent(r.map(function(e){return e.shape}),o);var s=e.concat(r,o);return n(r),s},n,null,Concat,o)}var concat=op({concat_:concat_});function sigmoid_(e){var t=convertToTensor(e,"x","sigmoid"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.sigmoid(t);return r([n]),n},r,null,Sigmoid)}var sigmoid=op({sigmoid_:sigmoid_});function slice_(e,t,r){var n=convertToTensor(e,"x","slice");if(0===n.rank)throw new Error("Slicing scalar is not possible");var o={x:n},a={begin:t,size:r};return ENGINE.runKernelFunc(function(e,o){var a=parseSliceParams(n,t,r),s=a[0],i=a[1];return assertParamsValid(n,s,i),o([n]),e.slice(n,s,i)},o,null,Slice,a)}var slice=op({slice_:slice_});function tanh_(e){var t=convertToTensor(e,"x","tanh"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.tanh(t);return r([n]),n},r,null,Tanh)}var tanh$1=op({tanh_:tanh_});function basicLSTMCell_(e,t,r,n,o,a){var s=convertToTensor(e,"forgetBias","basicLSTMCell"),i=convertToTensor(t,"lstmKernel","basicLSTMCell"),u=convertToTensor(r,"lstmBias","basicLSTMCell"),c=convertToTensor(n,"data","basicLSTMCell"),p=convertToTensor(o,"c","basicLSTMCell"),l=convertToTensor(a,"h","basicLSTMCell"),d=concat([c,l],1),f=matMul(d,i),h=add$1(f,u),m=h.shape[0],v=h.shape[1]/4,g=[m,v],y=slice(h,[0,0],g),x=slice(h,[0,v],g),b=slice(h,[0,2*v],g),T=slice(h,[0,3*v],g),E=add$1(mul(sigmoid(y),tanh$1(x)),mul(p,sigmoid(add$1(s,b))));return[E,mul(tanh$1(E),sigmoid(T))]}var basicLSTMCell=op({basicLSTMCell_:basicLSTMCell_});function batchToSpaceND_(e,t,r){var n=convertToTensor(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});assert(n.rank>=1+t.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+t.length}),assert(r.length===t.length,function(){return"crops.length is "+r.length+" but should be equal to blockShape.length  "+t.length}),assert(n.shape[0]%o==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o});var a={x:n},s={blockShape:t,crops:r};return ENGINE.runKernelFunc(function(e){return e.batchToSpaceND(n,t,r)},a,null,BatchToSpaceND,s)}var batchToSpaceND=op({batchToSpaceND_:batchToSpaceND_});function xAs4D(e){return 0===e.rank||1===e.rank?reshape(e,[1,1,1,e.size]):2===e.rank?reshape(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?reshape(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}function batchNorm_(e,t,r,n,o,a){null==a&&(a=.001);var s,i,u=convertToTensor(e,"x","batchNorm"),c=convertToTensor(t,"mean","batchNorm"),p=convertToTensor(r,"variance","batchNorm");null!=o&&(s=convertToTensor(o,"scale","batchNorm")),null!=n&&(i=convertToTensor(n,"offset","batchNorm")),assert(c.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),assert(null==i||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),assert(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var l=xAs4D(u),d={x:l,scale:s,offset:i,mean:c,variance:p},f={varianceEpsilon:a},h=ENGINE.runKernelFunc(function(e,t){return t([l,c,p,s]),e.batchNorm(l,as1DOr4D(c),as1DOr4D(p),as1DOr4D(i),as1DOr4D(s),a)},d,null,FusedBatchNorm,f);return reshape(h,u.shape)}function as1DOr4D(e){return null==e?null:0===e.rank?reshape(e,[e.size]):1===e.rank?e:2===e.rank?reshape(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?reshape(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var batchNorm=op({batchNorm_:batchNorm_});function batchNorm2d_(e,t,r,n,o,a){var s,i,u=convertToTensor(e,"x","batchNorm"),c=convertToTensor(t,"mean","batchNorm"),p=convertToTensor(r,"variance","batchNorm");return null!=o&&(s=convertToTensor(o,"scale","batchNorm")),null!=n&&(i=convertToTensor(n,"offset","batchNorm")),assert(2===u.rank,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+u.rank+"."}),assert(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),assert(2===p.rank||1===p.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+p.rank+"."}),null!=s&&assert(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),null!=i&&assert(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+i.rank+"."}),batchNorm(u,c,p,i,s,a)}var batchNorm2d=op({batchNorm2d_:batchNorm2d_});function batchNorm3d_(e,t,r,n,o,a){var s,i,u=convertToTensor(e,"x","batchNorm"),c=convertToTensor(t,"mean","batchNorm"),p=convertToTensor(r,"variance","batchNorm");return null!=o&&(s=convertToTensor(o,"scale","batchNorm")),null!=n&&(i=convertToTensor(n,"offset","batchNorm")),assert(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),assert(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),assert(3===p.rank||1===p.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+p.rank+"."}),null!=s&&assert(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),null!=i&&assert(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+i.rank+"."}),batchNorm(u,c,p,i,s,a)}var batchNorm3d=op({batchNorm3d_:batchNorm3d_});function batchNorm4d_(e,t,r,n,o,a){var s,i,u=convertToTensor(e,"x","batchNorm"),c=convertToTensor(t,"mean","batchNorm"),p=convertToTensor(r,"variance","batchNorm");return null!=o&&(s=convertToTensor(o,"scale","batchNorm")),null!=n&&(i=convertToTensor(n,"offset","batchNorm")),assert(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),assert(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),assert(4===p.rank||1===p.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+p.rank+"."}),null!=s&&assert(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),null!=i&&assert(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+i.rank+"."}),batchNorm(u,c,p,i,s,a)}var batchNorm4d=op({batchNorm4d_:batchNorm4d_});function broadcastTo_(e,t){var r=convertToTensor(e,"broadcastTo","x"),n=r.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<r.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+r.rank+".");if(t.length>r.rank){for(var o=r.shape.slice();o.length<t.length;)o.unshift(1);r=reshape(r,o)}for(var a=r.shape,s=Array.from(t),i=t.length-1;i>=0;i--)if(a[i]===t[i])s[i]=1;else if(1!==r.shape[i])throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+t+"].");if(0===s.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0}).length)return clone(r);var u={x:r},c={shape:t,inputShape:a};return ENGINE.runKernelFunc(function(e){return e.tile(r,s)},u,null,BroadcastTo,c)}var broadcastTo=op({broadcastTo_:broadcastTo_});function ceil_(e){var t=convertToTensor(e,"x","ceil"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.ceil(t)},r,null,Ceil)}var ceil=op({ceil_:ceil_});function clipByValue_(e,t,r){var n=convertToTensor(e,"x","clipByValue");assert(t<=r,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+r+")."});var o={x:n},a={clipValueMin:t,clipValueMax:r};return ENGINE.runKernelFunc(function(e,o){var a=e.clip(n,t,r);return o([n]),a},o,null,ClipByValue,a)}var clipByValue=op({clipByValue_:clipByValue_});function concat1d_(e){return concat(e,0)}var concat1d=op({concat1d_:concat1d_});function concat2d_(e,t){return concat(e,t)}var concat2d=op({concat2d_:concat2d_});function concat3d_(e,t){return concat(e,t)}var concat3d=op({concat3d_:concat3d_});function concat4d_(e,t){return concat(e,t)}var concat4d=op({concat4d_:concat4d_});function conv2d_(e,t,r,n,o,a,s){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var i=convertToTensor(e,"x","conv2d"),u=convertToTensor(t,"filter","conv2d"),c=i,p=!1;3===i.rank&&(p=!0,c=reshape(i,[1,i.shape[0],i.shape[1],i.shape[2]])),assert(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),assert(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=s&&assert(isInt(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+n+"."});var l="NHWC"===o?c.shape[3]:c.shape[1];assert(l===u.shape[2],function(){return"Error in conv2d: depth of input ("+l+") must match input depth for filter "+u.shape[2]+"."}),assert(eitherStridesOrDilationsAreOne(r,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"});var d={x:c,filter:u},f={strides:r,pad:n,dataFormat:o,dilations:a,dimRoundingMode:s},h=ENGINE.runKernelFunc(function(e,t){var i=convertConv2DDataFormat(o),p=computeConv2DInfo(c.shape,u.shape,r,a,n,s,!1,i),l=e.conv2d(c,u,p);return t([c,u]),l},d,null,Conv2D,f);return p?reshape(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var conv2d=op({conv2d_:conv2d_});function conv1d_(e,t,r,n,o,a,s){void 0===o&&(o="NWC"),void 0===a&&(a=1);var i=convertToTensor(e,"x","conv1d"),u=convertToTensor(t,"filter","conv1d"),c=i,p=!1;2===i.rank&&(p=!0,c=reshape(i,[1,i.shape[0],i.shape[1]])),assert(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),assert(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=s&&assert(isInt(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+n+"."}),assert(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),assert(eitherStridesOrDilationsAreOne(r,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+r+" and dilation '"+a+"'"}),assert("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var l=reshape(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=reshape(c,[c.shape[0],1,c.shape[1],c.shape[2]]),f=conv2d(d,l,[1,r],n,"NHWC",[1,a],s);return reshape(f,p?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}var conv1d=op({conv1d_:conv1d_});function conv2DBackpropInput_(e,t,r,n,o,a,s){void 0===a&&(a="NHWC"),assert(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,u=t,c=!1;3===t.rank&&(c=!0,u=reshape(t,[1,t.shape[0],t.shape[1],t.shape[2]]),i=[1,e[0],e[1],e[2]]),assert(4===i.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+i.length+"."}),assert(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),assert(4===r.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+r.rank});var p="NHWC"===a?i[3]:i[1],l="NHWC"===a?u.shape[3]:u.shape[1];assert(p===r.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+p+") must match input depth for filter "+r.shape[2]+"."}),assert(l===r.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+l+") must match output depth for filter "+r.shape[3]+"."}),null!=s&&assert(isInt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."});var d={dy:u,filter:r},f={strides:n,pad:o,dataFormat:a,dimRoundingMode:s,inputShape:i},h=ENGINE.runKernelFunc(function(e,t){var c=convertConv2DDataFormat(a),p=computeConv2DInfo(i,r.shape,n,1,o,s,!1,c),l=e.conv2dDerInput(u,r,p);return t([u,r]),l},d,null,Conv2DBackpropInput,f);return c?reshape(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var conv2DBackpropInput=op({conv2DBackpropInput_:conv2DBackpropInput_});function conv2dTranspose_(e,t,r,n,o,a){var s=convertToTensor(e,"x","conv2dTranspose"),i=convertToTensor(t,"filter","conv2dTranspose");return conv2DBackpropInput(r,s,i,n,o,"NHWC",a)}var conv2dTranspose=op({conv2dTranspose_:conv2dTranspose_});function conv3d_(e,t,r,n,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var s=convertToTensor(e,"x","conv3d"),i=convertToTensor(t,"filter","conv3d"),u=s,c=!1;4===s.rank&&(c=!0,u=reshape(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),assert(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),assert(5===i.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+i.rank+"."}),assert(u.shape[4]===i.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+i.shape[3]+"."}),assert(eitherStridesOrDilationsAreOne(r,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"}),assert("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var p={x:u,filter:i},l={strides:r,pad:n,dataFormat:o,dilations:a},d=ENGINE.runKernelFunc(function(e,t){var o=computeConv3DInfo(u.shape,i.shape,r,a,n),s=e.conv3d(u,i,o);return t([u,i]),s},p,null,Conv3D,l);return c?reshape(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var conv3d=op({conv3d_:conv3d_});function conv3DBackpropInput_(e,t,r,n,o){assert(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,s=t,i=!1;4===t.rank&&(i=!0,s=reshape(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],c=s.shape[4];assert(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),assert(5===s.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),assert(5===r.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+r.rank}),assert(u===r.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+r.shape[3]+"."}),assert(c===r.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+r.shape[4]+"."});var p={dy:s},l={pad:o},d=ENGINE.runKernelFunc(function(e){var t=computeConv3DInfo(a,r.shape,n,1,o);return e.conv3dDerInput(s,r,t)},p,null,Conv3DBackpropInputV2,l);return i?reshape(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var conv3DBackpropInput=op({conv3DBackpropInput_:conv3DBackpropInput_});function conv3dTranspose_(e,t,r,n,o){var a=convertToTensor(e,"x","conv3dTranspose"),s=convertToTensor(t,"filter","conv3dTranspose");return conv3DBackpropInput(r,a,s,n,o)}var conv3dTranspose=op({conv3dTranspose_:conv3dTranspose_});function cos_(e){var t=convertToTensor(e,"x","cos"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.cos(t);return r([t]),n},r,null,Cos)}var cos=op({cos_:cos_});function cosh_(e){var t=convertToTensor(e,"x","cosh"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.cosh(t);return r([t]),n},r,null,Cosh)}var cosh=op({cosh_:cosh_});function cumsum_(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=!1),void 0===n&&(n=!1);var o=convertToTensor(e,"x","cumsum"),a={x:o},s={axis:t,exclusive:r,reverse:n};return ENGINE.runKernelFunc(function(e,a){var s=getAxesPermutation([t],o.rank),i=o;null!=s&&(i=transpose(o,s));var u=getInnerMostAxes(1,o.rank)[0],c=e.cumsum(i,u,r,n);if(a([o]),null!=s){var p=getUndoAxesPermutation(s);c=transpose(c,p)}return c},a,null,Cumsum,s)}var cumsum=op({cumsum_:cumsum_});function depthToSpace_(e,t,r){void 0===r&&(r="NHWC");var n=convertToTensor(e,"x","depthToSpace"),o="NHWC"===r?n.shape[1]:n.shape[2],a="NHWC"===r?n.shape[2]:n.shape[3],s="NHWC"===r?n.shape[3]:n.shape[1];assert(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n    "+o+" and "+t+"  for depthToSpace with input shape\n    "+n.shape}),assert(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n    "+a+" and "+t+" for depthToSpace with input shape\n        "+n.shape}),assert(s%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+s+" for depthToSpace with input shape "+n.shape});var i={x:n},u={blockSize:t,dataFormat:r};return ENGINE.runKernelFunc(function(e){return e.depthToSpace(n,t,r)},i,null,DepthToSpace,u)}var depthToSpace=op({depthToSpace_:depthToSpace_});function depthwiseConv2d_(e,t,r,n,o,a,s){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var i=convertToTensor(e,"x","depthwiseConv2d"),u=convertToTensor(t,"filter","depthwiseConv2d"),c=i,p=!1;3===i.rank&&(p=!0,c=reshape(i,[1,i.shape[0],i.shape[1],i.shape[2]])),assert(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),assert(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),assert(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null!=s&&assert(isInt(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+n+"."});var l={x:c,filter:u},d={strides:r,pad:n,dataFormat:o,dilations:a,dimRoundingMode:s},f=ENGINE.runKernelFunc(function(e,t){null==a&&(a=[1,1]),assert(eitherStridesOrDilationsAreOne(r,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+a+"'"});var o=computeConv2DInfo(c.shape,u.shape,r,a,n,s,!0),i=e.depthwiseConv2D(c,u,o);return t([c,u]),i},l,null,DepthwiseConv2dNative,d);return p?reshape(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var depthwiseConv2d=op({depthwiseConv2d_:depthwiseConv2d_});function diag_(e){var t=convertToTensor(e,"x","diag"),r={x:t};return ENGINE.runKernelFunc(function(r){var n=reshape(t,[t.size]),o=r.diag(n),a=e.shape.concat(e.shape);return reshape(o,a)},r,null,Diag)}var diag=op({diag_:diag_});function dilation2d_(e,t,r,n,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var s=convertToTensor(e,"x","dilation2d"),i=convertToTensor(t,"filter","dilation2d");assert(3===s.rank||4===s.rank,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+s.rank+"."}),assert(3===i.rank,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+i.rank+"."}),assert("NHWC"===a,function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+a});var u=s,c=!1;3===s.rank&&(u=reshape(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0);var p={x:u,filter:i},l={strides:r,pad:n,dilations:o},d=ENGINE.runKernel(Dilation2D,p,l);return c?reshape(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var dilation2d=op({dilation2d_:dilation2d_});function getBroadcastDims(e,t){for(var r=e.length,n=[],o=0;o<r;o++){var a=r-1-o,s=e[a]||1;(t[t.length-1-o]||1)>1&&1===s&&n.unshift(a)}return n}function getReductionAxes(e,t){for(var r=[],n=0;n<t.length;n++){var o=e[e.length-n-1],a=t.length-n-1,s=t[a];(null==o||1===o&&s>1)&&r.unshift(a)}return r}function assertAndGetBroadcastShape(e,t){for(var r=[],n=Math.max(e.length,t.length),o=0;o<n;o++){var a=e[e.length-o-1];null==a&&(a=1);var s=t[t.length-o-1];if(null==s&&(s=1),1===a)r.unshift(s);else if(1===s)r.unshift(a);else{if(a!==s)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");r.unshift(a)}}return r}function equal_(e,t){var r,n=convertToTensor(e,"a","equal"),o=convertToTensor(t,"b","equal");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e){return e.equal(n,o)},a,null,Equal)}var equal=op({equal_:equal_});function where_(e,t,r){var n=convertToTensor(t,"a","where"),o=convertToTensor(r,"b","where"),a=convertToTensor(e,"condition","where","bool"),s=assertAndGetBroadcastShape(n.shape,o.shape),i=broadcastTo(n,s),u=broadcastTo(o,s);1===a.rank&&assert(a.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}),1!==a.rank&&assertShapesMatch(a.shape,u.shape,"Error in where: ");var c={condition:a,t:i,e:u};return ENGINE.runKernelFunc(function(e,t){var r=e.select(a,i,u);return t([a]),r},c,null,SelectV2)}var where=op({where_:where_});function zerosLike_(e){var t=convertToTensor(e,"x","zerosLike"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.zerosLike(t)},r,null,ZerosLike)}var zerosLike=op({zerosLike_:zerosLike_});function divNoNan_(e,t){var r,n=convertToTensor(e,"a","div"),o=convertToTensor(t,"b","div");n=(r=makeTypesMatch(n,o))[0],o=r[1];var a=div(n,o),s=zerosLike(a),i=equal(o,s);return where(i,s,a)}var divNoNan=op({divNoNan_:divNoNan_});function dot_(e,t){var r=convertToTensor(e,"t1","dot"),n=convertToTensor(t,"t2","dot");assert(!(1!==r.rank&&2!==r.rank||1!==n.rank&&2!==n.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+r.rank+" and "+n.rank+"."});var o=1===r.rank?r.size:r.shape[1],a=1===n.rank?n.size:n.shape[0];if(assert(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===r.rank&&1===n.rank){var s=reshape(r,[1,-1]),i=reshape(n,[-1,1]),u=matMul(s,i);return reshape(u,[])}if(1===r.rank&&2===n.rank){s=reshape(r,[1,-1]),i=reshape(n,[n.shape[0],n.shape[1]]),u=matMul(s,i);return reshape(u,[u.size])}if(2===r.rank&&1===n.rank){i=reshape(n,[-1,1]),u=matMul(r,i);return reshape(u,[u.size])}i=reshape(n,[n.shape[0],n.shape[1]]);return u=matMul(r,i)}var dot=op({dot_:dot_});function elu_(e){var t=convertToTensor(e,"x","elu"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.elu(t);return r([n]),n},r,null,Elu)}var elu=op({elu_:elu_});function erf_(e){var t=convertToTensor(e,"x","erf");assert("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=cast(t,"float32"));var r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.erf(t);return r([t]),n},r,null,Erf)}var erf=op({erf_:erf_});function exp_(e){var t=convertToTensor(e,"x","exp"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.exp(t);return r([n]),n},r,null,Exp)}var exp=op({exp_:exp_});function expandDims_(e,t){void 0===t&&(t=0);var r=convertToTensor(e,"x","expandDims",null);assert(t<=r.rank,function(){return"Axis must be <= rank of the tensor"});var n=r.shape.slice();return t<0&&(assert(-(r.rank+1)<=t,function(){return"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"}),t=r.rank+t+1),n.splice(t,0,1),reshape(r,n)}var expandDims=op({expandDims_:expandDims_});function expm1_(e){var t=convertToTensor(e,"x","expm1"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.expm1(t);return r([t]),n},r,null,Expm1)}var expm1=op({expm1_:expm1_});function tile_(e,t){var r=convertToTensor(e,"x","tile",null);assert(r.rank===t.length,function(){return"Error in transpose: rank of input "+r.rank+" must match length of reps "+t+"."});var n=[r],o={x:r},a={reps:t};return ENGINE.runKernelFunc(function(e,n){var o=e.tile(r,t);return n([r]),o},o,null,Tile,a,n)}var tile=op({tile_:tile_});function eye_(e,t,r,n){void 0===n&&(n="float32"),null==t&&(t=e);for(var o=buffer([e,t],n),a=e<=t?e:t,s=0;s<a;++s)o.set(1,s,s);var i=reshape(o.toTensor(),[e,t]);if(null==r)return i;if(1===r.length)return tile(expandDims(i,0),[r[0],1,1]);if(2===r.length)return tile(expandDims(expandDims(i,0),0),[r[0],r[1],1,1]);if(3===r.length)return tile(expandDims(expandDims(expandDims(i,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+r.length+"D.")}var eye=op({eye_:eye_});function fill(e,t,r){var n={shape:e,value:t,dtype:r};return ENGINE.runKernelFunc(function(n){return n.fill(e,t,r)},{},null,Fill,n)}function floor_(e){var t=convertToTensor(e,"x","floor"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.floor(t)},r,null,Floor)}var floor=op({floor_:floor_}),PARALLELIZE_THRESHOLD=30;function computeOptimalWindowSize(e){return e<=PARALLELIZE_THRESHOLD?e:nearestDivisor(e,Math.floor(Math.sqrt(e)))}function segOpComputeOptimalWindowSize(e,t){var r,n=!1;for(e<=PARALLELIZE_THRESHOLD?(r=e,n=!0):r=nearestDivisor(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=nearestDivisor(e,r+1);return r}function computeOutShape$2(e,t,r){for(var n=[],o=e.length,a=0;a<o;a++)a!==t?n.push(e[a]):n.push(r);return n}function collectGatherOpShapeInfo(e,t,r){for(var n=e.shape[r],o=[],a=1,s=1,i=0;i<r;i++)o.push(e.shape[i]),a*=e.shape[i];for(i=0;i<t.rank;i++)o.push(t.shape[i]);for(i=r+1;i<e.rank;i++)o.push(e.shape[i]),s*=e.shape[i];return{batchSize:a,sliceSize:s,dimSize:n,outputShape:o}}var segment_util={__proto__:null,segOpComputeOptimalWindowSize:segOpComputeOptimalWindowSize,computeOutShape:computeOutShape$2,collectGatherOpShapeInfo:collectGatherOpShapeInfo};function gather_(e,t,r){void 0===r&&(r=0);var n=convertToTensor(e,"x","gather"),o=convertToTensor(t,"indices","gather","int32"),a={x:n,indices:o},s={axis:r};return ENGINE.runKernelFunc(function(e,t){var a=parseAxisParam(r,n.shape)[0],s=collectGatherOpShapeInfo(n,o,a),i=e.gather(n,reshape(o,[o.size]),a);return t([n,o]),reshape(i,s.outputShape)},a,null,GatherV2,s)}var gather=op({gather_:gather_});function greater_(e,t){var r,n=convertToTensor(e,"a","greater"),o=convertToTensor(t,"b","greater");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e){return e.greater(n,o)},a,null,Greater)}var greater=op({greater_:greater_});function greaterEqual_(e,t){var r,n=convertToTensor(e,"a","greaterEqual"),o=convertToTensor(t,"b","greaterEqual");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.greaterEqual(n,o);return t([n,o]),r},a,null,GreaterEqual)}var greaterEqual=op({greaterEqual_:greaterEqual_});function imag_(e){var t=convertToTensor(e,"input","imag"),r={input:t};return ENGINE.runKernelFunc(function(e){return e.imag(t)},r,null,Imag)}var imag=op({imag_:imag_});function isFinite_(e){var t=convertToTensor(e,"x","isFinite"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.isFinite(t)},r,null,IsFinite)}var isFinite$1=op({isFinite_:isFinite_});function isInf_(e){var t=convertToTensor(e,"x","isInf"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.isInf(t)},r,null,IsInf)}var isInf=op({isInf_:isInf_});function isNaN_(e){var t=convertToTensor(e,"x","isNaN"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.isNaN(t)},r,null,IsNan)}var isNaN$1=op({isNaN_:isNaN_});function maximum_(e,t){var r,n=convertToTensor(e,"a","maximum"),o=convertToTensor(t,"b","maximum");r=makeTypesMatch(n,o),n=r[0],o=r[1],"bool"===n.dtype&&(n=cast(n,"int32"),o=cast(o,"int32")),assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.maximum(n,o);return t([n,o]),r},a,null,Maximum)}var maximum=op({maximum_:maximum_});function scalar(e,t){if((isTypedArray(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&isTypedArray(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return makeTensor(e,[],[],t)}function leakyRelu_(e,t){void 0===t&&(t=.2);var r=convertToTensor(e,"x","leakyRelu");return maximum(mul(scalar(t),r),r)}var leakyRelu=op({leakyRelu_:leakyRelu_});function less_(e,t){var r,n=convertToTensor(e,"a","less"),o=convertToTensor(t,"b","less");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e){return e.less(n,o)},a,null,Less)}var less=op({less_:less_});function lessEqual_(e,t){var r,n=convertToTensor(e,"a","lessEqual"),o=convertToTensor(t,"b","lessEqual");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.lessEqual(n,o);return t([n,o]),r},a,null,LessEqual)}var lessEqual=op({lessEqual_:lessEqual_});function linspace(e,t,r){if(r<=0)throw new Error("The number of values should be positive.");var n={start:e,stop:t,num:r};return ENGINE.runKernelFunc(function(n){return n.linspace(e,t,r)},{},null,LinSpace,n)}function localResponseNormalization_(e,t,r,n,o){void 0===t&&(t=5),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=.5);var a=convertToTensor(e,"x","localResponseNormalization");assert(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),assert(isInt(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var s=a,i=!1;3===a.rank&&(i=!0,s=reshape(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var u={x:s},c={depthRadius:t,bias:r,alpha:n,beta:o},p=ENGINE.runKernelFunc(function(e,a){var i=e.localResponseNormalization4D(s,t,r,n,o);return a([s,i]),i},u,null,LRN,c);return i?reshape(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var localResponseNormalization=op({localResponseNormalization_:localResponseNormalization_});function log_(e){var t=convertToTensor(e,"x","log"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.log(t);return r([t]),n},r,null,Log)}var log=op({log_:log_});function log1p_(e){var t=convertToTensor(e,"x","log1p"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.log1p(t);return r([t]),n},r,null,Log1p)}var log1p=op({log1p_:log1p_});function grad(e){return assert(isFunction(e),function(){return"The f passed in grad(f) must be a function"}),function(t,r){var n=convertToTensor(t,"x","tf.grad",null),o=null!=r?convertToTensor(r,"dy","tf.grad"):null;return ENGINE.tidy(function(){var t=ENGINE.gradients(function(){return e(n)},[n],o),r=t.value,a=t.grads;return null!=o&&assertShapesMatch(r.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),checkGrads(a),a[0]})}}function grads(e){return assert(isFunction(e),function(){return"The f passed in grads(f) must be a function"}),function(t,r){assert(Array.isArray(t),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=convertToTensorArray(t,"args","tf.grads",null),o=null!=r?convertToTensor(r,"dy","tf.grads"):null;return ENGINE.tidy(function(){var t=ENGINE.gradients(function(){return e.apply(void 0,n)},n,o),r=t.value,a=t.grads;return null!=o&&assertShapesMatch(r.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(a),a})}}function valueAndGrad(e){return assert(isFunction(e),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(t,r){assert(t instanceof Tensor,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),assert(null==r||r instanceof Tensor,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=ENGINE.gradients(function(){return e(t)},[t],r),o=n.grads,a=n.value;return checkGrads(o),{grad:o[0],value:a}}}function valueAndGrads(e){return assert(isFunction(e),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(t,r){assert(Array.isArray(t)&&t.every(function(e){return e instanceof Tensor}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),assert(null==r||r instanceof Tensor,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=ENGINE.gradients(function(){return e.apply(void 0,t)},t,r);return null!=r&&assertShapesMatch(n.value.shape,r.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(n.grads),n}}function variableGrads(e,t){assert(isFunction(e),function(){return"The f passed in variableGrads(f) must be a function"}),assert(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof Variable}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var r=null!=t;if(!r)for(var n in t=[],ENGINE.registeredVariables)t.push(ENGINE.registeredVariables[n]);var o=r?t.filter(function(e){return!e.trainable}):null,a=t.length;assert((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var s=ENGINE.gradients(e,t,null,!0),i=s.value,u=s.grads;assert(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),assert(0===i.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+i.rank+" tensor"});var c={};return t.forEach(function(e,t){null!=u[t]&&(c[e.name]=u[t])}),null!=o&&o.forEach(function(e){return c[e.name]=null}),{value:i,grads:c}}function customGrad(e){return ENGINE.customGrad(e)}function checkGrads(e){if(e.filter(function(e){return null==e}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function neg_(e){var t=convertToTensor(e,"x","neg"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.neg(t)},r,null,Negate)}var neg=op({neg_:neg_});function softplus_(e){var t=convertToTensor(e,"x","softplus"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.softplus(t);return r([t]),n},r,null,Softplus)}var softplus=op({softplus_:softplus_});function logSigmoid_(e){var t=convertToTensor(e,"x","logSigmoid");return customGrad(function(e){return{value:neg(softplus(neg(e))),gradFunc:function(t){return mul(t,sigmoid(neg(e)))}}})(t)}var logSigmoid=op({logSigmoid_:logSigmoid_});function max_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","max"),o={x:n},a={reductionIndices:t,keepDims:r};return ENGINE.runKernelFunc(function(e,o){var a=parseAxisParam(t,n.shape),s=getAxesPermutation(a,n.rank),i=n;null!=s&&(i=transpose(n,s),a=getInnerMostAxes(a.length,i.rank));var u=e.max(i,a);null!=s&&i.dispose();var c=u;if(r){var p=expandShapeToKeepDim(c.shape,parseAxisParam(t,n.shape));c=reshape(c,p),u.dispose()}return o([n,c]),c},o,null,Max,a)}var max=op({max_:max_});function sub_(e,t){var r,n=convertToTensor(e,"a","sub"),o=convertToTensor(t,"b","sub");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.subtract(n,o);return t([n,o]),r},a,null,Sub)}var sub=op({sub_:sub_});function sum_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","sum");"bool"===n.dtype&&(n=cast(n,"int32"));var o={x:n},a={axis:t,keepDims:r};return ENGINE.runKernelFunc(function(e,o){o([n]);var a=parseAxisParam(t,n.shape),s=getAxesPermutation(a,n.rank),i=a,u=n;null!=s&&(u=transpose(n,s),i=getInnerMostAxes(i.length,n.rank));var c=e.sum(u,i);if(r){var p=expandShapeToKeepDim(c.shape,a);c=reshape(c,p)}return c},o,null,Sum,a)}var sum$1=op({sum_:sum_});function logSoftmax_(e,t){void 0===t&&(t=-1);var r=convertToTensor(e,"logits","logSoftmax");if(-1===t&&(t=r.rank-1),t!==r.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and axis was "+t);var n={logits:r},o={axis:t};return ENGINE.runKernelFunc(function(r,n){var o=max(e,t,!0),a=sub(e,o),s=sub(cast(a,"float32"),log(sum$1(exp(a),t,!0)));return n([s]),s},n,null,LogSoftmax,o)}var logSoftmax=op({logSoftmax_:logSoftmax_});function logSumExp_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","logSumExp"),o=parseAxisParam(t,n.shape),a=max(n,o,!0),s=sub(n,a),i=exp(s),u=sum$1(i,o),c=log(u),p=add$1(reshape(a,c.shape),c);if(r){var l=expandShapeToKeepDim(p.shape,o);return reshape(p,l)}return p}var logSumExp=op({logSumExp_:logSumExp_});function logicalAnd_(e,t){var r=convertToTensor(e,"a","logicalAnd","bool"),n=convertToTensor(t,"b","logicalAnd","bool");assertAndGetBroadcastShape(r.shape,n.shape);var o={a:r,b:n};return ENGINE.runKernelFunc(function(e){return e.logicalAnd(r,n)},o,null,LogicalAnd)}var logicalAnd=op({logicalAnd_:logicalAnd_});function logicalNot_(e){var t=convertToTensor(e,"x","logicalNot","bool"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.logicalNot(t)},r,null,LogicalNot)}var logicalNot=op({logicalNot_:logicalNot_});function logicalOr_(e,t){var r=convertToTensor(e,"a","logicalOr","bool"),n=convertToTensor(t,"b","logicalOr","bool");assertAndGetBroadcastShape(r.shape,n.shape);var o={a:r,b:n};return ENGINE.runKernelFunc(function(e){return e.logicalOr(r,n)},o,null,LogicalOr)}var logicalOr=op({logicalOr_:logicalOr_});function logicalXor_(e,t){var r=convertToTensor(e,"a","logicalXor","bool"),n=convertToTensor(t,"b","logicalXor","bool");return assertAndGetBroadcastShape(r.shape,n.shape),logicalAnd(logicalOr(e,t),logicalNot(logicalAnd(e,t)))}var logicalXor=op({logicalXor_:logicalXor_});function maxPool_(e,t,r,n,o){var a=convertToTensor(e,"x","maxPool"),s=a,i=!1;3===a.rank&&(i=!0,s=reshape(a,[1,a.shape[0],a.shape[1],a.shape[2]])),assert(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),assert(eitherStridesOrDilationsAreOne(r,1),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+r+" and dilations '1'"}),null!=o&&assert(isInt(n),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var u={x:s},c={filterSize:t,strides:r,pad:n,dimRoundingMode:o},p=ENGINE.runKernelFunc(function(e,a){var i,u=computePool2DInfo(s.shape,t,r,1,n,o);return i=1===u.filterWidth&&1===u.filterHeight&&arraysEqual(u.inShape,u.outShape)?s.clone():e.maxPool(s,u),a([s,i]),i},u,null,MaxPool,c);return i?reshape(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var maxPool=op({maxPool_:maxPool_});function maxPool3d_(e,t,r,n,o,a,s){void 0===t&&(t=[1,1,1]),void 0===a&&(a="NDHWC"),null==s?s=[1,1,1]:deprecationWarn("dilations is deprecated, this field will be gone in v3.0.0.");var i=convertToTensor(e,"x","maxPool3d"),u=i,c=!1;4===i.rank&&(c=!0,u=reshape(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),assert(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),assert("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),assert(eitherStridesOrDilationsAreOne(r,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+s+"'"}),null!=o&&assert(isInt(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var p={x:u},l={filterSize:t,strides:r,pad:n,dimRoundingMode:o,dataFormat:a,dilations:s},d=ENGINE.runKernelFunc(function(e,i){null==s&&(s=[1,1,1]);var c=computePool3DInfo(u.shape,t,r,s,n,o,a),p=e.maxPool3d(u,c);return i([u,p]),p},p,null,MaxPool3D,l);return c?reshape(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var maxPool3d=op({maxPool3d_:maxPool3d_});function maxPoolWithArgmax_(e,t,r,n,o){void 0===o&&(o=!1);var a={x:convertToTensor(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:r,pad:n,includeBatchInIndex:o},i=ENGINE.runKernel(MaxPoolWithArgmax,a,s);return{result:i[0],indexes:i[1]}}var maxPoolWithArgmax=op({maxPoolWithArgmax_:maxPoolWithArgmax_});function zeros(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var r=zeros(e,"float32"),n=zeros(e,"float32");return complex(r,n)}var o=makeZerosTypedArray(sizeFromShape(e),t);return ENGINE.makeTensor(o,e,t)}function ones$1(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var r=ones$1(e,"float32"),n=zeros(e,"float32");return complex(r,n)}var o=makeOnesTypedArray(sizeFromShape(e),t);return ENGINE.makeTensor(o,e,t)}function mean_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","mean"),o=parseAxisParam(t,n.shape),a=sizeFromShape(computeOutAndReduceShapes(n.shape,o)[1]);return customGrad(function(e){var n=scalar(a),s=n.dtype===e.dtype?e:cast(e,n.dtype),i=div(s,n);return{value:sum$1(i,t,r),gradFunc:function(t){var r=e.shape.slice();o.forEach(function(e){r[e]=1});var n=reshape(t,r);return div(mul(n,ones$1(e.shape,"float32")),a)}}})(n)}var mean=op({mean_:mean_});function min_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","min"),o={x:n},a={axis:t,keepDims:r};return ENGINE.runKernelFunc(function(e,o){var a=parseAxisParam(t,n.shape),s=a,i=getAxesPermutation(s,n.rank),u=n;null!=i&&(u=transpose(n,i),s=getInnerMostAxes(s.length,n.rank));var c=e.min(u,s);null!=i&&u.dispose();var p=c;if(r){var l=expandShapeToKeepDim(p.shape,a);p=reshape(c,l),c.dispose()}return o([n,p]),p},o,null,Min,a)}var min=op({min_:min_});function minimum_(e,t){var r,n=convertToTensor(e,"a","minimum"),o=convertToTensor(t,"b","minimum");r=makeTypesMatch(n,o),n=r[0],o=r[1],"bool"===n.dtype&&(n=cast(n,"int32"),o=cast(o,"int32")),assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.minimum(n,o);return t([n,o]),r},a,null,Minimum)}var minimum=op({minimum_:minimum_});function mod_(e,t){var r,n=convertToTensor(e,"a","mod"),o=convertToTensor(t,"b","mod");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.mod(n,o);return t([n,o]),r},a,null,Mod)}var mod=op({mod_:mod_});function square_(e){var t=convertToTensor(e,"x","square"),r=[t];return ENGINE.runKernelFunc(function(e,r){return r([t]),e.square(t)},{x:t},null,"Square",{},r,[])}var square=op({square_:square_});function moments_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=parseAxisParam(t,(e=convertToTensor(e,"x","moments")).shape),o=mean(e,n,r),a=o.shape;r||(a=expandShapeToKeepDim(o.shape,n));var s=square(sub(cast(e,"float32"),reshape(o,a)));return{mean:o,variance:mean(s,n,r)}}var moments=op({moments_:moments_});function multiRNNCell_(e,t,r,n){for(var o=convertToTensor(t,"data","multiRNNCell"),a=convertToTensorArray(r,"c","multiRNNCell"),s=convertToTensorArray(n,"h","multiRNNCell"),i=o,u=[],c=0;c<e.length;c++){var p=e[c](i,a[c],s[c]);u.push(p[0]),u.push(p[1]),i=p[1]}var l=[],d=[];for(c=0;c<u.length;c+=2)l.push(u[c]),d.push(u[c+1]);return[l,d]}var multiRNNCell=op({multiRNNCell_:multiRNNCell_});function multinomial_(e,t,r,n){void 0===n&&(n=!1);var o=convertToTensor(e,"logits","multinomial"),a=o.size,s=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);r=r||Math.random();var i=1===s?reshape(o,[1,-1]):o,u=ENGINE.runKernelFunc(function(e){return e.multinomial(i,n,t,r)},{logits2D:i});return 1===s?reshape(u,[u.size]):u}var multinomial=op({multinomial_:multinomial_});function notEqual_(e,t){var r,n=convertToTensor(e,"a","notEqual"),o=convertToTensor(t,"b","notEqual");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e){return e.notEqual(n,o)},a,null,NotEqual)}var notEqual=op({notEqual_:notEqual_});function real_(e){var t=convertToTensor(e,"input","real"),r={input:t};return ENGINE.runKernelFunc(function(e){return e.real(t)},r,null,Real)}var real=op({real_:real_});function onesLike_(e){var t=convertToTensor(e,"x","onesLike"),r={x:t};return ENGINE.runKernelFunc(function(e,r){if("complex64"===t.dtype){var n=onesLike(real(t)),o=zerosLike(imag(t));return complex(n,o)}return e.onesLike(t)},r,null,OnesLike)}var onesLike=op({onesLike_:onesLike_});function outerProduct_(e,t){var r=convertToTensor(e,"v1","outerProduct"),n=convertToTensor(t,"v2","outerProduct");assert(1===r.rank&&1===n.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+r.rank+" and "+n.rank+"."});var o=reshape(r,[-1,1]),a=reshape(n,[1,-1]);return matMul(o,a)}var outerProduct=op({outerProduct_:outerProduct_});function pad_(e,t,r){void 0===r&&(r=0);var n=convertToTensor(e,"x","pad");if(0===n.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:r},a={x:n};return ENGINE.runKernelFunc(function(e,o){return o([n]),e.pad(n,t,r)},a,null,PadV2,o)}var pad=op({pad_:pad_});function pad1d_(e,t,r){return void 0===r&&(r=0),assert(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),pad(e,[t],r)}var pad1d=op({pad1d_:pad1d_});function pad2d_(e,t,r){return void 0===r&&(r=0),assert(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),pad(e,t,r)}var pad2d=op({pad2d_:pad2d_});function pad3d_(e,t,r){return void 0===r&&(r=0),assert(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),pad(e,t,r)}var pad3d=op({pad3d_:pad3d_});function pad4d_(e,t,r){return void 0===r&&(r=0),assert(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),pad(e,t,r)}var pad4d=op({pad4d_:pad4d_});function spaceToBatchND_(e,t,r){var n=convertToTensor(e,"x","spaceToBatchND");assert(n.rank>=1+t.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+t.length}),assert(r.length===t.length,function(){return"paddings.shape[0] "+r.length+" must be equal to [blockShape] "+t.length}),assert(n.shape.reduce(function(e,n,o){return o>0&&o<=t.length?e&&(n+r[o-1][0]+r[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+r.toString()+" must be divisible by blockShapes "+t.toString()});var o={x:n},a={blockShape:t,paddings:r};return ENGINE.runKernelFunc(function(e){return e.spaceToBatchND(n,t,r)},o,null,SpaceToBatchND,a)}var spaceToBatchND=op({spaceToBatchND_:spaceToBatchND_});function pool_(e,t,r,n,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===n&&(n="valid");var s=convertToTensor(e,"x","maxPool"),i=s,u=!1;3===s.rank&&(u=!0,i=reshape(s,[1,s.shape[0],s.shape[1],s.shape[2]])),assert(eitherStridesOrDilationsAreOne(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var c,p=computePool2DInfo(i.shape,t,a,o,n),l=[p.dilationHeight,p.dilationWidth];c="same"===n?withSpaceToBatchBasePaddings([p.filterHeight,p.filterWidth],l):[[0,0],[0,0]];var d=1===l[0]&&1===l[1],f=requiredSpaceToBatchPaddings([p.inHeight,p.inWidth],l,c),h=f[0],m=f[1],v=d?n:"valid",g=d?i:spaceToBatchND(i,l,h),y=("avg"===r?function(){return avgPool(g,t,a,v)}:function(){return maxPool(g,t,a,v)})(),x=d?y:batchToSpaceND(y,l,m);return u?reshape(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function requiredSpaceToBatchPaddings(e,t,r){var n=r.map(function(e){return e[0]}),o=r.map(function(e){return e[1]}),a=e.concat(n,o),s=t.map(function(e,t){return(e-a[t]%e)%e}),i=o.map(function(e,t){return e+s[t]});return[t.map(function(e,t){return[n[t],i[t]]}),t.map(function(e,t){return[0,s[t]]})]}function withSpaceToBatchBasePaddings(e,t){var r=e.map(function(e,r){return e+(e-1)*(t[r]-1)}).map(function(e){return e-1}),n=r.map(function(e){return Math.floor(e/2)}),o=r.map(function(e,t){return e-n[t]});return r.map(function(e,t){return[n[t],o[t]]})}var pool=op({pool_:pool_});function pow_(e,t){var r,n=convertToTensor(e,"base","pow"),o=convertToTensor(t,"exp","pow");r=makeTypesMatch(n,o),n=r[0],o=r[1];var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.pow(n,o);return t([n,o,r]),r},a,null,Pow)}var pow=op({pow_:pow_});function prelu_(e,t){var r=convertToTensor(e,"x","prelu"),n=convertToTensor(t,"alpha","prelu"),o={x:r,alpha:n};return ENGINE.runKernelFunc(function(e,t){var o=e.prelu(r,n);return t([r,n]),o},o,null,Prelu)}var prelu=op({prelu_:prelu_});function prod_(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=convertToTensor(e,"x","prod"),o={x:n},a={axis:t,keepDims:r};return ENGINE.runKernelFunc(function(e){"bool"===n.dtype&&(n=cast(n,"int32"));var o=parseAxisParam(t,n.shape),a=getAxesPermutation(o,n.rank),s=o,i=n;null!=a&&(i=transpose(n,a),s=getInnerMostAxes(s.length,n.rank));var u=e.prod(i,s);if(r){var c=expandShapeToKeepDim(u.shape,o);u=reshape(u,c)}return u},o,null,Prod,a)}var prod=op({prod_:prod_});function rand_(e,t,r){var n=sizeFromShape(e),o=null;if(null==r||"float32"===r)o=new Float32Array(n);else if("int32"===r)o=new Int32Array(n);else{if("bool"!==r)throw new Error("Unknown data type "+r);o=new Uint8Array(n)}for(var a=0;a<n;a++)o[a]=t();return ENGINE.makeTensor(o,e,r)}var rand=op({rand_:rand_}),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var alea=createCommonjsModule(function(e){!function(e,t,r){function n(e){var t,r=this,n=(t=4022871197,function(e){e=e.toString();for(var r=0;r<e.length;r++){var n=.02519603282416938*(t+=e.charCodeAt(r));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)});r.next=function(){var e=2091639*r.s0+2.3283064365386963e-10*r.c;return r.s0=r.s1,r.s1=r.s2,r.s2=e-(r.c=0|e)},r.c=1,r.s0=n(" "),r.s1=n(" "),r.s2=n(" "),r.s0-=n(e),r.s0<0&&(r.s0+=1),r.s1-=n(e),r.s1<0&&(r.s1+=1),r.s2-=n(e),r.s2<0&&(r.s2+=1),n=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var r=new n(e),a=t&&t.state,s=r.next;return s.int32=function(){return 4294967296*r.next()|0},s.double=function(){return s()+1.1102230246251565e-16*(2097152*s()|0)},s.quick=s,a&&("object"==typeof a&&o(a,r),s.state=function(){return o(r,{})}),s}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.alea=a}(0,e,!1)}),xor128=createCommonjsModule(function(e){!function(e,t,r){function n(e){var t=this,r="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:r+=e;for(var n=0;n<r.length+64;n++)t.x^=0|r.charCodeAt(n),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var r=new n(e),a=t&&t.state,s=function(){return(r.next()>>>0)/4294967296};return s.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=r.next,s.quick=s,a&&("object"==typeof a&&o(a,r),s.state=function(){return o(r,{})}),s}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xor128=a}(0,e,!1)}),xorwow=createCommonjsModule(function(e){!function(e,t,r){function n(e){var t=this,r="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:r+=e;for(var n=0;n<r.length+64;n++)t.x^=0|r.charCodeAt(n),n==r.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var r=new n(e),a=t&&t.state,s=function(){return(r.next()>>>0)/4294967296};return s.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=r.next,s.quick=s,a&&("object"==typeof a&&o(a,r),s.state=function(){return o(r,{})}),s}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xorwow=a}(0,e,!1)}),xorshift7=createCommonjsModule(function(e){!function(e,t,r){function n(e){var t=this;t.next=function(){var e,r,n=t.x,o=t.i;return e=n[o],r=(e^=e>>>7)^e<<24,r^=(e=n[o+1&7])^e>>>10,r^=(e=n[o+3&7])^e>>>3,r^=(e=n[o+4&7])^e<<7,e=n[o+7&7],r^=(e^=e<<13)^e<<9,n[o]=r,t.i=o+1&7,r},function(e,t){var r,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,r=0;r<t.length;++r)n[7&r]=n[7&r]<<15^t.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r?n[7]=-1:n[r],e.x=n,e.i=0,r=256;r>0;--r)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var r=new n(e),a=t&&t.state,s=function(){return(r.next()>>>0)/4294967296};return s.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=r.next,s.quick=s,a&&(a.x&&o(a,r),s.state=function(){return o(r,{})}),s}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xorshift7=a}(0,e,!1)}),xor4096=createCommonjsModule(function(e){!function(e,t,r){function n(e){var t=this;t.next=function(){var e,r,n=t.w,o=t.X,a=t.i;return t.w=n=n+1640531527|0,r=o[a+34&127],e=o[a=a+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,r=o[a]=r^e,t.i=a,r+(n^n>>>16)|0},function(e,t){var r,n,o,a,s,i=[],u=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(n^=t.charCodeAt((a+32)%t.length)),0===a&&(s=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,a>=0&&(s=s+1640531527|0,o=0==(r=i[127&a]^=n+s)?o+1:0);for(o>=128&&(i[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)n=i[o+34&127],r=i[o=o+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,i[o]=n^r;e.w=s,e.X=i,e.i=o}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var r=new n(e),a=t&&t.state,s=function(){return(r.next()>>>0)/4294967296};return s.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=r.next,s.quick=s,a&&(a.X&&o(a,r),s.state=function(){return o(r,{})}),s}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.xor4096=a}(0,e,!1)}),tychei=createCommonjsModule(function(e){!function(e,t,r){function n(e){var t=this,r="";t.next=function(){var e=t.b,r=t.c,n=t.d,o=t.a;return e=e<<25^e>>>7^r,r=r-n|0,n=n<<24^n>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^r,t.c=r=r-n|0,t.d=n<<16^r>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):r+=e;for(var n=0;n<r.length+20;n++)t.b^=0|r.charCodeAt(n),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var r=new n(e),a=t&&t.state,s=function(){return(r.next()>>>0)/4294967296};return s.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=r.next,s.quick=s,a&&("object"==typeof a&&o(a,r),s.state=function(){return o(r,{})}),s}t&&t.exports?t.exports=a:r&&r.amd?r(function(){return a}):this.tychei=a}(0,e,!1)}),seedrandom=createCommonjsModule(function(e){!function(t,r){var n,o=this,a=256,s=6,i="random",u=r.pow(a,s),c=r.pow(2,52),p=2*c,l=a-1;function d(e,l,d){var g=[],y=m(function e(t,r){var n,o=[],a=typeof t;if(r&&"object"==a)for(n in t)try{o.push(e(t[n],r-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return n&&(e=n.randomBytes)?e=e(a):(e=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(e)),v(e)}catch(e){var r=o.navigator,s=r&&r.plugins;return[+new Date,o,s,o.screen,v(t)]}}():e,3),g),x=new f(g),b=function(){for(var e=x.g(s),t=u,r=0;e<c;)e=(e+r)*a,t*=a,r=x.g(1);for(;e>=p;)e/=2,t/=2,r>>>=1;return(e+r)/t};return b.int32=function(){return 0|x.g(4)},b.quick=function(){return x.g(4)/4294967296},b.double=b,m(v(x.S),t),(l.pass||d||function(e,t,n,o){return o&&(o.S&&h(o,x),e.state=function(){return h(x,{})}),n?(r[i]=e,t):e})(b,y,"global"in l?l.global:this==r,l.state)}function f(e){var t,r=e.length,n=this,o=0,s=n.i=n.j=0,i=n.S=[];for(r||(e=[r++]);o<a;)i[o]=o++;for(o=0;o<a;o++)i[o]=i[s=l&s+e[o%r]+(t=i[o])],i[s]=t;(n.g=function(e){for(var t,r=0,o=n.i,s=n.j,i=n.S;e--;)t=i[o=l&o+1],r=r*a+i[l&(i[o]=i[s=l&s+t])+(i[s]=t)];return n.i=o,n.j=s,r})(a)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var r,n=e+"",o=0;o<n.length;)t[l&o]=l&(r^=19*t[l&o])+n.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+i]=d,m(r.random(),t),e.exports){e.exports=d;try{n=require("crypto")}catch(e){}}}([],Math)});seedrandom.alea=alea,seedrandom.xor128=xor128,seedrandom.xorwow=xorwow,seedrandom.xorshift7=xorshift7,seedrandom.xor4096=xor4096,seedrandom.tychei=tychei;var seedrandom$1=seedrandom,seedrandom_1=seedrandom$1.alea,MPRandGauss=function(){function e(e,t,r,n,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=n,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=seedrandom_1(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,n=!1;!n;){var o=void 0,a=void 0,s=void 0;do{s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(s>=1||0===s);var i=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*i,r=this.mean+this.stdDev*a*i,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),RandGamma=function(){function e(e,t,r,n){this.alpha=e,this.beta=1/t,this.dtype=r;var o=n||Math.random();this.randu=seedrandom_1(o.toString()),this.randn=new MPRandGauss(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,r,n,o,a;;){do{n=this.randn.nextValue(),a=1+this.c*n}while(a<=0);if(a*=a*a,t=1-.331*(e=n*n)*e,r=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),UniformRandom=function(){function e(e,t,r,n){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=r,null==n&&(n=Math.random()),"number"==typeof n&&(n=n.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=seedrandom_1(n)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function randomGamma_(e,t,r,n,o){if(void 0===r&&(r=1),void 0===n&&(n="float32"),null==r&&(r=1),null==n&&(n="float32"),"float32"!==n&&"int32"!==n)throw new Error("Unsupported data type "+n);for(var a=new RandGamma(t,r,n,o),s=buffer(e,n),i=0;i<s.values.length;i++)s.values[i]=a.nextValue();return s.toTensor()}var randomGamma=op({randomGamma_:randomGamma_});function randomNormal_(e,t,r,n,o){if(void 0===t&&(t=0),void 0===r&&(r=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var a=new MPRandGauss(t,r,n,!1,o),s=buffer(e,n),i=0;i<s.values.length;i++)s.values[i]=a.nextValue();return s.toTensor()}var randomNormal=op({randomNormal_:randomNormal_});function randomUniform_(e,t,r,n,o){void 0===t&&(t=0),void 0===r&&(r=1),void 0===n&&(n="float32");for(var a=buffer(e,n),s=new UniformRandom(t,r,null,o),i=0;i<a.values.length;i++)a.values[i]=s.nextValue();return a.toTensor()}var randomUniform=op({randomUniform_:randomUniform_});function tensor1d(e,t){assertNonNull(e);var r=inferShape(e,t);if(1!==r.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return makeTensor(e,null,r,t)}function range(e,t,r,n){if(void 0===r&&(r=1),void 0===n&&(n="float32"),0===r)throw new Error("Cannot have a step of zero");var o={start:e,stop:t,step:r,dtype:n};return ENGINE.runKernelFunc(function(){if(e===t||e<t&&r<0||t<e&&r>1)return zeros([0],n);var o=makeZerosTypedArray(Math.abs(Math.ceil((t-e)/r)),n);t<e&&1===r&&(r=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return tensor1d(o,n)},{},null,Range,o)}function reciprocal_(e){var t=convertToTensor(e,"x","reciprocal"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.reciprocal(t);return r([t]),n},r,null,Reciprocal)}var reciprocal=op({reciprocal_:reciprocal_});function relu_(e){var t=convertToTensor(e,"x","relu"),r={x:t};return ENGINE.runKernelFunc(function(e,r){return r([t]),"bool"===t.dtype?cast(t,"int32"):e.relu(t)},r,null,Relu)}var relu=op({relu_:relu_});function relu6_(e){var t=convertToTensor(e,"x","relu6"),r={x:t};return ENGINE.runKernelFunc(function(e,r){return r([t]),"bool"===t.dtype?cast(t,"int32"):e.relu6(t)},r,null,Relu6)}var relu6=op({relu6_:relu6_});function reverse_(e,t){var r=convertToTensor(e,"x","reverse"),n={x:r},o={dims:t};return ENGINE.runKernelFunc(function(e){var n=parseAxisParam(t,r.shape);if(0===r.rank)return clone(r);var o=e.reverse(r,n);return reshape(o,r.shape)},n,null,Reverse,o)}var reverse=op({reverse_:reverse_});function reverse1d_(e){var t=convertToTensor(e,"x","reverse");return assert(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),reverse(t,0)}var reverse1d=op({reverse1d_:reverse1d_});function reverse2d_(e,t){var r=convertToTensor(e,"x","reverse");return assert(2===r.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+r.rank+"."}),reverse(r,t)}var reverse2d=op({reverse2d_:reverse2d_});function reverse3d_(e,t){var r=convertToTensor(e,"x","reverse");return assert(3===r.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+r.rank+"."}),reverse(r,t)}var reverse3d=op({reverse3d_:reverse3d_});function reverse4d_(e,t){var r=convertToTensor(e,"x","reverse");return assert(4===r.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+r.rank+"."}),reverse(r,t)}var reverse4d=op({reverse4d_:reverse4d_});function round_(e){var t=convertToTensor(e,"x","round"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.round(t)},r,null,Round)}var round=op({round_:round_});function rsqrt_(e){var t=convertToTensor(e,"x","rsqrt"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.rsqrt(t);return r([t]),n},r,null,Rsqrt)}var rsqrt=op({rsqrt_:rsqrt_});function selu_(e){var t=convertToTensor(e,"x","selu"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.selu(t);return r([t]),n},r,null,Selu)}var selu=op({selu_:selu_});function separableConv2d_(e,t,r,n,o,a,s){void 0===a&&(a=[1,1]),void 0===s&&(s="NHWC");var i=convertToTensor(e,"x","separableConv2d"),u=convertToTensor(t,"depthwiseFilter","separableConv2d"),c=convertToTensor(r,"pointwiseFilter","separableConv2d"),p=i,l=!1;if(3===i.rank&&(l=!0,p=reshape(i,[1,i.shape[0],i.shape[1],i.shape[2]])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");assert(4===p.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+p.rank+"."}),assert(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),assert(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),assert(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),assert(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],f=u.shape[3];assert(c.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+c.shape[2]+"."});var h=depthwiseConv2d(p,u,n,o,s,a),m=conv2d(h,c,1,"valid",s);return l?reshape(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var separableConv2d=op({separableConv2d_:separableConv2d_});function setdiff1dAsync_(e,t){return __awaiter(this,void 0,void 0,function(){var r,n,o,a,s,i,u,c,p,l;return __generator(this,function(d){switch(d.label){case 0:return r=convertToTensor(e,"x","setdiff1d"),n=convertToTensor(t,"y","setdiff1d"),assert(r.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+r.dtype+") and y ("+n.dtype+")."}),assert(1===r.rank,function(){return"x should be 1D tensor, but got x ("+r.shape+")."}),assert(1===n.rank,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,r.data()];case 1:return o=d.sent(),[4,n.data()];case 2:for(a=d.sent(),s=new Set(a),i=0,p=0;p<o.length;p++)s.has(o[p])||i++;for(u=new TensorBuffer([i],r.dtype),c=new TensorBuffer([i],"int32"),p=0,l=0;p<o.length;p++)s.has(o[p])||(u.values[l]=o[p],c.values[l]=p,l++);return[2,[u.toTensor(),c.toTensor()]]}})})}var setdiff1dAsync=setdiff1dAsync_;function sign_(e){var t=convertToTensor(e,"x","sign"),r={x:t};return ENGINE.runKernelFunc(function(e){return e.sign(t)},r,null,Sign)}var sign=op({sign_:sign_});function sin_(e){var t=convertToTensor(e,"x","sin"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.sin(t);return r([t]),n},r,null,Sin)}var sin=op({sin_:sin_});function sinh_(e){var t=convertToTensor(e,"x","sinh"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.sinh(t);return r([t]),n},r,null,Sinh)}var sinh=op({sinh_:sinh_});function slice1d_(e,t,r){var n=convertToTensor(e,"x","slice1d");return assert(1===n.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),slice(n,[t],[r])}var slice1d=op({slice1d_:slice1d_});function slice2d_(e,t,r){var n=convertToTensor(e,"x","slice2d");return assert(2===n.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),slice(n,t,r)}var slice2d=op({slice2d_:slice2d_});function slice3d_(e,t,r){var n=convertToTensor(e,"x","slice3d");return assert(3===n.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),slice(n,t,r)}var slice3d=op({slice3d_:slice3d_});function slice4d_(e,t,r){var n=convertToTensor(e,"x","slice4d");return assert(4===n.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),slice(n,t,r)}var slice4d=op({slice4d_:slice4d_});function softmax_(e,t){void 0===t&&(t=-1);var r=convertToTensor(e,"logits","softmax","float32");if(-1===t&&(t=r.rank-1),t!==r.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+r.rank+" and dim was "+t);var n={logits:r},o={dim:t};return ENGINE.runKernelFunc(function(e,n){var o=e.softmax(r,t);return n([o]),o},n,null,Softmax,o)}var softmax=op({softmax_:softmax_});function fft_(e){assert("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t={input:e};return ENGINE.runKernelFunc(function(t){var r=e.shape[e.shape.length-1],n=e.size/r,o=e.as2D(n,r);return t.fft(o).reshape(e.shape)},t,null,FFT)}var fft=op({fft_:fft_});function ifft_(e){assert("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t={input:e};return ENGINE.runKernelFunc(function(t){var r=e.shape[e.shape.length-1],n=e.size/r,o=reshape(e,[n,r]),a=t.ifft(o);return reshape(a,e.shape)},t,null,IFFT)}var ifft=op({ifft_:ifft_});function irfft_(e){var t,r=e.shape[e.shape.length-1],n=e.size/r;if(r<=2){var o=reshape(e,[n,r]);t=ifft(o)}else{var a=[n,2*(r-1)],s=reshape(real(e),[n,r]),i=reshape(imag(e),[n,r]),u=reverse(slice(s,[0,1],[n,r-2]),1),c=mul(reverse(slice(i,[0,1],[n,r-2]),1),scalar(-1)),p=concat([s,u],1),l=concat([i,c],1);o=reshape(complex(p,l),[a[0],a[1]]);t=ifft(o)}if(t=real(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=reshape(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}var irfft=op({irfft_:irfft_});function prepareSplitSize(e,t,r){void 0===r&&(r=0);var n=[];if("number"==typeof t)assert(e.shape[r]%t==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(t).fill(e.shape[r]/t);else{assert(t.reduce(function(e,t){return-1===t&&(e+=1),e},0)<=1,function(){return"There should be only one negative value in split array."});var o=t.indexOf(-1);if(-1!==o){var a=t.reduce(function(e,t){return t>0?e+t:e});t[o]=e.shape[r]-a}assert(e.shape[r]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=t}return n}function split_(e,t,r){void 0===r&&(r=0);var n=convertToTensor(e,"x","split"),o={x:n},a={numOrSizeSplits:t,axis:r};return ENGINE.runKernelFunc(function(e,o){var a=parseAxisParam(r,n.shape)[0],s=prepareSplitSize(n,t,a);return e.split(n,s,a)},o,null,SplitV,a)}var split=op({split_:split_});function rfft_(e,t){assert("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var r,n=e.shape[e.shape.length-1],o=e.size/n;if(null!=t&&t<n){var a=e.shape.map(function(e){return 0}),s=e.shape.map(function(e){return e});s[e.shape.length-1]=t,r=slice(e,a,s),n=t}else if(null!=t&&t>n){var i=e.shape.map(function(e){return e});i[e.shape.length-1]=t-n,r=concat([e,zeros(i)],e.shape.length-1),n=t}else r=e;var u=zerosLike(r),c=reshape(complex(r,u),[o,n]),p=fft(c),l=Math.floor(n/2)+1,d=real(p),f=imag(p),h=split(d,[l,n-l],d.shape.length-1),m=split(f,[l,n-l],f.shape.length-1),v=r.shape.slice();return v[r.shape.length-1]=l,reshape(complex(h[0],m[0]),v)}var rfft=op({rfft_:rfft_});function sqrt_(e){var t=convertToTensor(e,"x","sqrt"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.sqrt(t);return r([t]),n},r,null,Sqrt)}var sqrt=op({sqrt_:sqrt_});function squaredDifference_(e,t){var r,n=convertToTensor(e,"a","squaredDifference"),o=convertToTensor(t,"b","squaredDifference");r=makeTypesMatch(n,o),n=r[0],o=r[1],assertAndGetBroadcastShape(n.shape,o.shape);var a={a:n,b:o};return ENGINE.runKernelFunc(function(e,t){var r=e.squaredDifference(n,o);return t([n,o]),r},a,null,SquaredDifference,{})}var squaredDifference=op({squaredDifference_:squaredDifference_});function squeeze_(e,t){var r=convertToTensor(e,"x","squeeze");return reshape(r,squeezeShape(r.shape,t).newShape)}var squeeze=op({squeeze_:squeeze_});function stack_(e,t){void 0===t&&(t=0);var r=convertToTensorArray(e,"tensors","stack");if(assert(r.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===r.length)return expandDims(r[0],t);var n=r[0].rank,o=r[0].shape,a=r[0].dtype;assert(t<=n,function(){return"Axis must be <= rank of the tensor"}),r.forEach(function(e){assertShapesMatch(o,e.shape,"All tensors passed to stack must have matching shapes"),assert(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=r.map(function(e){return expandDims(e,t)});return concat(s,t)}var stack=op({stack_:stack_});function step_(e,t){void 0===t&&(t=0);var r=convertToTensor(e,"x","step"),n={x:r},o={alpha:t};return ENGINE.runKernelFunc(function(e){return e.step(r,t)},n,null,Step,o)}var step=op({step_:step_});function stridedSlice_(e,t,r,n,o,a,s,i,u){void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===i&&(i=0),void 0===u&&(u=0);var c=convertToTensor(e,"x","stridedSlice"),p={x:c},l={begin:t,end:r,strides:n,beginMask:o,endMask:a,ellipsisMask:s,newAxisMask:i,shrinkAxisMask:u};return ENGINE.runKernelFunc(function(e){null==n&&(n=new Array(t.length));var p=maskToAxes(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==s&&0!==i)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==s&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var l=c.rank-t.length,d=maskToAxes(i),f=c.shape.slice();d.forEach(function(e){t[e]=0,r[e]=1,f.splice(e,0,1)});var h=getNormalizedAxes((c=reshape(c,f)).shape,p,l,t,r,n,o,a,s),m=h.begin,v=h.end,g=h.strides;t=m,r=v,n=g;var y=maskToAxes(u);y.forEach(function(e){r[e]=t[e]+1,n[e]=1});var x=computeOutShape(t,r,n),b=x.filter(function(e,t){return-1===y.indexOf(t)});if(n.every(function(e){return 1===e}))return reshape(slice(c,t,x),b);var T=e.stridedSlice(c,t,r,n);return reshape(T,b)},p,null,StridedSlice,l)}var stridedSlice=op({stridedSlice_:stridedSlice_});function tan_(e){var t=convertToTensor(e,"x","tan"),r={x:t};return ENGINE.runKernelFunc(function(e,r){var n=e.tan(t);return r([t]),n},r,null,Tan)}var tan=op({tan_:tan_});function tensor2d(e,t,r){if(assertNonNull(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var n=inferShape(e,r);if(2!==n.length&&1!==n.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===n.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return makeTensor(e,t,n,r)}function tensor4d(e,t,r){if(assertNonNull(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var n=inferShape(e,r);if(4!==n.length&&1!==n.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===n.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t,n,r)}function tensor5d(e,t,r){if(assertNonNull(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var n=inferShape(e,r);if(5!==n.length&&1!==n.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===n.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t,n,r)}function tensor6d(e,t,r){if(assertNonNull(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var n=inferShape(e,r);if(6!==n.length&&1!==n.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===n.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return makeTensor(e,t=t||n,n,r)}function topk_(e,t,r){void 0===t&&(t=1),void 0===r&&(r=!0);var n=convertToTensor(e,"x","topk");if(0===n.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=n.shape[n.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a={x:n},s={k:t,sorted:r},i=ENGINE.runKernelFunc(function(e){return e.topk(n,t,r)},a,null,TopK,s);return{values:i[0],indices:i[1]}}var topk=op({topk_:topk_});function truncatedNormal_(e,t,r,n,o){if(void 0===t&&(t=0),void 0===r&&(r=1),null!=n&&"bool"===n)throw new Error("Unsupported data type $ { dtype }");for(var a=new MPRandGauss(t,r,n,!0,o),s=buffer(e,n),i=0;i<s.values.length;i++)s.values[i]=a.nextValue();return s.toTensor()}var truncatedNormal=op({truncatedNormal_:truncatedNormal_});function unique_(e,t){void 0===t&&(t=0);var r=convertToTensor(e,"x","unique",null);assert(r.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:r},o={axis:t},a=ENGINE.runKernel(Unique,n,o);return{values:a[0],indices:a[1]}}var unique=op({unique_:unique_});function unsortedSegmentSum_(e,t,r){var n=convertToTensor(e,"x","unsortedSegmentSum"),o=convertToTensor(t,"segmentIds","unsortedSegmentSum","int32");assert(isInt(r),function(){return"numSegments must be of dtype int"});var a={x:n,segmentIds:o},s={numSegments:r};return ENGINE.runKernelFunc(function(e,t){var a=e.unsortedSegmentSum(n,o,r);return t([o]),a},a,null,UnsortedSegmentSum,s)}var unsortedSegmentSum=op({unsortedSegmentSum_:unsortedSegmentSum_});function unstack_(e,t){void 0===t&&(t=0);var r=convertToTensor(e,"x","unstack");assert(t>=-r.shape.length&&t<r.shape.length,function(){return"Axis = "+t+" is not in [-"+r.shape.length+", "+r.shape.length+")"}),t<0&&(t+=r.shape.length);var n={value:r},o={axis:t};return ENGINE.runKernelFunc(function(e){return e.unstack(r,t)},n,null,Unpack,o)}var unstack=op({unstack_:unstack_});function variable(e,t,r,n){return void 0===t&&(t=!0),ENGINE.makeVariable(e,t,r,n)}function whereImpl(e,t){for(var r=[],n=0;n<t.length;n++)t[n]&&r.push(n);var o=buffer(e,"int32"),a=buffer([r.length,e.length],"int32");for(n=0;n<r.length;n++){var s=o.indexToLoc(r[n]),i=n*e.length;a.values.set(s,i)}return a.toTensor()}function whereAsync_(e){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(o){switch(o.label){case 0:return[4,(t=convertToTensor(e,"condition","whereAsync","bool")).data()];case 1:return r=o.sent(),n=whereImpl(t.shape,r),e!==t&&t.dispose(),[2,n]}})})}var whereAsync=whereAsync_;function booleanMaskAsync_(e,t,r){return __awaiter(this,void 0,void 0,function(){var n,o,a,s,i,u,c,p,l,d,f,h,m;return __generator(this,function(v){switch(v.label){case 0:for(n=convertToTensor(e,"tensor","boolMask"),o=convertToTensor(t,"mask","boolMask","bool"),a=null==r?0:r,s=o.rank,i=n.shape,assert(s>0,function(){return"mask cannot be scalar"}),assertShapesMatch(i.slice(a,a+s),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=a;c<a+s;c++)u*=i[c];return p=i.slice(0,a).concat([u],i.slice(a+s)),l=reshape(n,p),d=reshape(o,[-1]),[4,whereAsync(d)];case 1:return f=v.sent(),h=squeeze(f,[1]),m=gather(l,h,a),e!==n&&n.dispose(),t!==o&&o.dispose(),h.dispose(),l.dispose(),d.dispose(),f.dispose(),[2,m]}})})}var booleanMaskAsync=booleanMaskAsync_;function notEqualStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","notEqualStrict"),n=convertToTensor(t,"b","notEqualStrict");return assertShapesMatch(r.shape,n.shape,"Error in notEqualStrict: "),notEqual(r,n)}function lessStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","lessStrict"),n=convertToTensor(t,"b","lessStrict");return assertShapesMatch(r.shape,n.shape,"Error in lessStrict: "),less(r,n)}function equalStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","equalStrict"),n=convertToTensor(t,"b","equalStrict");return assertShapesMatch(r.shape,n.shape,"Error in equalStrict: "),equal(r,n)}function lessEqualStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","lessEqualStrict"),n=convertToTensor(t,"b","lessEqualStrict");return assertShapesMatch(r.shape,n.shape,"Error in lessEqualStrict: "),lessEqual(r,n)}function greaterStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","greaterStrict"),n=convertToTensor(t,"b","greaterStrict");return assertShapesMatch(r.shape,n.shape,"Error in greaterStrict: "),greater(r,n)}function greaterEqualStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","greaterEqualStrict"),n=convertToTensor(t,"b","greaterEqualStrict");return assertShapesMatch(r.shape,n.shape,"Error in greaterEqualStrict: "),greaterEqual(r,n)}var equalStrict=op({equalStrict_:equalStrict_}),greaterEqualStrict=op({greaterEqualStrict_:greaterEqualStrict_}),greaterStrict=op({greaterStrict_:greaterStrict_}),lessEqualStrict=op({lessEqualStrict_:lessEqualStrict_}),lessStrict=op({lessStrict_:lessStrict_}),notEqualStrict=op({notEqualStrict_:notEqualStrict_});function addStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","addStrict"),n=convertToTensor(t,"b","addStrict");return assertShapesMatch(r.shape,n.shape,"Error in addStrict: "),add$1(r,n)}function subStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","subStrict"),n=convertToTensor(t,"b","subStrict");return assertShapesMatch(r.shape,n.shape,"Error in subStrict: "),sub(r,n)}function powStrict_(e,t){return deprecationWarn("strict variants of ops have been deprecated and will be removed in future"),assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),pow(e,t)}function mulStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","mul"),n=convertToTensor(t,"b","mul");return assertShapesMatch(r.shape,n.shape,"Error in multiplyStrict: "),mul(r,n)}function divStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","div"),n=convertToTensor(t,"b","div");return assertShapesMatch(r.shape,n.shape,"Error in divideStrict: "),div(r,n)}function modStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","modStrict"),n=convertToTensor(t,"b","modStrict");return assertShapesMatch(r.shape,n.shape,"Error in modStrict: "),mod(r,n)}function minimumStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","minimumStrict"),n=convertToTensor(t,"b","minimumStrict");return assertShapesMatch(r.shape,n.shape,"Error in minimumStrict: "),minimum(r,n)}function maximumStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","maximumStrict"),n=convertToTensor(t,"b","maximumStrict");return assertShapesMatch(r.shape,n.shape,"Error in maximumStrict: "),maximum(r,n)}function squaredDifferenceStrict_(e,t){deprecationWarn("strict variants of ops have been deprecated and will be removed in future");var r=convertToTensor(e,"a","squaredDifferenceStrict"),n=convertToTensor(t,"b","squaredDifferenceStrict");return assertShapesMatch(r.shape,n.shape,"Error in squaredDifferenceStrict: "),squaredDifference(r,n)}var addStrict=op({addStrict_:addStrict_}),divStrict=op({divStrict_:divStrict_}),maximumStrict=op({maximumStrict_:maximumStrict_}),minimumStrict=op({minimumStrict_:minimumStrict_}),modStrict=op({modStrict_:modStrict_}),mulStrict=op({mulStrict_:mulStrict_}),powStrict=op({powStrict_:powStrict_}),squaredDifferenceStrict=op({squaredDifferenceStrict_:squaredDifferenceStrict_}),subStrict=op({subStrict_:subStrict_});function norm_(e,t,r,n){void 0===t&&(t="euclidean"),void 0===r&&(r=null),void 0===n&&(n=!1);var o=normImpl(e=convertToTensor(e,"x","norm"),t,r),a=o.shape;if(n){var s=parseAxisParam(r,e.shape);a=expandShapeToKeepDim(o.shape,s)}return reshape(o,a)}function normImpl(e,t,r){if(void 0===r&&(r=null),0===e.rank)return abs(e);if(1!==e.rank&&null===r)return normImpl(reshape(e,[-1]),t,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===t)return sum$1(abs(e),r);if(t===1/0)return max(abs(e),r);if(t===-1/0)return min(abs(e),r);if("euclidean"===t||2===t)return sqrt(sum$1(pow(abs(e),scalar(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+t)}if(Array.isArray(r)&&2===r.length){if(1===t)return max(sum$1(abs(e),r[0]),r[1]-1);if(t===1/0)return max(sum$1(abs(e),r[1]),r[0]);if(t===-1/0)return min(sum$1(abs(e),r[1]),r[0]);if("fro"===t||"euclidean"===t)return sqrt(sum$1(square(e),r));throw new Error("Error in norm: invalid ord value: "+t)}throw new Error("Error in norm: invalid axis: "+r)}var norm=op({norm_:norm_});function movingAverage_(e,t,r,n,o){void 0===o&&(o=!0);var a=convertToTensor(e,"v","movingAverage"),s=convertToTensor(t,"x","movingAverage"),i=convertToTensor(r,"decay","movingAverage");assertTypesMatch(a,s),assert(arraysEqual(a.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=scalar(1),c=sub(u,i),p=mul(sub(s,a),c);if(o){assert(null!=n,function(){return"When using zeroDebias: true, step is required."});var l=convertToTensor(n,"step","movingAverage");p=div(p,sub(u,pow(i,l)))}return add$1(a,p)}var movingAverage=op({movingAverage_:movingAverage_});function scatterND_(e,t,r){var n=convertToTensor(e,"indices","scatterND","int32"),o=convertToTensor(t,"updates","scatterND");validateInput(o,n,r);var a={indices:n,updates:o},s={shape:r};return ENGINE.runKernelFunc(function(e){return e.scatterND(n,o,r)},a,null,ScatterNd,s)}var scatterND=op({scatterND_:scatterND_});function validateInput$1(e,t,r,n){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(r.length!==a)throw new Error("outputShape has incorrect number of elements:, "+r.length+", should be: "+a+".");var s=t.size;if(0!==t.rank&&(1!==t.rank||s!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function sparseToDense_(e,t,r,n){void 0===n&&(n=0);var o=convertToTensor(e,"sparseIndices","sparseToDense","int32"),a=convertToTensor(t,"sparseValues","sparseToDense"),s=convertToTensor(n,"defaultValue","sparseToDense",a.dtype);validateInput$1(o,a,r,s);var i={sparseIndices:o,sparseValues:a,defaultValue:s},u={outputShape:r};return ENGINE.runKernelFunc(function(e){return e.sparseToDense(o,a,r,s)},i,null,SparseToDense,u)}var sparseToDense=op({sparseToDense_:sparseToDense_});function gatherND_(e,t){var r=convertToTensor(t,"indices","gatherND","int32"),n=convertToTensor(e,"x","gatherND"),o={params:n,indices:r};return ENGINE.runKernelFunc(function(e){return e.gatherND(n,r)},o,null,GatherNd)}var gatherND=op({gatherND_:gatherND_});function getNoiseShape(e,t){if(null==t)return e.shape.slice();if(arraysEqual(e.shape,t))return t;if(e.shape.length===t.length){for(var r=[],n=0;n<e.shape.length;n++)null==t[n]&&null!=e.shape[n]?r.push(e.shape[n]):r.push(t[n]);return r}return t}function dropout_(e,t,r,n){var o=convertToTensor(e,"x","dropout");if(assert("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),assert(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof Tensor?o.clone():o;var a=getNoiseShape(o,r),s=1-t,i=div(floor(add$1(randomUniform(a,0,1,"float32",n),s)),s);return mul(o,i)}var dropout=op({dropout_:dropout_});function enclosingPowerOfTwo(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function cosineWindow(e,t,r){for(var n=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var s=2*Math.PI*a/(e+n-1);o[a]=t-r*Math.cos(s)}return tensor1d(o,"float32")}function inTopKAsync_(e,t,r){return void 0===r&&(r=1),__awaiter(this,void 0,void 0,function(){var n,o,a,s,i,u,c,p,l,d,f,h,m,v;return __generator(this,function(g){switch(g.label){case 0:return n=convertToTensor(e,"predictions","inTopK"),o=convertToTensor(t,"targets","inTopK"),assert(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),assert(n.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+o.rank}),assertShapesMatch(n.shape.slice(0,n.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=n.shape[n.shape.length-1],assert(r>0&&r<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+r}),[4,n.data()];case 1:return s=g.sent(),[4,o.data()];case 2:for(i=g.sent(),u=[s.length/a,a],p=u[1],l=getTypedArrayFromDType("bool",c=u[0]),d=0;d<c;d++){for(f=d*p,h=s.subarray(f,f+p),m=[],v=0;v<h.length;v++)m.push({value:h[v],index:v});for(m.sort(function(e,t){return t.value-e.value}),l[d]=0,v=0;v<r;v++)if(m[v].index===i[d]){l[d]=1;break}}return e!==n&&n.dispose(),t!==o&&o.dispose(),[2,tensor(l,o.shape,"bool")]}})})}var inTopKAsync=inTopKAsync_;function conv2DBackpropFilter_(e,t,r,n,o,a,s){void 0===a&&(a="NHWC");var i=e;3===e.rank&&(i=reshape(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=reshape(t,[1,t.shape[0],t.shape[1],t.shape[2]])),assert(4===i.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+i.shape+"."}),assert(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),assert(4===r.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+r+"."});var c="NHWC"===a?i.shape[3]:i.shape[1],p="NHWC"===a?u.shape[3]:u.shape[1];assert(c===r[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+r[2]+"."}),assert(p===r[3],function(){return"Error in conv2dDerFilter: depth of dy ("+p+") must match output depth for filter ("+r[3]+")."}),null!=s&&assert(isInt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."});var l={x:i,dy:u},d={strides:n,pad:o,dataFormat:a,dimRoundingMode:s};return ENGINE.runKernelFunc(function(e){var t=convertConv2DDataFormat(a),c=computeConv2DInfo(i.shape,r,n,1,o,s,!1,t);return e.conv2dDerFilter(i,u,c)},l,null,Conv2DBackpropFilter,d)}var conv2DBackpropFilter=op({conv2DBackpropFilter_:conv2DBackpropFilter_});function getFusedDyActivation(e,t,r){if(null==r||"linear"===r)return e;if("relu"===r)return mul(e,step(t));throw new Error("Cannot compute gradient for fused activation "+r+".")}function getFusedBiasGradient(e,t){var r=t,n=getReductionAxes(e.shape,t.shape);return n.length>0&&(r=sum$1(r,n)),reshape(r,e.shape)}function applyActivation(e,t,r){if("linear"===t)return e;if("relu"===t)return relu(e);if("elu"===t)return elu(e);if("relu6"===t)return relu6(e);if("prelu"===t)return prelu(e,r);throw new Error("Unknown fused activation "+t+".")}var shouldFuse=function(e,t){return!(e>0)||"linear"===t};function fusedConv2d_(e){var t=e.x,r=e.filter,n=e.strides,o=e.pad,a=e.dataFormat,s=void 0===a?"NHWC":a,i=e.dilations,u=void 0===i?[1,1]:i,c=e.dimRoundingMode,p=e.bias,l=e.activation,d=void 0===l?"linear":l,f=e.preluActivationWeights;if(d=d||"linear",!1===shouldFuse(ENGINE.state.gradientDepth,d)){var h=conv2d(t,r,n,o,s,u,c);return null!=p&&(h=add$1(h,p)),applyActivation(h,d,f)}var m=convertToTensor(t,"x","conv2d"),v=convertToTensor(r,"filter","conv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=reshape(m,[1,m.shape[0],m.shape[1],m.shape[2]])),assert(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),assert(4===v.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),null!=c&&assert(isInt(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),assert(g.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),assert(eitherStridesOrDilationsAreOne(n,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),assert("NHWC"===s,function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var x,b,T=computeConv2DInfo(g.shape,v.shape,n,u,o,c);null!=p&&(x=makeTypesMatch(x=convertToTensor(p,"bias","fused conv2d"),m)[0],assertAndGetBroadcastShape(T.outShape,x.shape)),null!=f&&(b=convertToTensor(f,"prelu weights","fused conv2d"));var E=function(e,t){var r=t,a=r[0],s=r[1],i=r[2],c=r[3],p=getFusedDyActivation(e,i,d);assert(tupleValuesAreOne(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var l=[conv2DBackpropInput(s.shape,p,a,n,o),conv2DBackpropFilter(s,p,a.shape,n,o)];if(null!=c){var f=getFusedBiasGradient(c,p);l.push(f)}return l},S=function(e){return e.fusedConv2d({input:g,filter:v,convInfo:T,bias:x,activation:d,preluActivationWeights:b})},w={x:g,filter:v,bias:x,preluActivationWeights:b},k={strides:n,pad:o,dataFormat:s,dilations:u,dimRoundingMode:c,activation:d};return null==p?customGrad(function(e,t,r){var n=ENGINE.runKernelFunc(S,w,null,FusedConv2D,k);return r([t,e,n]),y&&(n=reshape(n,[n.shape[1],n.shape[2],n.shape[3]])),{value:n,gradFunc:E}})(g,v):customGrad(function(e,t,r,n){var o=ENGINE.runKernelFunc(S,w,null,FusedConv2D,k);return n([t,e,o,r]),y&&(o=reshape(o,[o.shape[1],o.shape[2],o.shape[3]])),{value:o,gradFunc:E}})(g,v,x)}var conv2d$1=op({fusedConv2d_:fusedConv2d_});function depthwiseConv2dNativeBackpropFilter_(e,t,r,n){var o=e;3===e.rank&&(o=reshape(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var a=t;3===a.rank&&(a=reshape(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var s={x:o,dy:a};return ENGINE.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(o,a,n)},s,null,DepthwiseConv2dNativeBackpropFilter)}var depthwiseConv2dNativeBackpropFilter=op({depthwiseConv2dNativeBackpropFilter_:depthwiseConv2dNativeBackpropFilter_});function depthwiseConv2dNativeBackpropInput_(e,t,r,n){var o=t,a=!1;3===t.rank&&(a=!0,o=reshape(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var s={dy:o},i=ENGINE.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(o,r,n)},s,null,DepthwiseConv2dNativeBackpropInput);return a?reshape(i,[i.shape[1],i.shape[2],i.shape[3]]):i}var depthwiseConv2dNativeBackpropInput=op({depthwiseConv2dNativeBackpropInput_:depthwiseConv2dNativeBackpropInput_});function fusedDepthwiseConv2d_(e){var t=e.x,r=e.filter,n=e.strides,o=e.pad,a=e.dataFormat,s=void 0===a?"NHWC":a,i=e.dilations,u=void 0===i?[1,1]:i,c=e.dimRoundingMode,p=e.bias,l=e.activation,d=void 0===l?"linear":l,f=e.preluActivationWeights;if(!1===shouldFuse(ENGINE.state.gradientDepth,d)){var h=depthwiseConv2d(t,r,n,o,s,u,c);return null!=p&&(h=add$1(h,p)),applyActivation(h,d,f)}var m=convertToTensor(t,"x","depthwiseConv2d"),v=convertToTensor(r,"filter","depthwiseConv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=reshape(m,[1,m.shape[0],m.shape[1],m.shape[2]])),assert(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),assert(4===v.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),assert(g.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),null==u&&(u=[1,1]),assert(eitherStridesOrDilationsAreOne(n,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),null!=c&&assert(isInt(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var x,b,T=computeConv2DInfo(g.shape,v.shape,n,u,o,c,!0);null!=p&&(x=makeTypesMatch(x=convertToTensor(p,"bias","fused conv2d"),m)[0],assertAndGetBroadcastShape(T.outShape,x.shape)),null!=f&&(b=convertToTensor(f,"prelu weights","fused depthwiseConv2d"));var E=function(e,t){assert(tupleValuesAreOne(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var r=t[0],n=t[1],o=t[2],a=t[3],s=getFusedDyActivation(e,o,d),i=depthwiseConv2dNativeBackpropInput(n.shape,s,r,T),c=depthwiseConv2dNativeBackpropFilter(n,s,r.shape,T);return null!=a?[i,c,getFusedBiasGradient(x,s)]:[i,c]},S=function(e){return e.fusedDepthwiseConv2D({input:g,filter:v,convInfo:T,bias:x,activation:d,preluActivationWeights:b})},w={x:g,filter:v,bias:x,preluActivationWeights:b},k={strides:n,pad:o,dataFormat:s,dilations:u,dimRoundingMode:c,activation:d};return null==p?customGrad(function(e,t,r){var n=ENGINE.runKernelFunc(S,w,null,FusedDepthwiseConv2D,k);return r([t,e,n]),y&&(n=reshape(n,[n.shape[1],n.shape[2],n.shape[3]])),{value:n,gradFunc:E}})(g,v):customGrad(function(e,t,r,n){var o=ENGINE.runKernelFunc(S,w,null,FusedDepthwiseConv2D,k);return n([t,e,o,r]),y&&(o=reshape(o,[o.shape[1],o.shape[2],o.shape[3]])),{value:o,gradFunc:E}})(g,v,x)}var depthwiseConv2d$1=op({fusedDepthwiseConv2d_:fusedDepthwiseConv2d_});function fusedMatMul_(e){var t,r=e.a,n=e.b,o=e.transposeA,a=void 0!==o&&o,s=e.transposeB,i=void 0!==s&&s,u=e.bias,c=e.activation,p=void 0===c?"linear":c,l=e.preluActivationWeights;if(!1===shouldFuse(ENGINE.state.gradientDepth,p)){var d=matMul(r,n,a,i);return null!=u&&(d=add$1(d,u)),applyActivation(d,p,l)}var f=convertToTensor(r,"a","fused matMul"),h=convertToTensor(n,"b","fused matMul");t=makeTypesMatch(f,h),f=t[0],h=t[1];var m=a?f.shape[f.rank-2]:f.shape[f.rank-1],v=i?h.shape[h.rank-1]:h.shape[h.rank-2],g=a?f.shape[f.rank-1]:f.shape[f.rank-2],y=i?h.shape[h.rank-2]:h.shape[h.rank-1],x=f.shape.slice(0,-2),b=h.shape.slice(0,-2),T=sizeFromShape(x),E=sizeFromShape(b);assert(f.rank>=2&&h.rank>=2&&f.rank===h.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+h.rank+"."}),assert(arraysEqual(x,b),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+f.shape+" and "+h.shape+" must match."}),assert(m===v,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+f.shape+" and "+h.shape+" and transposeA="+a+" and transposeB="+i+" must match."});var S,w,k=f.shape.slice(0,-2).concat([g,y]),_=reshape(f,a?[T,m,g]:[T,g,m]),N=reshape(h,i?[E,y,v]:[E,v,y]);null!=u&&(S=makeTypesMatch(S=convertToTensor(u,"bias","fused matMul"),f)[0],assertAndGetBroadcastShape(k,S.shape)),null!=l&&(w=convertToTensor(l,"prelu weights","fused matMul"));var I=function(e,t){var r,n,o=t[0],s=t[1],c=t[2],l=t[3],d=getFusedDyActivation(reshape(e,c.shape),c,p);return a||i?!a&&i?(r=matMul(d,s,!1,!1),n=matMul(d,o,!0,!1)):a&&!i?(r=matMul(s,d,!1,!0),n=matMul(o,d,!1,!1)):(r=matMul(s,d,!0,!0),n=matMul(d,o,!0,!0)):(r=matMul(d,s,!1,!0),n=matMul(o,d,!0,!1)),null!=u?[r,n,getFusedBiasGradient(l,d)]:[r,n]},A=function(e){return e.fusedBatchMatMul({a:_,b:N,transposeA:a,transposeB:i,bias:S,activation:p,preluActivationWeights:w})},D={a:_,b:N,bias:S,preluActivationWeights:w},M={transposeA:a,transposeB:i,activation:p};return null==u?customGrad(function(e,t,r){var n=ENGINE.runKernelFunc(A,D,null,_FusedMatMul,M);return r([e,t,n]),{value:reshape(n,k),gradFunc:I}})(_,N):customGrad(function(e,t,r,n){var o=ENGINE.runKernelFunc(A,D,null,_FusedMatMul,M);return n([e,t,o,r]),{value:reshape(o,k),gradFunc:I}})(_,N,S)}var matMul$1=op({fusedMatMul_:fusedMatMul_}),fused_ops={__proto__:null,conv2d:conv2d$1,depthwiseConv2d:depthwiseConv2d$1,matMul:matMul$1};function hammingWindow_(e){return cosineWindow(e,.54,.46)}var hammingWindow=op({hammingWindow_:hammingWindow_});function hannWindow_(e){return cosineWindow(e,.5,.5)}var hannWindow=op({hannWindow_:hannWindow_});function frame_(e,t,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=0);for(var a=0,s=[];a+t<=e.size;)s.push(slice(e,a,t)),a+=r;if(n)for(;a<e.size;){var i=a+t-e.size,u=concat([slice(e,a,t-i),fill([i],o)]);s.push(u),a+=r}return 0===s.length?tensor2d([],[0,t]):reshape(concat(s),[s.length,t])}var frame=op({frame_:frame_});function stft_(e,t,r,n,o){void 0===o&&(o=hannWindow),null==n&&(n=enclosingPowerOfTwo(t));for(var a=frame(e,t,r),s=mul(a,o(t)),i=[],u=0;u<a.shape[0];u++)i.push(rfft(slice(s,[u,0],[1,t]),n));return concat(i)}var stft=op({stft_:stft_});function cropAndResize_(e,t,r,n,o,a){var s=convertToTensor(e,"image","cropAndResize"),i=convertToTensor(t,"boxes","cropAndResize","float32"),u=convertToTensor(r,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var c=i.shape[0];assert(4===s.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),assert(2===i.rank&&4===i.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+i.shape+"."}),assert(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+i.shape+"."}),assert(2===n.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),assert(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),assert("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o});var p={image:s,boxes:i,boxInd:u},l={method:o,extrapolationValue:a,cropSize:n};return ENGINE.runKernelFunc(function(e){return e.cropAndResize(s,i,u,n,o,a)},p,null,CropAndResize,l)}var cropAndResize=op({cropAndResize_:cropAndResize_});function flipLeftRight_(e){var t=convertToTensor(e,"image","flipLeftRight","float32");assert(4===t.rank,function(){return"Error in flipLeftRight: image must be rank 4,but got rank "+t.rank+"."});var r={image:t};return ENGINE.runKernel(FlipLeftRight,r,{})}var flipLeftRight=op({flipLeftRight_:flipLeftRight_});function rotateWithOffset_(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=.5);var o=convertToTensor(e,"image","rotateWithOffset","float32");assert(4===o.rank,function(){return"Error in rotateWithOffset: image must be rank 4,but got rank "+o.rank+"."});var a={image:o},s={radians:t,fillValue:r,center:n};return ENGINE.runKernel(RotateWithOffset,a,s)}var rotateWithOffset=op({rotateWithOffset_:rotateWithOffset_});function nonMaxSuppSanityCheck(e,t,r,n,o,a){null==n&&(n=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var s=e.shape[0];return r=Math.min(r,s),assert(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),assert(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),assert(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),assert(1===t.rank,function(){return"scores must be a 1D tensor"}),assert(t.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+t.shape[0]}),assert(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:a}}function nonMaxSuppression_(e,t,r,n,o){void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=convertToTensor(e,"boxes","nonMaxSuppression"),s=convertToTensor(t,"scores","nonMaxSuppression"),i=nonMaxSuppSanityCheck(a,s,r,n,o);r=i.maxOutputSize,n=i.iouThreshold,o=i.scoreThreshold;var u={maxOutputSize:r,iouThreshold:n,scoreThreshold:o};return ENGINE.runKernelFunc(function(e){return e.nonMaxSuppression(a,s,r,n,o)},{boxes:a,scores:s},null,NonMaxSuppressionV3,u)}var nonMaxSuppression=op({nonMaxSuppression_:nonMaxSuppression_});function binaryInsert(e,t,r){var n=binarySearch(e,t,r),o=n<0?-(n+1):n;e.splice(o,0,t)}function binarySearch(e,t,r){return binarySearch_(e,t,r||defaultComparator)}function defaultComparator(e,t){return e>t?1:e<t?-1:0}function binarySearch_(e,t,r){for(var n=0,o=e.length,a=0,s=!1;n<o;){var i=r(t,e[a=n+(o-n>>>1)]);i>0?n=a+1:(o=a,s=!i)}return s?n:-n-1}function nonMaxSuppressionV3Impl(e,t,r,n,o){return nonMaxSuppressionImpl_(e,t,r,n,o,0).selectedIndices}function nonMaxSuppressionV4Impl(e,t,r,n,o,a){return nonMaxSuppressionImpl_(e,t,r,n,o,0,!1,a,!0)}function nonMaxSuppressionV5Impl(e,t,r,n,o,a){return nonMaxSuppressionImpl_(e,t,r,n,o,a,!0)}function nonMaxSuppressionImpl_(e,t,r,n,o,a,s,i,u){void 0===s&&(s=!1),void 0===i&&(i=!1),void 0===u&&(u=!1);for(var c=[],p=0;p<t.length;p++)t[p]>o&&c.push({score:t[p],boxIndex:p,suppressBeginIndex:0});c.sort(ascendingComparator);for(var l=a>0?-.5/a:0,d=[],f=[];d.length<r&&c.length>0;){var h=c.pop(),m=h.score,v=h.boxIndex,g=h.suppressBeginIndex;if(m<o)break;for(var y=!1,x=d.length-1;x>=g;--x){var b=intersectionOverUnion(e,v,d[x]);if(b>=n){y=!0;break}if(h.score=h.score*suppressWeight(n,l,b),h.score<=o)break}h.suppressBeginIndex=d.length,y||(h.score===m?(d.push(v),f.push(h.score)):h.score>o&&binaryInsert(c,h,ascendingComparator))}var T=d.length,E=r-T;i&&E>0&&(d.push.apply(d,new Array(E).fill(0)),f.push.apply(f,new Array(E).fill(0)));var S={selectedIndices:tensor1d(d,"int32")};return s&&(S.selectedScores=tensor1d(f,"float32")),u&&(S.validOutputs=scalar(T,"int32")),S}function intersectionOverUnion(e,t,r){var n=e.subarray(4*t,4*t+4),o=e.subarray(4*r,4*r+4),a=Math.min(n[0],n[2]),s=Math.min(n[1],n[3]),i=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(o[0],o[2]),p=Math.min(o[1],o[3]),l=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),f=(i-a)*(u-s),h=(l-c)*(d-p);if(f<=0||h<=0)return 0;var m=Math.max(a,c),v=Math.max(s,p),g=Math.min(i,l),y=Math.min(u,d),x=Math.max(g-m,0)*Math.max(y-v,0);return x/(f+h-x)}function suppressWeight(e,t,r){var n=Math.exp(t*r*r);return r<=e?n:0}function ascendingComparator(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function nonMaxSuppressionAsync_(e,t,r,n,o){return void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),__awaiter(this,void 0,void 0,function(){var a,s,i,u,c,p,l;return __generator(this,function(d){switch(d.label){case 0:return a=convertToTensor(e,"boxes","nonMaxSuppressionAsync"),s=convertToTensor(t,"scores","nonMaxSuppressionAsync"),i=nonMaxSuppSanityCheck(a,s,r,n,o),r=i.maxOutputSize,n=i.iouThreshold,o=i.scoreThreshold,[4,Promise.all([a.data(),s.data()])];case 1:return u=d.sent(),c=u[0],p=u[1],l=nonMaxSuppressionV3Impl(c,p,r,n,o),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,l]}})})}var nonMaxSuppressionAsync=nonMaxSuppressionAsync_;function nonMaxSuppressionWithScore_(e,t,r,n,o,a){void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var s=convertToTensor(e,"boxes","nonMaxSuppression"),i=convertToTensor(t,"scores","nonMaxSuppression"),u=nonMaxSuppSanityCheck(s,i,r,n,o,a),c={boxes:s,scores:i},p={maxOutputSize:r=u.maxOutputSize,iouThreshold:n=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=ENGINE.runKernel(NonMaxSuppressionV5,c,p);return{selectedIndices:l[0],selectedScores:l[1]}}var nonMaxSuppressionWithScore=op({nonMaxSuppressionWithScore_:nonMaxSuppressionWithScore_});function nonMaxSuppressionWithScoreAsync_(e,t,r,n,o,a){return void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),__awaiter(this,void 0,void 0,function(){var s,i,u,c,p,l,d;return __generator(this,function(f){switch(f.label){case 0:return s=convertToTensor(e,"boxes","nonMaxSuppressionAsync"),i=convertToTensor(t,"scores","nonMaxSuppressionAsync"),u=nonMaxSuppSanityCheck(s,i,r,n,o,a),r=u.maxOutputSize,n=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([s.data(),i.data()])];case 1:return c=f.sent(),p=c[0],l=c[1],d=nonMaxSuppressionV5Impl(p,l,r,n,o,a),s!==e&&s.dispose(),i!==t&&i.dispose(),[2,d]}})})}var nonMaxSuppressionWithScoreAsync=nonMaxSuppressionWithScoreAsync_;function nonMaxSuppressionPadded_(e,t,r,n,o,a){void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=!1);var s=convertToTensor(e,"boxes","nonMaxSuppression"),i=convertToTensor(t,"scores","nonMaxSuppression"),u=nonMaxSuppSanityCheck(s,i,r,n,o,null),c={boxes:s,scores:i},p={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:a},l=ENGINE.runKernel(NonMaxSuppressionV4,c,p);return{selectedIndices:l[0],validOutputs:l[1]}}var nonMaxSuppressionPadded=op({nonMaxSuppressionPadded_:nonMaxSuppressionPadded_});function nonMaxSuppressionPaddedAsync_(e,t,r,n,o,a){return void 0===n&&(n=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=!1),__awaiter(this,void 0,void 0,function(){var s,i,u,c,p,l,d,f,h,m;return __generator(this,function(v){switch(v.label){case 0:return s=convertToTensor(e,"boxes","nonMaxSuppressionAsync"),i=convertToTensor(t,"scores","nonMaxSuppressionAsync"),u=nonMaxSuppSanityCheck(s,i,r,n,o,null),c=u.maxOutputSize,p=u.iouThreshold,l=u.scoreThreshold,[4,Promise.all([s.data(),i.data()])];case 1:return d=v.sent(),f=d[0],h=d[1],m=nonMaxSuppressionV4Impl(f,h,c,p,l,a),s!==e&&s.dispose(),i!==t&&i.dispose(),[2,m]}})})}var nonMaxSuppressionPaddedAsync=nonMaxSuppressionPaddedAsync_;function resizeBilinear_(e,t,r){void 0===r&&(r=!1);var n=convertToTensor(e,"images","resizeBilinear");assert(3===n.rank||4===n.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),assert(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=n,a=!1;3===n.rank&&(a=!0,o=reshape(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var s=t[0],i=t[1],u={images:o},c={alignCorners:r,size:t},p=ENGINE.runKernelFunc(function(e,t){return t([o]),e.resizeBilinear(o,s,i,r)},u,null,ResizeBilinear,c);return a?reshape(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var resizeBilinear=op({resizeBilinear_:resizeBilinear_});function resizeNearestNeighbor_(e,t,r){void 0===r&&(r=!1);var n=convertToTensor(e,"images","resizeNearestNeighbor");assert(3===n.rank||4===n.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),assert(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),assert("float32"===n.dtype||"int32"===n.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=n,a=!1;3===n.rank&&(a=!0,o=reshape(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var s=t[0],i=t[1],u={images:o},c={alignCorners:r,size:t},p=ENGINE.runKernelFunc(function(e,t){return t([o]),e.resizeNearestNeighbor(o,s,i,r)},u,null,ResizeNearestNeighbor,c);return a?reshape(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var resizeNearestNeighbor=op({resizeNearestNeighbor_:resizeNearestNeighbor_});function bandPart_(e,t,r){assert(t%1==0,function(){return"bandPart(): numLower must be an integer, got "+t+"."}),assert(r%1==0,function(){return"bandPart(): numUpper must be an integer, got "+r+"."});var n=convertToTensor(e,"a","bandPart");assert(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var o=n.shape,a=n.shape.slice(-2),s=a[0],i=a[1];if(!(t<=s))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+s+").");if(!(r<=i))throw new Error("bandPart(): numUpper ("+r+") must not be greater than the number of columns ("+i+").");t<0&&(t=s),r<0&&(r=i);var u=reshape(range(0,s,1,"int32"),[-1,1]),c=range(0,i,1,"int32"),p=sub(u,c),l=logicalAnd(lessEqual(p,scalar(+t,"int32")),greaterEqual(p,scalar(-r,"int32"))),d=zeros([s,i],n.dtype);return reshape(stack(unstack(reshape(n,[-1,s,i])).map(function(e){return where(l,e,d)})),o)}var bandPart=op({bandPart_:bandPart_});function gramSchmidt_(e){var t;if(Array.isArray(e)){t=!1,assert(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var r=e[0].shape[0],n=function(t){assert(e[t].shape[0]===r,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+r+")"})},o=1;o<e.length;++o)n(o)}else t=!0,e=split(e,e.shape[0],0).map(function(e){return squeeze(e,[0])});assert(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],s=e,i=function(e){a.push(ENGINE.tidy(function(){var t=s[e];if(e>0)for(var r=0;r<e;++r){var n=mul(sum$1(mul(a[r],t)),a[r]);t=sub(t,n)}return div(t,norm(t,"euclidean"))}))};for(o=0;o<e.length;++o)i(o);return t?stack(a,0):a}var gramSchmidt=op({gramSchmidt_:gramSchmidt_});function qr_(e,t){if(void 0===t&&(t=!1),assert(e.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+e.rank}),2===e.rank)return qr2d(e,t);var r=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),n=unstack(reshape(e,[r,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return n.forEach(function(e){var r=qr2d(e,t),n=r[0],s=r[1];o.push(n),a.push(s)}),[reshape(stack(o,0),e.shape),reshape(stack(a,0),e.shape)]}function qr2d(e,t){return void 0===t&&(t=!1),ENGINE.tidy(function(){assert(2===e.shape.length,function(){return"qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor."});for(var r=e.shape[0],n=e.shape[1],o=eye(r),a=clone(e),s=tensor2d([[1]],[1,1]),i=clone(s),u=r>=n?n:r,c=function(e){var t,u=a,c=i,p=o;t=ENGINE.tidy(function(){var t=slice(a,[e,e],[r-e,1]),u=norm(t),c=slice(a,[e,e],[1,1]),p=where(greater(c,0),tensor2d([[-1]]),tensor2d([[1]])),l=sub(c,mul(p,u)),d=div(t,l);i=1===d.shape[0]?clone(s):concat([s,slice(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);var f=neg(div(matMul(p,l),u)),h=slice(a,[e,0],[r-e,n]),m=mul(f,i),v=transpose(i);if(0===e)a=sub(h,matMul(m,matMul(v,h)));else{var g=sub(h,matMul(m,matMul(v,h)));a=concat([slice(a,[0,0],[e,n]),g],0)}var y=transpose(m),x=slice(o,[0,e],[r,o.shape[1]-e]);if(0===e)o=sub(x,matMul(matMul(x,i),y));else{var b=sub(x,matMul(matMul(x,i),y));o=concat([slice(o,[0,0],[r,e]),b],1)}return[i,a,o]}),i=t[0],a=t[1],o=t[2],dispose([u,c,p])},p=0;p<u;++p)c(p);return!t&&r>n&&(o=slice(o,[0,0],[r,n]),a=slice(a,[0,0],[n,n])),[o,a]})}var qr=op({qr_:qr_});function computeWeightedLoss_(e,t,r){void 0===r&&(r=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=convertToTensor(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=convertToTensor(t,"weights","computeWeightedLoss"));var a=null==o?n:mul(n,o);if(r===exports.Reduction.NONE)return a;if(r===exports.Reduction.SUM)return sum$1(a);if(r===exports.Reduction.MEAN){if(null==o)return mean(a);var s=n.size/o.size,i=div(sum$1(a),sum$1(o));return s>1?div(i,scalar(s)):i}if(r===exports.Reduction.SUM_BY_NONZERO_WEIGHTS){if(null==o)return div(sum$1(a),scalar(n.size));var u=mul(o,ones$1(n.shape)),c=cast(sum$1(notEqual(u,scalar(0))),"float32");return div(sum$1(a),c)}throw Error("Unknown reduction: "+r)}!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(exports.Reduction||(exports.Reduction={}));var computeWeightedLoss=op({computeWeightedLoss_:computeWeightedLoss_});function absoluteDifference_(e,t,r,n){void 0===n&&(n=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var o=convertToTensor(e,"labels","absoluteDifference"),a=convertToTensor(t,"predictions","absoluteDifference"),s=null;null!=r&&(s=convertToTensor(r,"weights","absoluteDifference")),assertShapesMatch(o.shape,a.shape,"Error in absoluteDifference: ");var i=abs(sub(o,a));return computeWeightedLoss(i,s,n)}var absoluteDifference=op({absoluteDifference_:absoluteDifference_});function cosineDistance_(e,t,r,n,o){void 0===o&&(o=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=convertToTensor(e,"labels","cosineDistance"),s=convertToTensor(t,"predictions","cosineDistance"),i=null;null!=n&&(i=convertToTensor(n,"weights","cosineDistance")),assertShapesMatch(a.shape,s.shape,"Error in cosineDistance: ");var u=scalar(1),c=sub(u,sum$1(mul(a,s),r,!0));return computeWeightedLoss(c,i,o)}var cosineDistance=op({cosineDistance_:cosineDistance_});function hingeLoss_(e,t,r,n){void 0===n&&(n=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var o=convertToTensor(e,"labels","hingeLoss"),a=convertToTensor(t,"predictions","hingeLoss"),s=null;null!=r&&(s=convertToTensor(r,"weights","hingeLoss")),assertShapesMatch(o.shape,a.shape,"Error in hingeLoss: ");var i=scalar(1);o=sub(mul(scalar(2),o),i);var u=relu(sub(i,mul(o,a)));return computeWeightedLoss(u,s,n)}var hingeLoss=op({hingeLoss_:hingeLoss_});function huberLoss_(e,t,r,n,o){void 0===n&&(n=1),void 0===o&&(o=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=convertToTensor(e,"labels","huberLoss"),s=convertToTensor(t,"predictions","huberLoss"),i=null;null!=r&&(i=convertToTensor(r,"weights","huberLoss")),assertShapesMatch(a.shape,s.shape,"Error in huberLoss: ");var u=scalar(n),c=abs(sub(s,a)),p=minimum(c,u),l=sub(c,p),d=add$1(mul(scalar(.5),square(p)),mul(u,l));return computeWeightedLoss(d,i,o)}var huberLoss=op({huberLoss_:huberLoss_});function logLoss_(e,t,r,n,o){void 0===n&&(n=1e-7),void 0===o&&(o=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=convertToTensor(e,"labels","logLoss"),s=convertToTensor(t,"predictions","logLoss"),i=null;null!=r&&(i=convertToTensor(r,"weights","logLoss")),assertShapesMatch(a.shape,s.shape,"Error in logLoss: ");var u=scalar(1),c=scalar(n),p=neg(mul(a,log(add$1(s,c)))),l=mul(sub(u,a),log(add$1(sub(u,s),c))),d=sub(p,l);return computeWeightedLoss(d,i,o)}var logLoss=op({logLoss_:logLoss_});function meanSquaredError_(e,t,r,n){void 0===n&&(n=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var o=convertToTensor(e,"labels","meanSquaredError"),a=convertToTensor(t,"predictions","meanSquaredError"),s=null;null!=r&&(s=convertToTensor(r,"weights","meanSquaredError")),assertShapesMatch(o.shape,a.shape,"Error in meanSquaredError: ");var i=squaredDifference(o,a);return computeWeightedLoss(i,s,n)}var meanSquaredError=op({meanSquaredError_:meanSquaredError_});function sigmoidCrossEntropyWithLogits_(e,t){var r=convertToTensor(e,"labels","sigmoidCrossEntropyWithLogits"),n=convertToTensor(t,"logits","sigmoidCrossEntropyWithLogits");assertShapesMatch(r.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=relu(n),a=mul(n,r),s=log1p(exp(neg(abs(n))));return add$1(sub(o,a),s)}function sigmoidCrossEntropy_(e,t,r,n,o){void 0===n&&(n=0),void 0===o&&(o=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=convertToTensor(e,"multiClassLabels","sigmoidCrossEntropy"),s=convertToTensor(t,"logits","sigmoidCrossEntropy"),i=null;if(null!=r&&(i=convertToTensor(r,"weights","sigmoidCrossEntropy")),assertShapesMatch(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=scalar(n),c=scalar(1),p=scalar(.5);a=add$1(mul(a,sub(c,u)),mul(p,u))}var l=sigmoidCrossEntropyWithLogits_(a,s);return computeWeightedLoss(l,i,o)}var sigmoidCrossEntropy=op({sigmoidCrossEntropy_:sigmoidCrossEntropy_});function softmaxCrossEntropyWithLogits_(e,t,r){if(void 0===r&&(r=-1),-1===r&&(r=t.rank-1),r!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+r);return customGrad(function(e,t,n){var o=logSumExp(t,[r],!0),a=sub(cast(t,"float32"),o);n([e,a]);var s=neg(mul(a,e));return{value:sum$1(s,[r]),gradFunc:function(e,t){var n=t[0],o=t[1],a=expandShapeToKeepDim(e.shape,[r]);return[mul(reshape(e,a),sub(cast(n,"float32"),exp(o))),mul(reshape(e,a),sub(exp(o),cast(n,"float32")))]}}})(e,t)}function softmaxCrossEntropy_(e,t,r,n,o){void 0===n&&(n=0),void 0===o&&(o=exports.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=convertToTensor(e,"onehotLabels","softmaxCrossEntropy"),s=convertToTensor(t,"logits","softmaxCrossEntropy"),i=null;if(null!=r&&(i=convertToTensor(r,"weights","softmaxCrossEntropy")),assertShapesMatch(a.shape,s.shape,"Error in softmaxCrossEntropy: "),n>0){var u=scalar(n),c=scalar(1),p=scalar(a.shape[1]);a=add$1(mul(a,sub(c,u)),div(u,p))}var l=softmaxCrossEntropyWithLogits_(a,s);return computeWeightedLoss(l,i,o)}var softmaxCrossEntropy=op({softmaxCrossEntropy_:softmaxCrossEntropy_}),spectral={fft:fft,ifft:ifft,rfft:rfft,irfft:irfft},signal={hammingWindow:hammingWindow,hannWindow:hannWindow,frame:frame,stft:stft},image={flipLeftRight:flipLeftRight,resizeNearestNeighbor:resizeNearestNeighbor,resizeBilinear:resizeBilinear,rotateWithOffset:rotateWithOffset,cropAndResize:cropAndResize,nonMaxSuppression:nonMaxSuppression,nonMaxSuppressionAsync:nonMaxSuppressionAsync,nonMaxSuppressionWithScore:nonMaxSuppressionWithScore,nonMaxSuppressionWithScoreAsync:nonMaxSuppressionWithScoreAsync,nonMaxSuppressionPadded:nonMaxSuppressionPadded,nonMaxSuppressionPaddedAsync:nonMaxSuppressionPaddedAsync},linalg={bandPart:bandPart,gramSchmidt:gramSchmidt,qr:qr},losses={absoluteDifference:absoluteDifference,computeWeightedLoss:computeWeightedLoss,cosineDistance:cosineDistance,hingeLoss:hingeLoss,huberLoss:huberLoss,logLoss:logLoss,meanSquaredError:meanSquaredError,sigmoidCrossEntropy:sigmoidCrossEntropy,softmaxCrossEntropy:softmaxCrossEntropy},Optimizer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.minimize=function(e,t,r){void 0===t&&(t=!1);var n=this.computeGradients(e,r),o=n.value,a=n.grads;if(null!=r){var s=r.map(function(e){return{name:e.name,tensor:a[e.name]}});this.applyGradients(s)}else this.applyGradients(a);return dispose(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return variableGrads(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&dispose(this.iterations_)},t.prototype.saveIterations=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:scalar(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=r.sent()[0],[2,e.slice(1)]}})})},t}(Serializable);Object.defineProperty(Optimizer,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var AdadeltaOptimizer=function(e){function t(t,r,n){void 0===n&&(n=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=n,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==n&&(o.epsilon=ENGINE.backend.epsilon()),o}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(r,n){var o=ENGINE.registeredVariables[r];null==t.accumulatedGrads[n]&&(t.accumulatedGrads[n]={originalName:r+"/accum_grad",variable:tidy(function(){return zerosLike(o).variable(!1)})}),null==t.accumulatedUpdates[n]&&(t.accumulatedUpdates[n]={originalName:r+"/accum_var",variable:tidy(function(){return zerosLike(o).variable(!1)})});var a=Array.isArray(e)?e[n].tensor:e[r];if(null!=a){var s=t.accumulatedGrads[n].variable,i=t.accumulatedUpdates[n].variable;tidy(function(){var e=add$1(mul(s,t.rho),mul(square(a),1-t.rho)),r=mul(div(sqrt(add$1(i,t.epsilon)),sqrt(add$1(s,t.epsilon))),a),n=add$1(mul(i,t.rho),mul(square(r),1-t.rho));s.assign(e),i.assign(n);var u=add$1(mul(r,-t.learningRate),o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(dispose(this.accumulatedGrads.map(function(e){return e.variable})),dispose(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),t=e.length/2,!1,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(Optimizer);registerClass(AdadeltaOptimizer);var AdagradOptimizer=function(e){function t(t,r){void 0===r&&(r=.1);var n=e.call(this)||this;return n.learningRate=t,n.initialAccumulatorValue=r,n.accumulatedGrads=[],n}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(r,n){var o=ENGINE.registeredVariables[r];if(null==t.accumulatedGrads[n]){t.accumulatedGrads[n]={originalName:r+"/accumulator",variable:tidy(function(){return fill(o.shape,t.initialAccumulatorValue).variable(!1)})}}var a=Array.isArray(e)?e[n].tensor:e[r];if(null!=a){var s=t.accumulatedGrads[n].variable;tidy(function(){var e=add$1(s,square(a));s.assign(e);var r=add$1(mul(div(a,sqrt(add$1(e,ENGINE.backend.epsilon()))),-t.learningRate),o);o.assign(r)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&dispose(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),!1,this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Optimizer);registerClass(AdagradOptimizer);var AdamOptimizer=function(e){function t(t,r,n,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=n,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],tidy(function(){a.accBeta1=scalar(r).variable(),a.accBeta2=scalar(n).variable()}),null==o&&(a.epsilon=ENGINE.backend.epsilon()),a}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this,r=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);tidy(function(){var n=sub(1,t.accBeta1),o=sub(1,t.accBeta2);r.forEach(function(r,a){var s=ENGINE.registeredVariables[r];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:r+"/m",variable:tidy(function(){return zerosLike(s).variable(!1)})}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:r+"/v",variable:tidy(function(){return zerosLike(s).variable(!1)})});var i=Array.isArray(e)?e[a].tensor:e[r];if(null!=i){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedSecondMoment[a].variable,p=add$1(mul(u,t.beta1),mul(i,1-t.beta1)),l=add$1(mul(c,t.beta2),mul(square(i),1-t.beta2)),d=div(p,n),f=div(l,o);u.assign(p),c.assign(l);var h=add$1(mul(div(d,add$1(sqrt(f),t.epsilon)),-t.learningRate),s);s.assign(h)}}),t.accBeta1.assign(mul(t.accBeta1,t.beta1)),t.accBeta2.assign(mul(t.accBeta2,t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&dispose(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&dispose(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),tidy(function(){r.accBeta1.assign(pow(r.beta1,r.iterations_+1)),r.accBeta2.assign(pow(r.beta2,r.iterations_+1))}),t=e.length/2,!1,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Optimizer);registerClass(AdamOptimizer);var AdamaxOptimizer=function(e){function t(t,r,n,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var s=e.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=n,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],tidy(function(){s.iteration=scalar(0).variable(),s.accBeta1=scalar(r).variable()}),null==o&&(s.epsilon=ENGINE.backend.epsilon()),s}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this,r=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);tidy(function(){var n=sub(1,t.accBeta1),o=div(-t.learningRate,add$1(mul(t.iteration,t.decay),1));r.forEach(function(r,a){var s=ENGINE.registeredVariables[r];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:r+"/m",variable:zerosLike(s).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:r+"/v",variable:zerosLike(s).variable(!1)});var i=Array.isArray(e)?e[a].tensor:e[r];if(null!=i){var u=t.accumulatedFirstMoment[a].variable,c=t.accumulatedWeightedInfNorm[a].variable,p=add$1(mul(u,t.beta1),mul(i,1-t.beta1)),l=mul(c,t.beta2),d=abs(i),f=maximum(l,d);u.assign(p),c.assign(f);var h=add$1(mul(div(o,n),div(p,add$1(f,t.epsilon))),s);s.assign(h)}}),t.iteration.assign(add$1(t.iteration,1)),t.accBeta1.assign(mul(t.accBeta1,t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&dispose(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&dispose(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Optimizer);registerClass(AdamaxOptimizer);var SGDOptimizer=function(e){function t(t){var r=e.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(r,n){var o=Array.isArray(e)?e[n].tensor:e[r];if(null!=o){var a=ENGINE.registeredVariables[r];tidy(function(){var e=add$1(mul(t.c,o),a);a.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=keep(scalar(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(Optimizer);registerClass(SGDOptimizer);var MomentumOptimizer=function(e){function t(t,r,n){void 0===n&&(n=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=n,o.accumulations=[],o.m=scalar(o.momentum),o}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(r,n){var o=ENGINE.registeredVariables[r];if(null==t.accumulations[n]){t.accumulations[n]={originalName:r+"/momentum",variable:tidy(function(){return zerosLike(o).variable(!1)})}}var a=t.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[r];null!=s&&tidy(function(){var e,r=add$1(mul(t.m,a),s);e=t.useNesterov?add$1(mul(t.c,add$1(s,mul(r,t.m))),o):add$1(mul(t.c,r),o),a.assign(r),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&dispose(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),!1,this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(SGDOptimizer);registerClass(MomentumOptimizer);var RMSPropOptimizer=function(e){function t(t,r,n,o,a){void 0===r&&(r=.9),void 0===n&&(n=0),void 0===o&&(o=null),void 0===a&&(a=!1);var s=e.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=n,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,null==o&&(s.epsilon=ENGINE.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return __extends(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(r,n){var o=ENGINE.registeredVariables[r];null==t.accumulatedMeanSquares[n]&&(t.accumulatedMeanSquares[n]={originalName:r+"/rms",variable:tidy(function(){return zerosLike(o).variable(!1)})}),null==t.accumulatedMoments[n]&&(t.accumulatedMoments[n]={originalName:r+"/momentum",variable:tidy(function(){return zerosLike(o).variable(!1)})}),null==t.accumulatedMeanGrads[n]&&t.centered&&(t.accumulatedMeanGrads[n]={originalName:r+"/mg",variable:tidy(function(){return zerosLike(o).variable(!1)})});var a=Array.isArray(e)?e[n].tensor:e[r];if(null!=a){var s=t.accumulatedMeanSquares[n].variable,i=t.accumulatedMoments[n].variable;tidy(function(){var e=add$1(mul(s,t.decay),mul(square(a),1-t.decay));if(t.centered){var r=t.accumulatedMeanGrads[n].variable,u=add$1(mul(r,t.decay),mul(a,1-t.decay)),c=div(mul(a,t.learningRate),sqrt(sub(e,add$1(square(u),t.epsilon)))),p=add$1(mul(i,t.momentum),c);s.assign(e),r.assign(u),i.assign(p);var l=sub(o,p);o.assign(l)}else{var d=add$1(mul(s,t.decay),mul(square(a),1-t.decay));p=add$1(mul(i,t.momentum),div(mul(a,t.learningRate),sqrt(add$1(d,t.epsilon))));s.assign(d),i.assign(p);l=sub(o,p);o.assign(l)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&dispose(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&dispose(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&dispose(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),t=this.centered?e.length/3:e.length/2,!1,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Optimizer);registerClass(RMSPropOptimizer);var OptimizerConstructors=function(){function e(){}return e.sgd=function(e){return new SGDOptimizer(e)},e.momentum=function(e,t,r){return void 0===r&&(r=!1),new MomentumOptimizer(e,t,r)},e.rmsprop=function(e,t,r,n,o){return void 0===t&&(t=.9),void 0===r&&(r=0),void 0===n&&(n=null),void 0===o&&(o=!1),new RMSPropOptimizer(e,t,r,n,o)},e.adam=function(e,t,r,n){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===n&&(n=null),new AdamOptimizer(e,t,r,n)},e.adadelta=function(e,t,r){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===r&&(r=null),new AdadeltaOptimizer(e,t,r)},e.adamax=function(e,t,r,n,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===r&&(r=.999),void 0===n&&(n=null),void 0===o&&(o=0),new AdamaxOptimizer(e,t,r,n,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new AdagradOptimizer(e,t)},e}(),train={sgd:OptimizerConstructors.sgd,momentum:OptimizerConstructors.momentum,adadelta:OptimizerConstructors.adadelta,adagrad:OptimizerConstructors.adagrad,rmsprop:OptimizerConstructors.rmsprop,adamax:OptimizerConstructors.adamax,adam:OptimizerConstructors.adam},delayCallback="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function nextFrame(){return new Promise(function(e){return delayCallback(function(){return e()})})}function getImageCenter(e,t,r){return[r*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function getReshaped(e,t,r,n){void 0===n&&(n=!0);var o=[];if(n)(o=o.concat(t.slice(0))).push(e[0]/r),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,s=0;s<a;++s)o=o.concat([e[s+1]/t[s],t[s]]);o=o.concat(e.slice(a+1))}return o}function getPermuted(e,t,r){void 0===r&&(r=!0);var n=[];if(r){n.push(t);for(var o=t+1;o<e;++o)o<=2*t?(n.push(o),n.push(o-(t+1))):n.push(o)}else{var a=[],s=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?s.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,s)}return n}function getReshapedPermuted(e,t,r,n){void 0===n&&(n=!0);var o=[];n?o.push(e[0]/r):o.push(e[0]*r);for(var a=1;a<e.length;++a)a<=t.length?n?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function getSliceBeginCoords(e,t){for(var r=[0],n=0;n<t;++n)r.push(e[n][0]);return r}function getSliceSize(e,t,r){for(var n=e.slice(0,1),o=0;o<r;++o)n.push(e[o+1]-t[o][0]-t[o][1]);return n}var SELU_SCALEALPHA=1.7580993408473768,SELU_SCALE=1.0507009873554805,ERF_P=.3275911,ERF_A1=.254829592,ERF_A2=-.284496736,ERF_A3=1.421413741,ERF_A4=-1.453152027,ERF_A5=1.061405429;function warn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];env().getBool("IS_TEST")||console.warn.apply(console,e)}function log$1(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];env().getBool("IS_TEST")||console.log.apply(console,e)}function mergeRealAndImagArrays(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var r=new Float32Array(2*e.length),n=0;n<r.length;n+=2)r[n]=e[n/2],r[n+1]=t[n/2];return r}function splitRealAndImagArrays(e){for(var t=new Float32Array(e.length/2),r=new Float32Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=e[n],r[n/2]=e[n+1];return{real:t,imag:r}}function complexWithEvenIndex(e){for(var t=Math.ceil(e.length/4),r=new Float32Array(t),n=new Float32Array(t),o=0;o<e.length;o+=4)r[Math.floor(o/4)]=e[o],n[Math.floor(o/4)]=e[o+1];return{real:r,imag:n}}function complexWithOddIndex(e){for(var t=Math.floor(e.length/4),r=new Float32Array(t),n=new Float32Array(t),o=2;o<e.length;o+=4)r[Math.floor(o/4)]=e[o],n[Math.floor(o/4)]=e[o+1];return{real:r,imag:n}}function getComplexWithIndex(e,t){return{real:e[2*t],imag:e[2*t+1]}}function assignToTypedArray(e,t,r,n){e[2*n]=t,e[2*n+1]=r}function exponents(e,t){for(var r=new Float32Array(e/2),n=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);r[o]=Math.cos(a),n[o]=Math.sin(a)}return{real:r,imag:n}}function exponent(e,t,r){var n=(r?2:-2)*Math.PI*(e/t);return{real:Math.cos(n),imag:Math.sin(n)}}function castTensor(e,t,r){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var n=zeros(e.shape),o=cast(e,"float32"),a=r.complex(o,n);return n.dispose(),o.dispose(),a}if(!hasEncodingLoss(e.dtype,t))return ENGINE.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var s=r.real(e);a=cast(s,t);return s.dispose(),a}if("int32"===t)return r.int(e);if("bool"===t){var i=scalar(0,e.dtype);a=r.notEqual(e,i);return i.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function reshapeTensor(e,t){return ENGINE.makeTensorFromDataId(e.dataId,t,e.dtype)}function linspaceImpl(e,t,r){var n=(t-e)/(r-1),o=makeZerosTypedArray(r,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return tensor1d(o,"float32")}var backend_util={__proto__:null,slice_util:slice_util,segment_util:segment_util,castTensor:castTensor,reshapeTensor:reshapeTensor,linspaceImpl:linspaceImpl,upcastType:upcastType,axesAreInnerMostDims:axesAreInnerMostDims,combineLocations:combineLocations,computeOutAndReduceShapes:computeOutAndReduceShapes,expandShapeToKeepDim:expandShapeToKeepDim,assertAxesAreInnerMostDims:assertAxesAreInnerMostDims,getAxesPermutation:getAxesPermutation,getUndoAxesPermutation:getUndoAxesPermutation,getInnerMostAxes:getInnerMostAxes,getBroadcastDims:getBroadcastDims,getReductionAxes:getReductionAxes,assertAndGetBroadcastShape:assertAndGetBroadcastShape,assertParamsConsistent:assertParamsConsistent,computeOutShape:computeOutShape$1,computeDilation2DInfo:computeDilation2DInfo,computePool2DInfo:computePool2DInfo,computePool3DInfo:computePool3DInfo,computeConv2DInfo:computeConv2DInfo,computeConv3DInfo:computeConv3DInfo,computeDefaultPad:computeDefaultPad,tupleValuesAreOne:tupleValuesAreOne,eitherStridesOrDilationsAreOne:eitherStridesOrDilationsAreOne,convertConv2DDataFormat:convertConv2DDataFormat,getFusedDyActivation:getFusedDyActivation,getFusedBiasGradient:getFusedBiasGradient,applyActivation:applyActivation,shouldFuse:shouldFuse,PARALLELIZE_THRESHOLD:PARALLELIZE_THRESHOLD,computeOptimalWindowSize:computeOptimalWindowSize,getImageCenter:getImageCenter,getReshaped:getReshaped,getPermuted:getPermuted,getReshapedPermuted:getReshapedPermuted,getSliceBeginCoords:getSliceBeginCoords,getSliceSize:getSliceSize,prepareAndValidate:prepareAndValidate,validateUpdateShape:validateUpdateShape,validateInput:validateInput,calculateShapes:calculateShapes,SELU_SCALEALPHA:SELU_SCALEALPHA,SELU_SCALE:SELU_SCALE,ERF_P:ERF_P,ERF_A1:ERF_A1,ERF_A2:ERF_A2,ERF_A3:ERF_A3,ERF_A4:ERF_A4,ERF_A5:ERF_A5,warn:warn,log:log$1,mergeRealAndImagArrays:mergeRealAndImagArrays,splitRealAndImagArrays:splitRealAndImagArrays,complexWithEvenIndex:complexWithEvenIndex,complexWithOddIndex:complexWithOddIndex,getComplexWithIndex:getComplexWithIndex,assignToTypedArray:assignToTypedArray,exponents:exponents,exponent:exponent,prepareSplitSize:prepareSplitSize};function split$1(e,t,r){var n=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){var a=o.slice();a[r]=t;var s=slice(e,n,a);return n[r]+=t,s})}function tile$1(e,t){for(var r=new Array(e.rank),n=0;n<r.length;n++)r[n]=e.shape[n]*t[n];var o=buffer(r,e.dtype);for(n=0;n<o.values.length;++n){for(var a=o.indexToLoc(n),s=new Array(e.rank),i=0;i<s.length;i++)s[i]=a[i]%e.shape[i];var u=e.locToIndex(s);o.values[n]=e.values[u]}return o.toTensor()}function topkImpl(e,t,r,n,o){for(var a=t[t.length-1],s=[e.length/a,a],i=s[0],u=s[1],c=getTypedArrayFromDType(r,i*n),p=getTypedArrayFromDType("int32",i*n),l=0;l<i;l++){for(var d=l*u,f=e.subarray(d,d+u),h=[],m=0;m<f.length;m++)h.push({value:f[m],index:m});h.sort(function(e,t){return t.value-e.value});var v=l*n,g=c.subarray(v,v+n),y=p.subarray(v,v+n);for(m=0;m<n;m++)g[m]=h[m].value,y[m]=h[m].index}var x=t.slice();return x[x.length-1]=n,[tensor(c,x,r),tensor(p,x,"int32")]}var kernel_impls={__proto__:null,nonMaxSuppressionV3Impl:nonMaxSuppressionV3Impl,nonMaxSuppressionV4Impl:nonMaxSuppressionV4Impl,nonMaxSuppressionV5Impl:nonMaxSuppressionV5Impl,split:split$1,tile:tile$1,topkImpl:topkImpl,whereImpl:whereImpl},absGradConfig={kernelName:Abs,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,step(cast(r,"float32"),-1))}}}},acosGradConfig={kernelName:Acos,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){var t=square(cast(r,"float32")),n=sqrt(sub(scalar(1),t));return neg(div(e,n))}}}},acoshGradConfig={kernelName:Acosh,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){var t=sqrt(sub(square(cast(r,"float32")),1));return div(e,t)}}}},addGradConfig={kernelName:Add,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=e,n=getReductionAxes(r.shape,o);return n.length>0&&(t=sum$1(t,n)),reshape(t,r.shape)},b:function(){var t=e,r=getReductionAxes(n.shape,o);return r.length>0&&(t=sum$1(t,r)),reshape(t,n.shape)}}}},addNGradConfig={kernelName:AddN,saveAllInputs:!0,gradFunc:function(e,t){var r={};return t.forEach(function(t,n){r[n]=function(){return e.clone()}}),r}},argMaxGradConfig={kernelName:ArgMax,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return zerosLike(r)}}}},argMinGradConfig={kernelName:ArgMin,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return zerosLike(r)}}}},asinGradConfig={kernelName:Asin,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,sqrt(sub(scalar(1),square(cast(r,"float32")))))}}}},asinhGradConfig={kernelName:Asinh,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){var t=sqrt(add$1(scalar(1),square(cast(r,"float32"))));return div(e,t)}}}},atan2GradConfig={kernelName:Atan2,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=add$1(square(r),square(n)),a=mul(e,div(n,t)),s=getReductionAxes(r.shape,o);return s.length>0&&(a=sum$1(a,s)),reshape(a,r.shape)},b:function(){var t=add$1(square(r),square(n)),a=neg(mul(e,div(r,t))),s=getReductionAxes(n.shape,o);return s.length>0&&(a=sum$1(a,s)),reshape(a,n.shape)}}}},atanGradConfig={kernelName:Atan,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,add$1(square(cast(r,"float32")),1))}}}},atanhGradConfig={kernelName:Atanh,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,sub(scalar(1),square(cast(r,"float32"))))}}}};function avgPool3dBackprop_(e,t,r,n,o,a,s){void 0===o&&(o=[1,1,1]);var i=convertToTensor(e,"dy","avgPool3dBackprop"),u=convertToTensor(t,"input","avgPool3dBackprop"),c=i,p=u,l=!1;4===u.rank&&(l=!0,c=reshape(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),p=reshape(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),assert(5===c.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),assert(5===p.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+p.rank+"."}),assert(eitherStridesOrDilationsAreOne(n,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=s&&assert(isInt(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var d={dy:c,input:p},f={filterSize:r,strides:n,dilations:o,pad:a,dimRoundingMode:s},h=ENGINE.runKernelFunc(function(e){var t=computePool3DInfo(p.shape,r,n,o,a,s);return e.avgPool3dBackprop(c,p,t)},d,null,AvgPool3DBackprop,f);return l?reshape(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var avgPool3dBackprop=op({avgPool3dBackprop_:avgPool3dBackprop_}),avgPool3DGradConfig={kernelName:AvgPool3D,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=r,a=o.filterSize,s=o.strides,i=o.dilations,u=o.pad,c=o.dimRoundingMode,p=null==i?[1,1,1]:i;return{x:function(){return avgPool3dBackprop(e,n,a,s,p,u,c)}}}};function avgPoolBackprop_(e,t,r,n,o){var a=convertToTensor(e,"dy","avgPoolBackprop"),s=convertToTensor(t,"input","avgPoolBackprop");assert(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"});var i=s,u=a,c=!1;3===s.rank&&(c=!0,i=reshape(s,[1,s.shape[0],s.shape[1],s.shape[2]]),u=reshape(a,[1,a.shape[0],a.shape[1],a.shape[2]])),assert(4===u.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),assert(4===i.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+i.rank+"."});var p={dy:u,input:i},l={filterSize:r,strides:n,pad:o},d=ENGINE.runKernelFunc(function(e){var t=computePool2DInfo(i.shape,r,n,1,o);return e.avgPoolBackprop(u,i,t)},p,null,AvgPoolBackprop,l);return c?reshape(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var avgPoolBackprop=op({avgPoolBackprop_:avgPoolBackprop_}),avgPoolGradConfig={kernelName:AvgPool,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=r,a=o.filterSize,s=o.strides,i=o.pad;return{x:function(){return avgPoolBackprop(e,n,a,s,i)}}}},batchMatMulGradConfig={kernelName:BatchMatMul,inputsToSave:["a","b"],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s=r,i=s.transposeA,u=s.transposeB;return i||u?!i&&u?{a:function(){return matMul(e,a,!1,!1)},b:function(){return matMul(e,o,!0,!1)}}:i&&!u?{a:function(){return matMul(a,e,!1,!0)},b:function(){return matMul(o,e,!1,!1)}}:{a:function(){return matMul(a,e,!0,!0)},b:function(){return matMul(e,o,!0,!0)}}:{a:function(){return matMul(e,a,!1,!0)},b:function(){return matMul(o,e,!0,!1)}}}},batchToSpaceNDGradConfig={kernelName:BatchToSpaceND,gradFunc:function(e,t,r){var n=r,o=n.blockShape,a=n.crops;return{x:function(){return spaceToBatchND(e,o,a)}}}},broadcastToGradConfig={kernelName:BroadcastTo,gradFunc:function(e,t,r){for(var n=r,o=n.inputShape,a=n.shape,s=Array.from(a),i=o.length-1;i>=0;i--)if(o[i]===a[i])s[i]=1;else if(1!==o[i])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+a+"].");var u=[];for(i=0;i<s.length;i++)s[i]>1&&u.push(i);return{x:function(){return sum$1(e,u,!0)}}}},castGradConfig={kernelName:Cast,gradFunc:function(e){return{x:function(){return e.clone()}}}},ceilGradConfig={kernelName:Ceil,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},clipByValueGradConfig={kernelName:ClipByValue,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=r,a=o.clipValueMin,s=o.clipValueMax;return{x:function(){return where(logicalAnd(greaterEqual(n,a),lessEqual(n,s)),e,zerosLike(e))}}}},concatGradConfig={kernelName:Concat,saveAllInputs:!0,gradFunc:function(e,t,r){var n=t.map(function(e){return e.shape}),o=parseAxisParam(r.axis,t[0].shape)[0],a=n.map(function(e){return e[o]});return split(e,a,o).map(function(e){return function(){return e}})}},conv2DGradConfig={kernelName:Conv2D,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s=r,i=s.dilations,u=s.strides,c=s.pad,p=s.dataFormat;return assert(tupleValuesAreOne(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return conv2DBackpropInput(o.shape,e,a,u,c,p)},filter:function(){return conv2DBackpropFilter(o,e,a.shape,u,c,p)}}}},conv2DBackpropInputGradConfig={kernelName:Conv2DBackpropInput,inputsToSave:["dy","filter"],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s=r,i=s.strides,u=s.pad,c=s.dataFormat,p=s.dimRoundingMode;return{dy:function(){return conv2d(e,a,i,u,c,1,p)},filter:function(){return conv2DBackpropFilter(e,o,a.shape,i,u,c,p)}}}};function conv3DBackpropFilter_(e,t,r,n,o){var a=e;4===e.rank&&(a=reshape(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var s=t;4===s.rank&&(s=reshape(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),assert(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),assert(5===s.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+s.shape+"."}),assert(5===r.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+r+"."}),assert(a.shape[4]===r[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+r[3]+"."}),assert(s.shape[4]===r[4],function(){return"Error in conv3dDerFilter: depth of dy ("+s.shape[4]+") must match output depth for filter ("+r[4]+")."});var i={x:a,y:s},u={strides:n,pad:o};return ENGINE.runKernelFunc(function(e){var t=computeConv3DInfo(a.shape,r,n,1,o);return e.conv3dDerFilter(a,s,t)},i,null,Conv3DBackpropFilterV2,u)}var conv3DBackpropFilter=op({conv3DBackpropFilter_:conv3DBackpropFilter_}),conv3DGradConfig={kernelName:Conv3D,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var n=r,o=n.dilations,a=n.strides,s=n.pad;assert(tupleValuesAreOne(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var i=t[0],u=t[1];return{x:function(){return conv3DBackpropInput(i.shape,e,u,a,s)},filter:function(){return conv3DBackpropFilter(i,e,u.shape,a,s)}}}},cosGradConfig={kernelName:Cos,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(neg(sin(cast(r,"float32"))),e)}}}},coshGradConfig={kernelName:Cosh,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(sinh(cast(r,"float32")),e)}}}},cumsumGradConfig={kernelName:Cumsum,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=r,a=o.axis,s=o.exclusive,i=o.reverse;return{x:function(){var t=getAxesPermutation([a],n.rank),r=cumsum(e,a,s,!i);return null!=t&&(r=transpose(r,t)),r}}}},depthwiseConv2dNativeGradConfig={kernelName:DepthwiseConv2dNative,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var n=r,o=n.dilations,a=n.strides,s=n.pad,i=n.dimRoundingMode,u=null==o?[1,1]:o;assert(tupleValuesAreOne(u),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var c=t,p=c[0],l=c[1];assert(4===p.rank,function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank "+p.rank+"."}),assert(4===l.rank,function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank "+l.rank+"."}),assert(p.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input channels ("+p.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."}),assert(eitherStridesOrDilationsAreOne(a,u),function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides "+a+" and dilations '"+u+"'."}),null!=i&&assert(isInt(s),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+s+"."});var d=computeConv2DInfo(p.shape,l.shape,a,u,s,i,!0);return{x:function(){return depthwiseConv2dNativeBackpropInput(p.shape,e,l,d)},filter:function(){return depthwiseConv2dNativeBackpropFilter(p,e,l.shape,d)}}}},dilation2dGradConfig={kernelName:Dilation2D,inputsToSave:["x","filter"],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s={x:o,filter:a,dy:e},i={x:o,filter:a,dy:e};return{x:function(){return ENGINE.runKernel(Dilation2DBackpropInput,s,r)},filter:function(){return ENGINE.runKernel(Dilation2DBackpropFilter,i,r)}}}},divGradConfig={kernelName:Div,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=div(e,cast(n,"float32")),a=getReductionAxes(r.shape,o);return a.length>0?reshape(sum$1(t,a),r.shape):t},b:function(){var t=mul(e,cast(r,"float32")),a=getReductionAxes(n.shape,o);a.length>0&&(t=reshape(sum$1(t,a),n.shape));var s=square(n);return neg(div(t,cast(s,"float32")))}}}},eluGradConfig={kernelName:Elu,outputsToSave:[!0],gradFunc:function(e,t){var r=t[0],n=function(t){return t.eluDer(e,r)},o={dy:e,y:r};return{x:function(){return ENGINE.runKernelFunc(n,o,null,EluGrad)}}}},erfGradConfig={kernelName:Erf,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0],n=mul(exp(neg(square(r))),2/Math.sqrt(Math.PI));return{x:function(){return mul(e,n)}}}},expGradConfig={kernelName:Exp,outputsToSave:[!0],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,r)}}}},expm1GradConfig={kernelName:Expm1,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,exp(r))}}}},floorGradConfig={kernelName:Floor,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},floorDivGradConfig={kernelName:FloorDiv,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=div(e,cast(n,"float32")),a=getReductionAxes(r.shape,o);return a.length>0?reshape(sum$1(t,a),r.shape):t},b:function(){var t=mul(e,cast(r,"float32")),a=getReductionAxes(n.shape,o);a.length>0&&(t=reshape(sum$1(t,a),n.shape));var s=square(n);return neg(div(t,cast(s,"float32")))}}}},fusedBatchNormGradConfig={kernelName:FusedBatchNorm,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,r){var n=r.varianceEpsilon,o=t[0],a=t[1],s=t[2],i=t[3],u=null==i?scalar(1):i,c=getReductionAxes(a.shape,o.shape),p=[];if(1===a.rank){for(var l=0;l<o.shape.length-1;++l)p.push(o.shape[l]);p.push(1)}var d=sub(o,a),f=mul(e,u),h=rsqrt(add$1(s,scalar(n))),m=mul(mul(mul(h,h),h),scalar(-.5));return{x:function(){return 1===a.rank?reshape(mul(mul(e,tile(reshape(h,[1,1,1,a.shape[0]]),p)),u),o.shape):reshape(mul(mul(e,h),u),o.shape)},mean:function(){var e=mul(mul(h,scalar(-1)),f);return 1===a.rank&&(e=sum$1(e,c)),reshape(e,a.shape)},variance:function(){var e=mul(mul(m,d),f);return 1===a.rank&&(e=sum$1(e,c)),reshape(e,a.shape)},scale:function(){var t=mul(d,h),r=mul(e,t);return 1===a.rank&&(r=sum$1(r,c)),reshape(r,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=sum$1(t,c)),reshape(t,a.shape)}}}},gatherGradConfig={kernelName:GatherV2,inputsToSave:["x","indices"],gradFunc:function(e,t,r){var n=t[0],o=t[1],a=r.axis,s=parseAxisParam(a,n.shape)[0];return{x:function(){var t=n.shape,r=o.size,i=t.slice(0,s),u=i.length,c=t.slice(a,t.length).slice(1),p=c.length,l=arrayRange(0,u),d=arrayRange(u+1,u+1+p),f=arrayConcat([i,[r],c]),h=reshape(e,f),m=reshape(o,[r]),v=arrayConcat([[u],l,d]),g=transpose(h,v),y=unsortedSegmentSum(g,m,n.shape[s]),x=getUndoAxesPermutation(v);return y=transpose(y,x)},indices:function(){return o}}}};function arrayRange(e,t){for(var r=[],n=e;n<t;++n)r.push(n);return r}function arrayConcat(e){for(var t=[],r=0;r<e.length;++r)for(var n=0;n<e[r].length;++n)t.push(e[r][n]);return t}var greaterEqualGradConfig={kernelName:GreaterEqual,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1];return{a:function(){return zerosLike(r)},b:function(){return zerosLike(n)}}}},identityGradConfig={kernelName:Identity,gradFunc:function(e){return{x:function(){return cast(e,"float32")}}}},isFiniteGradConfig={kernelName:IsFinite,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},isInfGradConfig={kernelName:IsInf,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},isNanGradConfig={kernelName:IsNan,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},log1pGradConfig={kernelName:Log1p,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,add$1(r,1))}}}},logGradConfig={kernelName:Log,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,cast(r,"float32"))}}}},logSoftmaxGradConfig={kernelName:LogSoftmax,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,r){var n=t[0],o=r.axis;return{logits:function(){var t=exp(n);return sub(e,mul(sum$1(e,o,!0),t))}}}};function localResponseNormalizationBackprop_(e,t,r,n,o,a,s){void 0===n&&(n=5),void 0===o&&(o=1),void 0===a&&(a=1),void 0===s&&(s=.5);var i={x:e,y:t,dy:r},u={depthRadius:n,bias:o,alpha:a,beta:s};return ENGINE.runKernelFunc(function(i){return i.LRNGrad(r,e,t,n,o,a,s)},i,null,LRNBackprop,u)}var localResponseNormalizationBackprop=op({localResponseNormalizationBackprop_:localResponseNormalizationBackprop_}),lrnGradConfig={kernelName:LRN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s=r,i=s.depthRadius,u=s.bias,c=s.alpha,p=s.beta;return{x:function(){return localResponseNormalizationBackprop(o,a,e,i,u,c,p)}}}};function gradForMinAndMax(e,t,r,n,o){return t.rank<r.rank&&(t=reshape(t,expandShapeToKeepDim(t.shape,n))),e.rank<r.rank&&(e=reshape(e,expandShapeToKeepDim(e.shape,n))),{x:function(){var n=mul(e,cast(equal(r,t),e.dtype));return null==o?n:transpose(n,o)}}}var maxGradConfig={kernelName:Max,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var n=r.reductionIndices,o=t[0],a=t[1],s=parseAxisParam(n,o.shape),i=getAxesPermutation(s,o.rank),u=gradForMinAndMax(e,a,o,s,i);return{x:function(){var e=u.x();return null!=i&&(e=transpose(e)),e}}}},maximumGradConfig={kernelName:Maximum,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1];return{a:function(){return mul(e,cast(greaterEqual(r,n),"float32"))},b:function(){return mul(e,cast(less(r,n),"float32"))}}}};function maxPool3dBackprop_(e,t,r,n,o,a,s,i){void 0===a&&(a=[1,1,1]);var u=convertToTensor(e,"dy","maxPool3dBackprop"),c=convertToTensor(t,"input","maxPool3dBackprop"),p=convertToTensor(r,"output","maxPool3dBackprop"),l=u,d=c,f=p,h=!1;4===c.rank&&(h=!0,l=reshape(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=reshape(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=reshape(p,[1,p.shape[0],p.shape[1],p.shape[2],p.shape[3]])),assert(5===l.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),assert(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),assert(5===f.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."}),assert(eitherStridesOrDilationsAreOne(o,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),null!=i&&assert(isInt(s),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+s+"."});var m={dy:l,input:d,output:f},v={filterSize:n,strides:o,dilations:a,pad:s,dimRoundingMode:i},g=ENGINE.runKernelFunc(function(e){var t=computePool3DInfo(d.shape,n,o,a,s,i);return e.maxPool3dBackprop(l,d,f,t)},m,null,MaxPool3DBackprop,v);return h?reshape(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var maxPool3dBackprop=op({maxPool3dBackprop_:maxPool3dBackprop_}),maxPool3DGradConfig={kernelName:MaxPool3D,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s=r,i=s.filterSize,u=s.strides,c=s.dilations,p=s.pad,l=s.dimRoundingMode,d=null==c?[1,1,1]:c;return{x:function(){return maxPool3dBackprop(e,o,a,i,u,d,p,l)}}}};function maxPoolBackprop_(e,t,r,n,o,a,s){var i=convertToTensor(e,"dy","maxPoolBackprop"),u=convertToTensor(t,"input","maxPoolBackprop"),c=convertToTensor(r,"output","maxPoolBackprop");assert(u.rank===i.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+i.rank+")"}),assert(4===i.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+i.rank+"."}),assert(4===u.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}),null!=s&&assert(isInt(a),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var p={dy:i,input:u,output:c},l={filterSize:n,strides:o,pad:a,dimRoundingMode:s};return ENGINE.runKernelFunc(function(e){var t=computePool2DInfo(u.shape,n,o,1,a,s);return e.maxPoolBackprop(i,u,c,t)},p,null,MaxPoolBackprop,l)}var maxPoolBackprop=op({maxPoolBackprop_:maxPoolBackprop_}),maxPoolGradConfig={kernelName:MaxPool,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var n=t,o=n[0],a=n[1],s=r,i=s.filterSize,u=s.strides,c=s.pad;return{x:function(){return maxPoolBackprop(e,o,a,i,u,c)}}}},minGradConfig={kernelName:Min,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,r){var n=r.axis,o=t[0],a=t[1],s=parseAxisParam(n,o.shape),i=getAxesPermutation(s,o.rank),u=gradForMinAndMax(e,a,o,s,i);return{x:function(){var e=u.x();return null!=i&&(e=transpose(e)),e}}}},minimumGradConfig={kernelName:Minimum,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1];return{a:function(){return mul(e,cast(lessEqual(r,n),"float32"))},b:function(){return mul(e,cast(greater(r,n),"float32"))}}}},modGradConfig={kernelName:Mod,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=getReductionAxes(r.shape,o);return t.length>0?reshape(sum$1(e,t),r.shape):e},b:function(){var t=mul(e,neg(floor(div(r,n)))),a=getReductionAxes(n.shape,o);return a.length>0?reshape(sum$1(t,a),n.shape):t}}}},multiplyGradConfig={kernelName:Multiply,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=mul(e,cast(n,"float32")),a=getReductionAxes(r.shape,o);return a.length>0?reshape(sum$1(t,a),r.shape):t},b:function(){var t=mul(e,cast(r,"float32")),a=getReductionAxes(n.shape,o);return a.length>0?reshape(sum$1(t,a),n.shape):t}}}},negateGradConfig={kernelName:Negate,gradFunc:function(e){return{x:function(){return neg(e)}}}},oneHotGradConfig={kernelName:OneHot,inputsToSave:["indices"],gradFunc:function(e,t){var r=t[0];return{indices:function(){return zeros(r.shape,"float32")}}}},onesLikeGradConfig={kernelName:OnesLike,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},padV2GradConfig={kernelName:PadV2,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=r.paddings.map(function(e){return e[0]});return{x:function(){return slice(e,o,n.shape)}}}},powGradConfig={kernelName:Pow,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var r=t[0],n=t[1],o=t[2],a=r,s=n,i=assertAndGetBroadcastShape(a.shape,s.shape);return{a:function(){var t=cast(s,"float32"),r=mul(e,mul(t,pow(a,sub(t,scalar(1))))),n=getReductionAxes(a.shape,i);return n.length>0&&(r=sum$1(r,n)),reshape(r,a.shape)},b:function(){var t=greater(a,0),r=where(t,log(a),zerosLike(a)),n=mul(e,mul(o,r)),u=getReductionAxes(s.shape,i);return u.length>0&&(n=sum$1(n,u)),reshape(n,s.shape)}}}},preluGradConfig={kernelName:Prelu,inputsToSave:["x","alpha"],gradFunc:function(e,t){var r=t[0],n=t[1],o=greater(r,0);return{x:function(){return where(o,e,mul(e,n))},alpha:function(){var t=where(o,zerosLike(e),mul(e,r)),a=getReductionAxes(n.shape,e.shape);return a.length>0&&(t=sum$1(t,a)),reshape(t,n.shape)}}}},reciprocalGradConfig={kernelName:Reciprocal,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,neg(square(r)))}}}},relu6GradConfig={kernelName:Relu6,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0],n=mul(lessEqual(r,6),step(r));return{x:function(){return mul(e,cast(n,"float32"))}}}},reluGradConfig={kernelName:Relu,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,cast(step(r),"float32"))}}}},reshapeGradConfig={kernelName:Reshape,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return reshape(e,r.shape)}}}},resizeBilinearGradConfig={kernelName:ResizeBilinear,inputsToSave:["images"],gradFunc:function(e,t,r){var n=t[0],o=function(t){var o=r.alignCorners;return t.resizeBilinearBackprop(e,n,o)},a={images:n};return{images:function(){return ENGINE.runKernelFunc(o,a,null,ResizeBilinearGrad,r)}}}},resizeNearestNeighborGradConfig={kernelName:ResizeNearestNeighbor,inputsToSave:["images"],gradFunc:function(e,t,r){var n=t[0],o=function(t){var o=r.alignCorners;return t.resizeNearestNeighborBackprop(e,n,o)},a={images:n};return{images:function(){return ENGINE.runKernelFunc(o,a,null,ResizeNearestNeighborGrad,r)}}}},reverseGradConfig={kernelName:Reverse,gradFunc:function(e,t,r){var n=parseAxisParam(r.dims,e.shape);return{x:function(){return reverse(e,n)}}}},roundGradConfig={kernelName:Round,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},rsqrtGradConfig={kernelName:Rsqrt,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return neg(div(e,mul(pow(r,1.5),2)))}}}},selectV2PoolGradConfig={kernelName:SelectV2,inputsToSave:["condition"],gradFunc:function(e,t){var r=t[0];return{condition:function(){return cast(zerosLike(r),"float32")},t:function(){return mul(e,cast(r,e.dtype))},e:function(){return mul(e,cast(logicalNot(r),e.dtype))}}}},seluGradConfig={kernelName:Selu,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){var t=greater(r,scalar(0)),n=scalar(SELU_SCALEALPHA),o=scalar(SELU_SCALE),a=mul(e,o),s=mul(mul(e,n),exp(cast(r,"float32")));return where(t,a,s)}}}},sigmoidGradConfig={kernelName:Sigmoid,outputsToSave:[!0],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,mul(r,sub(scalar(1),r)))}}}},signGradConfig={kernelName:Sign,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},sinGradConfig={kernelName:Sin,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(cos(cast(r,"float32")),e)}}}},sinhGradConfig={kernelName:Sinh,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(cosh(cast(r,"float32")),e)}}}},sliceGradConfig={kernelName:Slice,inputsToSave:["x"],gradFunc:function(e,t,r){for(var n=t[0],o=r,a=o.begin,s=o.size,i=n.shape,u=parseSliceParams(n,a,s),c=u[0],p=u[1],l=[],d=0;d<e.rank;d++)l.push([c[d],i[d]-c[d]-p[d]]);return{x:function(){return pad(e,l)}}}},softmaxGradConfig={kernelName:Softmax,outputsToSave:[!0],gradFunc:function(e,t,r){var n=t[0],o=r.dim,a=mul(e,n);return{logits:function(){return sub(a,mul(sum$1(a,[o],!0),n))}}}},softplusGradConfig={kernelName:Softplus,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,sigmoid(r))}}}},spaceToBatchNDGradConfig={kernelName:SpaceToBatchND,gradFunc:function(e,t,r){var n=r,o=n.blockShape,a=n.paddings;return{x:function(){return batchToSpaceND(e,o,a)}}}},splitVGradConfig={kernelName:SplitV,gradFunc:function(e,t,r){var n=r.axis;return{x:function(){return concat(e,n)}}}},sqrtGradConfig={kernelName:Sqrt,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,mul(sqrt(cast(r,"float32")),2))}}}},squareGradConfig={kernelName:Square,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(e,mul(cast(r,"float32"),2))}}}},squaredDifferenceGradConfig={kernelName:SquaredDifference,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=scalar(2);return{a:function(){return mul(e,mul(o,sub(r,n)))},b:function(){return mul(e,mul(o,sub(n,r)))}}}},stepGradConfig={kernelName:Step,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},subGradConfig={kernelName:Sub,inputsToSave:["a","b"],gradFunc:function(e,t){var r=t[0],n=t[1],o=assertAndGetBroadcastShape(r.shape,n.shape);return{a:function(){var t=e,n=getReductionAxes(r.shape,o);return n.length>0&&(t=sum$1(t,n)),reshape(t,r.shape)},b:function(){var t=e,r=getReductionAxes(n.shape,o);return r.length>0&&(t=sum$1(t,r)),reshape(neg(t),n.shape)}}}},sumGradConfig={kernelName:Sum,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=n.shape.slice();parseAxisParam(r.axis,n.shape).forEach(function(e){o[e]=1});var a=reshape(e,o),s=mul(a,ones$1(n.shape,"float32"));return{x:function(){return s}}}},tanGradConfig={kernelName:Tan,inputsToSave:["x"],gradFunc:function(e,t){var r=t[0];return{x:function(){return div(e,square(cos(r)))}}}},tanhGradConfig={kernelName:Tanh,outputsToSave:[!0],gradFunc:function(e,t){var r=t[0];return{x:function(){return mul(sub(scalar(1),square(r)),e)}}}},tileGradConfig={kernelName:Tile,inputsToSave:["x"],gradFunc:function(e,t,r){var n=t[0],o=r.reps;return{x:function(){var t=zerosLike(n);if(1===n.rank)for(var r=0;r<o[0];++r)t=add$1(t,slice(e,[r*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(r=0;r<o[0];++r)for(var a=0;a<o[1];++a)t=add$1(t,slice(e,[r*n.shape[0],a*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(r=0;r<o[0];++r)for(a=0;a<o[1];++a)for(var s=0;s<o[2];++s)t=add$1(t,slice(e,[r*n.shape[0],a*n.shape[1],s*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(r=0;r<o[0];++r)for(a=0;a<o[1];++a)for(s=0;s<o[2];++s)for(var i=0;i<o[3];++i)t=add$1(t,slice(e,[r*n.shape[0],a*n.shape[1],s*n.shape[2],i*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return t}}}},transposeGradConfig={kernelName:Transpose,gradFunc:function(e,t,r){var n=getUndoAxesPermutation(r.perm);return{x:function(){return transpose(e,n)}}}},unpackGradConfig={kernelName:Unpack,gradFunc:function(e,t,r){var n=r.axis;return{value:function(){return stack(e,n)}}}},unsortedSegmentSumGradConfig={kernelName:UnsortedSegmentSum,inputsToSave:["segmentIds"],gradFunc:function(e,t){var r=t[0];return{x:function(){return gatherDropNegatives(e,r)}}}};function gatherDropNegatives(e,t){for(var r=maximum(t,zerosLike(t)),n=gather(e,r),o=greaterEqual(t,scalar(0,"int32")),a=n.rank-o.rank,s=0;s<a;++s)o=expandDims(o,s+1);o=logicalAnd(o,ones$1(n.shape,"bool"));var i=zerosLike(n);return where(o,n,i)}for(var zerosLikeGradConfig={kernelName:ZerosLike,gradFunc:function(e){return{x:function(){return zerosLike(e)}}}},gradConfigs=[absGradConfig,acosGradConfig,acoshGradConfig,addGradConfig,addNGradConfig,argMaxGradConfig,argMinGradConfig,asinGradConfig,asinhGradConfig,atan2GradConfig,atanGradConfig,atanhGradConfig,avgPool3DGradConfig,avgPoolGradConfig,batchMatMulGradConfig,batchToSpaceNDGradConfig,broadcastToGradConfig,castGradConfig,ceilGradConfig,clipByValueGradConfig,concatGradConfig,conv2DBackpropInputGradConfig,conv2DGradConfig,conv3DGradConfig,cosGradConfig,coshGradConfig,cumsumGradConfig,depthwiseConv2dNativeGradConfig,dilation2dGradConfig,divGradConfig,eluGradConfig,erfGradConfig,expGradConfig,expm1GradConfig,floorDivGradConfig,floorGradConfig,fusedBatchNormGradConfig,gatherGradConfig,greaterEqualGradConfig,identityGradConfig,isFiniteGradConfig,isInfGradConfig,isNanGradConfig,log1pGradConfig,logGradConfig,logSoftmaxGradConfig,lrnGradConfig,maxGradConfig,maxGradConfig,maximumGradConfig,maxPool3DGradConfig,maxPoolGradConfig,minGradConfig,minimumGradConfig,modGradConfig,multiplyGradConfig,negateGradConfig,oneHotGradConfig,onesLikeGradConfig,padV2GradConfig,padV2GradConfig,powGradConfig,preluGradConfig,reciprocalGradConfig,relu6GradConfig,reluGradConfig,reshapeGradConfig,resizeBilinearGradConfig,resizeNearestNeighborGradConfig,reverseGradConfig,roundGradConfig,rsqrtGradConfig,selectV2PoolGradConfig,seluGradConfig,sigmoidGradConfig,signGradConfig,sinGradConfig,sinhGradConfig,sliceGradConfig,softmaxGradConfig,softplusGradConfig,spaceToBatchNDGradConfig,spaceToBatchNDGradConfig,splitVGradConfig,splitVGradConfig,sqrtGradConfig,squaredDifferenceGradConfig,squareGradConfig,stepGradConfig,subGradConfig,sumGradConfig,tanGradConfig,tanhGradConfig,tileGradConfig,transposeGradConfig,unpackGradConfig,unsortedSegmentSumGradConfig,zerosLikeGradConfig],_i=0,gradConfigs_1=gradConfigs;_i<gradConfigs_1.length;_i++){var gradientConfig=gradConfigs_1[_i];registerGradient(gradientConfig)}Tensor.prototype.abs=function(){return this.throwIfDisposed(),abs(this)},Tensor.prototype.acos=function(){return this.throwIfDisposed(),acos(this)},Tensor.prototype.acosh=function(){return this.throwIfDisposed(),acosh(this)},Tensor.prototype.addStrict=function(e){return this.throwIfDisposed(),addStrict(this,e)},Tensor.prototype.add=function(e){return this.throwIfDisposed(),add$1(this,e)},Tensor.prototype.all=function(e,t){return this.throwIfDisposed(),all(this,e,t)},Tensor.prototype.any=function(e,t){return this.throwIfDisposed(),any(this,e,t)},Tensor.prototype.argMax=function(e){return this.throwIfDisposed(),argMax(this,e)},Tensor.prototype.argMin=function(e){return this.throwIfDisposed(),argMin(this,e)},Tensor.prototype.asScalar=function(){return this.throwIfDisposed(),assert(1===this.size,function(){return"The array must have only 1 element."}),reshape(this,[])},Tensor.prototype.asType=function(e){return this.throwIfDisposed(),cast(this,e)},Tensor.prototype.as1D=function(){return this.throwIfDisposed(),reshape(this,[this.size])},Tensor.prototype.as2D=function(e,t){return this.throwIfDisposed(),reshape(this,[e,t])},Tensor.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),reshape(this,[e,t,r])},Tensor.prototype.as4D=function(e,t,r,n){return this.throwIfDisposed(),reshape(this,[e,t,r,n])},Tensor.prototype.as5D=function(e,t,r,n,o){return this.throwIfDisposed(),reshape(this,[e,t,r,n,o])},Tensor.prototype.asin=function(){return this.throwIfDisposed(),asin(this)},Tensor.prototype.asinh=function(){return this.throwIfDisposed(),asinh(this)},Tensor.prototype.atan=function(){return this.throwIfDisposed(),atan(this)},Tensor.prototype.atan2=function(e){return this.throwIfDisposed(),atan2(this,e)},Tensor.prototype.atanh=function(){return this.throwIfDisposed(),atanh(this)},Tensor.prototype.avgPool=function(e,t,r,n){return this.throwIfDisposed(),avgPool(this,e,t,r,n)},Tensor.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),batchToSpaceND(this,e,t)},Tensor.prototype.batchNorm=function(e,t,r,n,o){return this.throwIfDisposed(),batchNorm(this,e,t,r,n,o)},Tensor.prototype.broadcastTo=function(e){return this.throwIfDisposed(),broadcastTo(this,e)},Tensor.prototype.cast=function(e){return this.throwIfDisposed(),cast(this,e)},Tensor.prototype.ceil=function(){return this.throwIfDisposed(),ceil(this)},Tensor.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),clipByValue(this,e,t)},Tensor.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Tensor&&(e=[e]),concat([this].concat(e),t)},Tensor.prototype.conv1d=function(e,t,r,n,o,a){return this.throwIfDisposed(),conv1d(this,e,t,r,n,o,a)},Tensor.prototype.conv2dTranspose=function(e,t,r,n,o){return this.throwIfDisposed(),conv2dTranspose(this,e,t,r,n,o)},Tensor.prototype.conv2d=function(e,t,r,n,o,a){return this.throwIfDisposed(),conv2d(this,e,t,r,n,o,a)},Tensor.prototype.cos=function(){return this.throwIfDisposed(),cos(this)},Tensor.prototype.cosh=function(){return this.throwIfDisposed(),cosh(this)},Tensor.prototype.cumsum=function(e,t,r){return this.throwIfDisposed(),cumsum(this,e,t,r)},Tensor.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),depthToSpace(this,e,t)},Tensor.prototype.depthwiseConv2D=function(e,t,r,n,o,a){return deprecationWarn("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),depthwiseConv2d(this,e,t,r,n,o,a)},Tensor.prototype.depthwiseConv2d=function(e,t,r,n,o,a){return this.throwIfDisposed(),depthwiseConv2d(this,e,t,r,n,o,a)},Tensor.prototype.dilation2d=function(e,t,r,n,o){return this.throwIfDisposed(),dilation2d(this,e,t,r,n,o)},Tensor.prototype.divNoNan=function(e){return this.throwIfDisposed(),divNoNan(this,e)},Tensor.prototype.divStrict=function(e){return this.throwIfDisposed(),divStrict(this,e)},Tensor.prototype.div=function(e){return this.throwIfDisposed(),div(this,e)},Tensor.prototype.dot=function(e){return this.throwIfDisposed(),dot(this,e)},Tensor.prototype.elu=function(){return this.throwIfDisposed(),elu(this)},Tensor.prototype.equalStrict=function(e){return this.throwIfDisposed(),equalStrict(this,e)},Tensor.prototype.equal=function(e){return this.throwIfDisposed(),equal(this,e)},Tensor.prototype.erf=function(){return this.throwIfDisposed(),erf(this)},Tensor.prototype.exp=function(){return this.throwIfDisposed(),exp(this)},Tensor.prototype.expandDims=function(e){return this.throwIfDisposed(),expandDims(this,e)},Tensor.prototype.expm1=function(){return this.throwIfDisposed(),expm1(this)},Tensor.prototype.fft=function(){return this.throwIfDisposed(),fft(this)},Tensor.prototype.flatten=function(){return this.throwIfDisposed(),reshape(this,[this.size])},Tensor.prototype.floor=function(){return this.throwIfDisposed(),floor(this)},Tensor.prototype.floorDiv=function(e){return this.throwIfDisposed(),floorDiv(this,e)},Tensor.prototype.gather=function(e,t){return this.throwIfDisposed(),gather(this,e,t)},Tensor.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),greaterEqualStrict(this,e)},Tensor.prototype.greaterEqual=function(e){return this.throwIfDisposed(),greaterEqual(this,e)},Tensor.prototype.greaterStrict=function(e){return this.throwIfDisposed(),greaterStrict(this,e)},Tensor.prototype.greater=function(e){return this.throwIfDisposed(),greater(this,e)},Tensor.prototype.ifft=function(){return this.throwIfDisposed(),ifft(this)},Tensor.prototype.irfft=function(){return this.throwIfDisposed(),irfft(this)},Tensor.prototype.isFinite=function(){return this.throwIfDisposed(),isFinite$1(this)},Tensor.prototype.isInf=function(){return this.throwIfDisposed(),isInf(this)},Tensor.prototype.isNaN=function(){return this.throwIfDisposed(),isNaN$1(this)},Tensor.prototype.leakyRelu=function(e){return this.throwIfDisposed(),leakyRelu(this,e)},Tensor.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),lessEqualStrict(this,e)},Tensor.prototype.lessEqual=function(e){return this.throwIfDisposed(),lessEqual(this,e)},Tensor.prototype.lessStrict=function(e){return this.throwIfDisposed(),lessStrict(this,e)},Tensor.prototype.less=function(e){return this.throwIfDisposed(),less(this,e)},Tensor.prototype.localResponseNormalization=function(e,t,r,n){return this.throwIfDisposed(),localResponseNormalization(this,e,t,r,n)},Tensor.prototype.logSigmoid=function(){return this.throwIfDisposed(),logSigmoid(this)},Tensor.prototype.logSoftmax=function(e){return this.throwIfDisposed(),logSoftmax(this,e)},Tensor.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),logSumExp(this,e,t)},Tensor.prototype.log=function(){return this.throwIfDisposed(),log(this)},Tensor.prototype.log1p=function(){return this.throwIfDisposed(),log1p(this)},Tensor.prototype.logicalAnd=function(e){return this.throwIfDisposed(),logicalAnd(this,e)},Tensor.prototype.logicalNot=function(){return this.throwIfDisposed(),logicalNot(this)},Tensor.prototype.logicalOr=function(e){return this.throwIfDisposed(),logicalOr(this,e)},Tensor.prototype.logicalXor=function(e){return this.throwIfDisposed(),logicalXor(this,e)},Tensor.prototype.matMul=function(e,t,r){return this.throwIfDisposed(),matMul(this,e,t,r)},Tensor.prototype.maxPool=function(e,t,r,n){return this.throwIfDisposed(),maxPool(this,e,t,r,n)},Tensor.prototype.max=function(e,t){return this.throwIfDisposed(),max(this,e,t)},Tensor.prototype.maximumStrict=function(e){return this.throwIfDisposed(),maximumStrict(this,e)},Tensor.prototype.maximum=function(e){return this.throwIfDisposed(),maximum(this,e)},Tensor.prototype.mean=function(e,t){return this.throwIfDisposed(),mean(this,e,t)},Tensor.prototype.min=function(e,t){return this.throwIfDisposed(),min(this,e,t)},Tensor.prototype.minimumStrict=function(e){return this.throwIfDisposed(),minimumStrict(this,e)},Tensor.prototype.minimum=function(e){return this.throwIfDisposed(),minimum(this,e)},Tensor.prototype.modStrict=function(e){return this.throwIfDisposed(),modStrict(this,e)},Tensor.prototype.mod=function(e){return this.throwIfDisposed(),mod(this,e)},Tensor.prototype.mulStrict=function(e){return this.throwIfDisposed(),mulStrict(this,e)},Tensor.prototype.mul=function(e){return this.throwIfDisposed(),mul(this,e)},Tensor.prototype.neg=function(){return this.throwIfDisposed(),neg(this)},Tensor.prototype.norm=function(e,t,r){return this.throwIfDisposed(),norm(this,e,t,r)},Tensor.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),notEqualStrict(this,e)},Tensor.prototype.notEqual=function(e){return this.throwIfDisposed(),notEqual(this,e)},Tensor.prototype.oneHot=function(e,t,r){return void 0===t&&(t=1),void 0===r&&(r=0),this.throwIfDisposed(),oneHot(this,e,t,r)},Tensor.prototype.onesLike=function(){return this.throwIfDisposed(),onesLike(this)},Tensor.prototype.pad=function(e,t){return this.throwIfDisposed(),pad(this,e,t)},Tensor.prototype.pool=function(e,t,r,n,o){return this.throwIfDisposed(),pool(this,e,t,r,n,o)},Tensor.prototype.powStrict=function(e){return this.throwIfDisposed(),powStrict(this,e)},Tensor.prototype.pow=function(e){return this.throwIfDisposed(),pow(this,e)},Tensor.prototype.prelu=function(e){return this.throwIfDisposed(),prelu(this,e)},Tensor.prototype.prod=function(e,t){return this.throwIfDisposed(),prod(this,e,t)},Tensor.prototype.reciprocal=function(){return this.throwIfDisposed(),reciprocal(this)},Tensor.prototype.relu=function(){return this.throwIfDisposed(),relu(this)},Tensor.prototype.relu6=function(){return this.throwIfDisposed(),relu6(this)},Tensor.prototype.reshapeAs=function(e){return this.throwIfDisposed(),reshape(this,e.shape)},Tensor.prototype.reshape=function(e){return this.throwIfDisposed(),reshape(this,e)},Tensor.prototype.resizeBilinear=function(e,t){return this.throwIfDisposed(),resizeBilinear(this,e,t)},Tensor.prototype.resizeNearestNeighbor=function(e,t){return this.throwIfDisposed(),resizeNearestNeighbor(this,e,t)},Tensor.prototype.reverse=function(e){return this.throwIfDisposed(),reverse(this,e)},Tensor.prototype.rfft=function(){return this.throwIfDisposed(),rfft(this)},Tensor.prototype.round=function(){return this.throwIfDisposed(),round(this)},Tensor.prototype.rsqrt=function(){return this.throwIfDisposed(),rsqrt(this)},Tensor.prototype.selu=function(){return this.throwIfDisposed(),selu(this)},Tensor.prototype.separableConv2d=function(e,t,r,n,o,a){return this.throwIfDisposed(),separableConv2d(this,e,t,r,n,o,a)},Tensor.prototype.sigmoid=function(){return this.throwIfDisposed(),sigmoid(this)},Tensor.prototype.sign=function(){return this.throwIfDisposed(),sign(this)},Tensor.prototype.sin=function(){return this.throwIfDisposed(),sin(this)},Tensor.prototype.sinh=function(){return this.throwIfDisposed(),sinh(this)},Tensor.prototype.slice=function(e,t){return this.throwIfDisposed(),slice(this,e,t)},Tensor.prototype.softmax=function(e){return this.throwIfDisposed(),softmax(this,e)},Tensor.prototype.softplus=function(){return this.throwIfDisposed(),softplus(this)},Tensor.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),spaceToBatchND(this,e,t)},Tensor.prototype.split=function(e,t){return this.throwIfDisposed(),split(this,e,t)},Tensor.prototype.sqrt=function(){return this.throwIfDisposed(),sqrt(this)},Tensor.prototype.square=function(){return this.throwIfDisposed(),square(this)},Tensor.prototype.squaredDifference=function(e){return this.throwIfDisposed(),squaredDifference(this,e)},Tensor.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),squaredDifferenceStrict(this,e)},Tensor.prototype.squeeze=function(e){return this.throwIfDisposed(),squeeze(this,e)},Tensor.prototype.stack=function(e,t){this.throwIfDisposed();var r=e instanceof Tensor?[this,e]:[this].concat(e);return stack(r,t)},Tensor.prototype.step=function(e){return this.throwIfDisposed(),step(this,e)},Tensor.prototype.stridedSlice=function(e,t,r,n,o,a,s,i){return this.throwIfDisposed(),stridedSlice(this,e,t,r,n,o,a,s,i)},Tensor.prototype.subStrict=function(e){return this.throwIfDisposed(),subStrict(this,e)},Tensor.prototype.sub=function(e){return this.throwIfDisposed(),sub(this,e)},Tensor.prototype.sum=function(e,t){return this.throwIfDisposed(),sum$1(this,e,t)},Tensor.prototype.tan=function(){return this.throwIfDisposed(),tan(this)},Tensor.prototype.tanh=function(){return this.throwIfDisposed(),tanh$1(this)},Tensor.prototype.tile=function(e){return this.throwIfDisposed(),tile(this,e)},Tensor.prototype.toBool=function(){return this.throwIfDisposed(),cast(this,"bool")},Tensor.prototype.toFloat=function(){return this.throwIfDisposed(),cast(this,"float32")},Tensor.prototype.toInt=function(){return this.throwIfDisposed(),cast(this,"int32")},Tensor.prototype.topk=function(e,t){return this.throwIfDisposed(),topk(this,e,t)},Tensor.prototype.transpose=function(e){return this.throwIfDisposed(),transpose(this,e)},Tensor.prototype.unique=function(e){return this.throwIfDisposed(),unique(this,e)},Tensor.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),unsortedSegmentSum(this,e,t)},Tensor.prototype.unstack=function(e){return this.throwIfDisposed(),unstack(this,e)},Tensor.prototype.where=function(e,t){return this.throwIfDisposed(),where(e,this,t)},Tensor.prototype.zerosLike=function(){return this.throwIfDisposed(),zerosLike(this)},exports.Abs=Abs,exports.Acos=Acos,exports.Acosh=Acosh,exports.AdadeltaOptimizer=AdadeltaOptimizer,exports.AdagradOptimizer=AdagradOptimizer,exports.AdamOptimizer=AdamOptimizer,exports.AdamaxOptimizer=AdamaxOptimizer,exports.Add=Add,exports.AddN=AddN,exports.All=All,exports.Any=Any,exports.ArgMax=ArgMax,exports.ArgMin=ArgMin,exports.Asin=Asin,exports.Asinh=Asinh,exports.Atan=Atan,exports.Atan2=Atan2,exports.Atanh=Atanh,exports.AvgPool=AvgPool,exports.AvgPool3D=AvgPool3D,exports.AvgPool3DBackprop=AvgPool3DBackprop,exports.AvgPoolBackprop=AvgPoolBackprop,exports.BatchMatMul=BatchMatMul,exports.BatchToSpaceND=BatchToSpaceND,exports.BroadcastTo=BroadcastTo,exports.Cast=Cast,exports.Ceil=Ceil,exports.ClipByValue=ClipByValue,exports.Complex=Complex,exports.Concat=Concat,exports.Conv2D=Conv2D,exports.Conv2DBackpropFilter=Conv2DBackpropFilter,exports.Conv2DBackpropInput=Conv2DBackpropInput,exports.Conv3D=Conv3D,exports.Conv3DBackpropFilterV2=Conv3DBackpropFilterV2,exports.Conv3DBackpropInputV2=Conv3DBackpropInputV2,exports.Cos=Cos,exports.Cosh=Cosh,exports.CropAndResize=CropAndResize,exports.Cumsum=Cumsum,exports.DataStorage=DataStorage,exports.DepthToSpace=DepthToSpace,exports.DepthwiseConv2dNative=DepthwiseConv2dNative,exports.DepthwiseConv2dNativeBackpropFilter=DepthwiseConv2dNativeBackpropFilter,exports.DepthwiseConv2dNativeBackpropInput=DepthwiseConv2dNativeBackpropInput,exports.Diag=Diag,exports.Dilation2D=Dilation2D,exports.Dilation2DBackpropFilter=Dilation2DBackpropFilter,exports.Dilation2DBackpropInput=Dilation2DBackpropInput,exports.Div=Div,exports.Elu=Elu,exports.EluGrad=EluGrad,exports.Environment=Environment,exports.Equal=Equal,exports.Erf=Erf,exports.Exp=Exp,exports.Expm1=Expm1,exports.FFT=FFT,exports.Fill=Fill,exports.FlipLeftRight=FlipLeftRight,exports.Floor=Floor,exports.FloorDiv=FloorDiv,exports.FromPixels=FromPixels,exports.FusedBatchNorm=FusedBatchNorm,exports.FusedConv2D=FusedConv2D,exports.FusedDepthwiseConv2D=FusedDepthwiseConv2D,exports.GatherNd=GatherNd,exports.GatherV2=GatherV2,exports.Greater=Greater,exports.GreaterEqual=GreaterEqual,exports.IFFT=IFFT,exports.Identity=Identity,exports.Imag=Imag,exports.IsFinite=IsFinite,exports.IsInf=IsInf,exports.IsNan=IsNan,exports.KernelBackend=KernelBackend,exports.LRN=LRN,exports.LRNBackprop=LRNBackprop,exports.Less=Less,exports.LessEqual=LessEqual,exports.LinSpace=LinSpace,exports.Log=Log,exports.Log1p=Log1p,exports.LogSoftmax=LogSoftmax,exports.LogicalAnd=LogicalAnd,exports.LogicalNot=LogicalNot,exports.LogicalOr=LogicalOr,exports.Max=Max,exports.MaxPool=MaxPool,exports.MaxPool3D=MaxPool3D,exports.MaxPool3DBackprop=MaxPool3DBackprop,exports.MaxPoolBackprop=MaxPoolBackprop,exports.MaxPoolWithArgmax=MaxPoolWithArgmax,exports.Maximum=Maximum,exports.Mean=Mean,exports.Min=Min,exports.Minimum=Minimum,exports.Mod=Mod,exports.MomentumOptimizer=MomentumOptimizer,exports.Multiply=Multiply,exports.Negate=Negate,exports.NonMaxSuppressionV3=NonMaxSuppressionV3,exports.NonMaxSuppressionV4=NonMaxSuppressionV4,exports.NonMaxSuppressionV5=NonMaxSuppressionV5,exports.NotEqual=NotEqual,exports.OP_SCOPE_SUFFIX=OP_SCOPE_SUFFIX,exports.OneHot=OneHot,exports.OnesLike=OnesLike,exports.Optimizer=Optimizer,exports.PadV2=PadV2,exports.Pool=Pool,exports.Pow=Pow,exports.Prelu=Prelu,exports.Prod=Prod,exports.RMSPropOptimizer=RMSPropOptimizer,exports.Range=Range,exports.Real=Real,exports.Reciprocal=Reciprocal,exports.Relu=Relu,exports.Relu6=Relu6,exports.Reshape=Reshape,exports.ResizeBilinear=ResizeBilinear,exports.ResizeBilinearGrad=ResizeBilinearGrad,exports.ResizeNearestNeighbor=ResizeNearestNeighbor,exports.ResizeNearestNeighborGrad=ResizeNearestNeighborGrad,exports.Reverse=Reverse,exports.RotateWithOffset=RotateWithOffset,exports.Round=Round,exports.Rsqrt=Rsqrt,exports.SGDOptimizer=SGDOptimizer,exports.ScatterNd=ScatterNd,exports.SelectV2=SelectV2,exports.Selu=Selu,exports.Sigmoid=Sigmoid,exports.Sign=Sign,exports.Sin=Sin,exports.Sinh=Sinh,exports.Slice=Slice,exports.Softmax=Softmax,exports.Softplus=Softplus,exports.SpaceToBatchND=SpaceToBatchND,exports.SparseToDense=SparseToDense,exports.SplitV=SplitV,exports.Sqrt=Sqrt,exports.Square=Square,exports.SquaredDifference=SquaredDifference,exports.Step=Step,exports.StridedSlice=StridedSlice,exports.Sub=Sub,exports.Sum=Sum,exports.Tan=Tan,exports.Tanh=Tanh,exports.Tensor=Tensor,exports.TensorBuffer=TensorBuffer,exports.Tile=Tile,exports.TopK=TopK,exports.Transpose=Transpose,exports.Unique=Unique,exports.Unpack=Unpack,exports.UnsortedSegmentSum=UnsortedSegmentSum,exports.Variable=Variable,exports.ZerosLike=ZerosLike,exports._FusedMatMul=_FusedMatMul,exports.abs=abs,exports.acos=acos,exports.acosh=acosh,exports.add=add$1,exports.addN=addN,exports.addStrict=addStrict,exports.all=all,exports.any=any,exports.argMax=argMax,exports.argMin=argMin,exports.asin=asin,exports.asinh=asinh,exports.atan=atan,exports.atan2=atan2,exports.atanh=atanh,exports.avgPool=avgPool,exports.avgPool3d=avgPool3d,exports.backend=backend,exports.backend_util=backend_util,exports.basicLSTMCell=basicLSTMCell,exports.batchNorm=batchNorm,exports.batchNorm2d=batchNorm2d,exports.batchNorm3d=batchNorm3d,exports.batchNorm4d=batchNorm4d,exports.batchToSpaceND=batchToSpaceND,exports.booleanMaskAsync=booleanMaskAsync,exports.broadcastTo=broadcastTo,exports.browser=browser,exports.buffer=buffer,exports.cast=cast,exports.ceil=ceil,exports.clipByValue=clipByValue,exports.clone=clone,exports.complex=complex,exports.concat=concat,exports.concat1d=concat1d,exports.concat2d=concat2d,exports.concat3d=concat3d,exports.concat4d=concat4d,exports.conv1d=conv1d,exports.conv2d=conv2d,exports.conv2dTranspose=conv2dTranspose,exports.conv3d=conv3d,exports.conv3dTranspose=conv3dTranspose,exports.copyRegisteredKernels=copyRegisteredKernels,exports.cos=cos,exports.cosh=cosh,exports.cosineWindow=cosineWindow,exports.cumsum=cumsum,exports.customGrad=customGrad,exports.deprecationWarn=deprecationWarn,exports.depthToSpace=depthToSpace,exports.depthwiseConv2d=depthwiseConv2d,exports.device_util=device_util,exports.diag=diag,exports.dilation2d=dilation2d,exports.disableDeprecationWarnings=disableDeprecationWarnings,exports.dispose=dispose,exports.disposeVariables=disposeVariables,exports.div=div,exports.divNoNan=divNoNan,exports.divStrict=divStrict,exports.dot=dot,exports.dropout=dropout,exports.elu=elu,exports.enableDebugMode=enableDebugMode,exports.enableProdMode=enableProdMode,exports.enclosingPowerOfTwo=enclosingPowerOfTwo,exports.engine=engine,exports.env=env,exports.equal=equal,exports.equalStrict=equalStrict,exports.erf=erf,exports.exp=exp,exports.expandDims=expandDims,exports.expm1=expm1,exports.eye=eye,exports.fft=fft,exports.fill=fill,exports.findBackend=findBackend,exports.findBackendFactory=findBackendFactory,exports.floor=floor,exports.floorDiv=floorDiv,exports.fused=fused_ops,exports.gather=gather,exports.gatherND=gatherND,exports.gather_util=gather_nd_util,exports.getBackend=getBackend,exports.getGradient=getGradient,exports.getKernel=getKernel,exports.getKernelsForBackend=getKernelsForBackend,exports.grad=grad,exports.grads=grads,exports.greater=greater,exports.greaterEqual=greaterEqual,exports.greaterEqualStrict=greaterEqualStrict,exports.greaterStrict=greaterStrict,exports.ifft=ifft,exports.imag=imag,exports.image=image,exports.inTopKAsync=inTopKAsync,exports.io=io,exports.irfft=irfft,exports.isFinite=isFinite$1,exports.isInf=isInf,exports.isNaN=isNaN$1,exports.keep=keep,exports.kernel_impls=kernel_impls,exports.leakyRelu=leakyRelu,exports.less=less,exports.lessEqual=lessEqual,exports.lessEqualStrict=lessEqualStrict,exports.lessStrict=lessStrict,exports.linalg=linalg,exports.linspace=linspace,exports.localResponseNormalization=localResponseNormalization,exports.log=log,exports.log1p=log1p,exports.logSigmoid=logSigmoid,exports.logSoftmax=logSoftmax,exports.logSumExp=logSumExp,exports.logicalAnd=logicalAnd,exports.logicalNot=logicalNot,exports.logicalOr=logicalOr,exports.logicalXor=logicalXor,exports.losses=losses,exports.matMul=matMul,exports.math=math,exports.max=max,exports.maxPool=maxPool,exports.maxPool3d=maxPool3d,exports.maxPoolWithArgmax=maxPoolWithArgmax,exports.maximum=maximum,exports.maximumStrict=maximumStrict,exports.mean=mean,exports.memory=memory,exports.min=min,exports.minimum=minimum,exports.minimumStrict=minimumStrict,exports.mod=mod,exports.modStrict=modStrict,exports.moments=moments,exports.movingAverage=movingAverage,exports.mul=mul,exports.mulStrict=mulStrict,exports.multiRNNCell=multiRNNCell,exports.multinomial=multinomial,exports.neg=neg,exports.nextFrame=nextFrame,exports.norm=norm,exports.notEqual=notEqual,exports.notEqualStrict=notEqualStrict,exports.oneHot=oneHot,exports.ones=ones$1,exports.onesLike=onesLike,exports.op=op,exports.outerProduct=outerProduct,exports.pad=pad,exports.pad1d=pad1d,exports.pad2d=pad2d,exports.pad3d=pad3d,exports.pad4d=pad4d,exports.pool=pool,exports.pow=pow,exports.powStrict=powStrict,exports.prelu=prelu,exports.print=print,exports.prod=prod,exports.profile=profile,exports.rand=rand,exports.randomGamma=randomGamma,exports.randomNormal=randomNormal,exports.randomUniform=randomUniform,exports.range=range,exports.ready=ready,exports.real=real,exports.reciprocal=reciprocal,exports.registerBackend=registerBackend,exports.registerGradient=registerGradient,exports.registerKernel=registerKernel,exports.relu=relu,exports.relu6=relu6,exports.removeBackend=removeBackend,exports.reshape=reshape,exports.reverse=reverse,exports.reverse1d=reverse1d,exports.reverse2d=reverse2d,exports.reverse3d=reverse3d,exports.reverse4d=reverse4d,exports.rfft=rfft,exports.round=round,exports.rsqrt=rsqrt,exports.scalar=scalar,exports.scatterND=scatterND,exports.scatter_util=scatter_nd_util,exports.selu=selu,exports.separableConv2d=separableConv2d,exports.serialization=serialization,exports.setBackend=setBackend,exports.setPlatform=setPlatform,exports.setdiff1dAsync=setdiff1dAsync,exports.sigmoid=sigmoid,exports.sign=sign,exports.signal=signal,exports.sin=sin,exports.sinh=sinh,exports.slice=slice,exports.slice1d=slice1d,exports.slice2d=slice2d,exports.slice3d=slice3d,exports.slice4d=slice4d,exports.slice_util=slice_util,exports.softmax=softmax,exports.softplus=softplus,exports.spaceToBatchND=spaceToBatchND,exports.sparseToDense=sparseToDense,exports.spectral=spectral,exports.split=split,exports.sqrt=sqrt,exports.square=square,exports.squaredDifference=squaredDifference,exports.squaredDifferenceStrict=squaredDifferenceStrict,exports.squeeze=squeeze,exports.stack=stack,exports.step=step,exports.stridedSlice=stridedSlice,exports.sub=sub,exports.subStrict=subStrict,exports.sum=sum$1,exports.sumOutType=sumOutType,exports.tan=tan,exports.tanh=tanh$1,exports.tensor=tensor,exports.tensor1d=tensor1d,exports.tensor2d=tensor2d,exports.tensor3d=tensor3d,exports.tensor4d=tensor4d,exports.tensor5d=tensor5d,exports.tensor6d=tensor6d,exports.tensor_util=tensor_util,exports.test_util=test_util,exports.tidy=tidy,exports.tile=tile,exports.time=time,exports.topk=topk,exports.train=train,exports.transpose=transpose,exports.truncatedNormal=truncatedNormal,exports.unique=unique,exports.unregisterGradient=unregisterGradient,exports.unregisterKernel=unregisterKernel,exports.unsortedSegmentSum=unsortedSegmentSum,exports.unstack=unstack,exports.upcastType=upcastType,exports.util=util,exports.valueAndGrad=valueAndGrad,exports.valueAndGrads=valueAndGrads,exports.variable=variable,exports.variableGrads=variableGrads,exports.version_core=version,exports.where=where,exports.whereAsync=whereAsync,exports.zeros=zeros,exports.zerosLike=zerosLike;

}).call(this)}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {},require("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],require("timers").setImmediate)
},{"_process":26,"buffer":17,"crypto":15,"node-fetch":15,"timers":38,"util":15}],14:[function(require,module,exports){
"use strict";exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(o){var r=o.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=o.indexOf("=");return-1===e&&(e=r),[e,e===r?0:4-e%4]}function byteLength(o){var r=getLens(o),e=r[0],t=r[1];return 3*(e+t)/4-t}function _byteLength(o,r,e){return 3*(r+e)/4-e}function toByteArray(o){var r,e,t=getLens(o),n=t[0],u=t[1],p=new Arr(_byteLength(o,n,u)),a=0,h=u>0?n-4:n;for(e=0;e<h;e+=4)r=revLookup[o.charCodeAt(e)]<<18|revLookup[o.charCodeAt(e+1)]<<12|revLookup[o.charCodeAt(e+2)]<<6|revLookup[o.charCodeAt(e+3)],p[a++]=r>>16&255,p[a++]=r>>8&255,p[a++]=255&r;return 2===u&&(r=revLookup[o.charCodeAt(e)]<<2|revLookup[o.charCodeAt(e+1)]>>4,p[a++]=255&r),1===u&&(r=revLookup[o.charCodeAt(e)]<<10|revLookup[o.charCodeAt(e+1)]<<4|revLookup[o.charCodeAt(e+2)]>>2,p[a++]=r>>8&255,p[a++]=255&r),p}function tripletToBase64(o){return lookup[o>>18&63]+lookup[o>>12&63]+lookup[o>>6&63]+lookup[63&o]}function encodeChunk(o,r,e){for(var t,n=[],u=r;u<e;u+=3)t=(o[u]<<16&16711680)+(o[u+1]<<8&65280)+(255&o[u+2]),n.push(tripletToBase64(t));return n.join("")}function fromByteArray(o){for(var r,e=o.length,t=e%3,n=[],u=0,p=e-t;u<p;u+=16383)n.push(encodeChunk(o,u,u+16383>p?p:u+16383));return 1===t?(r=o[e-1],n.push(lookup[r>>2]+lookup[r<<4&63]+"==")):2===t&&(r=(o[e-2]<<8)+o[e-1],n.push(lookup[r>>10]+lookup[r>>4&63]+lookup[r<<2&63]+"=")),n.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63;

},{}],15:[function(require,module,exports){

},{}],16:[function(require,module,exports){
var objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(e){hasDefineProperty=!1}function $getMaxListeners(e){return void 0===e._maxListeners?EventEmitter.defaultMaxListeners:e._maxListeners}function emitNone(e,t,n){if(t)e.call(n);else for(var r=e.length,i=arrayClone(e,r),s=0;s<r;++s)i[s].call(n)}function emitOne(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].call(n,r)}function emitTwo(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=arrayClone(e,s),a=0;a<s;++a)o[a].call(n,r,i)}function emitThree(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,a=arrayClone(e,o),l=0;l<o;++l)a[l].call(n,r,i,s)}function emitMany(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].apply(n,r)}function _addListener(e,t,n,r){var i,s,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]):(s=e._events=objectCreate(null),e._eventsCount=0),o){if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=$getMaxListeners(e))&&i>0&&o.length>i){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else o=s[t]=n,++e._eventsCount;return e}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function _onceWrap(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=bind.call(onceWrapper,r);return i.listener=n,r.wrapFn=i,i}function _listeners(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?unwrapListeners(i):arrayClone(i,i.length):[]}function listenerCount(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}function arrayClone(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function unwrapListeners(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function objectCreatePolyfill(e){var t=function(){};return t.prototype=e,new t}function objectKeysPolyfill(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function functionBindPolyfill(e){var t=this;return function(){return t.apply(e,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=e}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(e){var t,n,r,i,s,o,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=o[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,u,this);break;case 2:emitOne(n,u,this,arguments[1]);break;case 3:emitTwo(n,u,this,arguments[1],arguments[2]);break;case 4:emitThree(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];emitMany(n,u,this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.removeListener=function(e,t){var n,r,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=objectCreate(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():spliceOne(n,i),1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,o||t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n,r;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=objectCreate(null):delete n[e]),this;if(0===arguments.length){var i,s=objectKeys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},EventEmitter.prototype.listeners=function(e){return _listeners(this,e,!0)},EventEmitter.prototype.rawListeners=function(e){return _listeners(this,e,!1)},EventEmitter.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};

},{}],17:[function(require,module,exports){
(function (Buffer){(function (){
"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function typedArraySupport(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}function createBuffer(e){if(e>K_MAX_LENGTH)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=Buffer.prototype,t}function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(e)}return from(e,t,r)}function from(e,t,r){if("string"==typeof e)return fromString(e,t);if(ArrayBuffer.isView(e))return fromArrayLike(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(isInstance(e,ArrayBuffer)||e&&isInstance(e.buffer,ArrayBuffer))return fromArrayBuffer(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var f=fromObject(e);if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function alloc(e,t,r){return assertSize(e),e<=0?createBuffer(e):void 0!==t?"string"==typeof r?createBuffer(e).fill(t,r):createBuffer(e).fill(t):createBuffer(e)}function allocUnsafe(e){return assertSize(e),createBuffer(e<0?0:0|checked(e))}function fromString(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|byteLength(e,t),n=createBuffer(r),f=n.write(e,t);return f!==r&&(n=n.slice(0,f)),n}function fromArrayLike(e){for(var t=e.length<0?0:0|checked(e.length),r=createBuffer(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function fromArrayBuffer(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r)).__proto__=Buffer.prototype,n}function fromObject(e){if(Buffer.isBuffer(e)){var t=0|checked(e.length),r=createBuffer(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}return void 0!==e.length?"number"!=typeof e.length||numberIsNaN(e.length)?createBuffer(0):fromArrayLike(e):"Buffer"===e.type&&Array.isArray(e.data)?fromArrayLike(e.data):void 0}function checked(e){if(e>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer.alloc(+e)}function byteLength(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||isInstance(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var f=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(f)return n?-1:utf8ToBytes(e).length;t=(""+t).toLowerCase(),f=!0}}function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,f){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),numberIsNaN(r=+r)&&(r=f?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(f)return-1;r=e.length-1}else if(r<0){if(!f)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,f);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,f);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,f){var i,o=1,u=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,u/=2,s/=2,r/=2}function a(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(f){var h=-1;for(i=r;i<u;i++)if(a(e,i)===a(t,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===s)return h*o}else-1!==h&&(i-=i-h),h=-1}else for(r+s>u&&(r=u-s),i=r;i>=0;i--){for(var c=!0,l=0;l<s;l++)if(a(e,i+l)!==a(t,l)){c=!1;break}if(c)return i}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var f=e.length-r;n?(n=Number(n))>f&&(n=f):n=f;var i=t.length;n>i/2&&(n=i/2);for(var o=0;o<n;++o){var u=parseInt(t.substr(2*o,2),16);if(numberIsNaN(u))return o;e[r+o]=u}return o}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(asciiToBytes(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?base64.fromByteArray(e):base64.fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],f=t;f<r;){var i,o,u,s,a=e[f],h=null,c=a>239?4:a>223?3:a>191?2:1;if(f+c<=r)switch(c){case 1:a<128&&(h=a);break;case 2:128==(192&(i=e[f+1]))&&(s=(31&a)<<6|63&i)>127&&(h=s);break;case 3:i=e[f+1],o=e[f+2],128==(192&i)&&128==(192&o)&&(s=(15&a)<<12|(63&i)<<6|63&o)>2047&&(s<55296||s>57343)&&(h=s);break;case 4:i=e[f+1],o=e[f+2],u=e[f+3],128==(192&i)&&128==(192&o)&&128==(192&u)&&(s=(15&a)<<18|(63&i)<<12|(63&o)<<6|63&u)>65535&&s<1114112&&(h=s)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),f+=c}return decodeCodePointsArray(n)}exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(e,t,r){return from(e,t,r)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(e,t,r){return alloc(e,t,r)},Buffer.allocUnsafe=function(e){return allocUnsafe(e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(e)},Buffer.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function(e,t){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,f=0,i=Math.min(r,n);f<i;++f)if(e[f]!==t[f]){r=e[f],n=t[f];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),f=0;for(r=0;r<e.length;++r){var i=e[r];if(isInstance(i,Uint8Array)&&(i=Buffer.from(i)),!Buffer.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,f),f+=i.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",t=exports.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,t,r,n,f){if(isInstance(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===f&&(f=this.length),t<0||r>e.length||n<0||f>this.length)throw new RangeError("out of range index");if(n>=f&&t>=r)return 0;if(n>=f)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(f>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),u=Math.min(i,o),s=this.slice(n,f),a=e.slice(t,r),h=0;h<u;++h)if(s[h]!==a[h]){i=s[h],o=a[h];break}return i<o?-1:o<i?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var f=this.length-t;if((void 0===r||r>f)&&(r=f),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var f=t;f<r;++f)n+=String.fromCharCode(127&e[f]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var f=t;f<r;++f)n+=String.fromCharCode(e[f]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var f="",i=t;i<r;++i)f+=toHex(e[i]);return f}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),f="",i=0;i<n.length;i+=2)f+=String.fromCharCode(n[i]+256*n[i+1]);return f}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,f,i){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>f||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function checkIEEE754(e,t,r,n,f,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,f){return t=+t,r>>>=0,f||checkIEEE754(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,f){return t=+t,r>>>=0,f||checkIEEE754(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=Buffer.prototype,n},Buffer.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],f=1,i=0;++i<t&&(f*=256);)n+=this[e+i]*f;return n},Buffer.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],f=1;t>0&&(f*=256);)n+=this[e+--t]*f;return n},Buffer.prototype.readUInt8=function(e,t){return e>>>=0,t||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,t){return e>>>=0,t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=this[e],f=1,i=0;++i<t&&(f*=256);)n+=this[e+i]*f;return n>=(f*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||checkOffset(e,t,this.length);for(var n=t,f=1,i=this[e+--n];n>0&&(f*=256);)i+=this[e+--n]*f;return i>=(f*=128)&&(i-=Math.pow(2,8*t)),i},Buffer.prototype.readInt8=function(e,t){return e>>>=0,t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){e>>>=0,t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),ieee754.read(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return e>>>=0,t||checkOffset(e,4,this.length),ieee754.read(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return e>>>=0,t||checkOffset(e,8,this.length),ieee754.read(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return e>>>=0,t||checkOffset(e,8,this.length),ieee754.read(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var f=1,i=0;for(this[t]=255&e;++i<r&&(f*=256);)this[t+i]=e/f&255;return t+r},Buffer.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var f=r-1,i=1;for(this[t+f]=255&e;--f>=0&&(i*=256);)this[t+f]=e/i&255;return t+r},Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,e,t,r,f-1,-f)}var i=0,o=1,u=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===u&&0!==this[t+i-1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var f=Math.pow(2,8*r-1);checkInt(this,e,t,r,f-1,-f)}var i=r-1,o=1,u=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===u&&0!==this[t+i+1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var f=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=f-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return f},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var f=e.charCodeAt(0);("utf8"===n&&f<128||"latin1"===n)&&(e=f)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=Buffer.isBuffer(e)?e:Buffer.from(e,n),u=o.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%u]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(e){if((e=(e=e.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,f=null,i=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!f){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}f=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),f=r;continue}r=65536+(f-55296<<10|r-56320)}else f&&(t-=3)>-1&&i.push(239,191,189);if(f=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,n,f,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,f=r%256,i.push(f),i.push(n);return i}function base64ToBytes(e){return base64.toByteArray(base64clean(e))}function blitBuffer(e,t,r,n){for(var f=0;f<n&&!(f+r>=t.length||f>=e.length);++f)t[f+r]=e[f];return f}function isInstance(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function numberIsNaN(e){return e!=e}

}).call(this)}).call(this,require("buffer").Buffer)
},{"base64-js":14,"buffer":17,"ieee754":24}],18:[function(require,module,exports){
module.exports=function(e){"string"==typeof e&&(e=[e]);for(var n=[].slice.call(arguments,1),o=[],r=0;r<e.length-1;r++)o.push(e[r],n[r]||"");return o.push(e[r]),o.join("")};

},{}],19:[function(require,module,exports){
function _cross(n,e,t){return(e[0]-n[0])*(t[1]-n[1])-(e[1]-n[1])*(t[0]-n[0])}function _upperTangent(n){const e=[];for(let t=0;t<n.length;t++){for(;e.length>=2&&_cross(e[e.length-2],e[e.length-1],n[t])<=0;)e.pop();e.push(n[t])}return e.pop(),e}function _lowerTangent(n){const e=n.reverse(),t=[];for(let n=0;n<e.length;n++){for(;t.length>=2&&_cross(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}return t.pop(),t}function convex(n){const e=_upperTangent(n),t=_lowerTangent(n).concat(e);return t.push(n[0]),t}module.exports=convex;

},{}],20:[function(require,module,exports){
module.exports={toXy:function(n,t){return void 0===t?n.slice():n.map(function(n){return new Function("pt","return [pt"+t[0]+",pt"+t[1]+"];")(n)})},fromXy:function(n,t){return void 0===t?n.slice():n.map(function(n){return new Function("pt","const o = {}; o"+t[0]+"= pt[0]; o"+t[1]+"= pt[1]; return o;")(n)})}};

},{}],21:[function(require,module,exports){
function Grid(e,l){this._cells=[],this._cellSize=l,this._reverseCellSize=1/l;for(let l=0;l<e.length;l++){const t=e[l],o=this.coordToCellNum(t[0]),i=this.coordToCellNum(t[1]);if(this._cells[o])this._cells[o][i]?this._cells[o][i].push(t):this._cells[o][i]=[t];else{const e=[];e[i]=[t],this._cells[o]=e}}}function grid(e,l){return new Grid(e,l)}Grid.prototype={cellPoints:function(e,l){return void 0!==this._cells[e]&&void 0!==this._cells[e][l]?this._cells[e][l]:[]},rangePoints:function(e){const l=this.coordToCellNum(e[0]),t=this.coordToCellNum(e[1]),o=this.coordToCellNum(e[2]),i=this.coordToCellNum(e[3]),s=[];for(let e=l;e<=o;e++)for(let l=t;l<=i;l++)Array.prototype.push.apply(s,this.cellPoints(e,l));return s},removePoint:function(e){const l=this.coordToCellNum(e[0]),t=this.coordToCellNum(e[1]),o=this._cells[l][t];let i;for(let l=0;l<o.length;l++)if(o[l][0]===e[0]&&o[l][1]===e[1]){i=l;break}return o.splice(i,1),o},trunc:Math.trunc||function(e){return e-e%1},coordToCellNum:function(e){return this.trunc(e*this._reverseCellSize)},extendBbox:function(e,l){return[e[0]-l*this._cellSize,e[1]-l*this._cellSize,e[2]+l*this._cellSize,e[3]+l*this._cellSize]}},module.exports=grid;

},{}],22:[function(require,module,exports){
"use strict";const intersect=require("./intersect.js"),grid=require("./grid.js"),formatUtil=require("./format.js"),convexHull=require("./convex.js");function _filterDuplicates(t){const n=[t[0]];let e=t[0];for(let r=1;r<t.length;r++){const o=t[r];e[0]===o[0]&&e[1]===o[1]||n.push(o),e=o}return n}function _sortByX(t){return t.sort(function(t,n){return t[0]-n[0]||t[1]-n[1]})}function _sqLength(t,n){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function _cos(t,n,e){const r=[n[0]-t[0],n[1]-t[1]],o=[e[0]-t[0],e[1]-t[1]],c=_sqLength(t,n),i=_sqLength(t,e);return(r[0]*o[0]+r[1]*o[1])/Math.sqrt(c*i)}function _intersect(t,n){for(let e=0;e<n.length-1;e++){const r=[n[e],n[e+1]];if(!(t[0][0]===r[0][0]&&t[0][1]===r[0][1]||t[0][0]===r[1][0]&&t[0][1]===r[1][1])&&intersect(t,r))return!0}return!1}function _occupiedArea(t){let n=1/0,e=1/0,r=-1/0,o=-1/0;for(let c=t.length-1;c>=0;c--)t[c][0]<n&&(n=t[c][0]),t[c][1]<e&&(e=t[c][1]),t[c][0]>r&&(r=t[c][0]),t[c][1]>o&&(o=t[c][1]);return[r-n,o-e]}function _bBoxAround(t){return[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}function _midPoint(t,n,e){let r,o,c=null,i=MAX_CONCAVE_ANGLE_COS,u=MAX_CONCAVE_ANGLE_COS;for(let l=0;l<n.length;l++)r=_cos(t[0],t[1],n[l]),o=_cos(t[1],t[0],n[l]),r>i&&o>u&&!_intersect([t[0],n[l]],e)&&!_intersect([t[1],n[l]],e)&&(i=r,u=o,c=n[l]);return c}function _concave(t,n,e,r,o){let c=!1;for(let i=0;i<t.length-1;i++){const u=[t[i],t[i+1]],l=u[0][0]+","+u[0][1]+","+u[1][0]+","+u[1][1];if(_sqLength(u[0],u[1])<n||o.has(l))continue;let _,s,f,a=0,h=_bBoxAround(u);do{_=(h=r.extendBbox(h,a))[2]-h[0],s=h[3]-h[1],f=_midPoint(u,r.rangePoints(h),t),a++}while(null===f&&(e[0]>_||e[1]>s));_>=e[0]&&s>=e[1]&&o.add(l),null!==f&&(t.splice(i+1,0,f),r.removePoint(f),c=!0)}return c?_concave(t,n,e,r,o):t}function hull(t,n,e){let r=n||20;const o=_filterDuplicates(_sortByX(formatUtil.toXy(t,e)));if(o.length<4)return o.concat([o[0]]);const c=_occupiedArea(o),i=[c[0]*MAX_SEARCH_BBOX_SIZE_PERCENT,c[1]*MAX_SEARCH_BBOX_SIZE_PERCENT],u=convexHull(o),l=o.filter(function(t){return u.indexOf(t)<0}),_=Math.ceil(1/(o.length/(c[0]*c[1]))),s=_concave(u,Math.pow(r,2),i,grid(l,_),new Set);return e?formatUtil.fromXy(s,e):s}const MAX_CONCAVE_ANGLE_COS=Math.cos(90/(180/Math.PI)),MAX_SEARCH_BBOX_SIZE_PERCENT=.6;module.exports=hull;

},{"./convex.js":19,"./format.js":20,"./grid.js":21,"./intersect.js":23}],23:[function(require,module,exports){
function ccw(c,t,n,e,r,o){const s=(o-t)*(n-c)-(e-t)*(r-c);return s>0||!(s<0)}function intersect(c,t){const n=c[0][0],e=c[0][1],r=c[1][0],o=c[1][1],s=t[0][0],u=t[0][1],w=t[1][0],i=t[1][1];return ccw(n,e,s,u,w,i)!==ccw(r,o,s,u,w,i)&&ccw(n,e,r,o,s,u)!==ccw(n,e,r,o,w,i)}module.exports=intersect;

},{}],24:[function(require,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),(o+=p+N>=1?n/f:n*Math.pow(2,1-N))*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};

},{}],25:[function(require,module,exports){
(function (process){(function (){
function normalizeArray(r,t){for(var e=0,n=r.length-1;n>=0;n--){var o=r[n];"."===o?r.splice(n,1):".."===o?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}function basename(r){"string"!=typeof r&&(r+="");var t,e=0,n=-1,o=!0;for(t=r.length-1;t>=0;--t)if(47===r.charCodeAt(t)){if(!o){e=t+1;break}}else-1===n&&(o=!1,n=t+1);return-1===n?"":r.slice(e,n)}function filter(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}exports.resolve=function(){for(var r="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var n=e>=0?arguments[e]:process.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(r=n+"/"+r,t="/"===n.charAt(0))}return(t?"/":"")+(r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"))||"."},exports.normalize=function(r){var t=exports.isAbsolute(r),e="/"===substr(r,-1);return(r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"))||t||(r="."),r&&e&&(r+="/"),(t?"/":"")+r},exports.isAbsolute=function(r){return"/"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(r,function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split("/")),o=e(t.split("/")),s=Math.min(n.length,o.length),i=s,u=0;u<s;u++)if(n[u]!==o[u]){i=u;break}var l=[];for(u=i;u<n.length;u++)l.push("..");return(l=l.concat(o.slice(i))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(r){if("string"!=typeof r&&(r+=""),0===r.length)return".";for(var t=r.charCodeAt(0),e=47===t,n=-1,o=!0,s=r.length-1;s>=1;--s)if(47===(t=r.charCodeAt(s))){if(!o){n=s;break}}else o=!1;return-1===n?e?"/":".":e&&1===n?"/":r.slice(0,n)},exports.basename=function(r,t){var e=basename(r);return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},exports.extname=function(r){"string"!=typeof r&&(r+="");for(var t=-1,e=0,n=-1,o=!0,s=0,i=r.length-1;i>=0;--i){var u=r.charCodeAt(i);if(47!==u)-1===n&&(o=!1,n=i+1),46===u?-1===t?t=i:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){e=i+1;break}}return-1===t||-1===n||0===s||1===s&&t===n-1&&t===e+1?"":r.slice(t,n)};var substr="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return t<0&&(t=r.length+t),r.substr(t,e)};

}).call(this)}).call(this,require('_process'))
},{"_process":26}],26:[function(require,module,exports){
var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],27:[function(require,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.createREGL=t()}(this,function(){function e(e,t){this.id=H++,this.type=e,this.data=t}function t(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(1<t.length&&r===n&&('"'===r||"'"===r))return['"'+t.substr(1,t.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t))return e(t.substr(0,r.index)).concat(e(r[1])).concat(e(t.substr(r.index+r[0].length)));if(1===(r=t.split(".")).length)return['"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(t=[],n=0;n<r.length;++n)t=t.concat(e(r[n]));return t}(e).join("][")+"]"}function r(e){return"string"==typeof e?e.split():e}function n(e){return"string"==typeof e?document.querySelector(e):e}function i(e){var t,i,a,f,o=e||{};e={};var u=[],s=[],c="undefined"==typeof window?1:window.devicePixelRatio,l=!1,p=function(e){},d=function(){};if("string"==typeof o?t=document.querySelector(o):"object"==typeof o&&("string"==typeof o.nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?t=o:"function"==typeof o.drawArrays||"function"==typeof o.drawElements?a=(f=o).canvas:("gl"in o?f=o.gl:"canvas"in o?a=n(o.canvas):"container"in o&&(i=n(o.container)),"attributes"in o&&(e=o.attributes),"extensions"in o&&(u=r(o.extensions)),"optionalExtensions"in o&&(s=r(o.optionalExtensions)),"onDone"in o&&(p=o.onDone),"profile"in o&&(l=!!o.profile),"pixelRatio"in o&&(c=+o.pixelRatio))),t&&("canvas"===t.nodeName.toLowerCase()?a=t:i=t),!f){if(!a){if(!(t=function(e,t,r){function n(){var t=window.innerWidth,n=window.innerHeight;e!==document.body&&(t=(n=e.getBoundingClientRect()).right-n.left,n=n.bottom-n.top),a.width=r*t,a.height=r*n,R(a.style,{width:t+"px",height:n+"px"})}var i,a=document.createElement("canvas");return R(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",R(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver(function(){setTimeout(n)})).observe(e):window.addEventListener("resize",n,!1),n(),{canvas:a,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",n),e.removeChild(a)}}}(i||document.body,0,c)))return null;a=t.canvas,d=t.onDestroy}void 0===e.premultipliedAlpha&&(e.premultipliedAlpha=!0),f=function(e,t){function r(r){try{return e.getContext(r,t)}catch(e){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(a,e)}return f?{gl:f,canvas:a,container:i,extensions:u,optionalExtensions:s,pixelRatio:c,profile:l,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function a(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}function f(e){var t,r;return t=(65535<e)<<4,t|=r=(255<(e>>>=t))<<3,(t|=r=(15<(e>>>=r))<<2)|(r=(3<(e>>>=r))<<1)|e>>>r>>1}function o(){function e(e){e:{for(var t=16;268435456>=t;t*=16)if(e<=t){e=t;break e}e=0}return 0<(t=r[f(e)>>2]).length?t.pop():new ArrayBuffer(e)}function t(e){r[f(e.byteLength)>>2].push(e)}var r=a(8,function(){return[]});return{alloc:e,free:t,allocType:function(t,r){var n=null;switch(t){case 5120:n=new Int8Array(e(r),0,r);break;case 5121:n=new Uint8Array(e(r),0,r);break;case 5122:n=new Int16Array(e(2*r),0,r);break;case 5123:n=new Uint16Array(e(2*r),0,r);break;case 5124:n=new Int32Array(e(4*r),0,r);break;case 5125:n=new Uint32Array(e(4*r),0,r);break;case 5126:n=new Float32Array(e(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n},freeType:function(e){t(e.buffer)}}}function u(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||G(e.data))}function s(e,t,r,n,i,a){for(var f=0;f<t;++f)for(var o=e[f],u=0;u<r;++u)for(var s=o[u],c=0;c<n;++c)i[a++]=s[c]}function c(e){return 0|J[Object.prototype.toString.call(e)]}function l(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function p(e,t,r,n,i,a,f){for(var o=0,u=0;u<r;++u)for(var s=0;s<n;++s)e[o++]=t[i*u+a*s+f]}function d(e,t,r,n){function i(t){this.id=s++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}function a(t,r,n){t.byteLength=r.byteLength,e.bufferData(t.type,r,n)}function f(e,t,r,n,i,f){if(e.usage=r,Array.isArray(t)){if(e.dtype=n||5126,0<t.length)if(Array.isArray(t[0])){i=ee(t);for(var o=n=1;o<i.length;++o)n*=i[o];e.dimension=n,a(e,t=$(t,i,e.dtype),r),f?e.persistentData=t:q.freeType(t)}else"number"==typeof t[0]?(e.dimension=i,l(i=q.allocType(e.dtype,t.length),t),a(e,i,r),f?e.persistentData=i:q.freeType(i)):G(t[0])&&(e.dimension=t[0].length,e.dtype=n||c(t[0])||5126,a(e,t=$(t,[t.length,t[0].length],e.dtype),r),f?e.persistentData=t:q.freeType(t))}else if(G(t))e.dtype=n||c(t),e.dimension=i,a(e,t,r),f&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(u(t)){i=t.shape;var s=t.stride,d=(o=t.offset,0),h=0,m=0,b=0;1===i.length?(d=i[0],h=1,m=s[0],b=0):2===i.length&&(d=i[0],h=i[1],m=s[0],b=s[1]),e.dtype=n||c(t.data)||5126,e.dimension=h,p(i=q.allocType(e.dtype,d*h),t.data,d,h,m,b,o),a(e,i,r),f?e.persistentData=i:q.freeType(i)}else t instanceof ArrayBuffer&&(e.dtype=5121,e.dimension=i,a(e,t,r),f&&(e.persistentData=new Uint8Array(new Uint8Array(t))))}function o(r){t.bufferCount--,n(r),e.deleteBuffer(r.buffer),r.buffer=null,delete d[r.id]}var s=0,d={};i.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){o(this)};var h=[];return r.profile&&(t.getTotalBufferSize=function(){var e=0;return Object.keys(d).forEach(function(t){e+=d[t].stats.size}),e}),{create:function(n,a,s,h){function m(t){var n=35044,i=null,a=0,o=0,s=1;return Array.isArray(t)||G(t)||u(t)||t instanceof ArrayBuffer?i=t:"number"==typeof t?a=0|t:t&&("data"in t&&(i=t.data),"usage"in t&&(n=Z[t.usage]),"type"in t&&(o=K[t.type]),"dimension"in t&&(s=0|t.dimension),"length"in t&&(a=0|t.length)),b.bind(),i?f(b,i,n,o,s,h):(a&&e.bufferData(b.type,a,n),b.dtype=o||5121,b.usage=n,b.dimension=s,b.byteLength=a),r.profile&&(b.stats.size=b.byteLength*te[b.dtype]),m}t.bufferCount++;var b=new i(a);return d[b.id]=b,s||m(n),m._reglType="buffer",m._buffer=b,m.subdata=function(t,r){var n,i=0|(r||0);if(b.bind(),G(t)||t instanceof ArrayBuffer)e.bufferSubData(b.type,i,t);else if(Array.isArray(t)){if(0<t.length)if("number"==typeof t[0]){var a=q.allocType(b.dtype,t.length);l(a,t),e.bufferSubData(b.type,i,a),q.freeType(a)}else(Array.isArray(t[0])||G(t[0]))&&(n=ee(t),a=$(t,n,b.dtype),e.bufferSubData(b.type,i,a),q.freeType(a))}else if(u(t)){n=t.shape;var f=t.stride,o=a=0,s=0,d=0;1===n.length?(a=n[0],o=1,s=f[0],d=0):2===n.length&&(a=n[0],o=n[1],s=f[0],d=f[1]),n=Array.isArray(t.data)?b.dtype:c(t.data),p(n=q.allocType(n,a*o),t.data,a,o,s,d,t.offset),e.bufferSubData(b.type,i,n),q.freeType(n)}return m},r.profile&&(m.stats=b.stats),m.destroy=function(){o(b)},m},createStream:function(e,t){var r=h.pop();return r||(r=new i(e)),r.bind(),f(r,t,35040,0,1,!1),r},destroyStream:function(e){h.push(e)},clear:function(){Y(d).forEach(o),h.forEach(o)},getBuffer:function(e){return e&&e._buffer instanceof i?e._buffer:null},restore:function(){Y(d).forEach(function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)})},_initBuffer:f}}function h(e,t,r,n){function i(e){this.id=s++,o[this.id]=this,this.buffer=e,this.primType=4,this.type=this.vertCount=0}function a(n,i,a,f,o,s,c){var l;if(n.buffer.bind(),i?((l=c)||G(i)&&(!u(i)||G(i.data))||(l=t.oes_element_index_uint?5125:5123),r._initBuffer(n.buffer,i,a,l,3)):(e.bufferData(34963,s,a),n.buffer.dtype=l||5121,n.buffer.usage=a,n.buffer.dimension=3,n.buffer.byteLength=s),l=c,!c){switch(n.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}n.buffer.dtype=l}n.type=l,0>(i=o)&&(i=n.buffer.byteLength,5123===l?i>>=1:5125===l&&(i>>=2)),n.vertCount=i,i=f,0>f&&(i=4,1===(f=n.buffer.dimension)&&(i=0),2===f&&(i=1),3===f&&(i=4)),n.primType=i}function f(e){n.elementsCount--,delete o[e.id],e.buffer.destroy(),e.buffer=null}var o={},s=0,c={uint8:5121,uint16:5123};t.oes_element_index_uint&&(c.uint32=5125),i.prototype.bind=function(){this.buffer.bind()};var l=[];return{create:function(e,t){function o(e){if(e)if("number"==typeof e)s(e),l.primType=4,l.vertCount=0|e,l.type=5121;else{var t=null,r=35044,n=-1,i=-1,f=0,p=0;Array.isArray(e)||G(e)||u(e)?t=e:("data"in e&&(t=e.data),"usage"in e&&(r=Z[e.usage]),"primitive"in e&&(n=re[e.primitive]),"count"in e&&(i=0|e.count),"type"in e&&(p=c[e.type]),"length"in e?f=0|e.length:(f=i,5123===p||5122===p?f*=2:5125!==p&&5124!==p||(f*=4))),a(l,t,r,n,i,f,p)}else s(),l.primType=4,l.vertCount=0,l.type=5121;return o}var s=r.create(null,34963,!0),l=new i(s._buffer);return n.elementsCount++,o(e),o._reglType="elements",o._elements=l,o.subdata=function(e,t){return s.subdata(e,t),o},o.destroy=function(){f(l)},o},createStream:function(e){var t=l.pop();return t||(t=new i(r.create(null,34963,!0,!1)._buffer)),a(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof i?e._elements:null},clear:function(){Y(o).forEach(f)}}}function m(e){for(var t=q.allocType(5123,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(1/0===e[r])t[r]=31744;else if(-1/0===e[r])t[r]=64512;else{ne[0]=e[r];var n=(a=ie[0])>>>31<<15,i=(a<<1>>>24)-127,a=a>>13&1023;t[r]=-24>i?n:-14>i?n+(a+1024>>-14-i):15<i?n+31744:n+(i+15<<10)+a}return t}function b(e){return Array.isArray(e)||G(e)}function g(e){return"[object "+e+"]"}function y(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function v(e){return!(!Array.isArray(e)||0===e.length||!b(e[0]))}function x(e){return Object.prototype.toString.call(e)}function w(e){if(!e)return!1;var t=x(e);return 0<=he.indexOf(t)||(y(e)||v(e)||u(e))}function A(e,t){36193===e.type?(e.data=m(t),q.freeType(t)):e.data=t}function k(e,t,r,n,i,a){if(e=void 0!==be[e]?be[e]:oe[e]*me[t],a&&(e*=6),i){for(n=0;1<=r;)n+=e*r*r,r/=2;return n}return e*r*n}function _(e,t,r,n,i,a,f){function o(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function s(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function c(e,t){if("object"==typeof t&&t){"premultiplyAlpha"in t&&(e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(e.flipY=t.flipY),"alignment"in t&&(e.unpackAlignment=t.alignment),"colorSpace"in t&&(e.colorSpace=U[t.colorSpace]),"type"in t&&(e.type=N[t.type]);var r=e.width,n=e.height,i=e.channels,a=!1;"shape"in t?(r=t.shape[0],n=t.shape[1],3===t.shape.length&&(i=t.shape[2],a=!0)):("radius"in t&&(r=n=t.radius),"width"in t&&(r=t.width),"height"in t&&(n=t.height),"channels"in t&&(i=t.channels,a=!0)),e.width=0|r,e.height=0|n,e.channels=0|i,r=!1,"format"in t&&(r=t.format,n=e.internalformat=Q[r],e.format=he[n],r in N&&!("type"in t)&&(e.type=N[r]),r in K&&(e.compressed=!0),r=!0),!a&&r?e.channels=oe[e.format]:a&&!r&&e.channels!==fe[e.format]&&(e.format=e.internalformat=fe[e.channels])}}function l(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function p(){o.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function d(e,t){var r=null;if(w(t)?r=t:t&&(c(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),w(t.data)&&(r=t.data)),t.copy){var n=i.viewportWidth,a=i.viewportHeight;e.width=e.width||n-e.xOffset,e.height=e.height||a-e.yOffset,e.needsCopy=!0}else if(r){if(G(r))e.channels=e.channels||4,e.data=r,"type"in t||5121!==e.type||(e.type=0|J[Object.prototype.toString.call(r)]);else if(y(r)){switch(e.channels=e.channels||4,a=(n=r).length,e.type){case 5121:case 5123:case 5125:case 5126:(a=q.allocType(e.type,a)).set(n),e.data=a;break;case 36193:e.data=m(n)}e.alignment=1,e.needsFree=!0}else if(u(r)){n=r.data,Array.isArray(n)||5121!==e.type||(e.type=0|J[Object.prototype.toString.call(n)]);a=r.shape;var f,o,s,l,p=r.stride;3===a.length?(s=a[2],l=p[2]):l=s=1,f=a[0],o=a[1],a=p[0],p=p[1],e.alignment=1,e.width=f,e.height=o,e.channels=s,e.format=e.internalformat=fe[s],e.needsFree=!0,f=l,r=r.offset,s=e.width,l=e.height,o=e.channels;for(var d=q.allocType(36193===e.type?5126:e.type,s*l*o),h=0,g=0;g<l;++g)for(var k=0;k<s;++k)for(var _=0;_<o;++_)d[h++]=n[a*k+p*g+f*_+r];A(e,d)}else if(x(r)===ue||x(r)===se||x(r)===ce)x(r)===ue||x(r)===se?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(x(r)===le)e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(x(r)===pe)e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(x(r)===de)e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(v(r)){for(n=e.width||r[0].length,a=e.height||r.length,p=e.channels,p=b(r[0][0])?p||r[0][0].length:p||1,f=X.shape(r),s=1,l=0;l<f.length;++l)s*=f[l];s=q.allocType(36193===e.type?5126:e.type,s),X.flatten(r,f,"",s),A(e,s),e.alignment=1,e.width=n,e.height=a,e.channels=p,e.format=e.internalformat=fe[p],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function h(t,r,i,a,f){var o=t.element,u=t.data,s=t.internalformat,c=t.format,p=t.type,d=t.width,h=t.height;l(t),o?e.texSubImage2D(r,f,i,a,c,p,o):t.compressed?e.compressedTexSubImage2D(r,f,i,a,s,d,h,u):t.needsCopy?(n(),e.copyTexSubImage2D(r,f,i,a,t.xOffset,t.yOffset,d,h)):e.texSubImage2D(r,f,i,a,d,h,c,p,u)}function g(){return me.pop()||new p}function _(e){e.needsFree&&q.freeType(e.data),p.call(e),me.push(e)}function O(){o.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function E(e,t,r){var n=e.images[0]=g();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function D(e,t){var r=null;if(w(t))s(r=e.images[0]=g(),e),d(r,t),e.mipmask=1;else if(c(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,i=0;i<n.length;++i)s(r=e.images[i]=g(),e),r.width>>=i,r.height>>=i,d(r,n[i]),e.mipmask|=1<<i;else s(r=e.images[0]=g(),e),d(r,t),e.mipmask=1;s(e,e.images[0])}function T(t,r){for(var i=t.images,a=0;a<i.length&&i[a];++a){var f=i[a],o=r,u=a,s=f.element,c=f.data,p=f.internalformat,d=f.format,h=f.type,m=f.width,b=f.height;l(f),s?e.texImage2D(o,u,d,d,h,s):f.compressed?e.compressedTexImage2D(o,u,p,m,b,0,c):f.needsCopy?(n(),e.copyTexImage2D(o,u,d,f.xOffset,f.yOffset,m,b,0)):e.texImage2D(o,u,d,m,b,0,d,h,c||null)}}function S(){var e=be.pop()||new O;o.call(e);for(var t=e.mipmask=0;16>t;++t)e.images[t]=null;return e}function j(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&_(t[r]),t[r]=null;be.push(e)}function C(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function V(e,t){"min"in t&&(e.minFilter=W[t.min],0<=ae.indexOf(e.minFilter)&&!("faces"in t)&&(e.genMipmaps=!0)),"mag"in t&&(e.magFilter=H[t.mag]);var r=e.wrapS,n=e.wrapT;if("wrap"in t){var i=t.wrap;"string"==typeof i?r=n=M[i]:Array.isArray(i)&&(r=M[i[0]],n=M[i[1]])}else"wrapS"in t&&(r=M[t.wrapS]),"wrapT"in t&&(n=M[t.wrapT]);if(e.wrapS=r,e.wrapT=n,"anisotropic"in t&&(e.anisotropic=t.anisotropic),"mipmap"in t){switch(r=!1,typeof t.mipmap){case"string":e.mipmapHint=L[t.mipmap],r=e.genMipmaps=!0;break;case"boolean":r=e.genMipmaps=t.mipmap;break;case"object":e.genMipmaps=!1,r=!0}!r||"min"in t||(e.minFilter=9984)}}function F(r,n){e.texParameteri(n,10241,r.minFilter),e.texParameteri(n,10240,r.magFilter),e.texParameteri(n,10242,r.wrapS),e.texParameteri(n,10243,r.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(n,34046,r.anisotropic),r.genMipmaps&&(e.hint(33170,r.mipmapHint),e.generateMipmap(n))}function B(t){o.call(this),this.mipmask=0,this.internalformat=6408,this.id=ge++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new C,f.profile&&(this.stats={size:0})}function z(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function I(){var t=xe[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function P(t){var r=t.texture,n=t.unit,i=t.target;0<=n&&(e.activeTexture(33984+n),e.bindTexture(i,null),xe[n]=null),e.deleteTexture(r),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete ye[t.id],a.textureCount--}var L={"don't care":4352,"dont care":4352,nice:4354,fast:4353},M={repeat:10497,clamp:33071,mirror:33648},H={nearest:9728,linear:9729},W=R({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},H),U={none:0,browser:37444},N={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Q={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},K={};t.ext_srgb&&(Q.srgb=35904,Q.srgba=35906),t.oes_texture_float&&(N.float32=N.float=5126),t.oes_texture_half_float&&(N.float16=N["half float"]=36193),t.webgl_depth_texture&&(R(Q,{depth:6402,"depth stencil":34041}),R(N,{uint16:5123,uint32:5125,"depth stencil":34042})),t.webgl_compressed_texture_s3tc&&R(K,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),t.webgl_compressed_texture_atc&&R(K,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),t.webgl_compressed_texture_pvrtc&&R(K,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),t.webgl_compressed_texture_etc1&&(K["rgb etc1"]=36196);var Z=Array.prototype.slice.call(e.getParameter(34467));Object.keys(K).forEach(function(e){var t=K[e];0<=Z.indexOf(t)&&(Q[e]=t)});var $=Object.keys(Q);r.textureFormats=$;var ee=[];Object.keys(Q).forEach(function(e){ee[Q[e]]=e});var te=[];Object.keys(N).forEach(function(e){te[N[e]]=e});var re=[];Object.keys(H).forEach(function(e){re[H[e]]=e});var ne=[];Object.keys(W).forEach(function(e){ne[W[e]]=e});var ie=[];Object.keys(M).forEach(function(e){ie[M[e]]=e});var he=$.reduce(function(e,r){var n=Q[r];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||t.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||0<=r.indexOf("rgba")?e[n]=6408:e[n]=6407,e},{}),me=[],be=[],ge=0,ye={},ve=r.maxTextureUnits,xe=Array(ve).map(function(){return null});return R(B.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(0>t){for(var r=0;r<ve;++r){var n=xe[r];if(n){if(0<n.bindCount)continue;n.unit=-1}xe[r]=this,t=r;break}f.profile&&a.maxTextureUnits<t+1&&(a.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&P(this)}}),f.profile&&(a.getTotalTextureSize=function(){var e=0;return Object.keys(ye).forEach(function(t){e+=ye[t].stats.size}),e}),{create2D:function(t,r){function n(e,t){var r=i.texInfo;C.call(r);var a=S();return"number"==typeof e?E(a,0|e,"number"==typeof t?0|t:0|e):e?(V(r,e),D(a,e)):E(a,1,1),r.genMipmaps&&(a.mipmask=(a.width<<1)-1),i.mipmask=a.mipmask,s(i,a),i.internalformat=a.internalformat,n.width=a.width,n.height=a.height,z(i),T(a,3553),F(r,3553),I(),j(a),f.profile&&(i.stats.size=k(i.internalformat,i.type,a.width,a.height,r.genMipmaps,!1)),n.format=ee[i.internalformat],n.type=te[i.type],n.mag=re[r.magFilter],n.min=ne[r.minFilter],n.wrapS=ie[r.wrapS],n.wrapT=ie[r.wrapT],n}var i=new B(3553);return ye[i.id]=i,a.textureCount++,n(t,r),n.subimage=function(e,t,r,a){t|=0,r|=0,a|=0;var f=g();return s(f,i),f.width=0,f.height=0,d(f,e),f.width=f.width||(i.width>>a)-t,f.height=f.height||(i.height>>a)-r,z(i),h(f,3553,t,r,a),I(),_(f),n},n.resize=function(t,r){var a=0|t,o=0|r||a;if(a===i.width&&o===i.height)return n;n.width=i.width=a,n.height=i.height=o,z(i);for(var u=0;i.mipmask>>u;++u){var s=a>>u,c=o>>u;if(!s||!c)break;e.texImage2D(3553,u,i.format,s,c,0,i.format,i.type,null)}return I(),f.profile&&(i.stats.size=k(i.internalformat,i.type,a,o,!1,!1)),n},n._reglType="texture2d",n._texture=i,f.profile&&(n.stats=i.stats),n.destroy=function(){i.decRef()},n},createCube:function(t,r,n,i,o,u){function l(e,t,r,n,i,a){var o,u=p.texInfo;for(C.call(u),o=0;6>o;++o)m[o]=S();if("number"!=typeof e&&e){if("object"==typeof e)if(t)D(m[0],e),D(m[1],t),D(m[2],r),D(m[3],n),D(m[4],i),D(m[5],a);else if(V(u,e),c(p,e),"faces"in e)for(e=e.faces,o=0;6>o;++o)s(m[o],p),D(m[o],e[o]);else for(o=0;6>o;++o)D(m[o],e)}else for(e=0|e||1,o=0;6>o;++o)E(m[o],e,e);for(s(p,m[0]),p.mipmask=u.genMipmaps?(m[0].width<<1)-1:m[0].mipmask,p.internalformat=m[0].internalformat,l.width=m[0].width,l.height=m[0].height,z(p),o=0;6>o;++o)T(m[o],34069+o);for(F(u,34067),I(),f.profile&&(p.stats.size=k(p.internalformat,p.type,l.width,l.height,u.genMipmaps,!0)),l.format=ee[p.internalformat],l.type=te[p.type],l.mag=re[u.magFilter],l.min=ne[u.minFilter],l.wrapS=ie[u.wrapS],l.wrapT=ie[u.wrapT],o=0;6>o;++o)j(m[o]);return l}var p=new B(34067);ye[p.id]=p,a.cubeCount++;var m=Array(6);return l(t,r,n,i,o,u),l.subimage=function(e,t,r,n,i){r|=0,n|=0,i|=0;var a=g();return s(a,p),a.width=0,a.height=0,d(a,t),a.width=a.width||(p.width>>i)-r,a.height=a.height||(p.height>>i)-n,z(p),h(a,34069+e,r,n,i),I(),_(a),l},l.resize=function(t){if((t|=0)!==p.width){l.width=p.width=t,l.height=p.height=t,z(p);for(var r=0;6>r;++r)for(var n=0;p.mipmask>>n;++n)e.texImage2D(34069+r,n,p.format,t>>n,t>>n,0,p.format,p.type,null);return I(),f.profile&&(p.stats.size=k(p.internalformat,p.type,l.width,l.height,!1,!0)),l}},l._reglType="textureCube",l._texture=p,f.profile&&(l.stats=p.stats),l.destroy=function(){p.decRef()},l},clear:function(){for(var t=0;t<ve;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),xe[t]=null;Y(ye).forEach(P),a.cubeCount=0,a.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<ve;++t){var r=xe[t];r&&(r.bindCount=0,r.unit=-1,xe[t]=null)}Y(ye).forEach(function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var r=0;32>r;++r)if(0!=(t.mipmask&1<<r))if(3553===t.target)e.texImage2D(3553,r,t.internalformat,t.width>>r,t.height>>r,0,t.internalformat,t.type,null);else for(var n=0;6>n;++n)e.texImage2D(34069+n,r,t.internalformat,t.width>>r,t.height>>r,0,t.internalformat,t.type,null);F(t.texInfo,t.target)})},refresh:function(){for(var t=0;t<ve;++t){var r=xe[t];r&&(r.bindCount=0,r.unit=-1,xe[t]=null),e.activeTexture(33984+t),e.bindTexture(3553,null),e.bindTexture(34067,null)}}}}function O(e,t,r,n,i,a){function f(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=e=0;t?(e=t.width,n=t.height):r&&(e=r.width,n=r.height),this.width=e,this.height=n}function o(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function u(e,t,r){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function s(t,r){r&&(r.texture?e.framebufferTexture2D(36160,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,r.renderbuffer._renderbuffer.renderbuffer))}function c(e){var t=3553,r=null,n=null,i=e;return"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),"texture2d"===(e=i._reglType)?r=i:"textureCube"===e?r=i:"renderbuffer"===e&&(n=i,t=36161),new f(t,r,n)}function l(e,t,r,a,o){return r?((e=n.create2D({width:e,height:t,format:a,type:o}))._texture.refCount=0,new f(3553,e,null)):((e=i.create({width:e,height:t,format:a}))._renderbuffer.refCount=0,new f(36161,null,e))}function p(e){return e&&(e.texture||e.renderbuffer)}function d(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}function h(){this.id=k++,_[this.id]=this,this.framebuffer=e.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function m(e){e.colorAttachments.forEach(o),o(e.depthAttachment),o(e.stencilAttachment),o(e.depthStencilAttachment)}function b(t){e.deleteFramebuffer(t.framebuffer),t.framebuffer=null,a.framebufferCount--,delete _[t.id]}function g(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)s(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),s(36096,t.depthAttachment),s(36128,t.stencilAttachment),s(33306,t.depthStencilAttachment),e.checkFramebufferStatus(36160),e.isContextLost(),e.bindFramebuffer(36160,v.next?v.next.framebuffer:null),v.cur=v.next,e.getError()}function y(e,t){function r(e,t){var i,a=0,f=0,o=!0,s=!0;i=null;var d=!0,h="rgba",b="uint8",y=1,v=null,A=null,k=null,_=!1;"number"==typeof e?(a=0|e,f=0|t||a):e?("shape"in e?(a=(f=e.shape)[0],f=f[1]):("radius"in e&&(a=f=e.radius),"width"in e&&(a=e.width),"height"in e&&(f=e.height)),("color"in e||"colors"in e)&&(i=e.color||e.colors,Array.isArray(i)),i||("colorCount"in e&&(y=0|e.colorCount),"colorTexture"in e&&(d=!!e.colorTexture,h="rgba4"),"colorType"in e&&(b=e.colorType,!d)&&("half float"===b||"float16"===b?h="rgba16f":"float"!==b&&"float32"!==b||(h="rgba32f")),"colorFormat"in e&&(h=e.colorFormat,0<=x.indexOf(h)?d=!0:0<=w.indexOf(h)&&(d=!1))),("depthTexture"in e||"depthStencilTexture"in e)&&(_=!(!e.depthTexture&&!e.depthStencilTexture)),"depth"in e&&("boolean"==typeof e.depth?o=e.depth:(v=e.depth,s=!1)),"stencil"in e&&("boolean"==typeof e.stencil?s=e.stencil:(A=e.stencil,o=!1)),"depthStencil"in e&&("boolean"==typeof e.depthStencil?o=s=e.depthStencil:(k=e.depthStencil,s=o=!1))):a=f=1;var O=null,E=null,D=null,T=null;if(Array.isArray(i))O=i.map(c);else if(i)O=[c(i)];else for(O=Array(y),i=0;i<y;++i)O[i]=l(a,f,d,h,b);for(a=a||O[0].width,f=f||O[0].height,v?E=c(v):o&&!s&&(E=l(a,f,_,"depth","uint32")),A?D=c(A):s&&!o&&(D=l(a,f,!1,"stencil","uint8")),k?T=c(k):!v&&!A&&s&&o&&(T=l(a,f,_,"depth stencil","depth stencil")),o=null,i=0;i<O.length;++i)u(O[i]),O[i]&&O[i].texture&&(s=ve[O[i].texture._texture.format]*xe[O[i].texture._texture.type],null===o&&(o=s));return u(E),u(D),u(T),m(n),n.width=a,n.height=f,n.colorAttachments=O,n.depthAttachment=E,n.stencilAttachment=D,n.depthStencilAttachment=T,r.color=O.map(p),r.depth=p(E),r.stencil=p(D),r.depthStencil=p(T),r.width=n.width,r.height=n.height,g(n),r}var n=new h;return a.framebufferCount++,r(e,t),R(r,{resize:function(e,t){var i=Math.max(0|e,1),a=Math.max(0|t||i,1);if(i===n.width&&a===n.height)return r;for(var f=n.colorAttachments,o=0;o<f.length;++o)d(f[o],i,a);return d(n.depthAttachment,i,a),d(n.stencilAttachment,i,a),d(n.depthStencilAttachment,i,a),n.width=r.width=i,n.height=r.height=a,g(n),r},_reglType:"framebuffer",_framebuffer:n,destroy:function(){b(n),m(n)},use:function(e){v.setFBO({framebuffer:r},e)}})}var v={cur:null,next:null,dirty:!1,setFBO:null},x=["rgba"],w=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&w.push("srgba"),t.ext_color_buffer_half_float&&w.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&w.push("rgba32f");var A=["uint8"];t.oes_texture_half_float&&A.push("half float","float16"),t.oes_texture_float&&A.push("float","float32");var k=0,_={};return R(v,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof h?e:null},create:y,createCube:function(e){function t(e){var i,a={color:null},f=0,o=null;i="rgba";var u="uint8",s=1;if("number"==typeof e?f=0|e:e?("shape"in e?f=e.shape[0]:("radius"in e&&(f=0|e.radius),"width"in e?f=0|e.width:"height"in e&&(f=0|e.height)),("color"in e||"colors"in e)&&(o=e.color||e.colors,Array.isArray(o)),o||("colorCount"in e&&(s=0|e.colorCount),"colorType"in e&&(u=e.colorType),"colorFormat"in e&&(i=e.colorFormat)),"depth"in e&&(a.depth=e.depth),"stencil"in e&&(a.stencil=e.stencil),"depthStencil"in e&&(a.depthStencil=e.depthStencil)):f=1,o)if(Array.isArray(o))for(e=[],i=0;i<o.length;++i)e[i]=o[i];else e=[o];else for(e=Array(s),o={radius:f,format:i,type:u},i=0;i<s;++i)e[i]=n.createCube(o);for(a.color=Array(e.length),i=0;i<e.length;++i)s=e[i],f=f||s.width,a.color[i]={target:34069,data:e[i]};for(i=0;6>i;++i){for(s=0;s<e.length;++s)a.color[s].target=34069+i;0<i&&(a.depth=r[0].depth,a.stencil=r[0].stencil,a.depthStencil=r[0].depthStencil),r[i]?r[i](a):r[i]=y(a)}return R(t,{width:f,height:f,color:e})}var r=Array(6);return t(e),R(t,{faces:r,resize:function(e){var n=0|e;if(n===t.width)return t;var i=t.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;6>e;++e)r[e].resize(n);return t.width=t.height=n,t},_reglType:"framebufferCube",destroy:function(){r.forEach(function(e){e.destroy()})}})},clear:function(){Y(_).forEach(b)},restore:function(){v.cur=null,v.next=null,v.dirty=!0,Y(_).forEach(function(t){t.framebuffer=e.createFramebuffer(),g(t)})}})}function E(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function D(e,t,r,n,i,a,f){function o(){this.id=++l,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var e=t.oes_vertex_array_object;this.vao=e?e.createVertexArrayOES():null,p[this.id]=this,this.buffers=[]}var s=r.maxAttributes,c=Array(s);for(r=0;r<s;++r)c[r]=new E;var l=0,p={},d={Record:E,scope:{},state:c,currentVAO:null,targetVAO:null,restore:t.oes_vertex_array_object?function(){t.oes_vertex_array_object&&Y(p).forEach(function(e){e.refresh()})}:function(){},createVAO:function(e){function t(e){var n;Array.isArray(e)?(n=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4):(e.elements?(n=e.elements,r.ownsElements?("function"==typeof n&&"elements"===n._reglType?r.elements.destroy():r.elements(n),r.ownsElements=!1):a.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=a.create(e.elements),r.ownsElements=!0)):(r.elements=null,r.ownsElements=!1),n=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(r.primitive=re[e.primitive])),e={};var f=r.attributes;f.length=n.length;for(var o=0;o<n.length;++o){var s,c=n[o],l=f[o]=new E,p=c.data||c;if(Array.isArray(p)||G(p)||u(p))r.buffers[o]&&(s=r.buffers[o],G(p)&&s._buffer.byteLength>=p.byteLength?s.subdata(p):(s.destroy(),r.buffers[o]=null)),r.buffers[o]||(s=r.buffers[o]=i.create(c,34962,!1,!0)),l.buffer=i.getBuffer(s),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1,e[o]=1;else i.getBuffer(c)?(l.buffer=i.getBuffer(c),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1):i.getBuffer(c.buffer)?(l.buffer=i.getBuffer(c.buffer),l.size=0|(+c.size||l.buffer.dimension),l.normalized=!!c.normalized||!1,l.type="type"in c?K[c.type]:l.buffer.dtype,l.offset=0|(c.offset||0),l.stride=0|(c.stride||0),l.divisor=0|(c.divisor||0),l.state=1):"x"in c&&(l.x=+c.x||0,l.y=+c.y||0,l.z=+c.z||0,l.w=+c.w||0,l.state=2)}for(s=0;s<r.buffers.length;++s)!e[s]&&r.buffers[s]&&(r.buffers[s].destroy(),r.buffers[s]=null);return r.refresh(),t}var r=new o;return n.vaoCount+=1,t.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},t._vao=r,t._reglType="vao",t(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(t){for(var r=0;r<c.length;++r){var n=c[r];n.buffer===t&&(e.disableVertexAttribArray(r),n.buffer=null)}},setVAO:t.oes_vertex_array_object?function(e){if(e!==d.currentVAO){var r=t.oes_vertex_array_object;e?r.bindVertexArrayOES(e.vao):r.bindVertexArrayOES(null),d.currentVAO=e}}:function(r){if(r!==d.currentVAO){if(r)r.bindAttrs();else{for(var n=t.angle_instanced_arrays,i=0;i<c.length;++i){var a=c[i];a.buffer?(e.enableVertexAttribArray(i),a.buffer.bind(),e.vertexAttribPointer(i,a.size,a.type,a.normalized,a.stride,a.offfset),n&&a.divisor&&n.vertexAttribDivisorANGLE(i,a.divisor)):(e.disableVertexAttribArray(i),e.vertexAttrib4f(i,a.x,a.y,a.z,a.w))}f.elements?e.bindBuffer(34963,f.elements.buffer.buffer):e.bindBuffer(34963,null)}d.currentVAO=r}},clear:t.oes_vertex_array_object?function(){Y(p).forEach(function(e){e.destroy()})}:function(){}};return o.prototype.bindAttrs=function(){for(var r=t.angle_instanced_arrays,n=this.attributes,i=0;i<n.length;++i){var f=n[i];f.buffer?(e.enableVertexAttribArray(i),e.bindBuffer(34962,f.buffer.buffer),e.vertexAttribPointer(i,f.size,f.type,f.normalized,f.stride,f.offset),r&&f.divisor&&r.vertexAttribDivisorANGLE(i,f.divisor)):(e.disableVertexAttribArray(i),e.vertexAttrib4f(i,f.x,f.y,f.z,f.w))}for(r=n.length;r<s;++r)e.disableVertexAttribArray(r);(r=a.getElements(this.elements))?e.bindBuffer(34963,r.buffer.buffer):e.bindBuffer(34963,null)},o.prototype.refresh=function(){var e=t.oes_vertex_array_object;e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=this)},o.prototype.destroy=function(){if(this.vao){var e=t.oes_vertex_array_object;this===d.currentVAO&&(d.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),p[this.id]&&(delete p[this.id],--n.vaoCount)},d}function T(e,t,r,n){function i(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function a(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function f(r,n,i){if(!(f=(i=35632===r?s:c)[n])){var a=t.str(n),f=e.createShader(r);e.shaderSource(f,a),e.compileShader(f),i[n]=f}return f}function o(e,t){this.id=d++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(r,o,u){var s;s=f(35632,r.fragId);var c=f(35633,r.vertId);if(o=r.program=e.createProgram(),e.attachShader(o,s),e.attachShader(o,c),u)for(s=0;s<u.length;++s)c=u[s],e.bindAttribLocation(o,c[0],c[1]);e.linkProgram(o),c=e.getProgramParameter(o,35718),n.profile&&(r.stats.uniformsCount=c);var l=r.uniforms;for(s=0;s<c;++s)if(u=e.getActiveUniform(o,s))if(1<u.size)for(var p=0;p<u.size;++p){var d=u.name.replace("[0]","["+p+"]");a(l,new i(d,t.id(d),e.getUniformLocation(o,d),u))}else a(l,new i(u.name,t.id(u.name),e.getUniformLocation(o,u.name),u));for(c=e.getProgramParameter(o,35721),n.profile&&(r.stats.attributesCount=c),r=r.attributes,s=0;s<c;++s)(u=e.getActiveAttrib(o,s))&&a(r,new i(u.name,t.id(u.name),e.getAttribLocation(o,u.name),u))}var s={},c={},l={},p=[],d=0;return n.profile&&(r.getMaxUniformsCount=function(){var e=0;return p.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},r.getMaxAttributesCount=function(){var e=0;return p.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);Y(s).forEach(t),s={},Y(c).forEach(t),c={},p.forEach(function(t){e.deleteProgram(t.program)}),p.length=0,l={},r.shaderCount=0},program:function(t,n,i,a){var f=l[n];f||(f=l[n]={});var d=f[t];if(d&&(d.refCount++,!a))return d;var h=new o(n,t);return r.shaderCount++,u(h,i,a),d||(f[t]=h),p.push(h),R(h,{destroy:function(){if(h.refCount--,0>=h.refCount){e.deleteProgram(h.program);var t=p.indexOf(h);p.splice(t,1),r.shaderCount--}0>=f[h.vertId].refCount&&(e.deleteShader(c[h.vertId]),delete c[h.vertId],delete l[h.fragId][h.vertId]),Object.keys(l[h.fragId]).length||(e.deleteShader(s[h.fragId]),delete s[h.fragId],delete l[h.fragId])}})},restore:function(){s={},c={};for(var e=0;e<p.length;++e)u(p[e],null,p[e].attributes.map(function(e){return[e.location,e.name]}))},shader:f,frag:-1,vert:-1}}function S(e,t,r,n,i,a,f){function o(i){var a;a=null===t.next?5121:t.next.colorAttachments[0].texture._texture.type;var f=0,o=0,u=n.framebufferWidth,s=n.framebufferHeight,c=null;return G(i)?c=i:i&&(f=0|i.x,o=0|i.y,u=0|(i.width||n.framebufferWidth-f),s=0|(i.height||n.framebufferHeight-o),c=i.data||null),r(),i=u*s*4,c||(5121===a?c=new Uint8Array(i):5126===a&&(c=c||new Float32Array(i))),e.pixelStorei(3333,4),e.readPixels(f,o,u,s,6408,a,c),c}return function(e){return e&&"framebuffer"in e?function(e){var r;return t.setFBO({framebuffer:e.framebuffer},function(){r=o(e)}),r}(e):o(e)}}function j(e){return Array.prototype.slice.call(e)}function C(e){return j(e).join("")}function V(e){return Array.isArray(e)||G(e)||u(e)}function F(e){return e.sort(function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1})}function B(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function z(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function I(e){return new B(!1,!1,!1,e)}function P(e,t){var r=e.type;if(0===r)return new B(!0,1<=(r=e.data.length),2<=r,t);if(4===r)return new B((r=e.data).thisDep,r.contextDep,r.propDep,t);if(5===r)return new B(!1,!1,!1,t);if(6===r){for(var n=r=!1,i=!1,a=0;a<e.data.length;++a){var f=e.data[a];1===f.type?i=!0:2===f.type?n=!0:3===f.type?r=!0:0===f.type?(r=!0,1<=(f=f.data)&&(n=!0),2<=f&&(i=!0)):4===f.type&&(r=r||f.data.thisDep,n=n||f.data.contextDep,i=i||f.data.propDep)}return new B(r,n,i,t)}return new B(3===r,2===r,1===r,t)}function L(e,t,r,n,i,f,o,u,s,c,l,p,d,h,m){function g(e){return e.replace(".","_")}function y(e,t,r){var n=g(e);fe.push(e),ae[n]=ie[n]=!!r,oe[n]=t}function v(e,t,r){var n=g(e);fe.push(e),Array.isArray(r)?(ie[n]=r.slice(),ae[n]=r.slice()):ie[n]=ae[n]=r,ue[n]=t}function x(){var e=function(){function e(){var e=[],t=[];return R(function(){e.push.apply(e,j(arguments))},{def:function(){var n="v"+r++;return t.push(n),0<arguments.length&&(e.push(n,"="),e.push.apply(e,j(arguments)),e.push(";")),n},toString:function(){return C([0<t.length?"var "+t.join(",")+";":"",C(e)])}})}function t(){function t(e,t){n(e,t,"=",r.def(e,t),";")}var r=e(),n=e(),i=r.toString,a=n.toString;return R(function(){r.apply(r,j(arguments))},{def:r.def,entry:r,exit:n,save:t,set:function(e,n,i){t(e,n),r(e,n,"=",i,";")},toString:function(){return i()+a()}})}var r=0,n=[],i=[],a=e(),f={};return{global:a,link:function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return n[t];return t="g"+r++,n.push(t),i.push(e),t},block:e,proc:function(e,r){function n(){var e="a"+i.length;return i.push(e),e}var i=[];r=r||0;for(var a=0;a<r;++a)n();var o=(a=t()).toString;return f[e]=R(a,{arg:n,toString:function(){return C(["function(",i.join(),"){",o(),"}"])}})},scope:t,cond:function(){var e=C(arguments),r=t(),n=t(),i=r.toString,a=n.toString;return R(r,{then:function(){return r.apply(r,j(arguments)),this},else:function(){return n.apply(n,j(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),C(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(f).forEach(function(t){e.push('"',t,'":',f[t].toString(),",")}),e.push("}");var t=C(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,i)}}}(),r=e.link,n=e.global;e.id=le++,e.batchId="0";var i=r(se),a=e.shared={props:"a0"};Object.keys(se).forEach(function(e){a[e]=n.def(i,".",e)});var f=e.next={},o=e.current={};Object.keys(ue).forEach(function(e){Array.isArray(ie[e])&&(f[e]=n.def(a.next,".",e),o[e]=n.def(a.current,".",e))});var u=e.constants={};Object.keys(ce).forEach(function(e){u[e]=n.def(JSON.stringify(ce[e]))}),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map(function(r){return e.invoke(t,r)})}},e.attribCache={};var s={};return e.scopeAttrib=function(e){if((e=t.id(e))in s)return s[e];var n=c.scope[e];return n||(n=c.scope[e]=new Z),s[e]=r(n)},e}function w(e,t){var r=e.static,n=e.dynamic;if("framebuffer"in r){var i=r.framebuffer;return i?(i=u.getFramebuffer(i),I(function(e,t){var r=e.link(i),n=e.shared;return t.set(n.framebuffer,".next",r),n=n.context,t.set(n,".framebufferWidth",r+".width"),t.set(n,".framebufferHeight",r+".height"),r})):I(function(e,t){var r=e.shared;return t.set(r.framebuffer,".next","null"),r=r.context,t.set(r,".framebufferWidth",r+".drawingBufferWidth"),t.set(r,".framebufferHeight",r+".drawingBufferHeight"),"null"})}if("framebuffer"in n){var a=n.framebuffer;return P(a,function(e,t){var r=e.invoke(t,a),n=e.shared,i=n.framebuffer;r=t.def(i,".getFramebuffer(",r,")");return t.set(i,".next",r),n=n.context,t.set(n,".framebufferWidth",r+"?"+r+".width:"+n+".drawingBufferWidth"),t.set(n,".framebufferHeight",r+"?"+r+".height:"+n+".drawingBufferHeight"),r})}return null}function A(e,r,n){function i(e){if(e in a){var r=t.id(a[e]);return(e=I(function(){return r})).id=r,e}if(e in f){var n=f[e];return P(n,function(e,t){var r=e.invoke(t,n);return t.def(e.shared.strings,".id(",r,")")})}return null}var a=e.static,f=e.dynamic,o=i("frag"),u=i("vert"),s=null;return z(o)&&z(u)?(s=l.program(u.id,o.id,null,n),e=I(function(e,t){return e.link(s)})):e=new B(o&&o.thisDep||u&&u.thisDep,o&&o.contextDep||u&&u.contextDep,o&&o.propDep||u&&u.propDep,function(e,t){var r,n,i=e.shared.shader;return r=o?o.append(e,t):t.def(i,".","frag"),n=u?u.append(e,t):t.def(i,".","vert"),t.def(i+".program("+n+","+r+")")}),{frag:o,vert:u,progVar:e,program:s}}function k(e,t){function r(e,t){if(e in n){var r=0|n[e];return t?a.offset=r:a.instances=r,I(function(e,n){return t&&(e.OFFSET=r),r})}if(e in i){var f=i[e];return P(f,function(e,r){var n=e.invoke(r,f);return t&&(e.OFFSET=n),n})}if(t){if(s)return I(function(e,t){return e.OFFSET=0});if(o)return new B(u.thisDep,u.contextDep,u.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")})}else if(o)return new B(u.thisDep,u.contextDep,u.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")});return null}var n=e.static,i=e.dynamic,a={},o=!1,u=function(){if("vao"in n){var e=n.vao;return null!==e&&null===c.getVAO(e)&&(e=c.createVAO(e)),o=!0,a.vao=e,I(function(t){var r=c.getVAO(e);return r?t.link(r):"null"})}if("vao"in i){o=!0;var t=i.vao;return P(t,function(e,r){var n=e.invoke(r,t);return r.def(e.shared.vao+".getVAO("+n+")")})}return null}(),s=!1,l=function(){if("elements"in n){var e=n.elements;if(a.elements=e,V(e)){var t=a.elements=f.create(e,!0);e=f.getElements(t);s=!0}else e&&(e=f.getElements(e),s=!0);return(t=I(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n}return t.ELEMENTS=null})).value=e,t}if("elements"in i){s=!0;var r=i.elements;return P(r,function(e,t){var n=(i=e.shared).isBufferArgs,i=i.elements,a=e.invoke(t,r),f=t.def("null");n=t.def(n,"(",a,")"),a=e.cond(n).then(f,"=",i,".createStream(",a,");").else(f,"=",i,".getElements(",a,");");return t.entry(a),t.exit(e.cond(n).then(i,".destroyStream(",f,");")),e.ELEMENTS=f})}return o?new B(u.thisDep,u.contextDep,u.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")}):null}();s&&(u=I(function(){return"null"}));var p=r("offset",!0),d=function(){if("primitive"in n){var e=n.primitive;return a.primitive=e,I(function(t,r){return re[e]})}if("primitive"in i){var t=i.primitive;return P(t,function(e,r){var n=e.constants.primTypes,i=e.invoke(r,t);return r.def(n,"[",i,"]")})}return s?z(l)?l.value?I(function(e,t){return t.def(e.ELEMENTS,".primType")}):I(function(){return 4}):new B(l.thisDep,l.contextDep,l.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",4)}):o?new B(u.thisDep,u.contextDep,u.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")}):null}(),h=function(){if("count"in n){var e=0|n.count;return a.count=e,I(function(){return e})}if("count"in i){var t=i.count;return P(t,function(e,r){return e.invoke(r,t)})}return s?z(l)?l?p?new B(p.thisDep,p.contextDep,p.propDep,function(e,t){return t.def(e.ELEMENTS,".vertCount-",e.OFFSET)}):I(function(e,t){return t.def(e.ELEMENTS,".vertCount")}):I(function(){return-1}):new B(l.thisDep||p.thisDep,l.contextDep||p.contextDep,l.propDep||p.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")}):o?new B(u.thisDep,u.contextDep,u.propDep,function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")}):null}(),m=r("instances",!1);return{elements:l,primitive:d,count:h,instances:m,offset:p,vao:u,vaoActive:o,elementsActive:s,static:a}}function _(e,r){var n=e.static,a=e.dynamic,f={};return Object.keys(n).forEach(function(e){var r=n[e],a=t.id(e),o=new Z;if(V(r))o.state=1,o.buffer=i.getBuffer(i.create(r,34962,!1,!0)),o.type=0;else if(s=i.getBuffer(r))o.state=1,o.buffer=s,o.type=0;else if("constant"in r){var u=r.constant;o.buffer="null",o.state=2,"number"==typeof u?o.x=u:we.forEach(function(e,t){t<u.length&&(o[e]=u[t])})}else{var s=V(r.buffer)?i.getBuffer(i.create(r.buffer,34962,!1,!0)):i.getBuffer(r.buffer),c=0|r.offset,l=0|r.stride,p=0|r.size,d=!!r.normalized,h=0;"type"in r&&(h=K[r.type]),r=0|r.divisor,o.buffer=s,o.state=1,o.size=p,o.normalized=d,o.type=h||s.dtype,o.offset=c,o.stride=l,o.divisor=r}f[e]=I(function(e,t){var r=e.attribCache;if(a in r)return r[a];var n={isStream:!1};return Object.keys(o).forEach(function(e){n[e]=o[e]}),o.buffer&&(n.buffer=e.link(o.buffer),n.type=n.type||n.buffer+".dtype"),r[a]=n})}),Object.keys(a).forEach(function(e){var t=a[e];f[e]=P(t,function(e,r){function n(e){r(u[e],"=",i,".",e,"|0;")}var i=e.invoke(r,t),a=e.shared,f=e.constants,o=a.isBufferArgs,u=(a=a.buffer,{isStream:r.def(!1)}),s=new Z;s.state=1,Object.keys(s).forEach(function(e){u[e]=r.def(""+s[e])});var c=u.buffer,l=u.type;return r("if(",o,"(",i,")){",u.isStream,"=true;",c,"=",a,".createStream(",34962,",",i,");",l,"=",c,".dtype;","}else{",c,"=",a,".getBuffer(",i,");","if(",c,"){",l,"=",c,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",2,";","if(typeof "+i+'.constant === "number"){',u[we[0]],"=",i,".constant;",we.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",we.map(function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"}).join(""),"}}else{","if(",o,"(",i,".buffer)){",c,"=",a,".createStream(",34962,",",i,".buffer);","}else{",c,"=",a,".getBuffer(",i,".buffer);","}",l,'="type" in ',i,"?",f.glTypes,"[",i,".type]:",c,".dtype;",u.normalized,"=!!",i,".normalized;"),n("size"),n("offset"),n("stride"),n("divisor"),r("}}"),r.exit("if(",u.isStream,"){",a,".destroyStream(",c,");","}"),u})}),f}function O(e,t,n,i,f){function o(e){var t=s[e];t&&(p[e]=t)}var u=function(e,t){if("string"==typeof(r=e.static).frag&&"string"==typeof r.vert){if(0<Object.keys(t.dynamic).length)return null;var r=t.static,n=Object.keys(r);if(0<n.length&&"number"==typeof r[n[0]]){for(var i=[],a=0;a<n.length;++a)i.push([0|r[n[a]],n[a]]);return i}}return null}(e,t),s=function(e,t,r){function n(e){if(e in i){var r=i[e];e=!0;var n,f,o=0|r.x,u=0|r.y;return"width"in r?n=0|r.width:e=!1,"height"in r?f=0|r.height:e=!1,new B(!e&&t&&t.thisDep,!e&&t&&t.contextDep,!e&&t&&t.propDep,function(e,t){var i=e.shared.context,a=n;"width"in r||(a=t.def(i,".","framebufferWidth","-",o));var s=f;return"height"in r||(s=t.def(i,".","framebufferHeight","-",u)),[o,u,a,s]})}if(e in a){var s=a[e];return e=P(s,function(e,t){var r=e.invoke(t,s),n=e.shared.context,i=t.def(r,".x|0"),a=t.def(r,".y|0");return[i,a,t.def('"width" in ',r,"?",r,".width|0:","(",n,".","framebufferWidth","-",i,")"),r=t.def('"height" in ',r,"?",r,".height|0:","(",n,".","framebufferHeight","-",a,")")]}),t&&(e.thisDep=e.thisDep||t.thisDep,e.contextDep=e.contextDep||t.contextDep,e.propDep=e.propDep||t.propDep),e}return t?new B(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".","framebufferWidth"),t.def(r,".","framebufferHeight")]}):null}var i=e.static,a=e.dynamic;if(e=n("viewport")){var f=e;e=new B(e.thisDep,e.contextDep,e.propDep,function(e,t){var r=f.append(e,t),n=e.shared.context;return t.set(n,".viewportWidth",r[2]),t.set(n,".viewportHeight",r[3]),r})}return{viewport:e,scissor_box:n("scissor.box")}}(e,h=w(e)),l=k(e),p=function(e,t){var r=e.static,n=e.dynamic,i={};return fe.forEach(function(e){function t(t,a){if(e in r){var o=t(r[e]);i[f]=I(function(){return o})}else if(e in n){var u=n[e];i[f]=P(u,function(e,t){return a(e,t,e.invoke(t,u))})}}var f=g(e);switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return t(function(e){return e},function(e,t,r){return r});case"depth.func":return t(function(e){return _e[e]},function(e,t,r){return t.def(e.constants.compareFuncs,"[",r,"]")});case"depth.range":return t(function(e){return e},function(e,t,r){return[t.def("+",r,"[0]"),t=t.def("+",r,"[1]")]});case"blend.func":return t(function(e){return[ke["srcRGB"in e?e.srcRGB:e.src],ke["dstRGB"in e?e.dstRGB:e.dst],ke["srcAlpha"in e?e.srcAlpha:e.src],ke["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,t,r){function n(e,n){return t.def('"',e,n,'" in ',r,"?",r,".",e,n,":",r,".",e)}e=e.constants.blendFuncs;var i=n("src","RGB"),a=n("dst","RGB"),f=(i=t.def(e,"[",i,"]"),t.def(e,"[",n("src","Alpha"),"]"));return[i,a=t.def(e,"[",a,"]"),f,e=t.def(e,"[",n("dst","Alpha"),"]")]});case"blend.equation":return t(function(e){return"string"==typeof e?[$[e],$[e]]:"object"==typeof e?[$[e.rgb],$[e.alpha]]:void 0},function(e,t,r){var n=e.constants.blendEquations,i=t.def(),a=t.def();return(e=e.cond("typeof ",r,'==="string"')).then(i,"=",a,"=",n,"[",r,"];"),e.else(i,"=",n,"[",r,".rgb];",a,"=",n,"[",r,".alpha];"),t(e),[i,a]});case"blend.color":return t(function(e){return a(4,function(t){return+e[t]})},function(e,t,r){return a(4,function(e){return t.def("+",r,"[",e,"]")})});case"stencil.mask":return t(function(e){return 0|e},function(e,t,r){return t.def(r,"|0")});case"stencil.func":return t(function(e){return[_e[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,t,r){return[e=t.def('"cmp" in ',r,"?",e.constants.compareFuncs,"[",r,".cmp]",":",7680),t.def(r,".ref|0"),t=t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case"stencil.opFront":case"stencil.opBack":return t(function(t){return["stencil.opBack"===e?1029:1028,Oe[t.fail||"keep"],Oe[t.zfail||"keep"],Oe[t.zpass||"keep"]]},function(t,r,n){function i(e){return r.def('"',e,'" in ',n,"?",a,"[",n,".",e,"]:",7680)}var a=t.constants.stencilOps;return["stencil.opBack"===e?1029:1028,i("fail"),i("zfail"),i("zpass")]});case"polygonOffset.offset":return t(function(e){return[0|e.factor,0|e.units]},function(e,t,r){return[t.def(r,".factor|0"),t=t.def(r,".units|0")]});case"cull.face":return t(function(e){var t=0;return"front"===e?t=1028:"back"===e&&(t=1029),t},function(e,t,r){return t.def(r,'==="front"?',1028,":",1029)});case"lineWidth":return t(function(e){return e},function(e,t,r){return r});case"frontFace":return t(function(e){return Ee[e]},function(e,t,r){return t.def(r+'==="cw"?2304:2305')});case"colorMask":return t(function(e){return e.map(function(e){return!!e})},function(e,t,r){return a(4,function(e){return"!!"+r+"["+e+"]"})});case"sample.coverage":return t(function(e){return["value"in e?e.value:1,!!e.invert]},function(e,t,r){return[t.def('"value" in ',r,"?+",r,".value:1"),t=t.def("!!",r,".invert")]})}}),i}(e),d=A(e,0,u);o("viewport"),o(g("scissor.box"));var h,m=0<Object.keys(p).length;if((h={framebuffer:h,draw:l,shader:d,state:p,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=function(e){var t,r=e.static;if(e=e.dynamic,"profile"in r){var n=!!r.profile;(t=I(function(e,t){return n})).enable=n}else if("profile"in e){var i=e.profile;t=P(i,function(e,t){return e.invoke(t,i)})}return t}(e),h.uniforms=function(e,t){var r=e.static,n=e.dynamic,i={};return Object.keys(r).forEach(function(e){var t,n=r[e];if("number"==typeof n||"boolean"==typeof n)t=I(function(){return n});else if("function"==typeof n){var f=n._reglType;"texture2d"===f||"textureCube"===f?t=I(function(e){return e.link(n)}):"framebuffer"!==f&&"framebufferCube"!==f||(t=I(function(e){return e.link(n.color[0])}))}else b(n)&&(t=I(function(e){return e.global.def("[",a(n.length,function(e){return n[e]}),"]")}));t.value=n,i[e]=t}),Object.keys(n).forEach(function(e){var t=n[e];i[e]=P(t,function(e,r){return e.invoke(r,t)})}),i}(n),h.drawVAO=h.scopeVAO=l.vao,!h.drawVAO&&d.program&&!u&&r.angle_instanced_arrays&&l.static.elements){var y=!0;if(e=d.program.attributes.map(function(e){return e=t.static[e],y=y&&!!e,e}),y&&0<e.length){var v=c.getVAO(c.createVAO({attributes:e,elements:l.static.elements}));h.drawVAO=new B(null,null,null,function(e,t){return e.link(v)}),h.useVAO=!0}}return u?h.useVAO=!0:h.attributes=_(t),h.context=function(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r=t[e];n[e]=I(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=P(t,function(e,r){return e.invoke(r,t)})}),n}(i),h}function E(e,t,r){var n=e.shared.context,i=e.scope();Object.keys(r).forEach(function(a){t.save(n,"."+a);var f=r[a].append(e,t);Array.isArray(f)?i(n,".",a,"=[",f.join(),"];"):i(n,".",a,"=",f,";")}),t(i)}function D(e,t,r,n){var i,a=(o=e.shared).gl,f=o.framebuffer;te&&(i=t.def(o.extensions,".webgl_draw_buffers"));var o=(u=e.constants).drawBuffer,u=u.backBuffer;e=r?r.append(e,t):t.def(f,".next"),n||t("if(",e,"!==",f,".cur){"),t("if(",e,"){",a,".bindFramebuffer(",36160,",",e,".framebuffer);"),te&&t(i,".drawBuffersWEBGL(",o,"[",e,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),te&&t(i,".drawBuffersWEBGL(",u,");"),t("}",f,".cur=",e,";"),n||t("}")}function T(e,t,r){var n=e.shared,i=n.gl,f=e.current,o=e.next,u=n.current,s=n.next,c=e.cond(u,".dirty");fe.forEach(function(t){var n,l;if(!((t=g(t))in r.state))if(t in o){n=o[t],l=f[t];var p=a(ie[t].length,function(e){return c.def(n,"[",e,"]")});c(e.cond(p.map(function(e,t){return e+"!=="+l+"["+t+"]"}).join("||")).then(i,".",ue[t],"(",p,");",p.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";"))}else n=c.def(s,".",t),p=e.cond(n,"!==",u,".",t),c(p),t in oe?p(e.cond(n).then(i,".enable(",oe[t],");").else(i,".disable(",oe[t],");"),u,".",t,"=",n,";"):p(i,".",ue[t],"(",n,");",u,".",t,"=",n,";")}),0===Object.keys(r.state).length&&c(u,".dirty=false;"),t(c)}function S(e,t,r,n){var i=e.shared,a=e.current,f=i.current,o=i.gl;F(Object.keys(r)).forEach(function(i){var u=r[i];if(!n||n(u)){var s=u.append(e,t);if(oe[i]){var c=oe[i];z(u)?t(o,s?".enable(":".disable(",c,");"):t(e.cond(s).then(o,".enable(",c,");").else(o,".disable(",c,");")),t(f,".",i,"=",s,";")}else if(b(s)){var l=a[i];t(o,".",ue[i],"(",s,");",s.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(o,".",ue[i],"(",s,");",f,".",i,"=",s,";")}})}function L(e,t){ee&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function M(e,t,r,n,i){function a(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function f(e){e(s=t.def(),"=",a(),";"),"string"==typeof i?e(p,".count+=",i,";"):e(p,".count++;"),h&&(n?e(c=t.def(),"=",m,".getNumPendingQueries();"):e(m,".beginQuery(",p,");"))}function o(e){e(p,".cpuTime+=",a(),"-",s,";"),h&&(n?e(m,".pushScopeStats(",c,",",m,".getNumPendingQueries(),",p,");"):e(m,".endQuery();"))}function u(e){var r=t.def(d,".profile");t(d,".profile=",e,";"),t.exit(d,".profile=",r,";")}var s,c,l=e.shared,p=e.stats,d=l.current,m=l.timer;if(r=r.profile){if(z(r))return void(r.enable?(f(t),o(t.exit),u("true")):u("false"));u(r=r.append(e,t))}else r=t.def(d,".profile");f(l=e.block()),t("if(",r,"){",l,"}"),o(e=e.block()),t.exit("if(",r,"){",e,"}")}function H(e,t,r,n,i){function a(r,n,i){function a(){t("if(!",c,".buffer){",u,".enableVertexAttribArray(",s,");}");var r,a=i.type;r=i.size?t.def(i.size,"||",n):n,t("if(",c,".type!==",a,"||",c,".size!==",r,"||",d.map(function(e){return c+"."+e+"!=="+i[e]}).join("||"),"){",u,".bindBuffer(",34962,",",l,".buffer);",u,".vertexAttribPointer(",[s,r,a,i.normalized,i.stride,i.offset],");",c,".type=",a,";",c,".size=",r,";",d.map(function(e){return c+"."+e+"="+i[e]+";"}).join(""),"}"),ee&&(a=i.divisor,t("if(",c,".divisor!==",a,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,a],");",c,".divisor=",a,";}"))}function o(){t("if(",c,".buffer){",u,".disableVertexAttribArray(",s,");",c,".buffer=null;","}if(",we.map(function(e,t){return c+"."+e+"!=="+p[t]}).join("||"),"){",u,".vertexAttrib4f(",s,",",p,");",we.map(function(e,t){return c+"."+e+"="+p[t]+";"}).join(""),"}")}var u=f.gl,s=t.def(r,".location"),c=t.def(f.attributes,"[",s,"]");r=i.state;var l=i.buffer,p=[i.x,i.y,i.z,i.w],d=["buffer","normalized","offset","stride"];1===r?a():2===r?o():(t("if(",r,"===",1,"){"),a(),t("}else{"),o(),t("}"))}var f=e.shared;n.forEach(function(n){var f,o=n.name,u=r.attributes[o];if(u){if(!i(u))return;f=u.append(e,t)}else{if(!i(De))return;var s=e.scopeAttrib(o);f={},Object.keys(new Z).forEach(function(e){f[e]=t.def(s,".",e)})}a(e.link(n),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(n.info.type),f)})}function U(e,r,n,i,f,o){for(var u,s=e.shared,c=s.gl,l=0;l<i.length;++l){var p,d=(g=i[l]).name,h=g.info.type,m=n.uniforms[d],g=e.link(g)+".location";if(m){if(!f(m))continue;if(z(m)){if(d=m.value,35678===h||35680===h)r(c,".uniform1i(",g,",",(h=e.link(d._texture||d.color[0]._texture))+".bind());"),r.exit(h,".unbind();");else if(35674===h||35675===h||35676===h)m=2,35675===h?m=3:35676===h&&(m=4),r(c,".uniformMatrix",m,"fv(",g,",false,",d=e.global.def("new Float32Array(["+Array.prototype.slice.call(d)+"])"),");");else{switch(h){case 5126:u="1f";break;case 35664:u="2f";break;case 35665:u="3f";break;case 35666:u="4f";break;case 35670:case 5124:u="1i";break;case 35671:case 35667:u="2i";break;case 35672:case 35668:u="3i";break;case 35673:u="4i";break;case 35669:u="4i"}r(c,".uniform",u,"(",g,",",b(d)?Array.prototype.slice.call(d):d,");")}continue}p=m.append(e,r)}else{if(!f(De))continue;p=r.def(s.uniforms,"[",t.id(d),"]")}switch(35678===h?r("if(",p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];","}"):35680===h&&r("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}"),d=1,h){case 35678:case 35680:h=r.def(p,"._texture"),r(c,".uniform1i(",g,",",h,".bind());"),r.exit(h,".unbind();");continue;case 5124:case 35670:u="1i";break;case 35667:case 35671:u="2i",d=2;break;case 35668:case 35672:u="3i",d=3;break;case 35669:case 35673:u="4i",d=4;break;case 5126:u="1f";break;case 35664:u="2f",d=2;break;case 35665:u="3f",d=3;break;case 35666:u="4f",d=4;break;case 35674:u="Matrix2fv";break;case 35675:u="Matrix3fv";break;case 35676:u="Matrix4fv"}if("M"===u.charAt(0)){r(c,".uniform",u,"(",g,",");g=Math.pow(h-35674+2,2);var y=e.global.def("new Float32Array(",g,")");Array.isArray(p)?r("false,(",a(g,function(e){return y+"["+e+"]="+p[e]}),",",y,")"):r("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",a(g,function(e){return y+"["+e+"]="+p+"["+e+"]"}),",",y,")"),r(");")}else{if(1<d){h=[];var v=[];for(m=0;m<d;++m)Array.isArray(p)?v.push(p[m]):v.push(r.def(p+"["+m+"]")),o&&h.push(r.def());o&&r("if(!",e.batchId,"||",h.map(function(e,t){return e+"!=="+v[t]}).join("||"),"){",h.map(function(e,t){return e+"="+v[t]+";"}).join("")),r(c,".uniform",u,"(",g,",",v.join(","),");")}else o&&(h=r.def(),r("if(!",e.batchId,"||",h,"!==",p,"){",h,"=",p,";")),r(c,".uniform",u,"(",g,",",p,");");o&&r("}")}}}function N(e,t,r,n){function i(i){var a=p[i];return a?a.contextDep&&n.contextDynamic||a.propDep?a.append(e,r):a.append(e,t):t.def(l,".",i)}function a(){function e(){r(u,".drawElementsInstancedANGLE(",[h,b,g,m+"<<(("+g+"-5121)>>1)",o],");")}function t(){r(u,".drawArraysInstancedANGLE(",[h,m,b,o],");")}d&&"null"!==d?y?e():(r("if(",d,"){"),e(),r("}else{"),t(),r("}")):t()}function f(){function e(){r(c+".drawElements("+[h,b,g,m+"<<(("+g+"-5121)>>1)"]+");")}function t(){r(c+".drawArrays("+[h,m,b]+");")}d&&"null"!==d?y?e():(r("if(",d,"){"),e(),r("}else{"),t(),r("}")):t()}var o,u,s=e.shared,c=s.gl,l=s.draw,p=n.draw,d=function(){var i=p.elements,a=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(a=r),p.vaoActive?i=i.append(e,a):a("if("+(i=i.append(e,a))+")"+c+".bindBuffer(34963,"+i+".buffer.buffer);")):(i=a.def(),a("if(",s.vao,".currentVAO){",i,"=",e.shared.elements+".getElements("+s.vao,".currentVAO.elements);",ne?"":"if("+i+")"+c+".bindBuffer(34963,"+i+".buffer.buffer);","}else{",i,"=",l,".","elements",";","if(",i,"){",c,".bindBuffer(",34963,",",i,".buffer.buffer);}}")),i}(),h=i("primitive"),m=i("offset"),b=function(){var i=p.count,a=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(a=r),i=i.append(e,a)):i=a.def(l,".","count"),i}();if("number"==typeof b){if(0===b)return}else r("if(",b,"){"),r.exit("}");ee&&(o=i("instances"),u=e.instancing);var g=d+".type",y=p.elements&&z(p.elements)&&!p.vaoActive;ee&&("number"!=typeof o||0<=o)?"string"==typeof o?(r("if(",o,">0){"),a(),r("}else if(",o,"<0){"),f(),r("}")):a():f()}function q(e,t,r,n,i){return i=(t=x()).proc("body",i),ee&&(t.instancing=i.def(t.shared.extensions,".angle_instanced_arrays")),e(t,i,r,n),t.compile().body}function Q(e,t,r,n){L(e,t),r.useVAO?r.drawVAO?t(e.shared.vao,".setVAO(",r.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),H(e,t,r,n.attributes,function(){return!0})),U(e,t,r,n.uniforms,function(){return!0},!1),N(e,t,t,r)}function G(e,t,r,n){function i(){return!0}e.batchId="a1",L(e,t),H(e,t,r,n.attributes,i),U(e,t,r,n.uniforms,i,!1),N(e,t,t,r)}function Y(e,t,r,n){function i(e){return e.contextDep&&f||e.propDep}function a(e){return!i(e)}L(e,t);var f=r.contextDep,o=t.def(),u=t.def();e.shared.props=u,e.batchId=o;var s=e.scope(),c=e.scope();t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",u,"=","a0","[",o,"];",c,"}",s.exit),r.needsContext&&E(e,c,r.context),r.needsFramebuffer&&D(e,c,r.framebuffer),S(e,c,r.state,i),r.profile&&i(r.profile)&&M(e,c,r,!1,!0),n?(r.useVAO?r.drawVAO?i(r.drawVAO)?c(e.shared.vao,".setVAO(",r.drawVAO.append(e,c),");"):s(e.shared.vao,".setVAO(",r.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),H(e,s,r,n.attributes,a),H(e,c,r,n.attributes,i)),U(e,s,r,n.uniforms,a,!1),U(e,c,r,n.uniforms,i,!0),N(e,s,c,r)):(t=e.global.def("{}"),n=r.shader.progVar.append(e,c),u=c.def(n,".id"),s=c.def(t,"[",u,"]"),c(e.shared.gl,".useProgram(",n,".program);","if(!",s,"){",s,"=",t,"[",u,"]=",e.link(function(t){return q(G,e,r,t,2)}),"(",n,");}",s,".call(this,a0[",o,"],",o,");"))}function X(e,r){function n(t){var n=r.shader[t];n&&i.set(a.shader,"."+t,n.append(e,i))}var i=e.proc("scope",3);e.batchId="a2";var a=e.shared,f=a.current;E(e,i,r.context),r.framebuffer&&r.framebuffer.append(e,i),F(Object.keys(r.state)).forEach(function(t){var n=r.state[t].append(e,i);b(n)?n.forEach(function(r,n){i.set(e.next[t],"["+n+"]",r)}):i.set(a.next,"."+t,n)}),M(e,i,r,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(t){var n=r.draw[t];n&&i.set(a.draw,"."+t,""+n.append(e,i))}),Object.keys(r.uniforms).forEach(function(n){var f=r.uniforms[n].append(e,i);Array.isArray(f)&&(f="["+f.join()+"]"),i.set(a.uniforms,"["+t.id(n)+"]",f)}),Object.keys(r.attributes).forEach(function(t){var n=r.attributes[t].append(e,i),a=e.scopeAttrib(t);Object.keys(new Z).forEach(function(e){i.set(a,"."+e,n[e])})}),r.scopeVAO&&i.set(a.vao,".targetVAO",r.scopeVAO.append(e,i)),n("vert"),n("frag"),0<Object.keys(r.state).length&&(i(f,".dirty=true;"),i.exit(f,".dirty=true;")),i("a1(",e.shared.context,",a0,",e.batchId,");")}function J(e,t,r){var n=t.static[r];if(n&&function(e){if("object"==typeof e&&!b(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(W.isDynamic(e[t[r]]))return!0;return!1}}(n)){var i=e.global,a=Object.keys(n),f=!1,o=!1,u=!1,s=e.global.def("{}");a.forEach(function(t){var r=n[t];if(W.isDynamic(r))"function"==typeof r&&(r=n[t]=W.unbox(r)),t=P(r,null),f=f||t.thisDep,u=u||t.propDep,o=o||t.contextDep;else{switch(i(s,".",t,"="),typeof r){case"number":i(r);break;case"string":i('"',r,'"');break;case"object":Array.isArray(r)&&i("[",r.join(),"]");break;default:i(e.link(r))}i(";")}}),t.dynamic[r]=new W.DynamicVariable(4,{thisDep:f,contextDep:o,propDep:u,ref:s,append:function(e,t){a.forEach(function(r){var i=n[r];W.isDynamic(i)&&(i=e.invoke(t,i),t(s,".",r,"=",i,";"))})}}),delete t.static[r]}}var Z=c.Record,$={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&($.min=32775,$.max=32776);var ee=r.angle_instanced_arrays,te=r.webgl_draw_buffers,ne=r.oes_vertex_array_object,ie={dirty:!0,profile:m.profile},ae={},fe=[],oe={},ue={};y("dither",3024),y("blend.enable",3042),v("blend.color","blendColor",[0,0,0,0]),v("blend.equation","blendEquationSeparate",[32774,32774]),v("blend.func","blendFuncSeparate",[1,0,1,0]),y("depth.enable",2929,!0),v("depth.func","depthFunc",513),v("depth.range","depthRange",[0,1]),v("depth.mask","depthMask",!0),v("colorMask","colorMask",[!0,!0,!0,!0]),y("cull.enable",2884),v("cull.face","cullFace",1029),v("frontFace","frontFace",2305),v("lineWidth","lineWidth",1),y("polygonOffset.enable",32823),v("polygonOffset.offset","polygonOffset",[0,0]),y("sample.alpha",32926),y("sample.enable",32928),v("sample.coverage","sampleCoverage",[1,!1]),y("stencil.enable",2960),v("stencil.mask","stencilMask",-1),v("stencil.func","stencilFunc",[519,0,-1]),v("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),v("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),y("scissor.enable",3089),v("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),v("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var se={gl:e,context:d,strings:t,next:ae,current:ie,draw:p,elements:f,buffer:i,shader:l,attributes:c.state,vao:c,uniforms:s,framebuffer:u,extensions:r,timer:h,isBufferArgs:V},ce={primTypes:re,compareFuncs:_e,blendFuncs:ke,blendEquations:$,stencilOps:Oe,glTypes:K,orientationType:Ee};te&&(ce.backBuffer=[1029],ce.drawBuffer=a(n.maxDrawbuffers,function(e){return 0===e?[0]:a(e,function(e){return 36064+e})}));var le=0;return{next:ae,current:ie,procs:function(){var e=x(),t=e.proc("poll"),i=e.proc("refresh"),f=e.block();t(f),i(f);var o,u=e.shared,s=u.gl,c=u.next,l=u.current;f(l,".dirty=false;"),D(e,t),D(e,i,null,!0),ee&&(o=e.link(ee)),r.oes_vertex_array_object&&i(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<n.maxAttributes;++p){var d=i.def(u.attributes,"[",p,"]"),h=e.cond(d,".buffer");h.then(s,".enableVertexAttribArray(",p,");",s,".bindBuffer(",34962,",",d,".buffer.buffer);",s,".vertexAttribPointer(",p,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(s,".disableVertexAttribArray(",p,");",s,".vertexAttrib4f(",p,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),i(h),ee&&i(o,".vertexAttribDivisorANGLE(",p,",",d,".divisor);")}return i(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(oe).forEach(function(r){var n=oe[r],a=f.def(c,".",r),o=e.block();o("if(",a,"){",s,".enable(",n,")}else{",s,".disable(",n,")}",l,".",r,"=",a,";"),i(o),t("if(",a,"!==",l,".",r,"){",o,"}")}),Object.keys(ue).forEach(function(r){var n,o,u=ue[r],p=ie[r],d=e.block();d(s,".",u,"("),b(p)?(u=p.length,n=e.global.def(c,".",r),o=e.global.def(l,".",r),d(a(u,function(e){return n+"["+e+"]"}),");",a(u,function(e){return o+"["+e+"]="+n+"["+e+"];"}).join("")),t("if(",a(u,function(e){return n+"["+e+"]!=="+o+"["+e+"]"}).join("||"),"){",d,"}")):(n=f.def(c,".",r),o=f.def(l,".",r),d(n,");",l,".",r,"=",n,";"),t("if(",n,"!==",o,"){",d,"}")),i(d)}),e.compile()}(),compile:function(e,t,r,n,i){var a=x();a.stats=a.link(i),Object.keys(t.static).forEach(function(e){J(a,t,e)}),Ae.forEach(function(t){J(a,e,t)});var f=O(e,t,r,n);return function(e,t){var r=e.proc("draw",1);L(e,r),E(e,r,t.context),D(e,r,t.framebuffer),T(e,r,t),S(e,r,t.state),M(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)Q(e,r,t,t.shader.program);else{r(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),a=r.def(n,".id"),f=r.def(i,"[",a,"]");r(e.cond(f).then(f,".call(this,a0);").else(f,"=",i,"[",a,"]=",e.link(function(r){return q(Q,e,t,r,1)}),"(",n,");",f,".call(this,a0);"))}0<Object.keys(t.state).length&&r(e.shared.current,".dirty=true;")}(a,f),X(a,f),function(e,t){function r(e){return e.contextDep&&i||e.propDep}var n=e.proc("batch",2);e.batchId="0",L(e,n);var i=!1,a=!0;Object.keys(t.context).forEach(function(e){i=i||t.context[e].propDep}),i||(E(e,n,t.context),a=!1);var f=!1;if((o=t.framebuffer)?(o.propDep?i=f=!0:o.contextDep&&i&&(f=!0),f||D(e,n,o)):D(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(i=!0),T(e,n,t),S(e,n,t.state,function(e){return!r(e)}),t.profile&&r(t.profile)||M(e,n,t,!1,"a1"),t.contextDep=i,t.needsContext=a,t.needsFramebuffer=f,(a=t.shader.progVar).contextDep&&i||a.propDep)Y(e,n,t,null);else if(a=a.append(e,n),n(e.shared.gl,".useProgram(",a,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var o=e.global.def("{}"),u=(f=n.def(a,".id"),n.def(o,"[",f,"]"));n(e.cond(u).then(u,".call(this,a0,a1);").else(u,"=",o,"[",f,"]=",e.link(function(r){return q(Y,e,t,r,2)}),"(",a,");",u,".call(this,a0,a1);"))}0<Object.keys(t.state).length&&n(e.shared.current,".dirty=true;")}(a,f),R(a.compile(),{destroy:function(){f.shader.program.destroy()}})}}}function M(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}var R=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},H=0,W={DynamicVariable:e,define:function(r,n){return new e(r,t(n+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof e},unbox:function t(r,n){return"function"==typeof r?new e(0,r):"number"==typeof r||"boolean"==typeof r?new e(5,r):Array.isArray(r)?new e(6,r.map(function(e,r){return t(e,n+"["+r+"]")})):r instanceof e?r:void 0},accessor:t},U={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},N="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},q=o();q.zero=o();var Q=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,i=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),i=e.getParameter(36063));var a=!!t.oes_texture_float;if(a){a=e.createTexture(),e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var f=e.createFramebuffer();if(e.bindFramebuffer(36160,f),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var o=q.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,o),e.getError()?a=!1:(e.deleteFramebuffer(f),e.deleteTexture(a),a=1===o[0]),q.freeType(o)}}return o=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(o=e.createTexture(),f=q.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,o),e.texImage2D(34069,0,6408,3,3,0,6408,5121,f),q.freeType(f),e.bindTexture(34067,null),e.deleteTexture(o),o=!e.getError()),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:a,npotTextureCube:o}},G=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},Y=function(e){return Object.keys(e).map(function(t){return e[t]})},X={shape:function(e){for(var t=[];e.length;e=e[0])t.push(e.length);return t},flatten:function(e,t,r,n){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;switch(r=n||q.allocType(r,i),t.length){case 0:break;case 1:for(n=t[0],t=0;t<n;++t)r[t]=e[t];break;case 2:for(n=t[0],t=t[1],a=i=0;a<n;++a)for(var f=e[a],o=0;o<t;++o)r[i++]=f[o];break;case 3:s(e,t[0],t[1],t[2],r,0);break;default:!function e(t,r,n,i,a){for(var f=1,o=n+1;o<r.length;++o)f*=r[o];var u=r[n];if(4==r.length-n){var c=r[n+1],l=r[n+2];for(r=r[n+3],o=0;o<u;++o)s(t[o],c,l,r,i,a),a+=f}else for(o=0;o<u;++o)e(t[o],r,n+1,i,a),a+=f}(e,t,0,r,0)}return r}},J={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},K={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Z={dynamic:35048,stream:35040,static:35044},$=X.flatten,ee=X.shape,te=[];te[5120]=1,te[5122]=2,te[5124]=4,te[5121]=1,te[5123]=2,te[5125]=4,te[5126]=4;var re={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ne=new Float32Array(1),ie=new Uint32Array(ne.buffer),ae=[9984,9986,9985,9987],fe=[0,6409,6410,6407,6408],oe={};oe[6409]=oe[6406]=oe[6402]=1,oe[34041]=oe[6410]=2,oe[6407]=oe[35904]=3,oe[6408]=oe[35906]=4;var ue=g("HTMLCanvasElement"),se=g("OffscreenCanvas"),ce=g("CanvasRenderingContext2D"),le=g("ImageBitmap"),pe=g("HTMLImageElement"),de=g("HTMLVideoElement"),he=Object.keys(J).concat([ue,se,ce,le,pe,de]),me=[];me[5121]=1,me[5126]=4,me[36193]=2,me[5123]=2,me[5125]=4;var be=[];be[32854]=2,be[32855]=2,be[36194]=2,be[34041]=4,be[33776]=.5,be[33777]=.5,be[33778]=1,be[33779]=1,be[35986]=.5,be[35987]=1,be[34798]=1,be[35840]=.5,be[35841]=.25,be[35842]=.5,be[35843]=.25,be[36196]=.5;var ge=[];ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[33189]=2,ge[36168]=1,ge[34041]=4,ge[35907]=4,ge[34836]=16,ge[34842]=8,ge[34843]=6;var ye=function(e,t,r,n,i){function a(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,i.profile&&(this.stats={size:0})}function f(t){var r=t.renderbuffer;e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete c[t.id],n.renderbufferCount--}var o={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var u=[];Object.keys(o).forEach(function(e){u[o[e]]=e});var s=0,c={};return a.prototype.decRef=function(){0>=--this.refCount&&f(this)},i.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(c).forEach(function(t){e+=c[t].stats.size}),e}),{create:function(t,r){function f(t,r){var n=0,a=0,c=32854;if("object"==typeof t&&t?("shape"in t?(n=0|(a=t.shape)[0],a=0|a[1]):("radius"in t&&(n=a=0|t.radius),"width"in t&&(n=0|t.width),"height"in t&&(a=0|t.height)),"format"in t&&(c=o[t.format])):"number"==typeof t?(n=0|t,a="number"==typeof r?0|r:n):t||(n=a=1),n!==s.width||a!==s.height||c!==s.format)return f.width=s.width=n,f.height=s.height=a,s.format=c,e.bindRenderbuffer(36161,s.renderbuffer),e.renderbufferStorage(36161,c,n,a),i.profile&&(s.stats.size=ge[s.format]*s.width*s.height),f.format=u[s.format],f}var s=new a(e.createRenderbuffer());return c[s.id]=s,n.renderbufferCount++,f(t,r),f.resize=function(t,r){var n=0|t,a=0|r||n;return n===s.width&&a===s.height?f:(f.width=s.width=n,f.height=s.height=a,e.bindRenderbuffer(36161,s.renderbuffer),e.renderbufferStorage(36161,s.format,n,a),i.profile&&(s.stats.size=ge[s.format]*s.width*s.height),f)},f._reglType="renderbuffer",f._renderbuffer=s,i.profile&&(f.stats=s.stats),f.destroy=function(){s.decRef()},f},clear:function(){Y(c).forEach(f)},restore:function(){Y(c).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)}),e.bindRenderbuffer(36161,null)}}},ve=[];ve[6408]=4,ve[6407]=3;var xe=[];xe[5121]=1,xe[5126]=4,xe[36193]=2;var we=["x","y","z","w"],Ae="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),ke={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},_e={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Oe={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ee={cw:2304,ccw:2305},De=new B(!1,!1,!1,function(){});return function(e){function t(){if(0===J.length)A&&A.update(),ee=null;else{ee=U.next(t),l();for(var e=J.length-1;0<=e;--e){var r=J[e];r&&r(C,null,0)}b.flush(),A&&A.update()}}function r(){!ee&&0<J.length&&(ee=U.next(t))}function n(){ee&&(U.cancel(t),ee=null)}function a(e){e.preventDefault(),n(),K.forEach(function(e){e()})}function f(e){b.getError(),y.restore(),I.restore(),F.restore(),P.restore(),H.restore(),q.restore(),z.restore(),A&&A.restore(),G.procs.refresh(),r(),Z.forEach(function(e){e()})}function o(e){function t(e,t){var r={},n={};return Object.keys(e).forEach(function(i){var a=e[i];if(W.isDynamic(a))n[i]=W.unbox(a,i);else{if(t&&Array.isArray(a))for(var f=0;f<a.length;++f)if(W.isDynamic(a[f]))return void(n[i]=W.unbox(a,i));r[i]=a}}),{dynamic:n,static:r}}var r=t(e.context||{},!0),n=t(e.uniforms||{},!0),i=t(e.attributes||{},!1);e=t(function(e){function t(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}var r=R({},e);return delete r.uniforms,delete r.attributes,delete r.context,delete r.vao,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),"vao"in e&&(r.vao=e.vao),r}(e),!1);var a={gpuTime:0,cpuTime:0,count:0},f=G.compile(e,i,n,r,a),o=f.draw,u=f.batch,s=f.scope,c=[];return R(function(e,t){var r;if("function"==typeof e)return s.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(r=0;r<e;++r)s.call(this,null,t,r);else{if(!Array.isArray(e))return s.call(this,e,t,0);for(r=0;r<e.length;++r)s.call(this,e[r],t,r)}else if("number"==typeof e){if(0<e)return u.call(this,function(e){for(;c.length<e;)c.push(null);return c}(0|e),0|e)}else{if(!Array.isArray(e))return o.call(this,e);if(e.length)return u.call(this,e,e.length)}},{stats:a,destroy:function(){f.destroy()}})}function u(e,t){var r=0;G.procs.poll();var n=t.color;n&&(b.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=16384),"depth"in t&&(b.clearDepth(+t.depth),r|=256),"stencil"in t&&(b.clearStencil(0|t.stencil),r|=1024),b.clear(r)}function s(e){return J.push(e),r(),{cancel:function(){var t=M(J,e);J[t]=function e(){var t=M(J,e);J[t]=J[J.length-1],--J.length,0>=J.length&&n()}}}}function c(){var e=Y.viewport,t=Y.scissor_box;e[0]=e[1]=t[0]=t[1]=0,C.viewportWidth=C.framebufferWidth=C.drawingBufferWidth=e[2]=t[2]=b.drawingBufferWidth,C.viewportHeight=C.framebufferHeight=C.drawingBufferHeight=e[3]=t[3]=b.drawingBufferHeight}function l(){C.tick+=1,C.time=m(),c(),G.procs.poll()}function p(){P.refresh(),c(),G.procs.refresh(),A&&A.update()}function m(){return(N()-k)/1e3}if(!(e=i(e)))return null;var b=e.gl,g=b.getContextAttributes();b.isContextLost();var y=function(e,t){function r(t){var r;t=t.toLowerCase();try{r=n[t]=e.getExtension(t)}catch(e){}return!!r}for(var n={},i=0;i<t.extensions.length;++i){var a=t.extensions[i];if(!r(a))return t.onDestroy(),t.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!r(e))throw Error("(regl): error restoring extension "+e)})}}}(b,e);if(!y)return null;var v=function(){var e={"":0},t=[""];return{id:function(r){var n=e[r];return n||(n=e[r]=t.length,t.push(r),n)},str:function(e){return t[e]}}}(),x={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},w=y.extensions,A=function(e,t){function r(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function n(e,t,n){var i=f.pop()||new r;i.startQueryIndex=e,i.endQueryIndex=t,i.sum=0,i.stats=n,o.push(i)}if(!t.ext_disjoint_timer_query)return null;var i=[],a=[],f=[],o=[],u=[],s=[];return{beginQuery:function(e){var r=i.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),a.push(r),n(a.length-1,a.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:n,update:function(){var e,r;if(0!==(e=a.length)){s.length=Math.max(s.length,e+1),u.length=Math.max(u.length,e+1),u[0]=0;var n=s[0]=0;for(r=e=0;r<a.length;++r){var c=a[r];t.ext_disjoint_timer_query.getQueryObjectEXT(c,34919)?(n+=t.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),i.push(c)):a[e++]=c,u[r+1]=n,s[r+1]=e}for(a.length=e,r=e=0;r<o.length;++r){var l=(n=o[r]).startQueryIndex;c=n.endQueryIndex,n.sum+=u[c]-u[l],l=s[l],(c=s[c])===l?(n.stats.gpuTime+=n.sum/1e6,f.push(n)):(n.startQueryIndex=l,n.endQueryIndex=c,o[e++]=n)}o.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){i.push.apply(i,a);for(var e=0;e<i.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(i[e]);a.length=0,i.length=0},restore:function(){a.length=0,i.length=0}}}(0,w),k=N(),E=b.drawingBufferWidth,j=b.drawingBufferHeight,C={tick:0,time:0,viewportWidth:E,viewportHeight:j,framebufferWidth:E,framebufferHeight:j,drawingBufferWidth:E,drawingBufferHeight:j,pixelRatio:e.pixelRatio},V=(E={elements:null,primitive:4,count:-1,offset:0,instances:-1},Q(b,w)),F=d(b,x,e,function(e){return z.destroyBuffer(e)}),B=h(b,w,F,x),z=D(b,w,V,x,F,B,E),I=T(b,v,x,e),P=_(b,w,V,function(){G.procs.poll()},C,x,e),H=ye(b,w,0,x,e),q=O(b,w,V,P,H,x),G=L(b,v,w,V,F,B,0,q,{},z,I,E,C,A,e),Y=(v=S(b,q,G.procs.poll,C),G.next),X=b.canvas,J=[],K=[],Z=[],$=[e.onDestroy],ee=null;X&&(X.addEventListener("webglcontextlost",a,!1),X.addEventListener("webglcontextrestored",f,!1));var te=q.setFBO=o({framebuffer:W.define.call(null,1,"framebuffer")});return p(),g=R(o,{clear:function(e){if("framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;6>t;++t)te(R({framebuffer:e.framebuffer.faces[t]},e),u);else te(e,u);else u(0,e)},prop:W.define.bind(null,1),context:W.define.bind(null,2),this:W.define.bind(null,3),draw:o({}),buffer:function(e){return F.create(e,34962,!1,!1)},elements:function(e){return B.create(e,!1)},texture:P.create2D,cube:P.createCube,renderbuffer:H.create,framebuffer:q.create,framebufferCube:q.createCube,vao:z.createVAO,attributes:g,frame:s,on:function(e,t){var r;switch(e){case"frame":return s(t);case"lost":r=K;break;case"restore":r=Z;break;case"destroy":r=$}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t){r[e]=r[r.length-1],r.pop();break}}}},limits:V,hasExtension:function(e){return 0<=V.extensions.indexOf(e.toLowerCase())},read:v,destroy:function(){J.length=0,n(),X&&(X.removeEventListener("webglcontextlost",a),X.removeEventListener("webglcontextrestored",f)),I.clear(),q.clear(),H.clear(),z.clear(),P.clear(),B.clear(),F.clear(),A&&A.clear(),$.forEach(function(e){e()})},_gl:b,_refresh:p,poll:function(){l(),A&&A.update()},now:m,stats:x}),e.onDone(null,g),g}});

},{}],28:[function(require,module,exports){
var alea=require("./lib/alea"),xor128=require("./lib/xor128"),xorwow=require("./lib/xorwow"),xorshift7=require("./lib/xorshift7"),xor4096=require("./lib/xor4096"),tychei=require("./lib/tychei"),sr=require("./seedrandom");sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei,module.exports=sr;

},{"./lib/alea":29,"./lib/tychei":30,"./lib/xor128":31,"./lib/xor4096":32,"./lib/xorshift7":33,"./lib/xorwow":34,"./seedrandom":35}],29:[function(require,module,exports){
!function(n,t,e){function s(n){var t,e=this,s=(t=4022871197,function(n){n=n.toString();for(var e=0;e<n.length;e++){var s=.02519603282416938*(t+=n.charCodeAt(e));s-=t=s>>>0,t=(s*=t)>>>0,t+=4294967296*(s-=t)}return 2.3283064365386963e-10*(t>>>0)});e.next=function(){var n=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=n-(e.c=0|n)},e.c=1,e.s0=s(" "),e.s1=s(" "),e.s2=s(" "),e.s0-=s(n),e.s0<0&&(e.s0+=1),e.s1-=s(n),e.s1<0&&(e.s1+=1),e.s2-=s(n),e.s2<0&&(e.s2+=1),s=null}function r(n,t){return t.c=n.c,t.s0=n.s0,t.s1=n.s1,t.s2=n.s2,t}function o(n,t){var e=new s(n),o=t&&t.state,u=e.next;return u.int32=function(){return 4294967296*e.next()|0},u.double=function(){return u()+1.1102230246251565e-16*(2097152*u()|0)},u.quick=u,o&&("object"==typeof o&&r(o,e),u.state=function(){return r(e,{})}),u}t&&t.exports?t.exports=o:e&&e.amd?e(function(){return o}):this.alea=o}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],30:[function(require,module,exports){
!function(t,n,e){function o(t){var n=this,e="";n.next=function(){var t=n.b,e=n.c,o=n.d,r=n.a;return t=t<<25^t>>>7^e,e=e-o|0,o=o<<24^o>>>8^r,r=r-t|0,n.b=t=t<<20^t>>>12^e,n.c=e=e-o|0,n.d=o<<16^e>>>16^r,n.a=r-t|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,t===Math.floor(t)?(n.a=t/4294967296|0,n.b=0|t):e+=t;for(var o=0;o<e.length+20;o++)n.b^=0|e.charCodeAt(o),n.next()}function r(t,n){return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n}function u(t,n){var e=new o(t),u=n&&n.state,c=function(){return(e.next()>>>0)/4294967296};return c.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},c.int32=e.next,c.quick=c,u&&("object"==typeof u&&r(u,e),c.state=function(){return r(e,{})}),c}n&&n.exports?n.exports=u:e&&e.amd?e(function(){return u}):this.tychei=u}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],31:[function(require,module,exports){
!function(t,n,e){function o(t){var n=this,e="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var t=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^t^t>>>8},t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),n.next()}function r(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n}function u(t,n){var e=new o(t),u=n&&n.state,i=function(){return(e.next()>>>0)/4294967296};return i.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=e.next,i.quick=i,u&&("object"==typeof u&&r(u,e),i.state=function(){return r(e,{})}),i}n&&n.exports?n.exports=u:e&&e.amd?e(function(){return u}):this.xor128=u}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],32:[function(require,module,exports){
!function(n,t,e){function r(n){var t=this;t.next=function(){var n,e,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,e=i[o+34&127],n=i[o=o+1&127],e^=e<<13,n^=n<<17,e^=e>>>15,n^=n>>>12,e=i[o]=e^n,t.i=o,e+(r^r>>>16)|0},function(n,t){var e,r,i,o,u,f=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),i=0,o=-32;o<c;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(u=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(u=u+1640531527|0,i=0==(e=f[127&o]^=r+u)?i+1:0);for(i>=128&&(f[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=f[i+34&127],e=f[i=i+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,f[i]=r^e;n.w=u,n.X=f,n.i=i}(t,n)}function i(n,t){return t.i=n.i,t.w=n.w,t.X=n.X.slice(),t}function o(n,t){null==n&&(n=+new Date);var e=new r(n),o=t&&t.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},u.int32=e.next,u.quick=u,o&&(o.X&&i(o,e),u.state=function(){return i(e,{})}),u}t&&t.exports?t.exports=o:e&&e.amd?e(function(){return o}):this.xor4096=o}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],33:[function(require,module,exports){
!function(n,t,e){function r(n){var t=this;t.next=function(){var n,e,r=t.x,i=t.i;return n=r[i],e=(n^=n>>>7)^n<<24,e^=(n=r[i+1&7])^n>>>10,e^=(n=r[i+3&7])^n>>>3,e^=(n=r[i+4&7])^n<<7,n=r[i+7&7],e^=(n^=n<<13)^n<<9,r[i]=e,t.i=i+1&7,e},function(n,t){var e,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,e=0;e<t.length;++e)r[7&e]=r[7&e]<<15^t.charCodeAt(e)+r[e+1&7]<<13;for(;r.length<8;)r.push(0);for(e=0;e<8&&0===r[e];++e);for(8==e?r[7]=-1:r[e],n.x=r,n.i=0,e=256;e>0;--e)n.next()}(t,n)}function i(n,t){return t.x=n.x.slice(),t.i=n.i,t}function o(n,t){null==n&&(n=+new Date);var e=new r(n),o=t&&t.state,u=function(){return(e.next()>>>0)/4294967296};return u.double=function(){do{var n=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===n);return n},u.int32=e.next,u.quick=u,o&&(o.x&&i(o,e),u.state=function(){return i(e,{})}),u}t&&t.exports?t.exports=o:e&&e.amd?e(function(){return o}):this.xorshift7=o}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],34:[function(require,module,exports){
!function(t,n,e){function o(t){var n=this,e="";n.next=function(){var t=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^t^t<<1)|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,t===(0|t)?n.x=t:e+=t;for(var o=0;o<e.length+64;o++)n.x^=0|e.charCodeAt(o),o==e.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function r(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n.v=t.v,n.d=t.d,n}function u(t,n){var e=new o(t),u=n&&n.state,x=function(){return(e.next()>>>0)/4294967296};return x.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},x.int32=e.next,x.quick=x,u&&("object"==typeof u&&r(u,e),x.state=function(){return r(e,{})}),x}n&&n.exports?n.exports=u:e&&e.amd?e(function(){return u}):this.xorwow=u}(0,"object"==typeof module&&module,"function"==typeof define&&define);

},{}],35:[function(require,module,exports){
!function(n,r){var t,e=this,o=256,i=6,u="random",f=r.pow(o,i),a=r.pow(2,52),c=2*a,s=o-1;function l(s,l,h){var m=[],v=g(function n(r,t){var e,o=[],i=typeof r;if(t&&"object"==i)for(e in r)try{o.push(n(r[e],t-1))}catch(n){}return o.length?o:"string"==i?r:r+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[s,y(n)]:null==s?function(){try{var r;return t&&(r=t.randomBytes)?r=r(o):(r=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(r)),y(r)}catch(r){var i=e.navigator,u=i&&i.plugins;return[+new Date,e,u,e.screen,y(n)]}}():s,3),m),j=new p(m),S=function(){for(var n=j.g(i),r=f,t=0;n<a;)n=(n+t)*o,r*=o,t=j.g(1);for(;n>=c;)n/=2,r/=2,t>>>=1;return(n+t)/r};return S.int32=function(){return 0|j.g(4)},S.quick=function(){return j.g(4)/4294967296},S.double=S,g(y(j.S),n),(l.pass||h||function(n,t,e,o){return o&&(o.S&&d(o,j),n.state=function(){return d(j,{})}),e?(r[u]=n,t):n})(S,v,"global"in l?l.global:this==r,l.state)}function p(n){var r,t=n.length,e=this,i=0,u=e.i=e.j=0,f=e.S=[];for(t||(n=[t++]);i<o;)f[i]=i++;for(i=0;i<o;i++)f[i]=f[u=s&u+n[i%t]+(r=f[i])],f[u]=r;(e.g=function(n){for(var r,t=0,i=e.i,u=e.j,f=e.S;n--;)r=f[i=s&i+1],t=t*o+f[s&(f[i]=f[u=s&u+r])+(f[u]=r)];return e.i=i,e.j=u,t})(o)}function d(n,r){return r.i=n.i,r.j=n.j,r.S=n.S.slice(),r}function g(n,r){for(var t,e=n+"",o=0;o<e.length;)r[s&o]=s&(t^=19*r[s&o])+e.charCodeAt(o++);return y(r)}function y(n){return String.fromCharCode.apply(0,n)}if(r["seed"+u]=l,g(r.random(),n),"object"==typeof module&&module.exports){module.exports=l;try{t=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd&&define(function(){return l})}([],Math);

},{"crypto":15}],36:[function(require,module,exports){
var EventEmitter=require("events").EventEmitter,inherits=require("util").inherits;function Shader(e){EventEmitter.call(this),e=e||{},this.vertex=e.vertex||"",this.fragment=e.fragment||"",this.version=0,this.setMaxListeners(1e4)}inherits(Shader,EventEmitter),module.exports=Shader;

},{"events":16,"util":41}],37:[function(require,module,exports){
var Shader=require("./lib/Shader");function createShader(e){return new Shader(e=e||{})}module.exports=createShader;

},{"./lib/Shader":36}],38:[function(require,module,exports){
(function (setImmediate,clearImmediate){(function (){
var nextTick=require("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;function Timeout(e,t){this._id=e,this._clearFn=t}exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(e){e.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},exports.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},exports._unrefActive=exports.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(e){var t=nextImmediateId++,i=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[t]=!0,nextTick(function(){immediateIds[t]&&(i?e.apply(null,i):e.call(null),exports.clearImmediate(t))}),t},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(e){delete immediateIds[e]};

}).call(this)}).call(this,require("timers").setImmediate,require("timers").clearImmediate)
},{"process/browser.js":26,"timers":38}],39:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};

},{}],40:[function(require,module,exports){
module.exports=function(o){return o&&"object"==typeof o&&"function"==typeof o.copy&&"function"==typeof o.fill&&"function"==typeof o.readUInt8};

},{}],41:[function(require,module,exports){
(function (process,global){(function (){
var formatRegExp=/%[sdj%]/g;exports.format=function(e){if(!isString(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(inspect(arguments[t]));return r.join(" ")}t=1;for(var n=arguments,i=n.length,o=String(e).replace(formatRegExp,function(e){if("%%"===e)return"%";if(t>=i)return e;switch(e){case"%s":return String(n[t++]);case"%d":return Number(n[t++]);case"%j":try{return JSON.stringify(n[t++])}catch(e){return"[Circular]"}default:return e}}),s=n[t];t<i;s=n[++t])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o},exports.deprecate=function(e,r){if(isUndefined(global.process))return function(){return exports.deprecate(e,r).apply(this,arguments)};if(!0===process.noDeprecation)return e;var t=!1;return function(){if(!t){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),t=!0}return e.apply(this,arguments)}};var debugEnviron,debugs={};function inspect(e,r){var t={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),isBoolean(r)?t.showHidden=r:r&&exports._extend(t,r),isUndefined(t.showHidden)&&(t.showHidden=!1),isUndefined(t.depth)&&(t.depth=2),isUndefined(t.colors)&&(t.colors=!1),isUndefined(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=stylizeWithColor),formatValue(t,e,t.depth)}function stylizeWithColor(e,r){var t=inspect.styles[r];return t?"["+inspect.colors[t][0]+"m"+e+"["+inspect.colors[t][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function formatValue(e,r,t){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==exports.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(t,e);return isString(n)||(n=formatValue(e,n,t)),n}var i=formatPrimitive(e,r);if(i)return i;var o=Object.keys(r),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(r)),isError(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(r);if(0===o.length){if(isFunction(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var c,a="",l=!1,p=["{","}"];(isArray(r)&&(l=!0,p=["[","]"]),isFunction(r))&&(a=" [Function"+(r.name?": "+r.name:"")+"]");return isRegExp(r)&&(a=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(a=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(a=" "+formatError(r)),0!==o.length||l&&0!=r.length?t<0?isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),c=l?formatArray(e,r,t,s,o):o.map(function(n){return formatProperty(e,r,t,s,n,l)}),e.seen.pop(),reduceToSingleString(c,a,p)):p[0]+a+p[1]}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,t,n,i){for(var o=[],s=0,u=r.length;s<u;++s)hasOwnProperty(r,String(s))?o.push(formatProperty(e,r,t,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(e,r,t,n,i,!0))}),o}function formatProperty(e,r,t,n,i,o){var s,u,c;if((c=Object.getOwnPropertyDescriptor(r,i)||{value:r[i]}).get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(s="["+i+"]"),u||(e.seen.indexOf(c.value)<0?(u=isNull(t)?formatValue(e,c.value,null):formatValue(e,c.value,t-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n")):u=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return u;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+u}function reduceToSingleString(e,r,t){return e.reduce(function(e,r){return 0,r.indexOf("\n")>=0&&0,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}exports.debuglog=function(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){var r=process.pid;debugs[e]=function(){var t=exports.format.apply(exports,arguments);console.error("%s %d: %s",e,r,t)}}else debugs[e]=function(){};return debugs[e]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var e=new Date,r=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],r].join(" ")}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(e,r){if(!r||!isObject(r))return e;for(var t=Object.keys(r),n=t.length;n--;)e[t[n]]=r[t[n]];return e};

}).call(this)}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./support/isBuffer":40,"_process":26,"inherits":39}],42:[function(require,module,exports){
const createREGL=require("regl");module.exports=function(e){var t={};e&&Object.keys(e).forEach(function(o){t[o]=e[o]});var o=t.pixelRatio||window.devicePixelRatio;t.pixelRatio=o,window.addEventListener("resize",function(){},!1),delete t.gl,delete t.container;var n=createREGL(t),i=[],r={x:0,y:0,width:0,height:0};function c(e){var t;console.log(e),"object"==typeof e&&e?"function"==typeof e.getBoundingClientRect?t=e:e.element&&(t=e.element):"string"==typeof e&&(t=document.querySelector(t)),t||(t=document.body);var o={tick:0,element:t,callbacks:[]};function r(e){return e}function c(e){return"viewport"in e&&(e.viewport=r(e.viewport)),"scissor"in e&&("box"in e&&(e.scissor.box=r(e.scissor.box)),"enable"in e&&(e.scissor.box=!0)),n.apply(n,Array.prototype.slice.call(arguments))}return i.push(o),Object.keys(n).forEach(function(e){c[e]=n[e]}),c.frame=function(e){return o.callbacks.push(e),{cancel:function(){o.callbacks.splice(o.callbacks.indexOf(e),1)}}},c.destroy=function(){i.splice(i.indexOf(o),1)},c.container=t,c}c.destroy=function(){n.destroy()},c.regl=n;var l=n({context:{tick:n.prop("subcontext.tick")},viewport:n.prop("viewbox"),scissor:{enable:!0,box:n.prop("scissorbox")}});function s(e,t){for(var o=t.subcontext.callbacks,n=0;n<o.length;++n)o[n](e)}return n.frame(function(e){n.clear({color:[0,0,0,0]});for(var t=window.innerWidth,o=window.innerHeight,c=e.pixelRatio,a=0;a<i.length;++a){var u=i[a],f=u.element.getBoundingClientRect();f.right<0||f.bottom<0||t<f.left||o<f.top||(r.x=c*f.left,r.y=c*(o-f.bottom),r.width=c*(f.right-f.left),r.height=c*(f.bottom-f.top),l({subcontext:u,viewbox:r,scissorbox:r},s),u.tick+=1)}}),c};

},{"regl":27}],43:[function(require,module,exports){
const glslify=require("glslify"),path=require("path");module.exports=require("shader-reload")({vertex:glslify(['\n// boring "pass-through" vertex shader\nprecision mediump float;\n#define GLSLIFY 1\nattribute vec2 position;\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}']),fragment:glslify(["precision highp float;\n#define GLSLIFY 1\nvarying vec2 uv;\nuniform float time;\nuniform float targetAspect;\nuniform vec2 resolution;\nuniform vec2 videoResolution;\nuniform vec2 scaledVideoResolution;\nuniform vec2 faceCenter;\nuniform vec2 leftEye;\nuniform vec2 rightEye;\nuniform sampler2D camTex;\nuniform sampler2D maskTex;\nuniform sampler2D glacierTex;\nuniform sampler2D previousTex;\nvec2 pixel = 1.0 / resolution;\n\n#define PI 3.1415926538\n#define TAU 6.283185307\n\nvec3 getCam(vec2 pos) {\n  float videoAspect = videoResolution.x / videoResolution.y;\n  vec2 uvA = vec2(pos.x * targetAspect / videoAspect, pos.y);\n  vec2 webcamCoord = (uvA) / 2.0 + vec2(0.5);\n  vec2 flipwcord = vec2(1.) - webcamCoord;\n  return texture2D(camTex, flipwcord).rgb;\n}\n\nvec3 getGlacier(vec2 pos) {\n  vec2 backCoord = (pos / 2.0) + vec2(0.5);\n  vec2 flipwcord = vec2(1.) - backCoord;\n  return texture2D(glacierTex, flipwcord).rgb;\n}\n\nvec3 getPrevious(vec2 pos) {\n  vec2 backCoord = (pos / 2.0) + vec2(0.5);\n  return texture2D(previousTex, backCoord).rgb;\n}\n\n// Access Facial Feature Masks\n\nfloat getFace(vec2 pos) {\n  float videoAspect = videoResolution.x / videoResolution.y;\n  vec2 uvA = vec2(pos.x * targetAspect / videoAspect, pos.y);\n  vec2 webcamCoord = (uvA) / 2.0 + vec2(0.5);\n  vec2 flipwcord = vec2(1.) - webcamCoord;\n  return texture2D(maskTex, flipwcord).b;\n}\n\nfloat getEye(vec2 pos) {\n  float videoAspect = videoResolution.x / videoResolution.y;\n  vec2 uvA = vec2(pos.x * targetAspect / videoAspect, pos.y);\n  vec2 webcamCoord = (uvA) / 2.0 + vec2(0.5);\n  vec2 flipwcord = vec2(1.) - webcamCoord;\n  return texture2D(maskTex, flipwcord).g;\n}\n\nfloat getMouth(vec2 pos) {\n  float videoAspect = videoResolution.x / videoResolution.y;\n  vec2 uvA = vec2(pos.x * targetAspect / videoAspect, pos.y);\n  vec2 webcamCoord = (uvA) / 2.0 + vec2(0.5);\n  vec2 flipwcord = vec2(1.) - webcamCoord;\n  return texture2D(maskTex, flipwcord).r;\n}\n\n// SPACER\nvec2 rotate(vec2 v, float a) {\n  float s = sin(a);\n  float c = cos(a);\n  mat2 m = mat2(c, -s, s, c);\n  return m * v;\n}\n// SPACER\n\nfloat map(float value, float min1, float max1, float min2, float max2) {\n  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\n// SPACER\nfloat rand(float n) { return fract(sin(n) * 43758.5453123); }\n\n// 1D, 2D, 3D Simplex Noise\nfloat noise(float p) {\n  float fl = floor(p);\n  float fc = fract(p);\n  return mix(rand(fl), rand(fl + 1.0), fc);\n}\n\n// INTERNAL\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n// INTERNAL\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n// INTERNAL\nvec3 permute(vec3 x) { return mod289(((x * 34.0) + 1.0) * x); }\n\n// INTERNAL\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n// INTERNAL\nvec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\n// INTERNAL\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n// Use these parameters to fiddle with settings\nfloat step = 1.0;\n\nfloat intensity(in vec3 color){\n  return sqrt((color.x*color.x)+(color.y*color.y)+(color.z*color.z));\n}\n\n// Basic sobel filter implementation\n// Jeroen Baert - jeroen.baert@cs.kuleuven.be\nvec3 sobel(float stepx, float stepy, vec2 center){\n    // get samples around pixel\n    float tleft = intensity(getCam(center + vec2(-stepx,stepy)));\n    float left = intensity(getCam(center + vec2(-stepx,0)));\n    float bleft = intensity(getCam(center + vec2(-stepx,-stepy)));\n    float top = intensity(getCam(center + vec2(0,stepy)));\n    float bottom = intensity(getCam(center + vec2(0,-stepy)));\n    float tright = intensity(getCam(center + vec2(stepx,stepy)));\n    float right = intensity(getCam(center + vec2(stepx,0)));\n    float bright = intensity(getCam(center + vec2(stepx,-stepy)));\n \n  // Sobel masks (see http://en.wikipedia.org/wiki/Sobel_operator)\n  //        1 0 -1     -1 -2 -1\n  //    X = 2 0 -2  Y = 0  0  0\n  //        1 0 -1      1  2  1\n  \n  // You could also use Scharr operator:\n  //        3 0 -3        3 10   3\n  //    X = 10 0 -10  Y = 0  0   0\n  //        3 0 -3        -3 -10 -3\n \n    float x = tleft + 2.0*left + bleft - tright - 2.0*right - bright;\n    float y = -tleft - 2.0*top - tright + bleft + 2.0 * bottom + bright;\n    float color = sqrt((x*x) + (y*y));\n    return vec3(color,color,color);\n }\n\nvoid main() {\n\n  vec3 cam = getCam(uv);\n  vec3 glac = getGlacier(uv);\n\n  float face = getFace(uv);\n  float eye = getEye(uv);\n  float mouth = getMouth(uv);\n\n  vec3 color = getGlacier(uv);\n\n  //vec2 ed = 3. * pixel;\n  //float edge = dot((getCam(uv) * 4. - getCam(uv + vec2(ed.x, 0)) -\n  //                  getCam(uv + vec2(-ed.x, 0)) - getCam(uv + vec2(0., ed.y)) -\n  //                  getCam(uv + vec2(0, -ed.y)))\n  //                     .rgb,\n  //                 vec3(0.333));\n\n  //cam = vec3(0.7, .8, 1.0) * dot(cam, vec3(0.333));\n\n  //color = (edge + 0.1) * cam * 15.;\n  vec3 edge = sobel(step/resolution.x, step/resolution.y, uv);\n  edge = (edge + 0.1) * cam * 15.;\n\n  if (face < 0.2) {\n    color = mix(color, cam, 0.8);\n  }\n\n  if (face > 0.2) {\n    //cam = vec3(0.7, .8, 1.0) * dot(cam, vec3(0.333));\n\n    //color = (edge + 0.1) * cam * 15.;\n    //color = mix(color, cam, 0.5);\n    color = mix(color, glac, 0.8);\n  }\n\n  if (eye > 0.3) {\n    color = getGlacier(uv);\n  }\n  gl_FragColor = vec4(color, 1);\n}"])});

},{"glslify":18,"path":25,"shader-reload":37}],44:[function(require,module,exports){
let hull=require("hull.js"),canvas=document.getElementById("paint");function averagePoints(e){let t=0,l=0;for(let r=0;r<e.length;r++)t+=e[r][0],l+=e[r][1];return[t/=e.length,l/=e.length]}function drawShape(e){ctx.beginPath();for(let t=0;t<e.length;t++){const l=e[t][0],r=e[t][1];0==t?ctx.moveTo(l,r):ctx.lineTo(l,r)}ctx.closePath(),ctx.stroke(),ctx.fill()}function paintFace(e){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.lineCap="round";let t=e.silhouette,l=hull(t,1e3);ctx.fillStyle="#008",ctx.strokeStyle="#004",ctx.lineWidth=2,drawShape(l),ctx.lineWidth=0,ctx.strokeStyle="rgba(1, 1, 1, 0)";let r=[...e.leftEyebrowLower,...e.leftEyebrowUpper],a=[...e.rightEyebrowLower,...e.rightEyebrowUpper];ctx.fillStyle="#048",drawShape(hull(r,20)),drawShape(hull(a,20));let h=[...e.leftEyeLower2,...e.leftEyeUpper2],i=[...e.rightEyeLower2,...e.rightEyeUpper2];ctx.fillStyle="#088",drawShape(hull(h,1e3)),drawShape(hull(i,1e3));let n=[...e.leftEyeLower1,...e.leftEyeUpper1],o=[...e.rightEyeLower1,...e.rightEyeUpper1];ctx.fillStyle="#0C8",drawShape(hull(n,1e3)),drawShape(hull(o,1e3));let p=[...e.leftEyeLower0,...e.leftEyeUpper0],c=[...e.rightEyeLower0,...e.rightEyeUpper0];ctx.fillStyle="#0f8",drawShape(hull(p,1e3)),drawShape(hull(c,1e3)),window.leftEye=averagePoints(p),window.rightEye=averagePoints(c);let w=[...e.lipsUpperOuter,...e.lipsLowerOuter];ctx.fillStyle="#808",drawShape(hull(w,1e3));let y=[...e.lipsUpperInner,...e.lipsLowerInner];ctx.fillStyle="#F08",drawShape(hull(y,1e3));let s=[...e.noseBottom,...e.noseTip,...e.noseLeftCorner,...e.midwayBetweenEyes,...e.noseRightCorner],x=hull(s,1e3);return ctx.fillStyle="#00F",ctx.strokeStyle="#00C",ctx.lineWidth=2,drawShape(x),ctx}ctx=canvas.getContext("2d"),ctx.translate(canvas.width,0),ctx.scale(-1,1),module.exports={paintFace:paintFace};

},{"hull.js":22}],45:[function(require,module,exports){
let model,keypoints,facemesh=require("@tensorflow-models/facemesh"),tf=require("@tensorflow/tfjs-core"),tfbe=require("@tensorflow/tfjs-backend-cpu"),video=null,facefilters=!1;async function loadModel(){model=await facemesh.load({maxFaces:1})}let dirty=!1;async function predictionLoop(){if(!model||!video)return window.requestAnimationFrame(predictionLoop),null;const e=await model.estimateFaces(video);if(e.length>0)for(let t=0;t<e.length;t++)keypoints=e[t].annotations,dirty=!0;window.requestAnimationFrame(predictionLoop)}function getKeyPoints(){return keypoints}function setupWebcam(e){const t=e.regl1,o=e.regl2;window.onload=function(){video=document.getElementById("video");let i=document.getElementById("start"),n=document.getElementById("paint"),d=document.getElementById("target1"),a=document.getElementById("target2");function c(i){"srcObject"in video?video.srcObject=i:video.src=window.URL&&window.URL.createObjectURL(i),video.onloadedmetadata=function(){const i=t.texture(video),a=o.texture(video),{videoWidth:c,videoHeight:r}=video;var s=r;n.height=s,n.width=1.33*s,d.height=s,d.width=1.33*s,predictionLoop(),t.frame(()=>i.subimage(video)),o.frame(()=>a.subimage(video)),e.done(i,a,{videoWidth:c,videoHeight:r,getKeyPoints:getKeyPoints})}}i.onclick=function(){facefilters?(d.hidden=!0,a.hidden=!0,facefilters=!1):(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(c).catch(e=>{console.log("initial gum failed")}),facefilters=!0,d.hidden=!1,a.hidden=!1)},video.onresize=function(){},video.addEventListener("canplay",function(e){video.play()},!1)}}loadModel(),module.exports={setupWebcam:setupWebcam};

},{"@tensorflow-models/facemesh":6,"@tensorflow/tfjs-backend-cpu":11,"@tensorflow/tfjs-core":13}]},{},[1]);
